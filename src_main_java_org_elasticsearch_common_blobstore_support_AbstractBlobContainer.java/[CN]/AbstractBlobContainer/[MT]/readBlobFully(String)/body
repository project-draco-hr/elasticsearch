{
  final CountDownLatch latch=new CountDownLatch(1);
  final AtomicReference<Throwable> failure=new AtomicReference<>();
  final ByteArrayOutputStream bos=new ByteArrayOutputStream();
  readBlob(blobName,new ReadBlobListener(){
    @Override public void onPartial(    byte[] data,    int offset,    int size){
      bos.write(data,offset,size);
    }
    @Override public void onCompleted(){
      latch.countDown();
    }
    @Override public void onFailure(    Throwable t){
      failure.set(t);
      latch.countDown();
    }
  }
);
  try {
    latch.await();
  }
 catch (  InterruptedException e) {
    throw new InterruptedIOException("Interrupted while waiting to read [" + blobName + "]");
  }
  if (failure.get() != null) {
    if (failure.get() instanceof IOException) {
      throw (IOException)failure.get();
    }
 else {
      throw new IOException("Failed to get [" + blobName + "]",failure.get());
    }
  }
  return bos.toByteArray();
}
