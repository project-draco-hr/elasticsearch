{
  if (shard == null) {
    onFirstPhaseResult(shardIndex,null,null,shardIt,new NoShardAvailableActionException(shardIt.shardId()));
  }
 else {
    final DiscoveryNode node=nodes.get(shard.currentNodeId());
    if (node == null) {
      onFirstPhaseResult(shardIndex,shard,null,shardIt,new NoShardAvailableActionException(shardIt.shardId()));
    }
 else {
      String[] filteringAliases=clusterState.metaData().filteringAliases(shard.index(),request.indices());
      sendExecuteFirstPhase(node,internalSearchRequest(shard,shardsIts.size(),request,filteringAliases,startTime(),useSlowScroll),new SearchServiceListener<FirstResult>(){
        @Override public void onResult(        FirstResult result){
          onFirstPhaseResult(shardIndex,shard,result,shardIt);
        }
        @Override public void onFailure(        Throwable t){
          onFirstPhaseResult(shardIndex,shard,node.id(),shardIt,t);
        }
      }
);
    }
  }
}
