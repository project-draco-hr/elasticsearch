{
  assertEquals(taskResultMap.size(),result.executionResults.size());
  for (  Map.Entry<ShardStateAction.ShardRoutingEntry,Boolean> entry : taskResultMap.entrySet()) {
    assertTrue(result.executionResults.containsKey(entry.getKey()));
    assertEquals(entry.getValue(),result.executionResults.get(entry.getKey()).isSuccess());
  }
  List<ShardRouting> shards=clusterState.getRoutingTable().allShards();
  for (  Map.Entry<ShardStateAction.ShardRoutingEntry,Boolean> entry : taskResultMap.entrySet()) {
    if (entry.getValue()) {
      for (      ShardRouting shard : shards) {
        if (entry.getKey().getShardRouting().allocationId() != null) {
          assertThat(shard.allocationId(),not(equalTo(entry.getKey().getShardRouting().allocationId())));
        }
      }
    }
  }
  if (clusterStateChanged) {
    assertNotSame(clusterState,result.resultingState);
  }
 else {
    assertSame(clusterState,result.resultingState);
  }
}
