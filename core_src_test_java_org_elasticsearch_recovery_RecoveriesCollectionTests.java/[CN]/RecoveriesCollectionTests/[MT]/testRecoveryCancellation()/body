{
  try (ReplicationGroup shards=createGroup(0)){
    final RecoveriesCollection collection=new RecoveriesCollection(logger,threadPool);
    final long recoveryId=startRecovery(collection,shards.getPrimaryNode(),shards.addReplica());
    final long recoveryId2=startRecovery(collection,shards.getPrimaryNode(),shards.addReplica());
    try (RecoveriesCollection.RecoveryRef recoveryRef=collection.getRecovery(recoveryId)){
      ShardId shardId=recoveryRef.status().shardId();
      assertTrue("failed to cancel recoveries",collection.cancelRecoveriesForShard(shardId,"test"));
      assertThat("all recoveries should be cancelled",collection.size(),equalTo(0));
    }
  finally {
      collection.cancelRecovery(recoveryId,"meh");
      collection.cancelRecovery(recoveryId2,"meh");
    }
  }
 }
