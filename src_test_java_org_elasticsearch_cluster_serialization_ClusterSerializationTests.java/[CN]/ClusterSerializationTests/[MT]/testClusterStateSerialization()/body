{
  MetaData metaData=MetaData.builder().put(IndexMetaData.builder("test").numberOfShards(10).numberOfReplicas(1)).build();
  RoutingTable routingTable=RoutingTable.builder().addAsNew(metaData.index("test")).build();
  DiscoveryNodes nodes=DiscoveryNodes.builder().put(newNode("node1")).put(newNode("node2")).put(newNode("node3")).localNodeId("node1").masterNodeId("node2").build();
  ClusterState clusterState=ClusterState.builder(new ClusterName("clusterName1")).nodes(nodes).metaData(metaData).routingTable(routingTable).build();
  AllocationService strategy=createAllocationService();
  clusterState=ClusterState.builder(clusterState).routingTable(strategy.reroute(clusterState).routingTable()).build();
  ClusterState serializedClusterState=ClusterState.Builder.fromBytes(ClusterState.Builder.toBytes(clusterState),newNode("node1"),new ClusterName("clusterName2"));
  assertThat(serializedClusterState.getClusterName().value(),equalTo(clusterState.getClusterName().value()));
  assertThat(serializedClusterState.routingTable().prettyPrint(),equalTo(clusterState.routingTable().prettyPrint()));
}
