{
  XContentBuilder mappingBuilder=jsonBuilder();
  mappingBuilder.startObject().startObject("mail").startObject("properties").startObject("attachments").startObject("properties").startObject("innerfield").field("type","attachment").endObject().endObject().endObject().endObject().endObject().endObject();
  byte[] mapping=BytesReference.toBytes(mappingBuilder.bytes());
  MapperService mapperService=MapperTestUtils.newMapperService(createTempDir(),Settings.EMPTY,getIndicesModuleWithRegisteredAttachmentMapper());
  DocumentMapper docMapper=mapperService.parse("mail",new CompressedXContent(mapping),true);
  mapperService.parse("mail",new CompressedXContent(docMapper.mapping().toString()),true);
  assertFalse(docMapper.mapping().toString().contains("."));
}
