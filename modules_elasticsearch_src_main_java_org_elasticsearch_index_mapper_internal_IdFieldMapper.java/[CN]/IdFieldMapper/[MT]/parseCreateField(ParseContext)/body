{
  if (context.parsedIdState() == ParseContext.ParsedIdState.NO) {
    String id=context.parser().text();
    if (context.id() != null && !context.id().equals(id)) {
      throw new MapperParsingException("Provided id [" + context.id() + "] does not match the content one ["+ id+ "]");
    }
    context.id(id);
    context.parsedId(ParseContext.ParsedIdState.PARSED);
    if (index == Field.Index.NO && store == Field.Store.NO) {
      return null;
    }
    return new Field(names.indexName(),false,context.id(),store,index,termVector);
  }
 else   if (context.parsedIdState() == ParseContext.ParsedIdState.EXTERNAL) {
    if (context.id() == null) {
      throw new MapperParsingException("No id mapping with [" + names.name() + "] found in the content, and not explicitly set");
    }
    if (index == Field.Index.NO && store == Field.Store.NO) {
      return null;
    }
    return new Field(names.indexName(),false,context.id(),store,index,termVector);
  }
 else {
    throw new MapperParsingException("Illegal parsed id state");
  }
}
