{
  if (!params.paramAsBoolean("flat_settings",false)) {
    for (    Map.Entry<String,Object> entry : getAsStructuredMap().entrySet()) {
      builder.field(entry.getKey(),entry.getValue());
    }
  }
 else {
    for (    Map.Entry<String,String> entry : getAsMap().entrySet()) {
      builder.field(entry.getKey(),entry.getValue(),XContentBuilder.FieldCaseConversion.NONE);
    }
  }
  return builder;
}
