{
  internalCluster().startNodesAsync(3).get();
  prepareCreate("test").setSettings(Settings.builder().put(IndexMetaData.SETTING_NUMBER_OF_SHARDS,1).put(IndexMetaData.SETTING_NUMBER_OF_REPLICAS,1).put(UnassignedInfo.DELAYED_NODE_LEFT_TIMEOUT,TimeValue.timeValueMillis(100))).get();
  ensureGreen("test");
  indexRandomData();
  internalCluster().stopRandomNode(InternalTestCluster.nameFilter(findNodeWithShard()));
  ensureGreen("test");
}
