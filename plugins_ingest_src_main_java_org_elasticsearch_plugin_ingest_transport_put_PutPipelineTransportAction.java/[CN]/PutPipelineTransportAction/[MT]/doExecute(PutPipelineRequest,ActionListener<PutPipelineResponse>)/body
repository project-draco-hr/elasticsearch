{
  Map<String,Object> pipelineConfig=XContentHelper.convertToMap(request.source(),false).v2();
  try {
    pipelineStore.constructPipeline(request.id(),pipelineConfig);
  }
 catch (  IOException e) {
    listener.onFailure(e);
    return;
  }
  IndexRequest indexRequest=new IndexRequest(request);
  indexRequest.index(PipelineStore.INDEX);
  indexRequest.type(PipelineStore.TYPE);
  indexRequest.id(request.id());
  indexRequest.source(request.source());
  indexRequest.refresh(true);
  indexAction.execute(indexRequest,new ActionListener<IndexResponse>(){
    @Override public void onResponse(    IndexResponse indexResponse){
      PutPipelineResponse response=new PutPipelineResponse();
      response.id(indexResponse.getId());
      response.version(indexResponse.getVersion());
      listener.onResponse(response);
    }
    @Override public void onFailure(    Throwable e){
      listener.onFailure(e);
    }
  }
);
}
