{
  IndicesSegmentResponse response=client().admin().indices().segments(Requests.indicesSegmentsRequest(idx)).actionGet();
  IndexSegments indicesSegments=response.getIndices().get(idx);
  long total=0;
  for (  IndexShardSegments indexShardSegments : indicesSegments) {
    for (    ShardSegments shardSegments : indexShardSegments) {
      for (      Segment segment : shardSegments) {
        logger.debug("+=" + segment.memoryInBytes + " "+ indexShardSegments.getShardId()+ " "+ shardSegments.getShardRouting().getIndex());
        total+=segment.memoryInBytes;
      }
    }
  }
  return total;
}
