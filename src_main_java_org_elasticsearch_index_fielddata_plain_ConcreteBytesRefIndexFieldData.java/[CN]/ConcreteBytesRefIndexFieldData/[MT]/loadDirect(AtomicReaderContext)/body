{
  AtomicReader reader=context.reader();
  Terms terms=reader.terms(getFieldNames().indexName());
  if (terms == null) {
    return ConcreteBytesRefAtomicFieldData.empty(reader.maxDoc());
  }
  long size=terms.size();
  if (size == -1) {
    size=1024;
  }
  final ArrayList<BytesRef> values=new ArrayList<BytesRef>((int)size);
  values.add(null);
  OrdinalsBuilder builder=new OrdinalsBuilder(terms,reader.maxDoc());
  try {
    BytesRefIterator iter=builder.buildFromTerms(filter(terms,reader),reader.getLiveDocs());
    BytesRef term;
    while ((term=iter.next()) != null) {
      values.add(BytesRef.deepCopyOf(term));
    }
    return new ConcreteBytesRefAtomicFieldData(values.toArray(new BytesRef[values.size()]),builder.build(fieldDataType.getSettings()));
  }
  finally {
    builder.close();
  }
}
