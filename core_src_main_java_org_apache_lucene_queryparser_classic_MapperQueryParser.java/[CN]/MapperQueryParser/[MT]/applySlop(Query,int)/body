{
  if (q instanceof PhraseQuery) {
    PhraseQuery pq=(PhraseQuery)q;
    PhraseQuery.Builder builder=new PhraseQuery.Builder();
    builder.setSlop(slop);
    final Term[] terms=pq.getTerms();
    final int[] positions=pq.getPositions();
    for (int i=0; i < terms.length; ++i) {
      builder.add(terms[i],positions[i]);
    }
    pq=builder.build();
    pq.setBoost(q.getBoost());
    return pq;
  }
 else   if (q instanceof MultiPhraseQuery) {
    ((MultiPhraseQuery)q).setSlop(slop);
    return q;
  }
 else {
    return q;
  }
}
