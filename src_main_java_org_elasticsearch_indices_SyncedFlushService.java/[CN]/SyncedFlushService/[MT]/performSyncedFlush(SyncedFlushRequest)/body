{
  IndexService indexService=indicesService.indexServiceSafe(request.shardId().getIndex());
  IndexShard indexShard=indexService.shardSafe(request.shardId().id());
  logger.trace("{} performing sync flush. sync id [{}], expected commit id {}",request.shardId(),request.syncId(),request.expectedCommitId());
  Engine.SyncedFlushResult result=indexShard.syncFlush(request.syncId(),request.expectedCommitId());
  logger.trace("{} sync flush done. sync id [{}], result  [{}]",request.shardId(),request.syncId(),result);
switch (result) {
case SUCCESS:
    return new SyncedFlushResponse();
case FAILED_COMMIT_MISMATCH:
  return new SyncedFlushResponse("commit has changed");
case FAILED_PENDING_OPERATIONS:
return new SyncedFlushResponse("pending operations");
default :
throw new ElasticsearchException("unknown synced flush result [" + result + "]");
}
}
