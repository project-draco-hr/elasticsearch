{
  String httpRange=settings.get("http.netty.port",settings.get("http.port",NettyHttpServerTransport.DEFAULT_PORT_RANGE));
  policy.add(new SocketPermission("localhost:" + httpRange,"listen,resolve"));
  Map<String,Settings> profiles=settings.getGroups("transport.profiles",true);
  if (!profiles.containsKey(NettyTransport.DEFAULT_PROFILE)) {
    profiles=new HashMap<>(profiles);
    profiles.put(NettyTransport.DEFAULT_PROFILE,Settings.EMPTY);
  }
  for (  Map.Entry<String,Settings> entry : profiles.entrySet()) {
    Settings profileSettings=entry.getValue();
    String name=entry.getKey();
    String transportRange=profileSettings.get("port",settings.get("transport.tcp.port",NettyTransport.DEFAULT_PORT_RANGE));
    boolean valid=NettyTransport.DEFAULT_PROFILE.equals(name) || (Strings.hasLength(name) && profileSettings.get("port") != null);
    if (valid) {
      policy.add(new SocketPermission("localhost:" + transportRange,"listen,resolve"));
    }
  }
}
