{
  if (Files.exists(environment.pluginsFile())) {
    try (DirectoryStream<Path> stream=Files.newDirectoryStream(environment.pluginsFile())){
      for (      Path plugin : stream) {
        String prop=INSECURE_PLUGINS.get(plugin.getFileName().toString());
        if (prop != null) {
          if (System.getProperty(prop) != null) {
            throw new IllegalStateException("property: " + prop + " is unexpectedly set: "+ System.getProperty(prop));
          }
          System.setProperty(prop,plugin.toUri().toURL().toString() + "*");
          ESLogger logger=Loggers.getLogger(Security.class);
          logger.warn("Adding permissions for insecure plugin [{}]",plugin.getFileName());
          logger.warn("There are unresolved issues with third-party code that may reduce the security of the system");
        }
      }
    }
   }
  for (  String prop : INSECURE_PLUGINS.values()) {
    if (System.getProperty(prop) == null) {
      System.setProperty(prop,"file:/dev/null");
    }
  }
}
