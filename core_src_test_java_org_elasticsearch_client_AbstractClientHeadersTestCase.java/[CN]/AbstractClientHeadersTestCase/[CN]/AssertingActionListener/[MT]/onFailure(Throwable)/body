{
  Throwable e=unwrap(t,InternalException.class);
  assertThat("expected action [" + action + "] to throw an internal exception",e,notNullValue());
  assertThat(action,equalTo(((InternalException)e).action));
  Map<String,Object> headers=((InternalException)e).headers;
  assertHeaders(headers,expectedHeaders);
}
