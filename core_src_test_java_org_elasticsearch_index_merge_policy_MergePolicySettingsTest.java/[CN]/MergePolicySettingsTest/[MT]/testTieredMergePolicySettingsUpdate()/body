{
  IndexSettingsService service=new IndexSettingsService(new Index("test"),EMPTY_SETTINGS);
  TieredMergePolicyProvider mp=new TieredMergePolicyProvider(createStore(EMPTY_SETTINGS),service);
  assertThat(mp.getMergePolicy().getNoCFSRatio(),equalTo(0.1));
  assertEquals(mp.getMergePolicy().getForceMergeDeletesPctAllowed(),TieredMergePolicyProvider.DEFAULT_EXPUNGE_DELETES_ALLOWED,0.0d);
  service.refreshSettings(Settings.builder().put(TieredMergePolicyProvider.INDEX_MERGE_POLICY_EXPUNGE_DELETES_ALLOWED,TieredMergePolicyProvider.DEFAULT_EXPUNGE_DELETES_ALLOWED + 1.0d).build());
  assertEquals(mp.getMergePolicy().getForceMergeDeletesPctAllowed(),TieredMergePolicyProvider.DEFAULT_EXPUNGE_DELETES_ALLOWED + 1.0d,0.0d);
  assertEquals(mp.getMergePolicy().getFloorSegmentMB(),TieredMergePolicyProvider.DEFAULT_FLOOR_SEGMENT.mbFrac(),0);
  service.refreshSettings(Settings.builder().put(TieredMergePolicyProvider.INDEX_MERGE_POLICY_FLOOR_SEGMENT,new ByteSizeValue(TieredMergePolicyProvider.DEFAULT_FLOOR_SEGMENT.mb() + 1,ByteSizeUnit.MB)).build());
  assertEquals(mp.getMergePolicy().getFloorSegmentMB(),new ByteSizeValue(TieredMergePolicyProvider.DEFAULT_FLOOR_SEGMENT.mb() + 1,ByteSizeUnit.MB).mbFrac(),0.001);
  assertEquals(mp.getMergePolicy().getMaxMergeAtOnce(),TieredMergePolicyProvider.DEFAULT_MAX_MERGE_AT_ONCE);
  service.refreshSettings(Settings.builder().put(TieredMergePolicyProvider.INDEX_MERGE_POLICY_MAX_MERGE_AT_ONCE,TieredMergePolicyProvider.DEFAULT_MAX_MERGE_AT_ONCE - 1).build());
  assertEquals(mp.getMergePolicy().getMaxMergeAtOnce(),TieredMergePolicyProvider.DEFAULT_MAX_MERGE_AT_ONCE - 1);
  assertEquals(mp.getMergePolicy().getMaxMergeAtOnceExplicit(),TieredMergePolicyProvider.DEFAULT_MAX_MERGE_AT_ONCE_EXPLICIT);
  service.refreshSettings(Settings.builder().put(TieredMergePolicyProvider.INDEX_MERGE_POLICY_MAX_MERGE_AT_ONCE_EXPLICIT,TieredMergePolicyProvider.DEFAULT_MAX_MERGE_AT_ONCE_EXPLICIT - 1).build());
  assertEquals(mp.getMergePolicy().getMaxMergeAtOnceExplicit(),TieredMergePolicyProvider.DEFAULT_MAX_MERGE_AT_ONCE_EXPLICIT - 1);
  assertEquals(mp.getMergePolicy().getMaxMergedSegmentMB(),TieredMergePolicyProvider.DEFAULT_MAX_MERGED_SEGMENT.mbFrac(),0.0001);
  service.refreshSettings(Settings.builder().put(TieredMergePolicyProvider.INDEX_MERGE_POLICY_MAX_MERGED_SEGMENT,new ByteSizeValue(TieredMergePolicyProvider.DEFAULT_MAX_MERGED_SEGMENT.bytes() + 1)).build());
  assertEquals(mp.getMergePolicy().getMaxMergedSegmentMB(),new ByteSizeValue(TieredMergePolicyProvider.DEFAULT_MAX_MERGED_SEGMENT.bytes() + 1).mbFrac(),0.0001);
  assertEquals(mp.getMergePolicy().getReclaimDeletesWeight(),TieredMergePolicyProvider.DEFAULT_RECLAIM_DELETES_WEIGHT,0);
  service.refreshSettings(Settings.builder().put(TieredMergePolicyProvider.INDEX_MERGE_POLICY_RECLAIM_DELETES_WEIGHT,TieredMergePolicyProvider.DEFAULT_RECLAIM_DELETES_WEIGHT + 1).build());
  assertEquals(mp.getMergePolicy().getReclaimDeletesWeight(),TieredMergePolicyProvider.DEFAULT_RECLAIM_DELETES_WEIGHT + 1,0);
  assertEquals(mp.getMergePolicy().getSegmentsPerTier(),TieredMergePolicyProvider.DEFAULT_SEGMENTS_PER_TIER,0);
  service.refreshSettings(Settings.builder().put(TieredMergePolicyProvider.INDEX_MERGE_POLICY_SEGMENTS_PER_TIER,TieredMergePolicyProvider.DEFAULT_SEGMENTS_PER_TIER + 1).build());
  assertEquals(mp.getMergePolicy().getSegmentsPerTier(),TieredMergePolicyProvider.DEFAULT_SEGMENTS_PER_TIER + 1,0);
  service.refreshSettings(EMPTY_SETTINGS);
  assertEquals(mp.getMergePolicy().getForceMergeDeletesPctAllowed(),TieredMergePolicyProvider.DEFAULT_EXPUNGE_DELETES_ALLOWED + 1.0d,0.0d);
  assertEquals(mp.getMergePolicy().getFloorSegmentMB(),new ByteSizeValue(TieredMergePolicyProvider.DEFAULT_FLOOR_SEGMENT.mb() + 1,ByteSizeUnit.MB).mbFrac(),0.001);
  assertEquals(mp.getMergePolicy().getMaxMergeAtOnce(),TieredMergePolicyProvider.DEFAULT_MAX_MERGE_AT_ONCE - 1);
  assertEquals(mp.getMergePolicy().getMaxMergeAtOnceExplicit(),TieredMergePolicyProvider.DEFAULT_MAX_MERGE_AT_ONCE_EXPLICIT - 1);
  assertEquals(mp.getMergePolicy().getMaxMergedSegmentMB(),new ByteSizeValue(TieredMergePolicyProvider.DEFAULT_MAX_MERGED_SEGMENT.bytes() + 1).mbFrac(),0.0001);
  assertEquals(mp.getMergePolicy().getReclaimDeletesWeight(),TieredMergePolicyProvider.DEFAULT_RECLAIM_DELETES_WEIGHT + 1,0);
  assertEquals(mp.getMergePolicy().getSegmentsPerTier(),TieredMergePolicyProvider.DEFAULT_SEGMENTS_PER_TIER + 1,0);
}
