{
  Pipeline.Builder builder=new Pipeline.Builder("_id");
  Processor processor=mock(Processor.class);
  builder.addProcessors(new Processor.Builder(){
    @Override public void fromMap(    Map<String,Object> config){
    }
    @Override public Processor build(){
      return processor;
    }
  }
);
  when(store.get("_id")).thenReturn(builder.build());
  Data data=new Data("_index","_type","_id",Collections.emptyMap());
  PipelineExecutionService.Listener listener=mock(PipelineExecutionService.Listener.class);
  executionService.execute(data,"_id",listener);
  assertBusy(new Runnable(){
    @Override public void run(){
      verify(processor).execute(data);
      verify(listener).executed(data);
      verify(listener,times(0)).failed(any(Exception.class));
    }
  }
);
}
