{
  if (jsonContext.parsedIdState() == JsonParseContext.ParsedIdState.NO) {
    String id=jsonContext.jp().getText();
    if (jsonContext.id() != null && !jsonContext.id().equals(id)) {
      throw new MapperParsingException("Provided id [" + jsonContext.id() + "] does not match the json one ["+ id+ "]");
    }
    jsonContext.id(id);
    jsonContext.parsedId(JsonParseContext.ParsedIdState.PARSED);
    return new Field(names.indexName(),jsonContext.id(),store,index);
  }
 else   if (jsonContext.parsedIdState() == JsonParseContext.ParsedIdState.EXTERNAL) {
    if (jsonContext.id() == null) {
      throw new MapperParsingException("No id mapping with [" + names.name() + "] found in the json, and not explicitly set");
    }
    return new Field(names.indexName(),jsonContext.id(),store,index);
  }
 else {
    throw new MapperParsingException("Illegal parsed id state");
  }
}
