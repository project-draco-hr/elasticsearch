{
  try {
    channel.connect(clusterName.value());
    channel.setReceiver(this);
    logger.debug("Connected to cluster [{}], address [{}]",channel.getClusterName(),channel.getAddress());
    this.localNode=new DiscoveryNode(settings.get("name"),settings.getAsBoolean("node.data",true),channel.getAddress().toString(),transportService.boundAddress().publishAddress());
    if (isMaster()) {
      firstMaster=true;
      clusterService.submitStateUpdateTask("jgroups-disco-initialconnect(master)",new ProcessedClusterStateUpdateTask(){
        @Override public ClusterState execute(        ClusterState currentState){
          DiscoveryNodes.Builder builder=new DiscoveryNodes.Builder().localNodeId(localNode.id()).masterNodeId(localNode.id()).put(localNode);
          return newClusterStateBuilder().state(currentState).nodes(builder).build();
        }
        @Override public void clusterStateProcessed(        ClusterState clusterState){
          sendInitialStateEventIfNeeded();
        }
      }
);
      addressSet=true;
    }
 else {
      clusterService.submitStateUpdateTask("jgroups-disco-initialconnect",new ClusterStateUpdateTask(){
        @Override public ClusterState execute(        ClusterState currentState){
          DiscoveryNodes.Builder builder=new DiscoveryNodes.Builder().localNodeId(localNode.id()).put(localNode);
          return newClusterStateBuilder().state(currentState).nodes(builder).build();
        }
      }
);
      try {
        channel.send(new Message(channel.getView().getCreator(),channel.getAddress(),nodeMessagePayload()));
        addressSet=true;
        logger.debug("Sent (initial) node information to master [{}], node [{}]",channel.getView().getCreator(),localNode);
      }
 catch (      Exception e) {
        logger.warn("Can't send address to master [" + channel.getView().getCreator() + "] will try again later...",e);
      }
    }
  }
 catch (  ChannelException e) {
    throw new DiscoveryException("Can't connect to group [" + clusterName + "]",e);
  }
}
