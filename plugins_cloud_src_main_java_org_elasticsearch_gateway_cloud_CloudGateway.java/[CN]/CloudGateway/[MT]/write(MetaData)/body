{
  try {
    String name="metadata-" + (currentIndex + 1);
    BinaryXContentBuilder builder=XContentFactory.contentBinaryBuilder(XContentType.JSON);
    builder.prettyPrint();
    builder.startObject();
    MetaData.Builder.toXContent(metaData,builder,ToXContent.EMPTY_PARAMS);
    builder.endObject();
    Blob blob=blobStoreService.context().getBlobStore().newBlob(name);
    blob.setPayload(new FastByteArrayInputStream(builder.unsafeBytes(),0,builder.unsafeBytesLength()));
    blob.setContentLength(builder.unsafeBytesLength());
    blobStoreService.context().getBlobStore().putBlob(container,blob);
    currentIndex++;
    PageSet<? extends StorageMetadata> pageSet=blobStoreService.context().getBlobStore().list(container);
    for (    StorageMetadata storageMetadata : pageSet) {
      if (storageMetadata.getName().startsWith("metadata-") && !name.equals(storageMetadata.getName())) {
        blobStoreService.context().getBlobStore().removeBlob(container,storageMetadata.getName());
      }
    }
  }
 catch (  IOException e) {
    throw new GatewayException("can't write new metadata file into the gateway",e);
  }
}
