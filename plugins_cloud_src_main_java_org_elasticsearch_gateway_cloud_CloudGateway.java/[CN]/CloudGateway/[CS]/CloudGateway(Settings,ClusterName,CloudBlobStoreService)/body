{
  super(settings);
  this.blobStoreContext=blobStoreService.context();
  this.chunkSize=componentSettings.getAsSize("chunk_size",null);
  String location=componentSettings.get("location");
  if (location == null) {
    this.location=null;
  }
 else {
    Location matchedLocation=null;
    Set<? extends Location> assignableLocations=blobStoreContext.getBlobStore().listAssignableLocations();
    for (    Location oLocation : assignableLocations) {
      if (oLocation.getId().equals(location)) {
        matchedLocation=oLocation;
        break;
      }
    }
    this.location=matchedLocation;
    if (this.location == null) {
      throw new ElasticSearchIllegalArgumentException("Not a valid location [" + location + "], available locations "+ assignableLocations);
    }
  }
  String container=componentSettings.get("container");
  if (container == null) {
    throw new ElasticSearchIllegalArgumentException("Cloud gateway requires 'container' setting");
  }
  this.container=container + JCloudsUtils.BLOB_CONTAINER_SEP + clusterName.value();
  this.metadataContainer=this.container + JCloudsUtils.BLOB_CONTAINER_SEP + "metadata";
  logger.debug("Using location [{}], container [{}], metadata_container [{}]",this.location,this.container,metadataContainer);
  blobStoreContext.getBlobStore().createContainerInLocation(this.location,metadataContainer);
  this.currentIndex=findLatestIndex();
  logger.debug("Latest metadata found at index [" + currentIndex + "]");
}
