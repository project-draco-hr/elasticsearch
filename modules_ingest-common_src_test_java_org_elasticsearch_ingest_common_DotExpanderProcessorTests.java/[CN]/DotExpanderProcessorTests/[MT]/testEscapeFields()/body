{
  Map<String,Object> source=new HashMap<>();
  source.put("foo.bar","baz1");
  IngestDocument document=new IngestDocument(source,Collections.emptyMap());
  DotExpanderProcessor processor=new DotExpanderProcessor("_tag",null,"foo.bar");
  processor.execute(document);
  assertThat(document.getFieldValue("foo",Map.class).size(),equalTo(1));
  assertThat(document.getFieldValue("foo.bar",String.class),equalTo("baz1"));
  source=new HashMap<>();
  source.put("foo.bar.baz","value");
  document=new IngestDocument(source,Collections.emptyMap());
  processor=new DotExpanderProcessor("_tag",null,"foo.bar.baz");
  processor.execute(document);
  assertThat(document.getFieldValue("foo",Map.class).size(),equalTo(1));
  assertThat(document.getFieldValue("foo.bar",Map.class).size(),equalTo(1));
  assertThat(document.getFieldValue("foo.bar.baz",String.class),equalTo("value"));
  source=new HashMap<>();
  source.put("foo.bar","baz1");
  source.put("foo",new HashMap<>(Collections.singletonMap("bar","baz2")));
  document=new IngestDocument(source,Collections.emptyMap());
  processor=new DotExpanderProcessor("_tag",null,"foo.bar");
  processor.execute(document);
  assertThat(document.getSourceAndMetadata().size(),equalTo(1));
  assertThat(document.getFieldValue("foo.bar",List.class).size(),equalTo(2));
  assertThat(document.getFieldValue("foo.bar.0",String.class),equalTo("baz2"));
  assertThat(document.getFieldValue("foo.bar.1",String.class),equalTo("baz1"));
  source=new HashMap<>();
  source.put("foo.bar","2");
  source.put("foo",new HashMap<>(Collections.singletonMap("bar",1)));
  document=new IngestDocument(source,Collections.emptyMap());
  processor=new DotExpanderProcessor("_tag",null,"foo.bar");
  processor.execute(document);
  assertThat(document.getSourceAndMetadata().size(),equalTo(1));
  assertThat(document.getFieldValue("foo.bar",List.class).size(),equalTo(2));
  assertThat(document.getFieldValue("foo.bar.0",Integer.class),equalTo(1));
  assertThat(document.getFieldValue("foo.bar.1",String.class),equalTo("2"));
}
