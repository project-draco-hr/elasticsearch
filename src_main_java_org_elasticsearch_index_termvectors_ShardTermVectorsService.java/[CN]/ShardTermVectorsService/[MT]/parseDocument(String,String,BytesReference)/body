{
  MapperService mapperService=indexShard.mapperService();
  IndexService indexService=indexShard.indexService();
  Tuple<DocumentMapper,Boolean> docMapper=mapperService.documentMapperWithAutoCreate(type);
  ParsedDocument parsedDocument=docMapper.v1().parse(source(doc).type(type).flyweight(true)).setMappingsModified(docMapper);
  if (parsedDocument.mappingsModified()) {
    mappingUpdatedAction.updateMappingOnMaster(index,docMapper.v1(),indexService.indexUUID());
  }
  return parsedDocument;
}
