{
  assertAcked(prepareCreate("test").setSettings(settingsBuilder().put(SETTING_NUMBER_OF_SHARDS,between(1,5)).put(SETTING_NUMBER_OF_REPLICAS,between(0,1))).addMapping("type","int_value","type=integer"));
  ensureGreen();
  client().prepareIndex("test","type","1").setSource(jsonBuilder().startObject().field("string_value","lucene index").field("int_value",1).endObject()).execute().actionGet();
  client().prepareIndex("test","type","2").setSource(jsonBuilder().startObject().field("string_value","elasticsearch index").field("int_value",42).endObject()).execute().actionGet();
  refresh();
  SearchResponse searchResponse=client().prepareSearch().setQuery(fuzzyLikeThisQuery().likeText("index")).execute().actionGet();
  assertThat(searchResponse.getFailedShards(),equalTo(0));
  assertThat(searchResponse.getHits().getTotalHits(),equalTo(2L));
  searchResponse=client().prepareSearch().setQuery(fuzzyLikeThisQuery("string_value").likeText("index")).execute().actionGet();
  assertThat(searchResponse.getFailedShards(),equalTo(0));
  assertThat(searchResponse.getHits().getTotalHits(),equalTo(2L));
  assertThrows(client().prepareSearch().setQuery(fuzzyLikeThisQuery("string_value","int_value").likeText("index")),SearchPhaseExecutionException.class);
  assertThrows(client().prepareSearch().setQuery(fuzzyLikeThisQuery("string_value","int_value").likeText("index").failOnUnsupportedField(true)),SearchPhaseExecutionException.class);
  searchResponse=client().prepareSearch().setQuery(fuzzyLikeThisQuery("string_value","int_value").likeText("index").failOnUnsupportedField(false)).execute().actionGet();
  assertThat(searchResponse.getFailedShards(),equalTo(0));
  assertThat(searchResponse.getHits().getTotalHits(),equalTo(2L));
  assertThrows(client().prepareSearch().setQuery(fuzzyLikeThisFieldQuery("int_value").likeText("42")),SearchPhaseExecutionException.class);
  assertThrows(client().prepareSearch().setQuery(fuzzyLikeThisFieldQuery("int_value").likeText("42").failOnUnsupportedField(true)),SearchPhaseExecutionException.class);
  searchResponse=client().prepareSearch().setQuery(fuzzyLikeThisFieldQuery("int_value").likeText("42").failOnUnsupportedField(false)).execute().actionGet();
  assertThat(searchResponse.getFailedShards(),equalTo(0));
  assertThat(searchResponse.getHits().getTotalHits(),equalTo(0L));
}
