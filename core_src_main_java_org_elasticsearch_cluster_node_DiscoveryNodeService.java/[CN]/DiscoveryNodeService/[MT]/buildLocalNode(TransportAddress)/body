{
  Map<String,String> attributes=new HashMap<>(settings.getByPrefix("node.").getAsMap());
  attributes.remove("name");
  if (attributes.containsKey("client")) {
    if (attributes.get("client").equals("false")) {
      attributes.remove("client");
    }
 else {
      attributes.put("data","false");
    }
  }
  if (attributes.containsKey("data")) {
    if (attributes.get("data").equals("true")) {
      attributes.remove("data");
    }
  }
  for (  CustomAttributesProvider provider : customAttributesProviders) {
    try {
      Map<String,String> customAttributes=provider.buildAttributes();
      if (customAttributes != null) {
        for (        Map.Entry<String,String> entry : customAttributes.entrySet()) {
          if (!attributes.containsKey(entry.getKey())) {
            attributes.put(entry.getKey(),entry.getValue());
          }
        }
      }
    }
 catch (    Exception e) {
      logger.warn("failed to build custom attributes from provider [{}]",e,provider);
    }
  }
  final String nodeId=generateNodeId(settings);
  return new DiscoveryNode(settings.get("node.name"),nodeId,publishAddress,attributes,version);
}
