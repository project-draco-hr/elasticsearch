{
  IndexMetaData indexMd=allocation.routingNodes().metaData().index(shardRouting.index());
  int totalShardsPerNode=indexMd.settings().getAsInt(INDEX_TOTAL_SHARDS_PER_NODE,-1);
  if (totalShardsPerNode <= 0) {
    return Decision.YES;
  }
  int nodeCount=0;
  for (  MutableShardRouting nodeShard : node) {
    if (!nodeShard.index().equals(shardRouting.index())) {
      continue;
    }
    if (nodeShard.relocating()) {
      continue;
    }
    nodeCount++;
  }
  if (nodeCount >= totalShardsPerNode) {
    return Decision.NO;
  }
  return Decision.YES;
}
