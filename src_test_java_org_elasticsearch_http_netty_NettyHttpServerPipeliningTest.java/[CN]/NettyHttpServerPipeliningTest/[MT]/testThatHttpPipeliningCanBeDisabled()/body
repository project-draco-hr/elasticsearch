{
  Settings settings=settingsBuilder().put("http.pipelining",false).build();
  httpServerTransport=new CustomNettyHttpServerTransport(settings);
  httpServerTransport.start();
  InetSocketTransportAddress transportAddress=(InetSocketTransportAddress)httpServerTransport.boundAddress().boundAddress();
  List<String> requests=Arrays.asList("/slow?sleep=1000","/firstfast","/secondfast","/thirdfast","/slow?sleep=500");
  try (NettyHttpClient nettyHttpClient=new NettyHttpClient()){
    Collection<HttpResponse> responses=nettyHttpClient.sendRequests(transportAddress.address(),requests.toArray(new String[]{}));
    List<String> responseBodies=Lists.newArrayList(returnHttpResponseBodies(responses));
    assertThat(responseBodies,hasSize(5));
    assertThat(responseBodies.get(3),is("/slow?sleep=500"));
    assertThat(responseBodies.get(4),is("/slow?sleep=1000"));
  }
 }
