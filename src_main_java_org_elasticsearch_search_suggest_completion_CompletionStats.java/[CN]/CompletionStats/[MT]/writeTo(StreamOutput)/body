{
  out.writeVLong(sizeInBytes);
  if (fields == null) {
    out.writeBoolean(false);
  }
 else {
    out.writeBoolean(true);
    out.writeVInt(fields.size());
    final boolean[] states=fields.allocated;
    final Object[] keys=fields.keys;
    final long[] values=fields.values;
    for (int i=0; i < states.length; i++) {
      if (states[i]) {
        out.writeString((String)keys[i]);
        out.writeVLong(values[i]);
      }
    }
  }
}
