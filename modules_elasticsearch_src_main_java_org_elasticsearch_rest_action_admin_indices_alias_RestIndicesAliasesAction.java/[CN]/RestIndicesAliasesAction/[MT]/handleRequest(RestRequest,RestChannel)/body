{
  IndicesAliasesRequest indicesAliasesRequest=new IndicesAliasesRequest();
  try {
    JsonParser jp=Jackson.defaultJsonFactory().createJsonParser(request.contentAsStream());
    JsonToken token=jp.nextToken();
    if (token == null) {
      throw new ElasticSearchIllegalArgumentException("No action is specified");
    }
    while ((token=jp.nextToken()) != JsonToken.END_OBJECT) {
      if (token == JsonToken.START_ARRAY) {
        while ((token=jp.nextToken()) != JsonToken.END_ARRAY) {
          if (token == JsonToken.FIELD_NAME) {
            String action=jp.getCurrentName();
            AliasAction.Type type;
            if ("add".equals(action)) {
              type=AliasAction.Type.ADD;
            }
 else             if ("remove".equals(action)) {
              type=AliasAction.Type.REMOVE;
            }
 else {
              throw new ElasticSearchIllegalArgumentException("Alias action [" + action + "] not supported");
            }
            String index=null;
            String alias=null;
            String currentFieldName=null;
            while ((token=jp.nextToken()) != JsonToken.END_OBJECT) {
              if (token == JsonToken.FIELD_NAME) {
                currentFieldName=jp.getCurrentName();
              }
 else               if (token == JsonToken.VALUE_STRING) {
                if ("index".equals(currentFieldName)) {
                  index=jp.getText();
                }
 else                 if ("alias".equals(currentFieldName)) {
                  alias=jp.getText();
                }
              }
            }
            if (index == null) {
              throw new ElasticSearchIllegalArgumentException("Alias action [" + action + "] requires an [index] to be set");
            }
            if (alias == null) {
              throw new ElasticSearchIllegalArgumentException("Alias action [" + action + "] requires an [alias] to be set");
            }
            if (type == AliasAction.Type.ADD) {
              indicesAliasesRequest.addAlias(index,alias);
            }
 else             if (type == AliasAction.Type.REMOVE) {
              indicesAliasesRequest.removeAlias(index,alias);
            }
          }
        }
      }
    }
  }
 catch (  Exception e) {
    try {
      channel.sendResponse(new JsonThrowableRestResponse(request,e));
    }
 catch (    IOException e1) {
      logger.warn("Failed to send response",e1);
      return;
    }
  }
  client.admin().indices().aliases(indicesAliasesRequest,new ActionListener<IndicesAliasesResponse>(){
    @Override public void onResponse(    IndicesAliasesResponse response){
      try {
        JsonBuilder builder=RestJsonBuilder.restJsonBuilder(request);
        builder.startObject().field("ok",true).endObject();
        channel.sendResponse(new JsonRestResponse(request,OK,builder));
      }
 catch (      Exception e) {
        onFailure(e);
      }
    }
    @Override public void onFailure(    Throwable e){
      try {
        channel.sendResponse(new JsonThrowableRestResponse(request,e));
      }
 catch (      IOException e1) {
        logger.error("Failed to send failure response",e1);
      }
    }
  }
);
}
