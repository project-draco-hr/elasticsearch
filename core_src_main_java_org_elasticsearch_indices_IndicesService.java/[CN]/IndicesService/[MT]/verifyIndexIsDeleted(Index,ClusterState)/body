{
  if (clusterState.metaData().index(index) != null) {
    throw new IllegalStateException("Cannot delete index [" + index + "], it is still part of the cluster state.");
  }
  if (nodeEnv.hasNodeFile() && FileSystemUtils.exists(nodeEnv.indexPaths(index))) {
    final IndexMetaData metaData;
    try {
      metaData=metaStateService.loadIndexState(index);
    }
 catch (    IOException e) {
      logger.warn(new ParameterizedMessage("[{}] failed to load state file from a stale deleted index, folders will be left on disk",index),e);
      return null;
    }
    final IndexSettings indexSettings=buildIndexSettings(metaData);
    try {
      deleteIndexStoreIfDeletionAllowed("stale deleted index",index,indexSettings,ALWAYS_TRUE);
    }
 catch (    IOException e) {
      logger.warn(new ParameterizedMessage("[{}] failed to delete index on disk",metaData.getIndex()),e);
    }
    return metaData;
  }
  return null;
}
