{
  IndexWriter writer=new IndexWriter(new RAMDirectory(),new IndexWriterConfig(Lucene.VERSION,Lucene.STANDARD_ANALYZER));
  IndexReader reader=IndexReader.open(writer,true);
  MatcherAssert.assertThat(UidField.loadVersion(reader,new Term("_uid","1")),equalTo(-1l));
  Document doc=new Document();
  doc.add(new Field("_uid","1",Field.Store.YES,Field.Index.NOT_ANALYZED));
  writer.addDocument(doc);
  reader=reader.reopen();
  assertThat(UidField.loadVersion(reader,new Term("_uid","1")),equalTo(-2l));
  assertThat(UidField.loadDocIdAndVersion(reader,0,new Term("_uid","1")).version,equalTo(-2l));
  doc=new Document();
  doc.add(new UidField("_uid","1",1));
  writer.updateDocument(new Term("_uid","1"),doc);
  reader=reader.reopen();
  assertThat(UidField.loadVersion(reader,new Term("_uid","1")),equalTo(1l));
  assertThat(UidField.loadDocIdAndVersion(reader,0,new Term("_uid","1")).version,equalTo(1l));
  doc=new Document();
  UidField uid=new UidField("_uid","1",2);
  doc.add(uid);
  writer.updateDocument(new Term("_uid","1"),doc);
  reader=reader.reopen();
  assertThat(UidField.loadVersion(reader,new Term("_uid","1")),equalTo(2l));
  assertThat(UidField.loadDocIdAndVersion(reader,0,new Term("_uid","1")).version,equalTo(2l));
  doc=new Document();
  uid.version(3);
  doc.add(uid);
  writer.updateDocument(new Term("_uid","1"),doc);
  reader=reader.reopen();
  assertThat(UidField.loadVersion(reader,new Term("_uid","1")),equalTo(3l));
  assertThat(UidField.loadDocIdAndVersion(reader,0,new Term("_uid","1")).version,equalTo(3l));
  writer.deleteDocuments(new Term("_uid","1"));
  reader=reader.reopen();
  assertThat(UidField.loadVersion(reader,new Term("_uid","1")),equalTo(-1l));
  assertThat(UidField.loadDocIdAndVersion(reader,0,new Term("_uid","1")),nullValue());
}
