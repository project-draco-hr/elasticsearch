{
  if (entries.v().isEmpty()) {
    entries.release();
    return new InternalTermsStatsLongFacet(facetName,comparatorType,size,ImmutableList.<InternalTermsStatsLongFacet.LongEntry>of(),missing);
  }
  if (size == 0) {
    return new InternalTermsStatsLongFacet(facetName,comparatorType,0,entries.v().valueCollection(),missing);
  }
  Object[] values=entries.v().internalValues();
  Arrays.sort(values,(Comparator)comparatorType.comparator());
  int limit=shardSize;
  List<InternalTermsStatsLongFacet.LongEntry> ordered=Lists.newArrayList();
  for (int i=0; i < limit; i++) {
    InternalTermsStatsLongFacet.LongEntry value=(InternalTermsStatsLongFacet.LongEntry)values[i];
    if (value == null) {
      break;
    }
    ordered.add(value);
  }
  entries.release();
  return new InternalTermsStatsLongFacet(facetName,comparatorType,size,ordered,missing);
}
