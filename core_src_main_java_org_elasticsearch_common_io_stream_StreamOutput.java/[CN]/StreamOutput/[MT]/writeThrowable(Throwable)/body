{
  if (throwable == null) {
    writeBoolean(false);
  }
 else {
    writeBoolean(true);
    boolean writeCause=true;
    boolean writeMessage=true;
    if (throwable instanceof CorruptIndexException) {
      writeVInt(1);
      Matcher matcher=CORRUPT_INDEX_EXCEPTION_REGEX.matcher(throwable.getMessage());
      if (matcher.find()) {
        writeOptionalString(matcher.group(1));
        writeOptionalString(matcher.group(2));
      }
 else {
        writeOptionalString("???");
        writeOptionalString("???");
      }
      writeMessage=false;
    }
 else     if (throwable instanceof IndexFormatTooNewException) {
      writeVInt(2);
      Matcher matcher=INDEX_FORMAT_TOO_NEW_EXCEPTION_REGEX.matcher(throwable.getMessage());
      if (matcher.find()) {
        writeOptionalString(matcher.group(1));
        writeInt(parseIntSafe(matcher.group(2),-1));
        writeInt(parseIntSafe(matcher.group(3),-1));
        writeInt(parseIntSafe(matcher.group(4),-1));
      }
 else {
        writeOptionalString("???");
        writeInt(-1);
        writeInt(-1);
        writeInt(-1);
      }
      writeMessage=false;
      writeCause=false;
    }
 else     if (throwable instanceof IndexFormatTooOldException) {
      writeVInt(3);
      Matcher matcher=INDEX_FORMAT_TOO_OLD_EXCEPTION_REGEX_1.matcher(throwable.getMessage());
      if (matcher.find()) {
        writeOptionalString(matcher.group(1));
        writeBoolean(true);
        writeInt(parseIntSafe(matcher.group(2),-1));
        writeInt(parseIntSafe(matcher.group(3),-1));
        writeInt(parseIntSafe(matcher.group(4),-1));
      }
 else {
        matcher=INDEX_FORMAT_TOO_OLD_EXCEPTION_REGEX_2.matcher(throwable.getMessage());
        if (matcher.matches()) {
          writeOptionalString(matcher.group(1));
          writeBoolean(false);
          writeOptionalString(matcher.group(2));
        }
 else {
          writeOptionalString("???");
          writeBoolean(true);
          writeInt(-1);
          writeInt(-1);
          writeInt(-1);
        }
      }
      writeMessage=false;
      writeCause=false;
    }
 else     if (throwable instanceof NullPointerException) {
      writeVInt(4);
      writeCause=false;
    }
 else     if (throwable instanceof NumberFormatException) {
      writeVInt(5);
      writeCause=false;
    }
 else     if (throwable instanceof IllegalArgumentException) {
      writeVInt(6);
    }
 else     if (throwable instanceof AlreadyClosedException) {
      writeVInt(7);
    }
 else     if (throwable instanceof EOFException) {
      writeVInt(8);
      writeCause=false;
    }
 else     if (throwable instanceof SecurityException) {
      writeVInt(9);
    }
 else     if (throwable instanceof StringIndexOutOfBoundsException) {
      writeVInt(10);
      writeCause=false;
    }
 else     if (throwable instanceof ArrayIndexOutOfBoundsException) {
      writeVInt(11);
      writeCause=false;
    }
 else     if (throwable instanceof AssertionError) {
      writeVInt(12);
    }
 else     if (throwable instanceof FileNotFoundException) {
      writeVInt(13);
      writeCause=false;
    }
 else     if (throwable instanceof NoSuchFileException) {
      writeVInt(14);
      writeOptionalString(((NoSuchFileException)throwable).getFile());
      writeOptionalString(((NoSuchFileException)throwable).getOtherFile());
      writeOptionalString(((NoSuchFileException)throwable).getReason());
      writeCause=false;
    }
 else     if (throwable instanceof OutOfMemoryError) {
      writeVInt(15);
      writeCause=false;
    }
 else     if (throwable instanceof IllegalStateException) {
      writeVInt(16);
    }
 else     if (throwable instanceof LockObtainFailedException) {
      writeVInt(17);
    }
 else {
      ElasticsearchException ex;
      final String name=throwable.getClass().getName();
      if (throwable instanceof ElasticsearchException && ElasticsearchException.isRegistered(name)) {
        ex=(ElasticsearchException)throwable;
      }
 else {
        ex=new NotSerializableExceptionWrapper(throwable);
      }
      writeVInt(0);
      writeString(ex.getClass().getName());
      ex.writeTo(this);
      return;
    }
    if (writeMessage) {
      writeOptionalString(throwable.getMessage());
    }
    if (writeCause) {
      writeThrowable(throwable.getCause());
    }
    ElasticsearchException.writeStackTraces(throwable,this);
  }
}
