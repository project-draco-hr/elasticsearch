{
  final Translog.TranslogGeneration generation=loadTranslogIdFromCommit(writer);
  final TranslogConfig translogConfig=engineConfig.getTranslogConfig();
  if (createNew == false) {
    translogConfig.setTranslogGeneration(generation);
    if (generation != null && generation.translogUUID == null) {
      Translog.upgradeLegacyTranslog(logger,translogConfig);
    }
  }
  final Translog translog=new Translog(translogConfig);
  if (generation == null) {
    if (createNew) {
      throw new IllegalStateException("no tranlog generation present in commit data but tranlog is expected to exists");
    }
    logger.debug("no translog ID present in the current generation - creating one");
    commitIndexWriter(writer,translog);
  }
  return translog;
}
