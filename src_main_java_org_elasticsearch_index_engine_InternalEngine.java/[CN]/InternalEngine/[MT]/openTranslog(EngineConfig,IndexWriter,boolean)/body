{
  final Translog.TranslogGeneration generation=loadTranslogIdFromCommit(writer);
  Translog translog;
  TranslogConfig translogConfig=engineConfig.getTranslogConfig();
  if (createNew) {
    translog=new Translog(translogConfig);
  }
 else {
    translogConfig.setTranslogGeneration(generation);
    if (generation != null && generation.translogUUID == null) {
      Translog.upgradeLegacyTranslog(logger,translogConfig);
    }
    translog=new Translog(translogConfig);
  }
  if (generation == null) {
    logger.debug("no translog ID present in the current generation - creating one");
    commitIndexWriter(writer,translog.getGeneration());
  }
  return translog;
}
