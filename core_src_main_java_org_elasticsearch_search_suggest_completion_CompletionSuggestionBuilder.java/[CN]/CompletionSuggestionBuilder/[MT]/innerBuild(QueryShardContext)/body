{
  CompletionSuggestionContext suggestionContext=new CompletionSuggestionContext(context);
  final MapperService mapperService=context.getMapperService();
  populateCommonFields(mapperService,suggestionContext);
  suggestionContext.setPayloadFields(payloadFields);
  suggestionContext.setFuzzyOptions(fuzzyOptions);
  suggestionContext.setRegexOptions(regexOptions);
  MappedFieldType mappedFieldType=mapperService.fullName(suggestionContext.getField());
  if (mappedFieldType == null) {
    throw new ElasticsearchException("Field [" + suggestionContext.getField() + "] is not a completion suggest field");
  }
 else   if (mappedFieldType instanceof CompletionFieldMapper.CompletionFieldType) {
    CompletionFieldMapper.CompletionFieldType type=(CompletionFieldMapper.CompletionFieldType)mappedFieldType;
    if (type.hasContextMappings() && contextBytes != null) {
      XContentParser contextParser=XContentFactory.xContent(contextBytes).createParser(contextBytes);
      suggestionContext.setQueryContexts(parseQueryContexts(contextParser,type));
    }
 else     if (contextBytes != null) {
      throw new IllegalArgumentException("suggester [" + type.name() + "] doesn't expect any context");
    }
  }
 else {
    throw new IllegalArgumentException("Field [" + suggestionContext.getField() + "] is not a completion suggest field");
  }
  return suggestionContext;
}
