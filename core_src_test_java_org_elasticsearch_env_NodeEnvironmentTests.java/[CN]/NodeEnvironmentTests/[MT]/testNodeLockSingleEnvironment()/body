{
  NodeEnvironment env=newNodeEnvironment(Settings.builder().put("node.max_local_storage_nodes",1).build());
  Settings settings=env.getSettings();
  List<String> dataPaths=Environment.PATH_DATA_SETTING.get(env.getSettings());
  try {
    new NodeEnvironment(settings,new Environment(settings));
    fail("env is already locked");
  }
 catch (  IllegalStateException ex) {
  }
  env.close();
  env=new NodeEnvironment(settings,new Environment(settings));
  assertEquals(env.nodeDataPaths().length,dataPaths.size());
  for (int i=0; i < dataPaths.size(); i++) {
    assertTrue(env.nodeDataPaths()[i].startsWith(PathUtils.get(dataPaths.get(i))));
  }
  env.close();
  assertTrue("LockedShards: " + env.lockedShards(),env.lockedShards().isEmpty());
}
