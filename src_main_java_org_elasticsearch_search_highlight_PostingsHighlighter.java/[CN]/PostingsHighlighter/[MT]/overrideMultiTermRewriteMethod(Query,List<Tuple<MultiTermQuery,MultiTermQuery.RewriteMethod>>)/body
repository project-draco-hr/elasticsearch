{
  if (query instanceof MultiTermQuery) {
    MultiTermQuery originalMultiTermQuery=(MultiTermQuery)query;
    if (!allowsForTermExtraction(originalMultiTermQuery.getRewriteMethod())) {
      MultiTermQuery.RewriteMethod originalRewriteMethod=originalMultiTermQuery.getRewriteMethod();
      originalMultiTermQuery.setRewriteMethod(new MultiTermQuery.TopTermsScoringBooleanQueryRewrite(50));
      modifiedMultiTermQueries.add(Tuple.tuple(originalMultiTermQuery,originalRewriteMethod));
    }
  }
  if (query instanceof BooleanQuery) {
    BooleanQuery booleanQuery=(BooleanQuery)query;
    for (    BooleanClause booleanClause : booleanQuery) {
      overrideMultiTermRewriteMethod(booleanClause.getQuery(),modifiedMultiTermQueries);
    }
  }
  if (query instanceof FilteredQuery) {
    overrideMultiTermRewriteMethod(((FilteredQuery)query).getQuery(),modifiedMultiTermQueries);
  }
  if (query instanceof ConstantScoreQuery) {
    overrideMultiTermRewriteMethod(((ConstantScoreQuery)query).getQuery(),modifiedMultiTermQueries);
  }
}
