{
  Query original=highlighterContext.query.originalQuery();
  List<Tuple<MultiTermQuery,MultiTermQuery.RewriteMethod>> modifiedMultiTermQueries=Lists.newArrayList();
  overrideMultiTermRewriteMethod(original,modifiedMultiTermQueries);
  if (highlighterContext.query.queryRewritten() && modifiedMultiTermQueries.size() == 0) {
    return highlighterContext.query.query();
  }
  Query query=original;
  for (Query rewrittenQuery=query.rewrite(reader); rewrittenQuery != query; rewrittenQuery=query.rewrite(reader)) {
    query=rewrittenQuery;
  }
  for (  Tuple<MultiTermQuery,MultiTermQuery.RewriteMethod> modifiedMultiTermQuery : modifiedMultiTermQueries) {
    modifiedMultiTermQuery.v1().setRewriteMethod(modifiedMultiTermQuery.v2());
  }
  return query;
}
