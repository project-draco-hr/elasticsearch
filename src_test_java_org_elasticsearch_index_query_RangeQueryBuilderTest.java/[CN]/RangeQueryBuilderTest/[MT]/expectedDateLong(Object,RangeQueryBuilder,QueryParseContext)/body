{
  FieldMapper mapper=context.fieldMapper(queryBuilder.fieldName());
  DateMathParser dateParser=null;
  if (queryBuilder.format() != null) {
    dateParser=new DateMathParser(Joda.forPattern(queryBuilder.format()),DateFieldMapper.Defaults.TIME_UNIT);
  }
  DateTimeZone dateTimeZone=null;
  if (queryBuilder.timeZone() != null) {
    dateTimeZone=DateTimeZone.forID(queryBuilder.timeZone());
  }
  Long expectedDate=null;
  if (value != null) {
    expectedDate=((DateFieldMapper)mapper).parseToMilliseconds(value,queryBuilder.includeLower(),dateTimeZone,dateParser);
  }
  return expectedDate;
}
