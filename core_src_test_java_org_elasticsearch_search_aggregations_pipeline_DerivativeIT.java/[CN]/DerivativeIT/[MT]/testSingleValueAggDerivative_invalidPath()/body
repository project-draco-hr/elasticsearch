{
  try {
    client().prepareSearch("idx").addAggregation(histogram("histo").field(SINGLE_VALUED_FIELD_NAME).interval(interval).subAggregation(filters("filters").filter(QueryBuilders.termQuery("tag","foo")).subAggregation(sum("sum").field(SINGLE_VALUED_FIELD_NAME))).subAggregation(derivative("deriv").setBucketsPaths("filters>get>sum"))).execute().actionGet();
    fail("Expected an Exception but didn't get one");
  }
 catch (  Exception e) {
    Throwable cause=ExceptionsHelper.unwrapCause(e);
    if (cause == null) {
      throw e;
    }
 else     if (cause instanceof SearchPhaseExecutionException) {
      ElasticsearchException[] rootCauses=((SearchPhaseExecutionException)cause).guessRootCauses();
      if (rootCauses.length > 1) {
        throw e;
      }
      ElasticsearchException rootCauseWrapper=rootCauses[0];
      Throwable rootCause=rootCauseWrapper.getCause();
      if (rootCause == null || !(rootCause instanceof IllegalArgumentException)) {
        throw e;
      }
    }
 else {
      throw e;
    }
  }
}
