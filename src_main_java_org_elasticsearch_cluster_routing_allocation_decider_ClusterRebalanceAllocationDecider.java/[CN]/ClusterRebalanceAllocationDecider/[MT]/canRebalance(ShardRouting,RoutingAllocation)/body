{
  if (type == ClusterRebalanceType.INDICES_PRIMARIES_ACTIVE) {
    for (    MutableShardRouting shard : allocation.routingNodes().unassigned()) {
      if (shard.primary()) {
        return false;
      }
    }
    for (    RoutingNode node : allocation.routingNodes()) {
      List<MutableShardRouting> shards=node.shards();
      for (int i=0; i < shards.size(); i++) {
        MutableShardRouting shard=shards.get(i);
        if (shard.primary() && !shard.active() && shard.relocatingNodeId() == null) {
          return false;
        }
      }
    }
    return true;
  }
  if (type == ClusterRebalanceType.INDICES_ALL_ACTIVE) {
    if (!allocation.routingNodes().unassigned().isEmpty()) {
      return false;
    }
    for (    RoutingNode node : allocation.routingNodes()) {
      List<MutableShardRouting> shards=node.shards();
      for (int i=0; i < shards.size(); i++) {
        MutableShardRouting shard=shards.get(i);
        if (!shard.active() && shard.relocatingNodeId() == null) {
          return false;
        }
      }
    }
  }
  return true;
}
