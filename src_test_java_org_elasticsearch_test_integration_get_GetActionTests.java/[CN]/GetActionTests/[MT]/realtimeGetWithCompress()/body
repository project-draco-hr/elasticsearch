{
  client.admin().indices().prepareDelete().execute().actionGet();
  client.admin().indices().prepareCreate("test").setSettings(ImmutableSettings.settingsBuilder().put("index.refresh_interval",-1)).addMapping("type",jsonBuilder().startObject().startObject("type").startObject("_source").field("compress",true).endObject().endObject().endObject()).execute().actionGet();
  ClusterHealthResponse clusterHealth=client.admin().cluster().health(clusterHealthRequest().waitForGreenStatus()).actionGet();
  assertThat(clusterHealth.isTimedOut(),equalTo(false));
  assertThat(clusterHealth.getStatus(),equalTo(ClusterHealthStatus.GREEN));
  StringBuilder sb=new StringBuilder();
  for (int i=0; i < 10000; i++) {
    sb.append((char)i);
  }
  String fieldValue=sb.toString();
  client.prepareIndex("test","type","1").setSource("field",fieldValue).execute().actionGet();
  GetResponse getResponse=client.prepareGet("test","type","1").execute().actionGet();
  assertThat(getResponse.isExists(),equalTo(true));
  assertThat(getResponse.getSourceAsMap().get("field").toString(),equalTo(fieldValue));
}
