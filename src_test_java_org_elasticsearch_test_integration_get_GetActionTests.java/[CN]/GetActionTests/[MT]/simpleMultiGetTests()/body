{
  try {
    client().admin().indices().prepareDelete("test").execute().actionGet();
  }
 catch (  Exception e) {
  }
  client().admin().indices().prepareCreate("test").setSettings(ImmutableSettings.settingsBuilder().put("index.refresh_interval",-1)).execute().actionGet();
  ClusterHealthResponse clusterHealth=client().admin().cluster().health(clusterHealthRequest().waitForGreenStatus()).actionGet();
  assertThat(clusterHealth.isTimedOut(),equalTo(false));
  assertThat(clusterHealth.getStatus(),equalTo(ClusterHealthStatus.GREEN));
  MultiGetResponse response=client().prepareMultiGet().add("test","type1","1").execute().actionGet();
  assertThat(response.getResponses().length,equalTo(1));
  assertThat(response.getResponses()[0].getResponse().isExists(),equalTo(false));
  for (int i=0; i < 10; i++) {
    client().prepareIndex("test","type1",Integer.toString(i)).setSource("field","value" + i).execute().actionGet();
  }
  response=client().prepareMultiGet().add("test","type1","1").add("test","type1","15").add("test","type1","3").add("test","type1","9").add("test","type1","11").execute().actionGet();
  assertThat(response.getResponses().length,equalTo(5));
  assertThat(response.getResponses()[0].getId(),equalTo("1"));
  assertThat(response.getResponses()[0].getResponse().isExists(),equalTo(true));
  assertThat(response.getResponses()[0].getResponse().getSourceAsMap().get("field").toString(),equalTo("value1"));
  assertThat(response.getResponses()[1].getId(),equalTo("15"));
  assertThat(response.getResponses()[1].getResponse().isExists(),equalTo(false));
  assertThat(response.getResponses()[2].getId(),equalTo("3"));
  assertThat(response.getResponses()[2].getResponse().isExists(),equalTo(true));
  assertThat(response.getResponses()[3].getId(),equalTo("9"));
  assertThat(response.getResponses()[3].getResponse().isExists(),equalTo(true));
  assertThat(response.getResponses()[4].getId(),equalTo("11"));
  assertThat(response.getResponses()[4].getResponse().isExists(),equalTo(false));
  response=client().prepareMultiGet().add(new MultiGetRequest.Item("test","type1","1").fields("field")).add(new MultiGetRequest.Item("test","type1","3").fields("field")).execute().actionGet();
  assertThat(response.getResponses().length,equalTo(2));
  assertThat(response.getResponses()[0].getResponse().getSourceAsBytes(),nullValue());
  assertThat(response.getResponses()[0].getResponse().getField("field").getValues().get(0).toString(),equalTo("value1"));
}
