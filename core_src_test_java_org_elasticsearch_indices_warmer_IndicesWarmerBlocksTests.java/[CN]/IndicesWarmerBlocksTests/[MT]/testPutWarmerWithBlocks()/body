{
  createIndex("test-blocks");
  ensureGreen("test-blocks");
  try {
    enableIndexBlock("test-blocks",SETTING_BLOCKS_READ);
    assertBlocked(client().admin().indices().preparePutWarmer("warmer_blocked").setSearchRequest(client().prepareSearch("test-*").setTypes("a1").setQuery(QueryBuilders.matchAllQuery())),INDEX_READ_BLOCK);
  }
  finally {
    disableIndexBlock("test-blocks",SETTING_BLOCKS_READ);
  }
  try {
    enableIndexBlock("test-blocks",SETTING_BLOCKS_WRITE);
    assertAcked(client().admin().indices().preparePutWarmer("warmer_acked").setSearchRequest(client().prepareSearch("test-blocks").setTypes("a1").setQuery(QueryBuilders.matchAllQuery())));
  }
  finally {
    disableIndexBlock("test-blocks",SETTING_BLOCKS_WRITE);
  }
  try {
    enableIndexBlock("test-blocks",SETTING_BLOCKS_METADATA);
    assertBlocked(client().admin().indices().preparePutWarmer("warmer_blocked").setSearchRequest(client().prepareSearch("test-*").setTypes("a1").setQuery(QueryBuilders.matchAllQuery())),INDEX_METADATA_BLOCK);
  }
  finally {
    disableIndexBlock("test-blocks",SETTING_BLOCKS_METADATA);
  }
  try {
    enableIndexBlock("test-blocks",SETTING_READ_ONLY);
    assertBlocked(client().admin().indices().preparePutWarmer("warmer_blocked").setSearchRequest(client().prepareSearch("test-*").setTypes("a1").setQuery(QueryBuilders.matchAllQuery())),INDEX_READ_ONLY_BLOCK);
  }
  finally {
    disableIndexBlock("test-blocks",SETTING_READ_ONLY);
  }
  try {
    setClusterReadOnly(true);
    assertBlocked(client().admin().indices().preparePutWarmer("warmer_blocked").setSearchRequest(client().prepareSearch("test-blocks").setTypes("a1").setQuery(QueryBuilders.matchAllQuery())),CLUSTER_READ_ONLY_BLOCK);
  }
  finally {
    setClusterReadOnly(false);
  }
}
