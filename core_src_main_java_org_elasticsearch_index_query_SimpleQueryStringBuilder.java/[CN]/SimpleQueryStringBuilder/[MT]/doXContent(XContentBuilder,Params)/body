{
  builder.startObject(NAME);
  builder.field("query",queryText);
  if (fieldsAndWeights.size() > 0) {
    builder.startArray("fields");
    for (    Map.Entry<String,Float> entry : fieldsAndWeights.entrySet()) {
      String field=entry.getKey();
      Float boost=entry.getValue();
      if (boost != null) {
        builder.value(field + "^" + boost);
      }
 else {
        builder.value(field);
      }
    }
    builder.endArray();
  }
  if (analyzer != null) {
    builder.field("analyzer",analyzer);
  }
  builder.field("flags",flags);
  builder.field("default_operator",defaultOperator.name().toLowerCase(Locale.ROOT));
  builder.field("lowercase_expanded_terms",settings.lowercaseExpandedTerms());
  builder.field("lenient",settings.lenient());
  builder.field("analyze_wildcard",settings.analyzeWildcard());
  builder.field("locale",(settings.locale().toLanguageTag()));
  if (queryName != null) {
    builder.field("_name",queryName);
  }
  if (minimumShouldMatch != null) {
    builder.field("minimum_should_match",minimumShouldMatch);
  }
  if (boost != -1.0f) {
    builder.field("boost",boost);
  }
  builder.endObject();
}
