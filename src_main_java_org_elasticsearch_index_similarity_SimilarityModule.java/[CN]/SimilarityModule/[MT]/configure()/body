{
  MapBinder<String,SimilarityProviderFactory> similarityBinder=MapBinder.newMapBinder(binder(),String.class,SimilarityProviderFactory.class);
  Map<String,Settings> similarityProvidersSettings=settings.getGroups("index.similarity");
  for (  Map.Entry<String,Settings> entry : similarityProvidersSettings.entrySet()) {
    String name=entry.getKey();
    Settings settings=entry.getValue();
    Class<? extends SimilarityProvider> type=settings.getAsClass("type",null,"org.elasticsearch.index.similarity.","SimilarityProvider");
    if (type == null) {
      throw new IllegalArgumentException("Similarity [" + name + "] must have a type associated with it");
    }
    similarityBinder.addBinding(name).toProvider(FactoryProvider.newFactory(SimilarityProviderFactory.class,type)).in(Scopes.SINGLETON);
  }
  bind(SimilarityService.class).in(Scopes.SINGLETON);
}
