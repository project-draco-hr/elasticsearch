{
  assertAcked(prepareCreate("test_index").addAlias(new Alias("test_alias")).get());
  index("test_index","type1","1","field","value");
  flush("test_index");
  final RolloverResponse response=client().admin().indices().prepareRolloverIndex("test_alias").setOptionalTargetAlias("test_alias_2").get();
  assertThat(response.getOldIndex(),equalTo("test_index"));
  assertThat(response.getNewIndex(),equalTo("test_index-1"));
  final ClusterState state=client().admin().cluster().prepareState().get().getState();
  final IndexMetaData oldIndex=state.metaData().index("test_index");
  assertFalse(oldIndex.getAliases().containsKey("test_alias"));
  final IndexMetaData newIndex=state.metaData().index("test_index-1");
  assertTrue(newIndex.getAliases().containsKey("test_alias"));
  assertTrue(newIndex.getAliases().containsKey("test_alias_2"));
}
