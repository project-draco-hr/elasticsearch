{
  final Settings newSettings=indexMetaData.getSettings();
  if (Version.indexCreated(newSettings) != version) {
    throw new IllegalArgumentException("version mismatch on settings update expected: " + version + " but was: "+ Version.indexCreated(newSettings));
  }
  final String newUUID=newSettings.get(IndexMetaData.SETTING_INDEX_UUID,IndexMetaData.INDEX_UUID_NA_VALUE);
  if (newUUID.equals(getUUID()) == false) {
    throw new IllegalArgumentException("uuid mismatch on settings update expected: " + uuid + " but was: "+ newUUID);
  }
  this.indexMetaData=indexMetaData;
  final Settings existingSettings=this.settings;
  if (existingSettings.getByPrefix(IndexMetaData.INDEX_SETTING_PREFIX).getAsMap().equals(newSettings.getByPrefix(IndexMetaData.INDEX_SETTING_PREFIX).getAsMap())) {
    return false;
  }
  this.settings=Settings.builder().put(nodeSettings).put(newSettings).build();
  final Settings mergedSettings=this.settings;
  for (  final Consumer<Settings> consumer : updateListeners) {
    try {
      consumer.accept(mergedSettings);
    }
 catch (    Exception e) {
      logger.warn("failed to refresh index settings for [{}]",e,mergedSettings);
    }
  }
  return true;
}
