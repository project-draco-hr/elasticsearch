{
  builder.startObject("doc");
  Map<IngestDocument.MetaData,String> metadataMap=ingestDocument.extractMetadata();
  for (  Map.Entry<IngestDocument.MetaData,String> metadata : metadataMap.entrySet()) {
    if (metadata.getValue() != null) {
      builder.field(metadata.getKey().getFieldName(),metadata.getValue());
    }
  }
  builder.field("_source",ingestDocument.getSourceAndMetadata());
  builder.startObject("_ingest");
  for (  Map.Entry<String,String> ingestMetadata : ingestDocument.getIngestMetadata().entrySet()) {
    builder.field(ingestMetadata.getKey(),ingestMetadata.getValue());
  }
  builder.endObject();
  builder.endObject();
  return builder;
}
