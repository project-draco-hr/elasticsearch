{
  long clusterSeed=randomLong();
  int minNumDataNodes=randomIntBetween(0,3);
  int maxNumDataNodes=randomIntBetween(minNumDataNodes,4);
  final String clusterName1="shared1";
  final String clusterName2="shared2";
  SettingsSource settingsSource=SettingsSource.EMPTY;
  int numClientNodes=randomIntBetween(0,2);
  boolean enableHttpPipelining=randomBoolean();
  int jvmOrdinal=randomIntBetween(0,10);
  String nodePrefix="foobar";
  Path baseDir=createTempDir();
  InternalTestCluster cluster0=new InternalTestCluster(clusterSeed,baseDir,minNumDataNodes,maxNumDataNodes,clusterName1,settingsSource,numClientNodes,enableHttpPipelining,nodePrefix);
  InternalTestCluster cluster1=new InternalTestCluster(clusterSeed,baseDir,minNumDataNodes,maxNumDataNodes,clusterName2,settingsSource,numClientNodes,enableHttpPipelining,nodePrefix);
  assertClusters(cluster0,cluster1,false);
  long seed=randomLong();
  try {
{
      Random random=new Random(seed);
      cluster0.beforeTest(random,random.nextDouble());
    }
{
      Random random=new Random(seed);
      cluster1.beforeTest(random,random.nextDouble());
    }
    assertArrayEquals(cluster0.getNodeNames(),cluster1.getNodeNames());
    Iterator<Client> iterator1=cluster1.iterator();
    for (    Client client : cluster0) {
      assertTrue(iterator1.hasNext());
      Client other=iterator1.next();
      assertSettings(client.settings(),other.settings(),false);
    }
    assertArrayEquals(cluster0.getNodeNames(),cluster1.getNodeNames());
    cluster0.afterTest();
    cluster1.afterTest();
  }
  finally {
    IOUtils.close(cluster0,cluster1);
  }
}
