{
synchronized (mutex) {
    try {
      raf.increaseRefCount();
      if (useStream) {
        return new FsStreamSnapshot(shardId,this.id,raf,raf.raf().getFilePointer());
      }
 else {
        return new FsChannelSnapshot(shardId,this.id,raf,raf.raf().getFilePointer());
      }
    }
 catch (    IOException e) {
      throw new TranslogException(shardId,"Failed to snapshot",e);
    }
  }
}
