{
synchronized (mutex) {
    FastByteArrayOutputStream bos=cachedBos.get();
    if (bos == null) {
      bos=new FastByteArrayOutputStream();
      cachedBos=new SoftReference<FastByteArrayOutputStream>(bos);
    }
    try {
      bos.reset();
      OutputStreamStreamOutput bosOs=new OutputStreamStreamOutput(bos);
      TranslogStreams.writeTranslogOperation(bosOs,operation);
      bosOs.flush();
      raf.raf().writeInt(bos.size());
      raf.raf().write(bos.unsafeByteArray(),0,bos.size());
    }
 catch (    Exception e) {
      throw new TranslogException(shardId,"Failed to write operation [" + operation + "]",e);
    }
  }
}
