{
  threadPool=new ThreadPool("test");
  client=mock(Client.class);
  Injector injector=mock(Injector.class);
  when(injector.getInstance(Client.class)).thenReturn(client);
  ClusterService clusterService=mock(ClusterService.class);
  when(client.searchScroll(any())).thenReturn(expectedSearchReponse(Collections.emptyList()));
  Environment environment=mock(Environment.class);
  store=new PipelineStore(Settings.EMPTY,injector,threadPool,environment,clusterService,Collections.emptyMap());
  store.start();
}
