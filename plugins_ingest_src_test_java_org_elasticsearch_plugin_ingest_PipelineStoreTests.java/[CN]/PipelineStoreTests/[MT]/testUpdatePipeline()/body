{
  List<InternalSearchHit> hits=new ArrayList<>();
  hits.add(new InternalSearchHit(0,"1",new Text("type"),Collections.emptyMap()).sourceRef(new BytesArray("{\"description\": \"_description1\"}")));
  when(client.search(any())).thenReturn(expectedSearchReponse(hits));
  when(client.get(any())).thenReturn(expectedGetResponse(true));
  assertThat(store.get("1"),nullValue());
  store.updatePipelines();
  assertThat(store.get("1").getId(),equalTo("1"));
  assertThat(store.get("1").getDescription(),equalTo("_description1"));
  when(client.get(any())).thenReturn(expectedGetResponse(true));
  hits.add(new InternalSearchHit(0,"2",new Text("type"),Collections.emptyMap()).sourceRef(new BytesArray("{\"description\": \"_description2\"}")));
  store.updatePipelines();
  assertThat(store.get("1").getId(),equalTo("1"));
  assertThat(store.get("1").getDescription(),equalTo("_description1"));
  assertThat(store.get("2").getId(),equalTo("2"));
  assertThat(store.get("2").getDescription(),equalTo("_description2"));
  hits.remove(1);
  when(client.get(eqGetRequest(PipelineStore.INDEX,PipelineStore.TYPE,"2"))).thenReturn(expectedGetResponse(false));
  store.updatePipelines();
  assertThat(store.get("1").getId(),equalTo("1"));
  assertThat(store.get("1").getDescription(),equalTo("_description1"));
  assertThat(store.get("2"),nullValue());
}
