{
  List<SearchHit> hits=new ArrayList<>();
  hits.add(new InternalSearchHit(0,"1",new StringText("type"),Collections.emptyMap()).sourceRef(new BytesArray("{\"description\": \"_description1\"}")));
  when(client.readAllPipelines()).thenReturn(hits);
  when(client.existPipeline("1")).thenReturn(true);
  assertThat(store.get("1"),nullValue());
  store.updatePipelines();
  assertThat(store.get("1").getId(),equalTo("1"));
  assertThat(store.get("1").getDescription(),equalTo("_description1"));
  when(client.existPipeline("2")).thenReturn(true);
  hits.add(new InternalSearchHit(0,"2",new StringText("type"),Collections.emptyMap()).sourceRef(new BytesArray("{\"description\": \"_description2\"}")));
  store.updatePipelines();
  assertThat(store.get("1").getId(),equalTo("1"));
  assertThat(store.get("1").getDescription(),equalTo("_description1"));
  assertThat(store.get("2").getId(),equalTo("2"));
  assertThat(store.get("2").getDescription(),equalTo("_description2"));
  hits.remove(1);
  when(client.existPipeline("2")).thenReturn(false);
  store.updatePipelines();
  assertThat(store.get("1").getId(),equalTo("1"));
  assertThat(store.get("1").getDescription(),equalTo("_description1"));
  assertThat(store.get("2"),nullValue());
}
