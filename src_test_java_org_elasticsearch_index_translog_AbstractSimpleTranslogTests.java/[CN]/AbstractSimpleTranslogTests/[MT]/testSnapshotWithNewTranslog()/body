{
  Translog.Snapshot snapshot=translog.snapshot();
  MatcherAssert.assertThat(snapshot,TranslogSizeMatcher.translogSize(0));
  snapshot.close();
  translog.add(new Translog.Create("test","1",new byte[]{1}));
  Translog.Snapshot actualSnapshot=translog.snapshot();
  translog.add(new Translog.Index("test","2",new byte[]{2}));
  translog.newTranslog(2);
  translog.add(new Translog.Index("test","3",new byte[]{3}));
  snapshot=translog.snapshot(actualSnapshot);
  MatcherAssert.assertThat(snapshot,TranslogSizeMatcher.translogSize(1));
  snapshot.close();
  snapshot=translog.snapshot(actualSnapshot);
  Translog.Index index=(Translog.Index)snapshot.next();
  assertThat(index != null,equalTo(true));
  assertThat(index.source().toBytes(),equalTo(new byte[]{3}));
  assertThat(snapshot.next(),equalTo(null));
  actualSnapshot.close();
  snapshot.close();
}
