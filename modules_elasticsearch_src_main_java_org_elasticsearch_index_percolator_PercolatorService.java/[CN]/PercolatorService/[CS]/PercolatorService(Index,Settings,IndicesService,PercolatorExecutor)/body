{
  super(index,indexSettings);
  this.indicesService=indicesService;
  this.percolator=percolator;
  this.shardLifecycleListener=new ShardLifecycleListener();
  this.indicesService.indicesLifecycle().addListener(shardLifecycleListener);
  this.percolator.setIndicesService(indicesService);
  if (percolatorAllocated()) {
    IndexService percolatorIndexService=percolatorIndexService();
    if (percolatorIndexService != null) {
      for (      IndexShard indexShard : percolatorIndexService) {
        try {
          indexShard.addListener(realTimePercolatorOperationListener);
        }
 catch (        Exception e) {
        }
      }
    }
  }
}
