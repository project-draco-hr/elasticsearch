{
  builder.startObject("state");
  builder.field("version",state.version());
  builder.startArray("shards");
  for (  Map.Entry<ShardId,Long> entry : state.shards.entrySet()) {
    builder.startObject();
    builder.field("index",entry.getKey().index().name());
    builder.field("id",entry.getKey().id());
    builder.field("version",entry.getValue());
    builder.endObject();
  }
  builder.endArray();
  builder.endObject();
}
