{
{
    assertAcked(prepareCreate("idx").addMapping("type","ip","type=ip","ips","type=ip"));
    IndexRequestBuilder[] builders=new IndexRequestBuilder[255];
    for (int i=0; i < builders.length; i++) {
      builders[i]=client().prepareIndex("idx","type").setSource(jsonBuilder().startObject().field("ip","10.0.0." + (i)).startArray("ips").value("10.0.0." + i).value("10.0.0." + (i + 1)).endArray().field("value",(i < 100 ? 1 : i < 200 ? 2 : 3)).endObject());
    }
    indexRandom(true,builders);
    createIndex("idx_unmapped");
  }
{
    assertAcked(prepareCreate("empty_bucket_idx").addMapping("type","value","type=integer","ip","type=ip"));
    List<IndexRequestBuilder> builders=new ArrayList<>();
    for (int i=0; i < 2; i++) {
      builders.add(client().prepareIndex("empty_bucket_idx","type","" + i).setSource(jsonBuilder().startObject().field("value",i * 2).field("ip","10.0.0.5").endObject()));
    }
    indexRandom(true,builders.toArray(new IndexRequestBuilder[builders.size()]));
  }
{
    assertAcked(prepareCreate("range_idx").addMapping("type","ip","type=ip","ips","type=ip"));
    IndexRequestBuilder[] builders=new IndexRequestBuilder[4];
    builders[0]=client().prepareIndex("range_idx","type").setSource(jsonBuilder().startObject().field("ip","0.0.0.0").endObject());
    builders[1]=client().prepareIndex("range_idx","type").setSource(jsonBuilder().startObject().field("ip","0.0.0.255").endObject());
    builders[2]=client().prepareIndex("range_idx","type").setSource(jsonBuilder().startObject().field("ip","255.255.255.0").endObject());
    builders[3]=client().prepareIndex("range_idx","type").setSource(jsonBuilder().startObject().field("ip","255.255.255.255").endObject());
    indexRandom(true,builders);
  }
  ensureSearchable();
}
