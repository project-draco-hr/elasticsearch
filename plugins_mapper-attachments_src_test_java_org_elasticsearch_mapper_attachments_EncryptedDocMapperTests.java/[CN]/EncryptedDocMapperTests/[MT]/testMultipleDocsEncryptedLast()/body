{
  DocumentMapperParser mapperParser=MapperTestUtils.newMapperService(createTempDir(),Settings.EMPTY).documentMapperParser();
  String mapping=copyToStringFromClasspath("/org/elasticsearch/index/mapper/attachment/test/unit/encrypted/test-mapping.json");
  DocumentMapper docMapper=mapperParser.parse(mapping);
  byte[] html=copyToBytesFromClasspath("/org/elasticsearch/index/mapper/attachment/test/sample-files/htmlWithValidDateMeta.html");
  byte[] pdf=copyToBytesFromClasspath("/org/elasticsearch/index/mapper/attachment/test/sample-files/encrypted.pdf");
  BytesReference json=jsonBuilder().startObject().field("file1",html).field("file2",pdf).endObject().bytes();
  ParseContext.Document doc=docMapper.parse("person","person","1",json).rootDoc();
  assertThat(doc.get(docMapper.mappers().getMapper("file1.content").fieldType().names().indexName()),containsString("World"));
  assertThat(doc.get(docMapper.mappers().getMapper("file1.title").fieldType().names().indexName()),equalTo("Hello"));
  assertThat(doc.get(docMapper.mappers().getMapper("file1.author").fieldType().names().indexName()),equalTo("kimchy"));
  assertThat(doc.get(docMapper.mappers().getMapper("file1.keywords").fieldType().names().indexName()),equalTo("elasticsearch,cool,bonsai"));
  assertThat(doc.get(docMapper.mappers().getMapper("file1.content_type").fieldType().names().indexName()),startsWith("text/html;"));
  assertThat(doc.getField(docMapper.mappers().getMapper("file1.content_length").fieldType().names().indexName()).numericValue().longValue(),is(344L));
  assertThat(doc.get(docMapper.mappers().getMapper("file2").fieldType().names().indexName()),nullValue());
  assertThat(doc.get(docMapper.mappers().getMapper("file2.title").fieldType().names().indexName()),nullValue());
  assertThat(doc.get(docMapper.mappers().getMapper("file2.author").fieldType().names().indexName()),nullValue());
  assertThat(doc.get(docMapper.mappers().getMapper("file2.keywords").fieldType().names().indexName()),nullValue());
  assertThat(doc.get(docMapper.mappers().getMapper("file2.content_type").fieldType().names().indexName()),nullValue());
  assertThat(doc.getField(docMapper.mappers().getMapper("file2.content_length").fieldType().names().indexName()),nullValue());
}
