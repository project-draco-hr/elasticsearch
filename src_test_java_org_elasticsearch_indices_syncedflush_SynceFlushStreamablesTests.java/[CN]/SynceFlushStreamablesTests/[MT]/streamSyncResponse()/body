{
  ShardRouting shardRouting=new ImmutableShardRouting("test",0,"test_node","other_test_node",randomBoolean(),ShardRoutingState.STARTED,randomInt());
  AtomicReferenceArray atomicReferenceArray=new AtomicReferenceArray(1);
  atomicReferenceArray.set(0,new PreSyncedShardFlushResponse(generateRandomId(randomInt(100)),shardRouting));
  PreSyncedFlushResponse preSyncedFlushResponse=new PreSyncedFlushResponse(randomInt(),randomInt(),randomInt(),new ArrayList<ShardOperationFailedException>(),atomicReferenceArray);
  BytesStreamOutput out=new BytesStreamOutput();
  preSyncedFlushResponse.writeTo(out);
  out.close();
  StreamInput in=new BytesStreamInput(out.bytes());
  PreSyncedFlushResponse request=new PreSyncedFlushResponse();
  request.readFrom(in);
  assertArrayEquals(request.commitIds().get(shardRouting),preSyncedFlushResponse.commitIds().get(shardRouting));
}
