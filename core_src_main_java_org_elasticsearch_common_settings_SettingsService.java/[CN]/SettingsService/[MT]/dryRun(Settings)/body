{
  final Settings build=Settings.builder().put(this.settings).put(settings).build();
  try {
    List<RuntimeException> exceptions=new ArrayList<>();
    for (    SettingUpdater settingUpdater : settingUpdaters) {
      try {
        settingUpdater.prepareApply(build);
      }
 catch (      RuntimeException ex) {
        exceptions.add(ex);
        logger.debug("failed to prepareCommit settings for [{}]",ex,settingUpdater);
      }
    }
    ExceptionsHelper.rethrowAndSuppress(exceptions);
  }
  finally {
    for (    SettingUpdater settingUpdater : settingUpdaters) {
      try {
        settingUpdater.rollback();
      }
 catch (      Exception e) {
        logger.warn("failed to rollback settings for [{}]",e,settingUpdater);
      }
    }
  }
  return build;
}
