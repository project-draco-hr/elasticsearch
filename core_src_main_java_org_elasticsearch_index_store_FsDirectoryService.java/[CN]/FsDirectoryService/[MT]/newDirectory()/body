{
  final Path location=path.resolveIndex();
  Files.createDirectories(location);
  Directory wrapped=newFSDirectory(location,indexSettings.getValue(INDEX_LOCK_FACTOR_SETTING));
  if (IndexMetaData.isOnSharedFilesystem(indexSettings.getSettings())) {
    wrapped=new SleepingLockWrapper(wrapped,5000);
  }
  return new RateLimitedFSDirectory(wrapped,this,this);
}
