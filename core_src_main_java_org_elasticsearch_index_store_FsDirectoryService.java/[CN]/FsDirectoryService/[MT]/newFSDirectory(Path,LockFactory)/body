{
  final String storeType=indexSettings.get(IndexModule.STORE_TYPE,IndexModule.Type.DEFAULT.getSettingsKey());
  if (IndexModule.Type.FS.match(storeType) || IndexModule.Type.DEFAULT.match(storeType)) {
    final FSDirectory open=FSDirectory.open(location,lockFactory);
    if (open instanceof MMapDirectory && Constants.WINDOWS == false) {
      return newDefaultDir(location,(MMapDirectory)open,lockFactory);
    }
    return open;
  }
 else   if (IndexModule.Type.SIMPLEFS.match(storeType)) {
    return new SimpleFSDirectory(location,lockFactory);
  }
 else   if (IndexModule.Type.NIOFS.match(storeType)) {
    return new NIOFSDirectory(location,lockFactory);
  }
 else   if (IndexModule.Type.MMAPFS.match(storeType)) {
    return new MMapDirectory(location,lockFactory);
  }
  throw new IllegalArgumentException("No directory found for type [" + storeType + "]");
}
