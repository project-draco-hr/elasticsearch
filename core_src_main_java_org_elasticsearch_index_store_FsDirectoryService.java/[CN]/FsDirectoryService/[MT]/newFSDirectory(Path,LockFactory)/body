{
  final String storeType=indexSettings.get(IndexStoreModule.STORE_TYPE,IndexStoreModule.Type.DEFAULT.getSettingsKey());
  if (IndexStoreModule.Type.FS.match(storeType) || IndexStoreModule.Type.DEFAULT.match(storeType)) {
    final FSDirectory open=FSDirectory.open(location,lockFactory);
    if (open instanceof MMapDirectory && Constants.WINDOWS == false) {
      return newDefaultDir(location,(MMapDirectory)open,lockFactory);
    }
    return open;
  }
 else   if (IndexStoreModule.Type.SIMPLEFS.match(storeType)) {
    return new SimpleFSDirectory(location,lockFactory);
  }
 else   if (IndexStoreModule.Type.NIOFS.match(storeType)) {
    return new NIOFSDirectory(location,lockFactory);
  }
 else   if (IndexStoreModule.Type.MMAPFS.match(storeType)) {
    return new MMapDirectory(location,lockFactory);
  }
  throw new IllegalArgumentException("No directory found for type [" + storeType + "]");
}
