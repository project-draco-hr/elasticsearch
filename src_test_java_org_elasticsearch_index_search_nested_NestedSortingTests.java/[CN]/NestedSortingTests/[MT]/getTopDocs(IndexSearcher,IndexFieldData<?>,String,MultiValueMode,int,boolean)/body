{
  Filter parentFilter=Queries.wrap(new TermQuery(new Term("__type","parent")));
  Filter childFilter=Queries.wrap(new TermQuery(new Term("__type","child")));
  XFieldComparatorSource nestedComparatorSource=indexFieldData.comparatorSource(missingValue,sortMode,createNested(parentFilter,childFilter));
  Query query=new ConstantScoreQuery(parentFilter);
  Sort sort=new Sort(new SortField("f",nestedComparatorSource,reverse));
  return searcher.search(query,n,sort);
}
