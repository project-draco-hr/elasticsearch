{
  Filter parentFilter=new TermFilter(new Term("__type","parent"));
  Filter childFilter=new TermFilter(new Term("__type","child"));
  XFieldComparatorSource innerSource=indexFieldData.comparatorSource(missingValue,sortMode);
  NestedFieldComparatorSource nestedComparatorSource=new NestedFieldComparatorSource(sortMode,innerSource,parentFilter,childFilter);
  Query query=new ConstantScoreQuery(parentFilter);
  Sort sort=new Sort(new SortField("f",nestedComparatorSource,reverse));
  return searcher.search(query,n,sort);
}
