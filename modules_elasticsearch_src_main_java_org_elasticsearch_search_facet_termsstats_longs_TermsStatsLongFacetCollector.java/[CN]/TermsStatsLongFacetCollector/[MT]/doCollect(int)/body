{
  if (!keyFieldData.hasValue(doc)) {
    missing++;
    return;
  }
  long key=keyFieldData.longValue(doc);
  InternalTermsStatsLongFacet.LongEntry LongEntry=entries.get(key);
  if (LongEntry == null) {
    LongEntry=new InternalTermsStatsLongFacet.LongEntry(key,1,0);
    entries.put(key,LongEntry);
  }
 else {
    LongEntry.count++;
  }
  if (script == null) {
    if (valueFieldData.multiValued()) {
      for (      double value : valueFieldData.doubleValues(doc)) {
        LongEntry.total+=value;
      }
    }
 else {
      double value=valueFieldData.doubleValue(doc);
      LongEntry.total+=value;
    }
  }
 else {
    script.setNextDocId(doc);
    double value=script.runAsDouble();
    LongEntry.total+=value;
  }
}
