{
  sortedShardList=searchPhaseController.sortDocs(queryFetchResults.values());
  final InternalSearchResponse internalResponse=searchPhaseController.merge(sortedShardList,queryFetchResults,queryFetchResults);
  String scrollId=null;
  if (request.scroll() != null) {
    scrollId=buildScrollId(request.searchType(),dfsResults);
  }
  searchCache.releaseDfsResults(dfsResults);
  searchCache.releaseQueryFetchResults(queryFetchResults);
  invokeListener(new SearchResponse(internalResponse,scrollId,expectedSuccessfulOps,successulOps.get(),buildShardFailures()));
}
