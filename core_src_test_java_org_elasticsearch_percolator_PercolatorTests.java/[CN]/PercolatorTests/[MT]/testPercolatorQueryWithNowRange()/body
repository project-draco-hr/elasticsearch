{
  client().admin().indices().prepareCreate("test").addMapping("my-type","timestamp","type=date").get();
  ensureGreen();
  client().prepareIndex("test",PercolatorService.TYPE_NAME,"1").setSource(jsonBuilder().startObject().field("query",rangeQuery("timestamp").from("now-1d").to("now")).endObject()).get();
  client().prepareIndex("test",PercolatorService.TYPE_NAME,"2").setSource(jsonBuilder().startObject().field("query",constantScoreQuery(rangeQuery("timestamp").from("now-1d").to("now"))).endObject()).get();
  logger.info("--> Percolate doc with field1=b");
  PercolateResponse response=client().preparePercolate().setIndices("test").setDocumentType("my-type").setPercolateDoc(docBuilder().setDoc("timestamp",System.currentTimeMillis())).get();
  assertMatchCount(response,2l);
  assertThat(response.getMatches(),arrayWithSize(2));
  assertThat(convertFromTextArray(response.getMatches(),"test"),arrayContainingInAnyOrder("1","2"));
}
