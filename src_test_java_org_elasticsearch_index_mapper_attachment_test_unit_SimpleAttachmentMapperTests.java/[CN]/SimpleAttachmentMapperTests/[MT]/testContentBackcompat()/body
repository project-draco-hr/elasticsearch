{
  DocumentMapperParser mapperParser=MapperTestUtils.newMapperParser(ImmutableSettings.builder().put("path.home",createTempDir()).put(IndexMetaData.SETTING_VERSION_CREATED,Version.V_1_4_2.id).build());
  mapperParser.putTypeParser(AttachmentMapper.CONTENT_TYPE,new AttachmentMapper.TypeParser());
  String mapping=copyToStringFromClasspath("/org/elasticsearch/index/mapper/attachment/test/unit/simple/test-mapping.json");
  DocumentMapper docMapper=mapperParser.parse(mapping);
  byte[] html=copyToBytesFromClasspath("/org/elasticsearch/index/mapper/attachment/test/sample-files/testXHTML.html");
  BytesReference json=jsonBuilder().startObject().field("file",html).endObject().bytes();
  ParseContext.Document doc=docMapper.parse("person","1",json).rootDoc();
  assertThat(doc.get("file"),containsString("This document tests the ability of Apache Tika to extract content"));
}
