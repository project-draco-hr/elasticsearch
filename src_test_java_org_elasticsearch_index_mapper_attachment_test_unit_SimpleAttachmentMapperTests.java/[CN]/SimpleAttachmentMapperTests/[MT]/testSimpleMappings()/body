{
  String mapping=copyToStringFromClasspath("/org/elasticsearch/index/mapper/attachment/test/unit/simple/test-mapping.json");
  DocumentMapper docMapper=mapperParser.parse(mapping);
  byte[] html=copyToBytesFromClasspath("/org/elasticsearch/index/mapper/attachment/test/sample-files/testXHTML.html");
  BytesReference json=jsonBuilder().startObject().field("_id",1).field("file",html).endObject().bytes();
  ParseContext.Document doc=docMapper.parse(json).rootDoc();
  assertThat(doc.get(docMapper.mappers().smartName("file.content_type").mapper().names().indexName()),equalTo("application/xhtml+xml"));
  assertThat(doc.get(docMapper.mappers().smartName("file.title").mapper().names().indexName()),equalTo("XHTML test document"));
  assertThat(doc.get(docMapper.mappers().smartName("file").mapper().names().indexName()),containsString("This document tests the ability of Apache Tika to extract content"));
  String builtMapping=docMapper.mappingSource().string();
  docMapper=mapperParser.parse(builtMapping);
  json=jsonBuilder().startObject().field("_id",1).field("file",html).endObject().bytes();
  doc=docMapper.parse(json).rootDoc();
  assertThat(doc.get(docMapper.mappers().smartName("file.content_type").mapper().names().indexName()),equalTo("application/xhtml+xml"));
  assertThat(doc.get(docMapper.mappers().smartName("file.title").mapper().names().indexName()),equalTo("XHTML test document"));
  assertThat(doc.get(docMapper.mappers().smartName("file").mapper().names().indexName()),containsString("This document tests the ability of Apache Tika to extract content"));
}
