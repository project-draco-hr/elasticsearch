{
  assertAcked(prepareCreate("test").addAlias(new Alias("alias")));
  int numDocs=scaledRandomIntBetween(10,100);
  for (int i=0; i < numDocs; i++) {
    client().prepareIndex("test","test",Integer.toString(i)).setRouting(randomAsciiOfLengthBetween(1,5)).setSource("foo","bar").get();
  }
  refresh();
  assertHitCount(client().prepareCount("test").setQuery(QueryBuilders.matchQuery("_id",Integer.toString(between(0,numDocs - 1)))).get(),1);
  assertHitCount(client().prepareCount("test").setQuery(QueryBuilders.matchAllQuery()).get(),numDocs);
  DeleteByQueryResponse deleteByQueryResponse=client().prepareDeleteByQuery(indexOrAlias()).setQuery(QueryBuilders.matchQuery("_id",Integer.toString(between(0,numDocs - 1)))).get();
  assertThat(deleteByQueryResponse.getIndices().size(),equalTo(1));
  assertThat(deleteByQueryResponse.getIndex("test"),notNullValue());
  refresh();
  assertHitCount(client().prepareCount("test").setQuery(QueryBuilders.matchAllQuery()).get(),numDocs - 1);
}
