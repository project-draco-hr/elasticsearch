{
  String json="{" + "\"user\":\"kimchy\"," + "\"postDate\":\"2013-01-30\","+ "\"message\":\"trying out Elastic Search\""+ "}";
  final long iters=randomIntBetween(1,50);
  for (int i=0; i < iters; i++) {
    client().prepareIndex("twitter","tweet","" + i).setSource(json).execute().actionGet();
  }
  refresh();
  SearchResponse search=client().prepareSearch().setQuery(QueryBuilders.matchAllQuery()).execute().actionGet();
  assertThat(search.getHits().totalHits(),equalTo(iters));
  DeleteByQueryRequestBuilder deleteByQueryRequestBuilder=client().prepareDeleteByQuery();
  deleteByQueryRequestBuilder.setQuery(QueryBuilders.matchAllQuery());
  DeleteByQueryResponse response=deleteByQueryRequestBuilder.execute().actionGet();
  assertThat(response.status(),equalTo(RestStatus.OK));
  assertSyncShardInfo(response.getIndex("twitter").getShardInfo(),getNumShards("twitter"));
  client().admin().indices().prepareRefresh().execute().actionGet();
  search=client().prepareSearch().setQuery(QueryBuilders.matchAllQuery()).execute().actionGet();
  assertThat(search.getHits().totalHits(),equalTo(0l));
}
