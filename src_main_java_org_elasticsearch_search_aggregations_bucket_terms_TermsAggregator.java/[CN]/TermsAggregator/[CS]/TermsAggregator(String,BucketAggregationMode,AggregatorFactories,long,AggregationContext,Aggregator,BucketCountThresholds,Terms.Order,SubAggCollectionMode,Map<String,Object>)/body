{
  super(name,bucketAggregationMode,factories,estimatedBucketsCount,context,parent,metaData);
  this.bucketCountThresholds=bucketCountThresholds;
  this.order=InternalOrder.validate(order,this);
  this.subAggCollectMode=subAggCollectMode;
  if (order instanceof Aggregation) {
    OrderPath path=((Aggregation)order).path();
    aggsUsedForSorting.add(path.resolveTopmostAggregator(this));
  }
 else   if (order instanceof CompoundOrder) {
    CompoundOrder compoundOrder=(CompoundOrder)order;
    for (    Terms.Order orderElement : compoundOrder.orderElements()) {
      if (orderElement instanceof Aggregation) {
        OrderPath path=((Aggregation)orderElement).path();
        aggsUsedForSorting.add(path.resolveTopmostAggregator(this));
      }
    }
  }
}
