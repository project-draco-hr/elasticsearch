{
  if (logger.isTraceEnabled()) {
    logger.trace("thrift message {}",request);
  }
  final CountDownLatch latch=new CountDownLatch(1);
  final AtomicReference<org.elasticsearch.thrift.RestResponse> ref=new AtomicReference<org.elasticsearch.thrift.RestResponse>();
  boolean dispatched=restController.dispatchRequest(new ThriftRestRequest(request),new RestChannel(){
    @Override public void sendResponse(    RestResponse response){
      try {
        ref.set(convert(response));
      }
 catch (      IOException e) {
      }
      latch.countDown();
    }
  }
);
  if (!dispatched) {
    try {
      ref.set(convert(new StringRestResponse(BAD_REQUEST,"No handler found for uri [" + request.getUri() + "] and method ["+ request.getMethod()+ "]")));
    }
 catch (    IOException e) {
    }
    latch.countDown();
  }
  try {
    latch.await();
    return ref.get();
  }
 catch (  Exception e) {
    throw new TException("failed to generate response",e);
  }
}
