{
  SearchContext sc=SearchContext.current();
  ChildWeight childWeight;
  boolean releaseCollectorResource=true;
  ParentOrdAndScoreCollector collector=null;
  IndexParentChildFieldData globalIfd=parentChildIndexFieldData.loadGlobal(searcher.getIndexReader());
  if (globalIfd == null) {
    return new BooleanQuery.Builder().build().createWeight(searcher,needsScores);
  }
  try {
    collector=new ParentOrdAndScoreCollector(sc,globalIfd,parentType);
    searcher.search(parentQuery,collector);
    if (collector.parentCount() == 0) {
      return new BooleanQuery.Builder().build().createWeight(searcher,needsScores);
    }
    childWeight=new ChildWeight(this,parentQuery.createWeight(searcher,needsScores),childrenFilter,collector,globalIfd);
    releaseCollectorResource=false;
  }
  finally {
    if (releaseCollectorResource) {
      Releasables.close(collector);
    }
  }
  sc.addReleasable(collector,Lifetime.COLLECTION);
  return childWeight;
}
