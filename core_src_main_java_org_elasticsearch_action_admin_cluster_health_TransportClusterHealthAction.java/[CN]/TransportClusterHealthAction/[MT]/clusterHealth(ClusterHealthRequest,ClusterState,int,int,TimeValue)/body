{
  if (logger.isTraceEnabled()) {
    logger.trace("Calculating health based on state version [{}]",clusterState.version());
  }
  String[] concreteIndices;
  try {
    concreteIndices=indexNameExpressionResolver.concreteIndices(clusterState,request);
  }
 catch (  IndexNotFoundException e) {
    ClusterHealthResponse response=new ClusterHealthResponse(clusterName.value(),Strings.EMPTY_ARRAY,clusterState,numberOfPendingTasks,numberOfInFlightFetch,UnassignedInfo.getNumberOfDelayedUnassigned(clusterState),pendingTaskTimeInQueue);
    response.setStatus(ClusterHealthStatus.RED);
    return response;
  }
  return new ClusterHealthResponse(clusterName.value(),concreteIndices,clusterState,numberOfPendingTasks,numberOfInFlightFetch,UnassignedInfo.getNumberOfDelayedUnassigned(clusterState),pendingTaskTimeInQueue);
}
