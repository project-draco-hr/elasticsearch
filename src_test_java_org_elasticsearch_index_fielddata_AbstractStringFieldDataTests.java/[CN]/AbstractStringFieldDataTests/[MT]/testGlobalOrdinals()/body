{
  fillExtendedMvSet();
  refreshReader();
  FieldDataType fieldDataType=new FieldDataType("string",ImmutableSettings.builder().put("global_ordinals","fixed"));
  IndexFieldData.WithOrdinals ifd=getForField(fieldDataType,"value");
  IndexFieldData.WithOrdinals globalOrdinals=ifd.loadGlobal(topLevelReader);
  assertThat(topLevelReader.leaves().size(),equalTo(3));
  assertThat(globalOrdinals,instanceOf(GlobalOrdinalsIndexFieldData.class));
  AtomicFieldData.WithOrdinals afd=globalOrdinals.load(topLevelReader.leaves().get(0));
  assertThat(afd.getNumDocs(),equalTo(3));
  BytesValues.WithOrdinals values=afd.getBytesValues(randomBoolean());
  Ordinals.Docs ordinals=values.ordinals().ordinals().ordinals();
  assertThat(ordinals.setDocument(0),equalTo(2));
  long ord=ordinals.nextOrd();
  assertThat(ord,equalTo(4l));
  assertThat(values.getValueByOrd(ord).utf8ToString(),equalTo("02"));
  ord=ordinals.nextOrd();
  assertThat(ord,equalTo(6l));
  assertThat(values.getValueByOrd(ord).utf8ToString(),equalTo("04"));
  assertThat(ordinals.setDocument(1),equalTo(0));
  assertThat(ordinals.setDocument(2),equalTo(1));
  ord=ordinals.nextOrd();
  assertThat(ord,equalTo(5l));
  assertThat(values.getValueByOrd(ord).utf8ToString(),equalTo("03"));
  afd=globalOrdinals.load(topLevelReader.leaves().get(1));
  assertThat(afd.getNumDocs(),equalTo(4));
  values=afd.getBytesValues(randomBoolean());
  ordinals=values.ordinals().ordinals().ordinals();
  assertThat(ordinals.setDocument(0),equalTo(3));
  ord=ordinals.nextOrd();
  assertThat(ord,equalTo(6l));
  assertThat(values.getValueByOrd(ord).utf8ToString(),equalTo("04"));
  ord=ordinals.nextOrd();
  assertThat(ord,equalTo(7l));
  assertThat(values.getValueByOrd(ord).utf8ToString(),equalTo("05"));
  ord=ordinals.nextOrd();
  assertThat(ord,equalTo(8l));
  assertThat(values.getValueByOrd(ord).utf8ToString(),equalTo("06"));
  assertThat(ordinals.setDocument(1),equalTo(3));
  ord=ordinals.nextOrd();
  assertThat(ord,equalTo(8l));
  assertThat(values.getValueByOrd(ord).utf8ToString(),equalTo("06"));
  ord=ordinals.nextOrd();
  assertThat(ord,equalTo(9l));
  assertThat(values.getValueByOrd(ord).utf8ToString(),equalTo("07"));
  ord=ordinals.nextOrd();
  assertThat(ord,equalTo(10l));
  assertThat(values.getValueByOrd(ord).utf8ToString(),equalTo("08"));
  assertThat(ordinals.setDocument(2),equalTo(0));
  assertThat(ordinals.setDocument(3),equalTo(3));
  ord=ordinals.nextOrd();
  assertThat(ord,equalTo(10l));
  assertThat(values.getValueByOrd(ord).utf8ToString(),equalTo("08"));
  ord=ordinals.nextOrd();
  assertThat(ord,equalTo(11l));
  assertThat(values.getValueByOrd(ord).utf8ToString(),equalTo("09"));
  ord=ordinals.nextOrd();
  assertThat(ord,equalTo(12l));
  assertThat(values.getValueByOrd(ord).utf8ToString(),equalTo("10"));
  afd=globalOrdinals.load(topLevelReader.leaves().get(2));
  values=afd.getBytesValues(randomBoolean());
  ordinals=values.ordinals().ordinals().ordinals();
  assertThat(afd.getNumDocs(),equalTo(1));
  assertThat(ordinals.setDocument(0),equalTo(3));
  ord=ordinals.nextOrd();
  assertThat(ord,equalTo(1l));
  assertThat(values.getValueByOrd(ord).utf8ToString(),equalTo("!08"));
  ord=ordinals.nextOrd();
  assertThat(ord,equalTo(2l));
  assertThat(values.getValueByOrd(ord).utf8ToString(),equalTo("!09"));
  ord=ordinals.nextOrd();
  assertThat(ord,equalTo(3l));
  assertThat(values.getValueByOrd(ord).utf8ToString(),equalTo("!10"));
}
