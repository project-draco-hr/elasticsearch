{
  fillExtendedMvSet();
  refreshReader();
  FieldDataType fieldDataType=new FieldDataType("string",ImmutableSettings.builder().put("global_values","fixed").put("cache","node"));
  IndexOrdinalsFieldData ifd=getForField(fieldDataType,"value");
  IndexOrdinalsFieldData globalOrdinals=ifd.loadGlobal(topLevelReader);
  assertThat(ifd.loadGlobal(topLevelReader),sameInstance(globalOrdinals));
  assertThat(indicesFieldDataCache.getCache().size(),equalTo(4l));
  IndexOrdinalsFieldData cachedInstance=null;
  for (  Accountable ramUsage : indicesFieldDataCache.getCache().asMap().values()) {
    if (ramUsage instanceof IndexOrdinalsFieldData) {
      cachedInstance=(IndexOrdinalsFieldData)ramUsage;
      break;
    }
  }
  assertThat(cachedInstance,sameInstance(globalOrdinals));
  topLevelReader.close();
  assertThat(indicesFieldDataCache.getCache().size(),equalTo(3l));
  refreshReader();
  assertThat(ifd.loadGlobal(topLevelReader),not(sameInstance(globalOrdinals)));
  ifdService.clear();
  assertThat(indicesFieldDataCache.getCache().size(),equalTo(0l));
}
