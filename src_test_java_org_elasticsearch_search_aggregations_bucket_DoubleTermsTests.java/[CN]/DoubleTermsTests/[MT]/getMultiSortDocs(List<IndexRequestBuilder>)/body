{
  expectedMultiSortBuckets=new HashMap<>();
  Map<String,Object> bucketProps=new HashMap<>();
  bucketProps.put("_term",1d);
  bucketProps.put("_count",3l);
  bucketProps.put("avg_l",1d);
  bucketProps.put("sum_d",6d);
  expectedMultiSortBuckets.put((Double)bucketProps.get("_term"),bucketProps);
  bucketProps=new HashMap<>();
  bucketProps.put("_term",2d);
  bucketProps.put("_count",3l);
  bucketProps.put("avg_l",2d);
  bucketProps.put("sum_d",6d);
  expectedMultiSortBuckets.put((Double)bucketProps.get("_term"),bucketProps);
  bucketProps=new HashMap<>();
  bucketProps.put("_term",3d);
  bucketProps.put("_count",2l);
  bucketProps.put("avg_l",3d);
  bucketProps.put("sum_d",3d);
  expectedMultiSortBuckets.put((Double)bucketProps.get("_term"),bucketProps);
  bucketProps=new HashMap<>();
  bucketProps.put("_term",4d);
  bucketProps.put("_count",2l);
  bucketProps.put("avg_l",3d);
  bucketProps.put("sum_d",4d);
  expectedMultiSortBuckets.put((Double)bucketProps.get("_term"),bucketProps);
  bucketProps=new HashMap<>();
  bucketProps.put("_term",5d);
  bucketProps.put("_count",2l);
  bucketProps.put("avg_l",5d);
  bucketProps.put("sum_d",3d);
  expectedMultiSortBuckets.put((Double)bucketProps.get("_term"),bucketProps);
  bucketProps=new HashMap<>();
  bucketProps.put("_term",6d);
  bucketProps.put("_count",1l);
  bucketProps.put("avg_l",5d);
  bucketProps.put("sum_d",1d);
  expectedMultiSortBuckets.put((Double)bucketProps.get("_term"),bucketProps);
  bucketProps=new HashMap<>();
  bucketProps.put("_term",7d);
  bucketProps.put("_count",1l);
  bucketProps.put("avg_l",5d);
  bucketProps.put("sum_d",1d);
  expectedMultiSortBuckets.put((Double)bucketProps.get("_term"),bucketProps);
  assertAcked(prepareCreate("sort_idx").addMapping("multi_sort_type",SINGLE_VALUED_FIELD_NAME,"type=double"));
  for (int i=1; i <= 3; i++) {
    builders.add(client().prepareIndex("sort_idx","multi_sort_type").setSource(jsonBuilder().startObject().field(SINGLE_VALUED_FIELD_NAME,1).field("l",1).field("d",i).endObject()));
    builders.add(client().prepareIndex("sort_idx","multi_sort_type").setSource(jsonBuilder().startObject().field(SINGLE_VALUED_FIELD_NAME,2).field("l",2).field("d",i).endObject()));
  }
  builders.add(client().prepareIndex("sort_idx","multi_sort_type").setSource(jsonBuilder().startObject().field(SINGLE_VALUED_FIELD_NAME,3).field("l",3).field("d",1).endObject()));
  builders.add(client().prepareIndex("sort_idx","multi_sort_type").setSource(jsonBuilder().startObject().field(SINGLE_VALUED_FIELD_NAME,3).field("l",3).field("d",2).endObject()));
  builders.add(client().prepareIndex("sort_idx","multi_sort_type").setSource(jsonBuilder().startObject().field(SINGLE_VALUED_FIELD_NAME,4).field("l",3).field("d",1).endObject()));
  builders.add(client().prepareIndex("sort_idx","multi_sort_type").setSource(jsonBuilder().startObject().field(SINGLE_VALUED_FIELD_NAME,4).field("l",3).field("d",3).endObject()));
  builders.add(client().prepareIndex("sort_idx","multi_sort_type").setSource(jsonBuilder().startObject().field(SINGLE_VALUED_FIELD_NAME,5).field("l",5).field("d",1).endObject()));
  builders.add(client().prepareIndex("sort_idx","multi_sort_type").setSource(jsonBuilder().startObject().field(SINGLE_VALUED_FIELD_NAME,5).field("l",5).field("d",2).endObject()));
  builders.add(client().prepareIndex("sort_idx","multi_sort_type").setSource(jsonBuilder().startObject().field(SINGLE_VALUED_FIELD_NAME,6).field("l",5).field("d",1).endObject()));
  builders.add(client().prepareIndex("sort_idx","multi_sort_type").setSource(jsonBuilder().startObject().field(SINGLE_VALUED_FIELD_NAME,7).field("l",5).field("d",1).endObject()));
}
