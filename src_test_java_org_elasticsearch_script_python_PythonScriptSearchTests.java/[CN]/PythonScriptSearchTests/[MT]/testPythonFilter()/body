{
  client.admin().indices().prepareCreate("test").execute().actionGet();
  client.prepareIndex("test","type1","1").setSource(jsonBuilder().startObject().field("test","value beck").field("num1",1.0f).endObject()).execute().actionGet();
  client.admin().indices().prepareFlush().execute().actionGet();
  client.prepareIndex("test","type1","2").setSource(jsonBuilder().startObject().field("test","value beck").field("num1",2.0f).endObject()).execute().actionGet();
  client.admin().indices().prepareFlush().execute().actionGet();
  client.prepareIndex("test","type1","3").setSource(jsonBuilder().startObject().field("test","value beck").field("num1",3.0f).endObject()).execute().actionGet();
  client.admin().indices().refresh(refreshRequest()).actionGet();
  logger.info("running doc['num1'].value > 1");
  SearchResponse response=client.prepareSearch().setQuery(filteredQuery(matchAllQuery(),scriptFilter("doc['num1'].value > 1").lang("python"))).addSort("num1",SortOrder.ASC).addScriptField("sNum1","python","doc['num1'].value",null).execute().actionGet();
  assertThat(response.getHits().totalHits(),equalTo(2l));
  assertThat(response.getHits().getAt(0).id(),equalTo("2"));
  assertThat((Double)response.getHits().getAt(0).fields().get("sNum1").values().get(0),equalTo(2.0));
  assertThat(response.getHits().getAt(1).id(),equalTo("3"));
  assertThat((Double)response.getHits().getAt(1).fields().get("sNum1").values().get(0),equalTo(3.0));
  logger.info("running doc['num1'].value > param1");
  response=client.prepareSearch().setQuery(filteredQuery(matchAllQuery(),scriptFilter("doc['num1'].value > param1").lang("python").addParam("param1",2))).addSort("num1",SortOrder.ASC).addScriptField("sNum1","python","doc['num1'].value",null).execute().actionGet();
  assertThat(response.getHits().totalHits(),equalTo(1l));
  assertThat(response.getHits().getAt(0).id(),equalTo("3"));
  assertThat((Double)response.getHits().getAt(0).fields().get("sNum1").values().get(0),equalTo(3.0));
  logger.info("running doc['num1'].value > param1");
  response=client.prepareSearch().setQuery(filteredQuery(matchAllQuery(),scriptFilter("doc['num1'].value > param1").lang("python").addParam("param1",-1))).addSort("num1",SortOrder.ASC).addScriptField("sNum1","python","doc['num1'].value",null).execute().actionGet();
  assertThat(response.getHits().totalHits(),equalTo(3l));
  assertThat(response.getHits().getAt(0).id(),equalTo("1"));
  assertThat((Double)response.getHits().getAt(0).fields().get("sNum1").values().get(0),equalTo(1.0));
  assertThat(response.getHits().getAt(1).id(),equalTo("2"));
  assertThat((Double)response.getHits().getAt(1).fields().get("sNum1").values().get(0),equalTo(2.0));
  assertThat(response.getHits().getAt(2).id(),equalTo("3"));
  assertThat((Double)response.getHits().getAt(2).fields().get("sNum1").values().get(0),equalTo(3.0));
}
