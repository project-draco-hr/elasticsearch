{
  wipeIndices("test");
  createIndex("test");
  index("test","type1","1",jsonBuilder().startObject().field("myfield","foo").endObject());
  refresh();
  client().prepareUpdate("test","type1","1").setScriptLang("python").setScript("ctx[\"_source\"][\"myfield\"]=\"bar\"").execute().actionGet();
  refresh();
  Object value=get("test","type1","1").getSourceAsMap().get("myfield");
  assertThat(value instanceof String,is(true));
  assertThat((String)value,CoreMatchers.equalTo("bar"));
}
