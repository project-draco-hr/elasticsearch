{
  client().admin().indices().preparePutTemplate(IngestBootstrapper.INGEST_INDEX_TEMPLATE_NAME).setTemplate(".ingest").get();
  GetIndexTemplatesResponse response=client().admin().indices().prepareGetTemplates(IngestBootstrapper.INGEST_INDEX_TEMPLATE_NAME).get();
  assertThat(response.getIndexTemplates().size(),Matchers.equalTo(1));
  assertThat(response.getIndexTemplates().get(0).getOrder(),Matchers.equalTo(0));
  ClusterState clusterState=client().admin().cluster().prepareState().get().getState();
  bootstrapper.clusterChanged(new ClusterChangedEvent("test",clusterState,clusterState));
  response=client().admin().indices().prepareGetTemplates(IngestBootstrapper.INGEST_INDEX_TEMPLATE_NAME).get();
  assertThat(response.getIndexTemplates().size(),Matchers.equalTo(1));
  assertThat("The empty index template shouldn't get overwritten",response.getIndexTemplates().get(0).getOrder(),Matchers.equalTo(0));
  assertThat("The empty index template shouldn't get overwritten",response.getIndexTemplates().get(0).getMappings().size(),Matchers.equalTo(0));
}
