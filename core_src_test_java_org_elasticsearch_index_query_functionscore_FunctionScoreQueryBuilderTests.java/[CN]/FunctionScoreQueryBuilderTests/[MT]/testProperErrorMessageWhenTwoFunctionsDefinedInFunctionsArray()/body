{
  String functionScoreQuery="{\n" + "    \"function_score\":{\n" + "        \"functions\":  [\n"+ "            {\n"+ "                \"random_score\":  {\n"+ "                    \"seed\":123456\n"+ "                },\n"+ "                \"weight\": 3,\n"+ "                \"script_score\": {\n"+ "                    \"script\": \"_index['text']['foo'].tf()\"\n"+ "                },\n"+ "                \"filter\": {\n"+ "                    \"term\":{\n"+ "                        \"field2\":\"value2\"\n"+ "                    }\n"+ "                }\n"+ "            }\n"+ "        ]\n"+ "    }\n"+ "}";
  try {
    parseQuery(functionScoreQuery);
    fail("parsing should have failed");
  }
 catch (  ParsingException e) {
    assertThat(e.getMessage(),containsString("failed to parse function_score functions. already found [random_score], now encountering [script_score]."));
  }
}
