{
  try (BytesStreamOutput output=new BytesStreamOutput()){
    output.writeNamedWriteable(query);
    try (StreamInput in=new NamedWriteableAwareStreamInput(StreamInput.wrap(output.bytes()),serviceHolder.namedWriteableRegistry)){
      return (QB)in.readNamedWriteable(QueryBuilder.class);
    }
   }
 }
