{
  final String node_1=internalCluster().startNode(settingsBuilder().put("path.data",newTempDirPath()).build());
  client().prepareIndex("test","type1","1").setSource("field","value").execute().actionGet();
  internalCluster().startNode(settingsBuilder().put("path.data",newTempDirPath()).build());
  ensureGreen();
  internalCluster().fullRestart(new RestartCallback(){
    @Override public boolean doRestart(    String nodeName){
      return !node_1.equals(nodeName);
    }
  }
);
  ensureYellow();
  assertThat(client().admin().indices().prepareExists("test").execute().actionGet().isExists(),equalTo(true));
  assertHitCount(client().prepareCount("test").setQuery(QueryBuilders.matchAllQuery()).execute().actionGet(),1);
}
