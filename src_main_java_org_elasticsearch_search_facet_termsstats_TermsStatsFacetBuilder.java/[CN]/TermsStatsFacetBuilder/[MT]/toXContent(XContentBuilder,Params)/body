{
  if (keyField == null) {
    throw new SearchSourceBuilderException("key field must be set on terms facet for facet [" + name + "]");
  }
  if (valueField == null && script == null) {
    throw new SearchSourceBuilderException("value field or value script must be set on terms facet for facet [" + name + "]");
  }
  builder.startObject(name);
  builder.startObject(TermsStatsFacet.TYPE);
  builder.field("key_field",keyField);
  if (valueField != null) {
    builder.field("value_field",valueField);
  }
  if (script != null) {
    builder.field("value_script",script);
    if (lang != null) {
      builder.field("lang",lang);
    }
    if (this.params != null) {
      builder.field("params",this.params);
    }
  }
  if (comparatorType != null) {
    builder.field("order",comparatorType.name().toLowerCase(Locale.ROOT));
  }
  if (size != -1) {
    builder.field("size",size);
  }
  builder.endObject();
  addFilterFacetAndGlobal(builder,params);
  builder.endObject();
  return builder;
}
