{
  BoolQueryBuilder boolQueryBuilder=new BoolQueryBuilder();
  boolQueryBuilder.must(new WrapperQueryBuilder(new WrapperQueryBuilder(new MatchAllQueryBuilder().toString()).toString()));
  QueryBuilder<?> rewritten=boolQueryBuilder.rewrite(queryShardContext());
  BoolQueryBuilder expected=new BoolQueryBuilder();
  expected.must(new WrapperQueryBuilder(new MatchAllQueryBuilder().toString()));
  assertEquals(expected,rewritten);
  expected=new BoolQueryBuilder();
  expected.must(new MatchAllQueryBuilder());
  QueryBuilder<?> rewrittenAgain=rewritten.rewrite(queryShardContext());
  assertEquals(rewrittenAgain,expected);
  assertEquals(QueryBuilder.rewriteQuery(boolQueryBuilder,queryShardContext()),expected);
}
