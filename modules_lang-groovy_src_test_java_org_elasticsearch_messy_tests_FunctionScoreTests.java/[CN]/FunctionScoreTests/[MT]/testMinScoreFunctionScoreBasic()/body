{
  index(INDEX,TYPE,jsonBuilder().startObject().field("num",2).endObject());
  refresh();
  float score=randomFloat();
  float minScore=randomFloat();
  SearchResponse searchResponse=client().search(searchRequest().source(searchSource().query(functionScoreQuery(scriptFunction(new Script(Float.toString(score)))).setMinScore(minScore)))).actionGet();
  if (score < minScore) {
    assertThat(searchResponse.getHits().getTotalHits(),is(0L));
  }
 else {
    assertThat(searchResponse.getHits().getTotalHits(),is(1L));
  }
  searchResponse=client().search(searchRequest().source(searchSource().query(functionScoreQuery(new MatchAllQueryBuilder(),new FilterFunctionBuilder[]{new FilterFunctionBuilder(scriptFunction(new Script(Float.toString(score)))),new FilterFunctionBuilder(scriptFunction(new Script(Float.toString(score))))}).scoreMode(FiltersFunctionScoreQuery.ScoreMode.AVG).setMinScore(minScore)))).actionGet();
  if (score < minScore) {
    assertThat(searchResponse.getHits().getTotalHits(),is(0L));
  }
 else {
    assertThat(searchResponse.getHits().getTotalHits(),is(1L));
  }
}
