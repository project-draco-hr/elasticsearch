{
  if (host == null) {
    host=defaultValue1;
  }
  if (host == null) {
    host=defaultValue2;
  }
  if (host == null) {
    return null;
  }
  if ((host.startsWith("#") && host.endsWith("#")) || (host.startsWith("_") && host.endsWith("_"))) {
    host=host.substring(1,host.length() - 1);
    CustomNameResolver customNameResolver=customNameResolvers.get(host);
    if (customNameResolver != null) {
      return customNameResolver.resolve();
    }
    if (host.equals("local")) {
      return NetworkUtils.getLocalAddress();
    }
 else     if (host.startsWith("non_loopback")) {
      if (host.toLowerCase().endsWith(":ipv4")) {
        return NetworkUtils.getFirstNonLoopbackAddress(NetworkUtils.StackType.IPv4);
      }
 else       if (host.toLowerCase().endsWith(":ipv6")) {
        return NetworkUtils.getFirstNonLoopbackAddress(NetworkUtils.StackType.IPv6);
      }
 else {
        return NetworkUtils.getFirstNonLoopbackAddress(NetworkUtils.getIpStackType());
      }
    }
 else {
      Collection<NetworkInterface> allInterfs=NetworkUtils.getAllAvailableInterfaces();
      for (      NetworkInterface ni : allInterfs) {
        if (!ni.isUp() || ni.isLoopback()) {
          continue;
        }
        if (host.equals(ni.getName()) || host.equals(ni.getDisplayName())) {
          return NetworkUtils.getFirstNonLoopbackAddress(ni,NetworkUtils.getIpStackType());
        }
      }
    }
    throw new IOException("Failed to find network interface for [" + host + "]");
  }
  return InetAddress.getByName(host);
}
