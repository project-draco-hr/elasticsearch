{
  while (true) {
    boolean currentReference=counter.getReference();
    int stamp=counter.getStamp();
    boolean result=counter.compareAndSet(currentReference,currentReference,stamp,stamp - 1);
    if (result) {
      if (currentReference && (stamp <= 1)) {
        close();
      }
      return;
    }
  }
}
