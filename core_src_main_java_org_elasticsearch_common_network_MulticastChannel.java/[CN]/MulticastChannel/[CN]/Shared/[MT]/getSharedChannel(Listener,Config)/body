{
synchronized (mutex) {
    Shared shared=sharedChannels.get(config);
    if (shared != null) {
      shared.incRef();
      ((MultiListener)shared.listener).add(listener);
    }
 else {
      MultiListener multiListener=new MultiListener();
      multiListener.add(listener);
      shared=new Shared(multiListener,new Plain(multiListener,SHARED_CHANNEL_NAME,config));
      sharedChannels.put(config,shared);
    }
    return new Delegate(listener,shared);
  }
}
