{
synchronized (sendMutex) {
    try {
      HandlesStreamOutput out=BytesStreamOutput.Cached.cachedHandles();
      out.writeInt(id);
      clusterName.writeTo(out);
      nodesProvider.nodes().localNode().writeTo(out);
      datagramPacketSend.setData(((BytesStreamOutput)out.wrappedOut()).copiedByteArray());
    }
 catch (    IOException e) {
      receivedResponses.remove(id);
      throw new ZenPingException("Failed to serialize ping request",e);
    }
    try {
      multicastSocket.send(datagramPacketSend);
      if (logger.isTraceEnabled()) {
        logger.trace("[{}] sending ping request",id);
      }
    }
 catch (    IOException e) {
      receivedResponses.remove(id);
      throw new ZenPingException("Failed to send ping request over multicast",e);
    }
  }
}
