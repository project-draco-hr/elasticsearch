{
  Index index=new Index("test");
  Settings settings=ImmutableSettings.settingsBuilder().put("index.analysis.filter.myCollator.type","icu_collation").put("index.analysis.filter.myCollator.language","en").put("index.analysis.filter.myCollator.strength","primary").put("index.analysis.filter.myCollator.caseLevel","true").build();
  AnalysisService analysisService=createAnalysisService(settings);
  String withAccents="r??sum??";
  String withoutAccents="resume";
  String withAccentsUpperCase="R??sum??";
  String withoutAccentsUpperCase="Resume";
  TokenFilterFactory filterFactory=analysisService.tokenFilter("myCollator");
  TokenStream tsWithAccents=filterFactory.create(new KeywordTokenizer(new StringReader(withAccents)));
  TokenStream tsWithoutAccents=filterFactory.create(new KeywordTokenizer(new StringReader(withoutAccents)));
  assertCollatesToSame(tsWithAccents,tsWithoutAccents);
  TokenStream tsWithAccentsUpperCase=filterFactory.create(new KeywordTokenizer(new StringReader(withAccentsUpperCase)));
  TokenStream tsWithoutAccentsUpperCase=filterFactory.create(new KeywordTokenizer(new StringReader(withoutAccentsUpperCase)));
  assertCollatesToSame(tsWithAccentsUpperCase,tsWithoutAccentsUpperCase);
  TokenStream tsLower=filterFactory.create(new KeywordTokenizer(new StringReader(withoutAccents)));
  TokenStream tsUpper=filterFactory.create(new KeywordTokenizer(new StringReader(withoutAccentsUpperCase)));
  assertCollation(tsLower,tsUpper,-1);
}
