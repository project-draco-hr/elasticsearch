{
  final Map<String,StorageMetadata> allMetaDatas=Maps.newHashMap();
  String nextMarker=null;
  while (true) {
    ListContainerOptions options=ListContainerOptions.Builder.recursive();
    if (prefix != null) {
      options=options.inDirectory(prefix);
    }
    if (nextMarker != null) {
      options.afterMarker(nextMarker);
    }
    PageSet<? extends StorageMetadata> pageSet=cloudBlobStore.sync().list(container,options);
    for (    StorageMetadata metadata : pageSet) {
      allMetaDatas.put(metadata.getName(),metadata);
    }
    nextMarker=pageSet.getNextMarker();
    if (nextMarker == null) {
      break;
    }
  }
  return allMetaDatas;
}
