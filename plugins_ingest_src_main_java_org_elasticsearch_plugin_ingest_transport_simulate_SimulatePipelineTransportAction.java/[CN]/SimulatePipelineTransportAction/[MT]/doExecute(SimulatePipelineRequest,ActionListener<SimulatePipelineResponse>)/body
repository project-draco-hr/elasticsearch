{
  Map<String,Object> source=XContentHelper.convertToMap(request.getSource(),false).v2();
  ParsedSimulateRequest simulateRequest;
  ParsedSimulateRequest.Parser parser=new ParsedSimulateRequest.Parser();
  try {
    if (request.getId() != null) {
      simulateRequest=parser.parseWithPipelineId(request.getId(),source,request.isVerbose(),pipelineStore);
    }
 else {
      simulateRequest=parser.parse(source,request.isVerbose(),pipelineStore);
    }
  }
 catch (  IOException e) {
    listener.onFailure(e);
    return;
  }
  executionService.execute(simulateRequest,listener);
}
