{
  Object retVal=super.encode(ctx,channel,msg);
  if (retVal instanceof CompositeChannelBuffer) {
    CompositeChannelBuffer ccb=(CompositeChannelBuffer)retVal;
    if (ccb.useGathering() != NettyUtils.DEFAULT_GATHERING) {
      List<ChannelBuffer> decompose=ccb.decompose(ccb.readerIndex(),ccb.readableBytes());
      return ChannelBuffers.wrappedBuffer(NettyUtils.DEFAULT_GATHERING,decompose.toArray(new ChannelBuffer[decompose.size()]));
    }
  }
  return retVal;
}
