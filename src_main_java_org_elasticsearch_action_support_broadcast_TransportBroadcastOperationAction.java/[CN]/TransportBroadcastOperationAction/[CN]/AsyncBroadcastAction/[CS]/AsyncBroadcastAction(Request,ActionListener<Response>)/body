{
  this.request=request;
  this.listener=listener;
  clusterState=clusterService.state();
  concreteIndices=clusterState.metaData().concreteIndices(request.indices(),false,true);
  checkBlock(request,concreteIndices,clusterState);
  nodes=clusterState.nodes();
  shardsIts=shards(request,concreteIndices,clusterState);
  expectedOps=shardsIts.size();
  shardsResponses=new AtomicReferenceArray<Object>(expectedOps);
}
