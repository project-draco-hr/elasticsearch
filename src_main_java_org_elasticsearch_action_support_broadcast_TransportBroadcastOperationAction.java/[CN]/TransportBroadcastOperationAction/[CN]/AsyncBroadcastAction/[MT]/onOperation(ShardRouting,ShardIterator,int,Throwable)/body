{
  setFailure(shardIt,shardIndex,t);
  ShardRouting nextShard=shardIt.nextOrNull();
  if (nextShard != null) {
    if (t != null) {
      if (logger.isTraceEnabled()) {
        if (!ignoreException(t)) {
          if (shard != null) {
            logger.trace(shard.shortSummary() + ": Failed to execute [" + request+ "]",t);
          }
 else {
            logger.trace(shardIt.shardId() + ": Failed to execute [" + request+ "]",t);
          }
        }
      }
    }
    performOperation(shardIt,nextShard,shardIndex,true);
  }
 else {
    if (logger.isDebugEnabled()) {
      if (t != null) {
        if (!ignoreException(t)) {
          if (shard != null) {
            logger.debug(shard.shortSummary() + ": Failed to execute [" + request+ "]",t);
          }
 else {
            logger.debug(shardIt.shardId() + ": Failed to execute [" + request+ "]",t);
          }
        }
      }
    }
    if (expectedOps == counterOps.incrementAndGet()) {
      finishHim();
    }
  }
}
