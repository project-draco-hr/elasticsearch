{
  if (!accumulateExceptions()) {
    return;
  }
  if (ignoreNonActiveExceptions() && t instanceof NoShardAvailableActionException) {
    return;
  }
  if (ignoreException(t)) {
    return;
  }
  if (!(t instanceof BroadcastShardOperationFailedException)) {
    t=new BroadcastShardOperationFailedException(shardIt.shardId(),t);
  }
  Object response=shardsResponses.get(shardIndex);
  if (response == null) {
    shardsResponses.set(shardIndex,t);
  }
  if (!(response instanceof Throwable)) {
    return;
  }
  if (isOverrideException(t)) {
    shardsResponses.set(shardIndex,t);
  }
}
