{
  if (Names.TREE_GEOHASH.equals(tree)) {
    prefixTree=new GeohashPrefixTree(ShapeBuilder.SPATIAL_CONTEXT,getLevels(treeLevels,precisionInMeters,Defaults.GEOHASH_LEVELS,true));
  }
 else   if (Names.TREE_QUADTREE.equals(tree)) {
    if (context.indexCreatedVersion().before(Version.V_1_6_0)) {
      prefixTree=new QuadPrefixTree(ShapeBuilder.SPATIAL_CONTEXT,getLevels(treeLevels,precisionInMeters,Defaults.QUADTREE_LEVELS,false));
    }
 else {
      prefixTree=new PackedQuadPrefixTree(ShapeBuilder.SPATIAL_CONTEXT,getLevels(treeLevels,precisionInMeters,Defaults.QUADTREE_LEVELS,false));
    }
  }
 else {
    throw new IllegalArgumentException("Unknown prefix tree type [" + tree + "]");
  }
  setupFieldType(context);
  RecursivePrefixTreeStrategy recursiveStrategy=new RecursivePrefixTreeStrategy(prefixTree,fieldType.names().indexName());
  recursiveStrategy.setDistErrPct(distanceErrorPct);
  recursiveStrategy.setPruneLeafyBranches(false);
  TermQueryPrefixTreeStrategy termStrategy=new TermQueryPrefixTreeStrategy(prefixTree,fieldType.names().indexName());
  termStrategy.setDistErrPct(distanceErrorPct);
  GeoShapeFieldType geoShapeFieldType=(GeoShapeFieldType)fieldType;
  geoShapeFieldType.setStrategies(strategyName,recursiveStrategy,termStrategy);
  geoShapeFieldType.setOrientation(orientation);
  return new GeoShapeFieldMapper(fieldType,context.indexSettings(),multiFieldsBuilder.build(this,context),copyTo);
}
