{
  final FieldMapper.Names names=buildNames(context);
  if (Names.TREE_GEOHASH.equals(tree)) {
    prefixTree=new GeohashPrefixTree(ShapeBuilder.SPATIAL_CONTEXT,getLevels(treeLevels,precisionInMeters,Defaults.GEOHASH_LEVELS,true));
  }
 else   if (Names.TREE_QUADTREE.equals(tree)) {
    if (context.indexCreatedVersion().before(Version.V_1_6_0)) {
      prefixTree=new QuadPrefixTree(ShapeBuilder.SPATIAL_CONTEXT,getLevels(treeLevels,precisionInMeters,Defaults.QUADTREE_LEVELS,false));
    }
 else {
      prefixTree=new PackedQuadPrefixTree(ShapeBuilder.SPATIAL_CONTEXT,getLevels(treeLevels,precisionInMeters,Defaults.QUADTREE_LEVELS,false));
    }
  }
 else {
    throw new IllegalArgumentException("Unknown prefix tree type [" + tree + "]");
  }
  return new GeoShapeFieldMapper(names,prefixTree,strategyName,distanceErrorPct,orientation,fieldType,context.indexSettings(),multiFieldsBuilder.build(this,context),copyTo);
}
