{
  MetaData metaData=MetaData.builder().put(IndexMetaData.builder("test1").numberOfShards(1).numberOfReplicas(2)).put(IndexMetaData.builder("test2").settings(settingsBuilder().put("setting1","value1").put("setting2","value2")).numberOfShards(2).numberOfReplicas(3)).put(IndexMetaData.builder("test3").numberOfShards(1).numberOfReplicas(2).putMapping("mapping1",MAPPING_SOURCE1)).put(IndexMetaData.builder("test4").settings(settingsBuilder().put("setting1","value1").put("setting2","value2")).numberOfShards(1).numberOfReplicas(2).putMapping("mapping1",MAPPING_SOURCE1).putMapping("mapping2",MAPPING_SOURCE2)).put(IndexMetaData.builder("test5").settings(settingsBuilder().put("setting1","value1").put("setting2","value2")).numberOfShards(1).numberOfReplicas(2).putMapping("mapping1",MAPPING_SOURCE1).putMapping("mapping2",MAPPING_SOURCE2).putAlias(newAliasMetaDataBuilder("alias1")).putAlias(newAliasMetaDataBuilder("alias2"))).put(IndexMetaData.builder("test6").settings(settingsBuilder().put("setting1","value1").put("setting2","value2").put("index.aliases.0","alias3").put("index.aliases.1","alias1")).numberOfShards(1).numberOfReplicas(2).putMapping("mapping1",MAPPING_SOURCE1).putMapping("mapping2",MAPPING_SOURCE2).putAlias(newAliasMetaDataBuilder("alias1")).putAlias(newAliasMetaDataBuilder("alias2"))).put(IndexMetaData.builder("test7").settings(settingsBuilder().put("setting1","value1").put("setting2","value2").put("index.aliases.0","alias3").put("index.aliases.1","alias1")).numberOfShards(1).numberOfReplicas(2).putMapping("mapping1",MAPPING_SOURCE1).putMapping("mapping2",MAPPING_SOURCE2).putAlias(newAliasMetaDataBuilder("alias1").filter(ALIAS_FILTER1)).putAlias(newAliasMetaDataBuilder("alias2")).putAlias(newAliasMetaDataBuilder("alias4").filter(ALIAS_FILTER2))).put(IndexTemplateMetaData.builder("foo").template("bar").order(1).settings(settingsBuilder().put("setting1","value1").put("setting2","value2"))).build();
  String metaDataSource=MetaData.Builder.toXContent(metaData);
  MetaData parsedMetaData=MetaData.Builder.fromXContent(XContentFactory.xContent(XContentType.JSON).createParser(metaDataSource));
  IndexMetaData indexMetaData=parsedMetaData.index("test1");
  assertThat(indexMetaData.numberOfShards(),equalTo(1));
  assertThat(indexMetaData.numberOfReplicas(),equalTo(2));
  assertThat(indexMetaData.settings().getAsMap().size(),equalTo(2));
  assertThat(indexMetaData.mappings().size(),equalTo(0));
  indexMetaData=parsedMetaData.index("test2");
  assertThat(indexMetaData.numberOfShards(),equalTo(2));
  assertThat(indexMetaData.numberOfReplicas(),equalTo(3));
  assertThat(indexMetaData.settings().getAsMap().size(),equalTo(4));
  assertThat(indexMetaData.settings().get("setting1"),equalTo("value1"));
  assertThat(indexMetaData.settings().get("setting2"),equalTo("value2"));
  assertThat(indexMetaData.mappings().size(),equalTo(0));
  indexMetaData=parsedMetaData.index("test3");
  assertThat(indexMetaData.numberOfShards(),equalTo(1));
  assertThat(indexMetaData.numberOfReplicas(),equalTo(2));
  assertThat(indexMetaData.settings().getAsMap().size(),equalTo(2));
  assertThat(indexMetaData.mappings().size(),equalTo(1));
  assertThat(indexMetaData.mappings().get("mapping1").source().string(),equalTo(MAPPING_SOURCE1));
  indexMetaData=parsedMetaData.index("test4");
  assertThat(indexMetaData.numberOfShards(),equalTo(1));
  assertThat(indexMetaData.numberOfReplicas(),equalTo(2));
  assertThat(indexMetaData.settings().getAsMap().size(),equalTo(4));
  assertThat(indexMetaData.settings().get("setting1"),equalTo("value1"));
  assertThat(indexMetaData.settings().get("setting2"),equalTo("value2"));
  assertThat(indexMetaData.mappings().size(),equalTo(2));
  assertThat(indexMetaData.mappings().get("mapping1").source().string(),equalTo(MAPPING_SOURCE1));
  assertThat(indexMetaData.mappings().get("mapping2").source().string(),equalTo(MAPPING_SOURCE2));
  indexMetaData=parsedMetaData.index("test5");
  assertThat(indexMetaData.numberOfShards(),equalTo(1));
  assertThat(indexMetaData.numberOfReplicas(),equalTo(2));
  assertThat(indexMetaData.settings().getAsMap().size(),equalTo(4));
  assertThat(indexMetaData.settings().get("setting1"),equalTo("value1"));
  assertThat(indexMetaData.settings().get("setting2"),equalTo("value2"));
  assertThat(indexMetaData.mappings().size(),equalTo(2));
  assertThat(indexMetaData.mappings().get("mapping1").source().string(),equalTo(MAPPING_SOURCE1));
  assertThat(indexMetaData.mappings().get("mapping2").source().string(),equalTo(MAPPING_SOURCE2));
  assertThat(indexMetaData.aliases().size(),equalTo(2));
  assertThat(indexMetaData.aliases().get("alias1").alias(),equalTo("alias1"));
  assertThat(indexMetaData.aliases().get("alias2").alias(),equalTo("alias2"));
  indexMetaData=parsedMetaData.index("test6");
  assertThat(indexMetaData.numberOfShards(),equalTo(1));
  assertThat(indexMetaData.numberOfReplicas(),equalTo(2));
  assertThat(indexMetaData.settings().getAsMap().size(),equalTo(4));
  assertThat(indexMetaData.settings().get("setting1"),equalTo("value1"));
  assertThat(indexMetaData.settings().get("setting2"),equalTo("value2"));
  assertThat(indexMetaData.mappings().size(),equalTo(2));
  assertThat(indexMetaData.mappings().get("mapping1").source().string(),equalTo(MAPPING_SOURCE1));
  assertThat(indexMetaData.mappings().get("mapping2").source().string(),equalTo(MAPPING_SOURCE2));
  assertThat(indexMetaData.aliases().size(),equalTo(3));
  assertThat(indexMetaData.aliases().get("alias1").alias(),equalTo("alias1"));
  assertThat(indexMetaData.aliases().get("alias2").alias(),equalTo("alias2"));
  assertThat(indexMetaData.aliases().get("alias3").alias(),equalTo("alias3"));
  indexMetaData=parsedMetaData.index("test7");
  assertThat(indexMetaData.numberOfShards(),equalTo(1));
  assertThat(indexMetaData.numberOfReplicas(),equalTo(2));
  assertThat(indexMetaData.settings().getAsMap().size(),equalTo(4));
  assertThat(indexMetaData.settings().get("setting1"),equalTo("value1"));
  assertThat(indexMetaData.settings().get("setting2"),equalTo("value2"));
  assertThat(indexMetaData.mappings().size(),equalTo(2));
  assertThat(indexMetaData.mappings().get("mapping1").source().string(),equalTo(MAPPING_SOURCE1));
  assertThat(indexMetaData.mappings().get("mapping2").source().string(),equalTo(MAPPING_SOURCE2));
  assertThat(indexMetaData.aliases().size(),equalTo(4));
  assertThat(indexMetaData.aliases().get("alias1").alias(),equalTo("alias1"));
  assertThat(indexMetaData.aliases().get("alias1").filter().string(),equalTo(ALIAS_FILTER1));
  assertThat(indexMetaData.aliases().get("alias2").alias(),equalTo("alias2"));
  assertThat(indexMetaData.aliases().get("alias2").filter(),nullValue());
  assertThat(indexMetaData.aliases().get("alias3").alias(),equalTo("alias3"));
  assertThat(indexMetaData.aliases().get("alias3").filter(),nullValue());
  assertThat(indexMetaData.aliases().get("alias4").alias(),equalTo("alias4"));
  assertThat(indexMetaData.aliases().get("alias4").filter().string(),equalTo(ALIAS_FILTER2));
  assertThat(parsedMetaData.templates().get("foo").name(),is("foo"));
  assertThat(parsedMetaData.templates().get("foo").template(),is("bar"));
  assertThat(parsedMetaData.templates().get("foo").settings().get("index.setting1"),is("value1"));
  assertThat(parsedMetaData.templates().get("foo").settings().getByPrefix("index.").get("setting2"),is("value2"));
}
