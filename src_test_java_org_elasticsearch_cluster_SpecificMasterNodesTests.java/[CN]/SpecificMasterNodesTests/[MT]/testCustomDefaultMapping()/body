{
  logger.info("--> start master node / non data");
  cluster().startNode(settingsBuilder().put("node.data",false).put("node.master",true));
  logger.info("--> start data node / non master node");
  cluster().startNode(settingsBuilder().put("node.data",true).put("node.master",false));
  assertAcked(client().admin().indices().prepareCreate("test").setSettings("number_of_shards",1).get());
  assertAcked(client().admin().indices().preparePutMapping("test").setType("_default_").setSource("_timestamp","enabled=true"));
  MappingMetaData defaultMapping=client().admin().cluster().prepareState().get().getState().getMetaData().getIndices().get("test").getMappings().get("_default_");
  assertThat(defaultMapping.getSourceAsMap().get("_timestamp"),notNullValue());
  assertAcked(client().admin().indices().preparePutMapping("test").setType("_default_").setSource("_timestamp","enabled=true"));
  assertAcked(client().admin().indices().preparePutMapping("test").setType("type1").setSource("foo","enabled=true"));
  MappingMetaData type1Mapping=client().admin().cluster().prepareState().get().getState().getMetaData().getIndices().get("test").getMappings().get("type1");
  assertThat(type1Mapping.getSourceAsMap().get("_timestamp"),notNullValue());
}
