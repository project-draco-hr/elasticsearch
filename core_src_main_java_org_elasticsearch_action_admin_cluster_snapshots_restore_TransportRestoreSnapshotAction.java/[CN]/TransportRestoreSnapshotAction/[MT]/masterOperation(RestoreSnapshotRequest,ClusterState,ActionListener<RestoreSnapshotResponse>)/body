{
  RestoreService.RestoreRequest restoreRequest=new RestoreService.RestoreRequest("restore_snapshot[" + request.snapshot() + "]",request.repository(),request.snapshot(),request.indices(),request.indicesOptions(),request.renamePattern(),request.renameReplacement(),request.settings(),request.masterNodeTimeout(),request.includeGlobalState(),request.partial(),request.includeAliases(),request.indexSettings(),request.ignoreIndexSettings());
  restoreService.restoreSnapshot(restoreRequest,new ActionListener<RestoreInfo>(){
    @Override public void onResponse(    RestoreInfo restoreInfo){
      if (restoreInfo == null && request.waitForCompletion()) {
        restoreService.addListener(new ActionListener<RestoreService.RestoreCompletionResponse>(){
          SnapshotId snapshotId=new SnapshotId(request.repository(),request.snapshot());
          @Override public void onResponse(          RestoreService.RestoreCompletionResponse restoreCompletionResponse){
            if (this.snapshotId.equals(restoreCompletionResponse.getSnapshotId())) {
              listener.onResponse(new RestoreSnapshotResponse(restoreCompletionResponse.getRestoreInfo()));
              restoreService.removeListener(this);
            }
          }
          @Override public void onFailure(          Throwable e){
            listener.onFailure(e);
          }
        }
);
      }
 else {
        listener.onResponse(new RestoreSnapshotResponse(restoreInfo));
      }
    }
    @Override public void onFailure(    Throwable t){
      listener.onFailure(t);
    }
  }
);
}
