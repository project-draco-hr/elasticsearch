{
  Objects.requireNonNull(queryMetadataField);
  List<Term> extractedTerms=new ArrayList<>();
  Collections.addAll(extractedTerms,optionalTerms);
  Fields fields=MultiFields.getFields(indexReader);
  for (  String field : fields) {
    Terms terms=fields.terms(field);
    if (terms == null) {
      continue;
    }
    BytesRef fieldBr=new BytesRef(field);
    TermsEnum tenum=terms.iterator();
    for (BytesRef term=tenum.next(); term != null; term=tenum.next()) {
      BytesRefBuilder builder=new BytesRefBuilder();
      builder.append(fieldBr);
      builder.append(FIELD_VALUE_SEPARATOR);
      builder.append(term);
      extractedTerms.add(new Term(queryMetadataField,builder.toBytesRef()));
    }
  }
  return new TermsQuery(extractedTerms);
}
