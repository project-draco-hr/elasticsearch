{
  this.size=size;
  this.comparatorType=comparatorType;
  this.script=script;
  this.indexFieldDatas=new IndexFieldData[fieldsNames.length];
  for (int i=0; i < fieldsNames.length; i++) {
    FieldMapper mapper=context.smartNameFieldMapper(fieldsNames[i]);
    if (mapper == null) {
      throw new FacetPhaseExecutionException(facetName,"failed to find mapping for [" + fieldsNames[i] + "]");
    }
    indexFieldDatas[i]=context.fieldData().getForField(mapper);
  }
  if (excluded.isEmpty() && pattern == null && script == null) {
    aggregator=new HashedAggregator();
  }
 else {
    aggregator=new HashedScriptAggregator(excluded,pattern,script);
  }
  if (allTerms) {
    for (int i=0; i < fieldsNames.length; i++) {
      TermsStringFacetExecutor.loadAllTerms(context,indexFieldDatas[i],aggregator);
    }
  }
}
