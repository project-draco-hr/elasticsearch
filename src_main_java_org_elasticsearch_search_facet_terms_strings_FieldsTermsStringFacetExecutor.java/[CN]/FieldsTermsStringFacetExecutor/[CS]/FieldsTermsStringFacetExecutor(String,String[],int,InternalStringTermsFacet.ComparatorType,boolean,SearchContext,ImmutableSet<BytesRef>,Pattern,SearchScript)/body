{
  this.size=size;
  this.comparatorType=comparatorType;
  this.numberOfShards=context.numberOfShards();
  this.script=script;
  this.excluded=excluded;
  this.pattern=pattern;
  facets=CacheRecycler.popObjectIntMap();
  this.indexFieldDatas=new IndexFieldData[fieldsNames.length];
  for (int i=0; i < fieldsNames.length; i++) {
    FieldMapper mapper=context.smartNameFieldMapper(fieldsNames[i]);
    if (mapper == null) {
      throw new FacetPhaseExecutionException(facetName,"failed to find mapping for [" + fieldsNames[i] + "]");
    }
    indexFieldDatas[i]=context.fieldData().getForField(mapper);
  }
}
