{
  Index index=new Index("test");
  if (settings.get(IndexMetaData.SETTING_VERSION_CREATED) == null) {
    settings=Settings.builder().put(settings).put(IndexMetaData.SETTING_VERSION_CREATED,Version.CURRENT).build();
  }
  IndicesModule indicesModule=new IndicesModule(){
    @Override public void configure(){
      bindHunspellExtension();
    }
  }
;
  Injector parentInjector=new ModulesBuilder().add(new SettingsModule(settings),new EnvironmentModule(new Environment(settings)),indicesModule).createInjector();
  AnalysisModule analysisModule=new AnalysisModule(settings,parentInjector.getInstance(IndicesAnalysisService.class));
  Injector injector=new ModulesBuilder().add(new IndexSettingsModule(index,settings),new IndexNameModule(index),analysisModule).createChildInjector(parentInjector);
  return injector.getInstance(AnalysisService.class);
}
