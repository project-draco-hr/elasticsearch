{
  if (length == 0) {
    return;
  }
  final int BUFFER_LEN=uncompressed.length;
  int free=BUFFER_LEN - position;
  if (free >= length) {
    System.arraycopy(input,offset,uncompressed,position,length);
    position+=length;
    uncompressedPosition+=length;
    return;
  }
  if (position > 0) {
    System.arraycopy(input,offset,uncompressed,position,free);
    position+=free;
    uncompressedPosition+=free;
    flushBuffer();
    offset+=free;
    length-=free;
  }
  while (length >= BUFFER_LEN) {
    offsets.add(out.getFilePointer());
    compress(input,offset,BUFFER_LEN,out);
    offset+=BUFFER_LEN;
    length-=BUFFER_LEN;
    uncompressedPosition+=BUFFER_LEN;
  }
  if (length > 0) {
    System.arraycopy(input,offset,uncompressed,0,length);
  }
  position=length;
  uncompressedPosition+=length;
}
