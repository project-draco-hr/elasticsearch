{
  final int BUFFER_LEN=uncompressed.length;
  int free=BUFFER_LEN - position;
  if (free >= length) {
    input.readBytes(uncompressed,position,(int)length,false);
    position+=length;
    uncompressedPosition+=length;
    return;
  }
  if (position > 0) {
    input.readBytes(uncompressed,position,free,false);
    position+=free;
    uncompressedPosition+=free;
    flushBuffer();
    length-=free;
  }
  while (length >= BUFFER_LEN) {
    offsets.add(out.getFilePointer());
    input.readBytes(uncompressed,0,BUFFER_LEN);
    compress(uncompressed,0,BUFFER_LEN,out);
    length-=BUFFER_LEN;
    uncompressedPosition+=BUFFER_LEN;
  }
  if (length > 0) {
    input.readBytes(uncompressed,0,(int)length,false);
  }
  position=(int)length;
  uncompressedPosition+=length;
}
