{
  flushAction.execute(Requests.flushRequest(request.indices()),new ActionListener<FlushResponse>(){
    @Override public void onResponse(    FlushResponse flushResponse){
      QuerySourceBuilder querySourceBuilder=new QuerySourceBuilder().setQuery(QueryBuilders.filteredQuery(QueryBuilders.matchAllQuery(),FilterBuilders.typeFilter(request.type())));
      deleteByQueryAction.execute(Requests.deleteByQueryRequest(request.indices()).source(querySourceBuilder),new ActionListener<DeleteByQueryResponse>(){
        @Override public void onResponse(        DeleteByQueryResponse deleteByQueryResponse){
          refreshAction.execute(Requests.refreshRequest(request.indices()),new ActionListener<RefreshResponse>(){
            @Override public void onResponse(            RefreshResponse refreshResponse){
              removeMapping();
            }
            @Override public void onFailure(            Throwable e){
              removeMapping();
            }
            protected void removeMapping(){
              DeleteMappingClusterStateUpdateRequest clusterStateUpdateRequest=new DeleteMappingClusterStateUpdateRequest().indices(request.indices()).type(request.type()).ackTimeout(request.timeout()).masterNodeTimeout(request.masterNodeTimeout());
              metaDataMappingService.removeMapping(clusterStateUpdateRequest,new ClusterStateUpdateListener(){
                @Override public void onResponse(                ClusterStateUpdateResponse response){
                  listener.onResponse(new DeleteMappingResponse(response.isAcknowledged()));
                }
                @Override public void onFailure(                Throwable t){
                  listener.onFailure(t);
                }
              }
);
            }
          }
);
        }
        @Override public void onFailure(        Throwable t){
          listener.onFailure(t);
        }
      }
);
    }
    @Override public void onFailure(    Throwable t){
      listener.onFailure(t);
    }
  }
);
}
