{
  SettingsFilter settingsFilter=new SettingsFilter(Settings.EMPTY);
  for (  String pattern : patterns) {
    settingsFilter.addFilter(pattern);
  }
  Settings filteredSettings=SettingsFilter.filterSettings(settingsFilter.getPatterns(),source);
  assertThat(filteredSettings.getAsMap().entrySet(),equalTo(filtered.getAsMap().entrySet()));
  RestRequest request=new FakeRestRequest();
  settingsFilter.addFilterSettingParams(request);
  XContentBuilder xContentBuilder=XContentBuilder.builder(JsonXContent.jsonXContent);
  xContentBuilder.startObject();
  source.toXContent(xContentBuilder,request);
  xContentBuilder.endObject();
  String filteredSettingsString=xContentBuilder.string();
  filteredSettings=Settings.builder().loadFromSource(filteredSettingsString).build();
  assertThat(filteredSettings.getAsMap().entrySet(),equalTo(filtered.getAsMap().entrySet()));
}
