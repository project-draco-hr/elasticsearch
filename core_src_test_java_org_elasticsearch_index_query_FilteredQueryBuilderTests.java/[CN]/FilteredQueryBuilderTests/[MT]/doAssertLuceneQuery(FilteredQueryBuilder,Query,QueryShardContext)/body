{
  Query innerQuery=queryBuilder.innerQuery().toQuery(context);
  if (innerQuery == null) {
    assertThat(query,nullValue());
  }
 else {
    assertThat(query,instanceOf(BooleanQuery.class));
    BooleanQuery booleanQuery=(BooleanQuery)query;
    Query innerFilter=queryBuilder.innerFilter().toQuery(context);
    if (innerFilter == null) {
      assertThat(booleanQuery.clauses().size(),equalTo(1));
      assertThat(booleanQuery.clauses().get(0).getOccur(),equalTo(BooleanClause.Occur.MUST));
      assertThat(booleanQuery.clauses().get(0).getQuery(),equalTo(innerQuery));
    }
 else {
      assertThat(booleanQuery.clauses().get(0).getOccur(),equalTo(BooleanClause.Occur.MUST));
      assertThat(booleanQuery.clauses().get(0).getQuery(),equalTo(innerQuery));
      assertThat(booleanQuery.clauses().get(1).getOccur(),equalTo(BooleanClause.Occur.FILTER));
      assertThat(booleanQuery.clauses().get(1).getQuery(),equalTo(innerFilter));
    }
  }
}
