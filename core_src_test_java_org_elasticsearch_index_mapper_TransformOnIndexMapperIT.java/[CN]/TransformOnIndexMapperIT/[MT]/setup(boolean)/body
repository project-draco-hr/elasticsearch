{
  XContentBuilder builder=XContentFactory.jsonBuilder().startObject();
  builder.field("transform");
  if (getRandom().nextBoolean()) {
    builder.startObject();
    buildTransformScript(builder);
    builder.field("lang",randomFrom(null,GroovyScriptEngineService.NAME));
    builder.endObject();
  }
 else {
    int total=between(1,10);
    int actual=between(0,total - 1);
    builder.startArray();
    for (int s=0; s < total; s++) {
      builder.startObject();
      if (s == actual) {
        buildTransformScript(builder);
      }
 else {
        builder.field("script","true");
      }
      builder.field("lang",randomFrom(null,GroovyScriptEngineService.NAME));
      builder.endObject();
    }
    builder.endArray();
  }
  assertAcked(client().admin().indices().prepareCreate("test").addMapping("test",builder));
  indexRandom(forceRefresh,client().prepareIndex("test","test","notitle").setSource("content","findme"),client().prepareIndex("test","test","badtitle").setSource("content","findme","title","cat"),client().prepareIndex("test","test","righttitle").setSource("content","findme","title","table"));
}
