{
  if (host == null) {
    host=defaultValue1;
  }
  if (host == null) {
    host=defaultValue2;
  }
  if (host == null) {
    return null;
  }
  if (host.startsWith("#") && host.endsWith("#")) {
    host=host.substring(1,host.length() - 1);
    if (host.equals("local")) {
      return localAddress;
    }
 else {
      Collection<NetworkInterface> allInterfs=getAllAvailableInterfaces();
      for (      NetworkInterface ni : allInterfs) {
        if (!ni.isUp() || ni.isLoopback()) {
          continue;
        }
        if (host.equals(ni.getName()) || host.equals(ni.getDisplayName())) {
          return getFirstNonLoopbackAddress(ni,getIpStackType());
        }
      }
    }
    throw new IOException("Failed to find network interface for [" + host + "]");
  }
  return InetAddress.getByName(host);
}
