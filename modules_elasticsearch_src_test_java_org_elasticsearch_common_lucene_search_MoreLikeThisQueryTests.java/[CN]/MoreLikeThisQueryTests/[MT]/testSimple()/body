{
  Directory dir=new RAMDirectory();
  IndexWriter indexWriter=new IndexWriter(dir,Lucene.STANDARD_ANALYZER,true,IndexWriter.MaxFieldLength.UNLIMITED);
  indexWriter.commit();
  assertThat("Index is empty after creation and commit",estimateRamSize(indexWriter),equalTo(0l));
  indexWriter.addDocument(doc().add(field("_id","1")).add(field("text","lucene")).build());
  indexWriter.addDocument(doc().add(field("_id","2")).add(field("text","lucene release")).build());
  IndexReader reader=indexWriter.getReader();
  IndexSearcher searcher=new IndexSearcher(reader);
  MoreLikeThisQuery mltQuery=new MoreLikeThisQuery("lucene",new String[]{"text"},Lucene.STANDARD_ANALYZER);
  mltQuery.setLikeText("lucene");
  mltQuery.setMinTermFrequency(1);
  mltQuery.setMinDocFreq(1);
  long count=Lucene.count(searcher,mltQuery,-1);
  assertThat(count,equalTo(2l));
  reader.close();
  indexWriter.close();
}
