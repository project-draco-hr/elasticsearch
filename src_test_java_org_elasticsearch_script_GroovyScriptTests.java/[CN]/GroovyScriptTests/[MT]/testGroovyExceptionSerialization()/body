{
  List<IndexRequestBuilder> reqs=newArrayList();
  for (int i=0; i < randomIntBetween(50,500); i++) {
    reqs.add(client().prepareIndex("test","doc","" + i).setSource("foo","bar"));
  }
  indexRandom(true,false,reqs);
  try {
    client().prepareSearch("test").setQuery(constantScoreQuery(scriptFilter("1 == not_found").lang("groovy"))).get();
    fail("should have thrown an exception");
  }
 catch (  SearchPhaseExecutionException e) {
    assertThat(ExceptionsHelper.detailedMessage(e) + "should not contained NotSerializableTransportException",ExceptionsHelper.detailedMessage(e).contains("NotSerializableTransportException"),equalTo(false));
    assertThat(ExceptionsHelper.detailedMessage(e) + "should have contained GroovyScriptExecutionException",ExceptionsHelper.detailedMessage(e).contains("GroovyScriptExecutionException"),equalTo(true));
    assertThat(ExceptionsHelper.detailedMessage(e) + "should have contained not_found",ExceptionsHelper.detailedMessage(e).contains("No such property: not_found"),equalTo(true));
  }
  try {
    client().prepareSearch("test").setQuery(constantScoreQuery(scriptFilter("pr = Runtime.getRuntime().exec(\"touch /tmp/gotcha\"); pr.waitFor()").lang("groovy"))).get();
    fail("should have thrown an exception");
  }
 catch (  SearchPhaseExecutionException e) {
    assertThat(ExceptionsHelper.detailedMessage(e) + "should not contained NotSerializableTransportException",ExceptionsHelper.detailedMessage(e).contains("NotSerializableTransportException"),equalTo(false));
    assertThat(ExceptionsHelper.detailedMessage(e) + "should have contained GroovyScriptCompilationException",ExceptionsHelper.detailedMessage(e).contains("GroovyScriptCompilationException"),equalTo(true));
    assertThat(ExceptionsHelper.detailedMessage(e) + "should have contained Method calls not allowed on [java.lang.Runtime]",ExceptionsHelper.detailedMessage(e).contains("Method calls not allowed on [java.lang.Runtime]"),equalTo(true));
  }
  try {
    client().prepareSearch("test").setQuery(constantScoreQuery(scriptFilter("assert false").lang("groovy"))).get();
    fail("should have thrown an exception");
  }
 catch (  SearchPhaseExecutionException e) {
    assertThat(ExceptionsHelper.detailedMessage(e) + "should not contained NotSerializableTransportException",ExceptionsHelper.detailedMessage(e).contains("NotSerializableTransportException"),equalTo(false));
    assertThat(ExceptionsHelper.detailedMessage(e) + "should have contained GroovyScriptExecutionException",ExceptionsHelper.detailedMessage(e).contains("GroovyScriptExecutionException"),equalTo(true));
    assertThat(ExceptionsHelper.detailedMessage(e) + "should have contained an assert error",ExceptionsHelper.detailedMessage(e).contains("PowerAssertionError[assert false"),equalTo(true));
  }
}
