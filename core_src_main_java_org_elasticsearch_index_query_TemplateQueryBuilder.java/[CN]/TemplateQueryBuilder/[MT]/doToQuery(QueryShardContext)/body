{
  BytesReference querySource=context.executeQueryTemplate(template,SearchContext.current());
  try (XContentParser qSourceParser=XContentFactory.xContent(querySource).createParser(querySource)){
    final QueryShardContext contextCopy=new QueryShardContext(context.index(),context.indexQueryParserService());
    contextCopy.reset(qSourceParser);
    QueryBuilder result=contextCopy.parseContext().parseInnerQueryBuilder();
    context.combineNamedQueries(contextCopy);
    return result.toQuery(context);
  }
 }
