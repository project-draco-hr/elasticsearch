{
  BytesReference querySource=context.executeQueryTemplate(template,SearchContext.current());
  try (XContentParser qSourceParser=XContentFactory.xContent(querySource).createParser(querySource)){
    final QueryShardContext contextCopy=context.clone();
    contextCopy.reset(qSourceParser);
    QueryBuilder result=contextCopy.parseContext().parseInnerQueryBuilder();
    context.combineNamedQueries(contextCopy);
    return result.toQuery(context);
  }
 }
