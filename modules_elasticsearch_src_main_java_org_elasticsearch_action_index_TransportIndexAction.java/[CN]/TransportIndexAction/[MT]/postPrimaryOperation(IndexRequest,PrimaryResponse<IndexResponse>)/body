{
  Engine.IndexingOperation op=(Engine.IndexingOperation)response.payload();
  if (!Strings.hasLength(request.percolate())) {
    try {
      op.docMapper().processDocumentAfterIndex(op.doc());
    }
 catch (    Exception e) {
      logger.warn("failed to cleanup doc after index [{}]",e,request);
    }
    return;
  }
  IndexService indexService=indicesService.indexServiceSafe(request.index());
  try {
    PercolatorExecutor.Response percolate=indexService.percolateService().percolate(new PercolatorExecutor.DocAndSourceQueryRequest(op.parsedDoc(),request.percolate()));
    response.response().matches(percolate.matches());
    op.docMapper().processDocumentAfterIndex(op.doc());
  }
 catch (  Exception e) {
    logger.warn("failed to percolate [{}]",e,request);
  }
}
