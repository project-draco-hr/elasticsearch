{
  IndexShard indexShard=indexShard(shardRequest);
  IndexRequest request=shardRequest.request;
  SourceToParse sourceToParse=SourceToParse.source(request.source()).type(request.type()).id(request.id()).routing(request.routing()).parent(request.parent());
  if (request.opType() == IndexRequest.OpType.INDEX) {
    Engine.Index index=indexShard.prepareIndex(sourceToParse).version(request.version()).origin(Engine.Operation.Origin.REPLICA);
    indexShard.index(index);
    index.docMapper().processDocumentAfterIndex(index.doc());
  }
 else {
    Engine.Create create=indexShard.prepareCreate(sourceToParse).version(request.version()).origin(Engine.Operation.Origin.REPLICA);
    indexShard.create(create);
    create.docMapper().processDocumentAfterIndex(create.doc());
  }
  if (request.refresh()) {
    try {
      indexShard.refresh(new Engine.Refresh(false));
    }
 catch (    Exception e) {
    }
  }
}
