{
  if (allowIdGeneration) {
    if (indexRequest.id() == null) {
      indexRequest.id(UUID.randomBase64UUID());
      indexRequest.opType(IndexRequest.OpType.CREATE);
    }
  }
  if (autoCreateIndex && !clusterService.state().metaData().hasConcreteIndex(indexRequest.index())) {
    createIndexAction.execute(new CreateIndexRequest(indexRequest.index()).cause("auto(index api)"),new ActionListener<CreateIndexResponse>(){
      @Override public void onResponse(      CreateIndexResponse result){
        TransportIndexAction.super.doExecute(indexRequest,listener);
      }
      @Override public void onFailure(      Throwable e){
        if (ExceptionsHelper.unwrapCause(e) instanceof IndexAlreadyExistsException) {
          TransportIndexAction.super.doExecute(indexRequest,listener);
        }
 else {
          listener.onFailure(e);
        }
      }
    }
);
  }
 else {
    super.doExecute(indexRequest,listener);
  }
}
