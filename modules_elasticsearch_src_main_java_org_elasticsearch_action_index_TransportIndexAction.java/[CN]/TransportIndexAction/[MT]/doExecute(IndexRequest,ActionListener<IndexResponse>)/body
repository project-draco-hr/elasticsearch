{
  if (allowIdGeneration) {
    if (indexRequest.id() == null) {
      indexRequest.id(UUID.randomUUID().toString());
      indexRequest.opType(IndexRequest.OpType.CREATE);
    }
  }
  if (autoCreateIndex) {
    if (!clusterService.state().metaData().hasIndex(indexRequest.index())) {
      createIndexAction.execute(new CreateIndexRequest(indexRequest.index()),new ActionListener<CreateIndexResponse>(){
        @Override public void onResponse(        CreateIndexResponse result){
          TransportIndexAction.super.doExecute(indexRequest,listener);
        }
        @Override public void onFailure(        Throwable e){
          if (ExceptionsHelper.unwrapCause(e) instanceof IndexAlreadyExistsException) {
            TransportIndexAction.super.doExecute(indexRequest,listener);
          }
 else {
            listener.onFailure(e);
          }
        }
      }
);
    }
 else {
      super.doExecute(indexRequest,listener);
    }
  }
}
