{
  ProtocolVersion protocolVersion=new ProtocolVersion("HTTP",1,1);
  int statusCode=RandomInts.randomIntBetween(random(),200,599);
  String reasonPhrase="REASON";
  BasicStatusLine statusLine=new BasicStatusLine(protocolVersion,statusCode,reasonPhrase);
  String expected="# " + statusLine.toString();
  BasicHttpResponse httpResponse=new BasicHttpResponse(statusLine);
  int numHeaders=RandomInts.randomIntBetween(random(),0,3);
  for (int i=0; i < numHeaders; i++) {
    httpResponse.setHeader("header" + i,"value");
    expected+="\n# header" + i + ": value";
  }
  expected+="\n#";
  if (random().nextBoolean()) {
    String responseBody="{\n  \"field\": \"value\"\n}";
    httpResponse.setEntity(new StringEntity(responseBody,StandardCharsets.UTF_8));
    expected+="\n# {";
    expected+="\n#   \"field\": \"value\"";
    expected+="\n# }";
  }
  String traceResponse=RequestLogger.buildTraceResponse(httpResponse);
  assertThat(traceResponse,equalTo(expected));
}
