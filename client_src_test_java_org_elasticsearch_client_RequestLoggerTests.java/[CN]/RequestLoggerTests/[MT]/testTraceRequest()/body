{
  HttpHost host=new HttpHost("localhost",9200,random().nextBoolean() ? "http" : "https");
  URI uri=new URI("/index/type/_api");
  HttpRequestBase request;
  int requestType=RandomInts.randomIntBetween(random(),0,4);
switch (requestType) {
case 0:
    request=new HttpGetWithEntity(uri);
  break;
case 1:
request=new HttpPost(uri);
break;
case 2:
request=new HttpPut(uri);
break;
case 3:
request=new HttpDeleteWithEntity(uri);
break;
case 4:
request=new HttpHead(uri);
break;
default :
throw new UnsupportedOperationException();
}
String expected="curl -iX " + request.getMethod() + " '"+ host+ uri+ "'";
if (request instanceof HttpEntityEnclosingRequest && random().nextBoolean()) {
HttpEntityEnclosingRequest enclosingRequest=(HttpEntityEnclosingRequest)request;
String requestBody="{ \"field\": \"value\" }";
enclosingRequest.setEntity(new StringEntity(requestBody,Charsets.UTF_8));
expected+=" -d '" + requestBody + "'";
}
String traceRequest=RequestLogger.buildTraceRequest(request,host);
assertThat(traceRequest,equalTo(expected));
}
