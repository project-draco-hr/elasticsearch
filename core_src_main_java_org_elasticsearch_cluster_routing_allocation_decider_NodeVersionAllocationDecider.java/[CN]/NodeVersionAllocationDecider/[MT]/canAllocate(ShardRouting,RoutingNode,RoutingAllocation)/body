{
  if (shardRouting.primary()) {
    if (shardRouting.currentNodeId() == null) {
      return allocation.decision(Decision.YES,NAME,"primary shard can be allocated anywhere");
    }
 else {
      return isVersionCompatible(allocation.routingNodes(),shardRouting.currentNodeId(),node,allocation);
    }
  }
 else {
    final ShardRouting primary=allocation.routingNodes().activePrimary(shardRouting);
    if (primary != null) {
      return isVersionCompatible(allocation.routingNodes(),primary.currentNodeId(),node,allocation);
    }
 else {
      return allocation.decision(Decision.YES,NAME,"no active primary shard yet");
    }
  }
}
