{
  String sourceNodeId=shardRouting.currentNodeId();
  if (sourceNodeId == null) {
    if (shardRouting.primary()) {
      return allocation.decision(Decision.YES,NAME,"primary shard can be allocated anywhere");
    }
    final MutableShardRouting primary=allocation.routingNodes().activePrimary(shardRouting);
    if (primary == null) {
      return allocation.decision(Decision.YES,NAME,"no active primary shard yet");
    }
    sourceNodeId=primary.currentNodeId();
  }
  return isVersionCompatible(allocation.routingNodes(),sourceNodeId,node,allocation);
}
