{
  String templateString="{ \"file\": \"storedTemplate\" ,\"params\":{\"template\":\"all\" } } ";
  XContentParser templateSourceParser=XContentFactory.xContent(templateString).createParser(templateString);
  context.reset(templateSourceParser);
  templateSourceParser.nextToken();
  TemplateQueryParser parser=injector.getInstance(TemplateQueryParser.class);
  try {
    parser.fromXContent(context.parseContext()).toQuery(context);
  }
 catch (  UnsupportedOperationException ex) {
    assertEquals("this query must be rewritten first",ex.getMessage());
  }
}
