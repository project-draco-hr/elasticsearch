{
  XContentBuilder xContentBuilder=jsonBuilder().startObject().startObject("item").startObject("properties").startObject("suggest").field("type","completion").startObject("context").startObject("location").field("type","geo").field("precision",6).field("neighbors",false).endObject().endObject().endObject().endObject().endObject().endObject();
  assertAcked(prepareCreate(INDEX).addMapping("item",xContentBuilder));
  ensureYellow();
  GeoPoint alexanderplatz=GeoHashUtils.decode("u33dc1");
  GeoPoint cellNeighbourOfAlexanderplatz=GeoHashUtils.decode("u33dbc");
  index(INDEX,"item","1",jsonBuilder().startObject().startObject("suggest").field("input","Berlin Alexanderplatz").field("weight",3).startObject("context").startObject("location").field("lat",alexanderplatz.lat()).field("lon",alexanderplatz.lon()).endObject().endObject().endObject().endObject());
  index(INDEX,"item","2",jsonBuilder().startObject().startObject("suggest").field("input","Berlin Hackescher Markt").field("weight",2).startObject("context").startObject("location").field("lat",cellNeighbourOfAlexanderplatz.lat()).field("lon",cellNeighbourOfAlexanderplatz.lon()).endObject().endObject().endObject().endObject());
  refresh();
  CompletionSuggestionBuilder suggestionBuilder=SuggestBuilders.completionSuggestion("suggestion").field("suggest").text("b").size(10).addGeoLocation("location",alexanderplatz.lat(),alexanderplatz.lon());
  SuggestResponse suggestResponse=client().prepareSuggest(INDEX).addSuggestion(suggestionBuilder).get();
  assertSuggestion(suggestResponse.getSuggest(),0,"suggestion","Berlin Alexanderplatz");
}
