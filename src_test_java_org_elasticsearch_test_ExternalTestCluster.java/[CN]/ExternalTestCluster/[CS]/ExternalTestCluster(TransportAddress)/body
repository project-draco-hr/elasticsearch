{
  this.client=new TransportClient(ImmutableSettings.settingsBuilder().put("client.transport.ignore_cluster_name",true)).addTransportAddresses(transportAddresses);
  NodesInfoResponse nodeInfos=this.client.admin().cluster().prepareNodesInfo().clear().setSettings(true).setHttp(true).get();
  httpAddresses=new InetSocketAddress[nodeInfos.getNodes().length];
  int dataNodes=0;
  for (int i=0; i < nodeInfos.getNodes().length; i++) {
    NodeInfo nodeInfo=nodeInfos.getNodes()[i];
    httpAddresses[i]=((InetSocketTransportAddress)nodeInfo.getHttp().address().publishAddress()).address();
    if (nodeInfo.getSettings().getAsBoolean("node.data",true)) {
      dataNodes++;
    }
  }
  this.dataNodes=dataNodes;
  logger.info("Setup ExternalTestCluster [{}] made of [{}] nodes",nodeInfos.getClusterName().value(),size());
}
