{
  Settings clientSettings=ImmutableSettings.settingsBuilder().put("client.transport.ignore_cluster_name",true).put("node.mode","network").build();
  Tuple<Settings,Environment> finalSettings=InternalSettingsPreparer.prepareSettings(clientSettings,true);
  assertFalse("testing against an external cluster must run in network mode. You probably have a system property overriding the test settings.",DiscoveryNode.localNode(finalSettings.v1()));
  this.client=new TransportClient(clientSettings).addTransportAddresses(transportAddresses);
  NodesInfoResponse nodeInfos=this.client.admin().cluster().prepareNodesInfo().clear().setSettings(true).setHttp(true).get();
  httpAddresses=new InetSocketAddress[nodeInfos.getNodes().length];
  this.clusterName=nodeInfos.getClusterName().value();
  int dataNodes=0;
  int benchNodes=0;
  for (int i=0; i < nodeInfos.getNodes().length; i++) {
    NodeInfo nodeInfo=nodeInfos.getNodes()[i];
    httpAddresses[i]=((InetSocketTransportAddress)nodeInfo.getHttp().address().publishAddress()).address();
    if (nodeInfo.getSettings().getAsBoolean("node.data",true)) {
      dataNodes++;
    }
    if (nodeInfo.getSettings().getAsBoolean("node.bench",false)) {
      benchNodes++;
    }
  }
  this.numDataNodes=dataNodes;
  this.numBenchNodes=benchNodes;
  logger.info("Setup ExternalTestCluster [{}] made of [{}] nodes",nodeInfos.getClusterName().value(),size());
}
