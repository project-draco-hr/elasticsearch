{
  byte[] commitId=shardRequest.request.commitIds().get(clusterService.localNode().getId());
  IndexService indexService=indicesService.indexServiceSafe(shardRequest.shardId.getIndex());
  IndexShard indexShard=indexService.shardSafe(shardRequest.shardId.id());
  SyncedFlushResponse syncedFlushResponse=new SyncedFlushResponse(indexShard.syncFlushIfNoPendingChanges(shardRequest.request.syncId(),commitId),shardRequest.request.syncId());
  if (syncedFlushResponse.success() == false) {
    throw new ElasticsearchIllegalStateException("could not sync commit on primary");
  }
  return new Tuple<>(syncedFlushResponse,shardRequest.request);
}
