{
  if (collectsFromSingleBucket == false) {
    return asMultiBucketAggregator(this,context,parent);
  }
  Map<String,Object> params=null;
  if (this.params != null) {
    params=deepCopyParams(this.params,context.searchContext());
  }
  Map<String,Object> reduceParams=null;
  if (this.reduceParams != null) {
    reduceParams=deepCopyParams(this.reduceParams,context.searchContext());
  }
  return new ScriptedMetricAggregator(name,scriptLang,initScriptType,initScript,mapScriptType,mapScript,combineScriptType,combineScript,reduceScriptType,reduceScript,params,reduceParams,context,parent,reducers,metaData);
}
