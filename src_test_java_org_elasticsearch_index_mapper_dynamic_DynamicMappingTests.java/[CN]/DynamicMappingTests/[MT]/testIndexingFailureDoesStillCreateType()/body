{
  XContentBuilder mapping=jsonBuilder().startObject().startObject("_default_").field("dynamic","strict").endObject().endObject();
  IndexService indexService=createIndex("test",ImmutableSettings.EMPTY,"_default_",mapping);
  try {
    client().prepareIndex().setIndex("test").setType("type").setSource(jsonBuilder().startObject().field("test","test").endObject()).get();
    fail();
  }
 catch (  StrictDynamicMappingException e) {
  }
  awaitBusy(new Predicate<Object>(){
    @Override public boolean apply(    java.lang.Object input){
      GetMappingsResponse currentMapping=client().admin().indices().prepareGetMappings("test").get();
      return currentMapping.getMappings().get("test").get("type") != null;
    }
  }
);
  GetMappingsResponse getMappingsResponse=client().admin().indices().prepareGetMappings("test").get();
  assertNotNull(getMappingsResponse.getMappings().get("test").get("type"));
  DocumentMapper mapper=indexService.mapperService().documentMapper("type");
  assertNotNull(mapper);
}
