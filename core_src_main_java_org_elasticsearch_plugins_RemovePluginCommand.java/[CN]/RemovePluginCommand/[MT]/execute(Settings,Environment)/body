{
  terminal.println("-> Removing " + Strings.coalesceToEmpty(pluginName) + "...");
  Path pluginDir=env.pluginsFile().resolve(pluginName);
  if (Files.exists(pluginDir) == false) {
    throw new UserError(CliTool.ExitStatus.USAGE,"Plugin " + pluginName + " not found. Run 'plugin list' to get list of installed plugins.");
  }
  List<Path> pluginPaths=new ArrayList<>();
  Path pluginBinDir=env.binFile().resolve(pluginName);
  if (Files.exists(pluginBinDir)) {
    if (Files.isDirectory(pluginBinDir) == false) {
      throw new UserError(CliTool.ExitStatus.IO_ERROR,"Bin dir for " + pluginName + " is not a directory");
    }
    pluginPaths.add(pluginBinDir);
    terminal.println(VERBOSE,"Removing: %s",pluginBinDir);
  }
  terminal.println(VERBOSE,"Removing: %s",pluginDir);
  Path tmpPluginDir=env.pluginsFile().resolve(".removing-" + pluginName);
  Files.move(pluginDir,tmpPluginDir,StandardCopyOption.ATOMIC_MOVE);
  pluginPaths.add(tmpPluginDir);
  IOUtils.rm(pluginPaths.toArray(new Path[pluginPaths.size()]));
  return CliTool.ExitStatus.OK;
}
