{
  Entry[] entries=new Entry[in.readVInt()];
  for (int i=0; i < entries.length; i++) {
    SnapshotId snapshotId=SnapshotId.readSnapshotId(in);
    State state=State.fromValue(in.readByte());
    int indices=in.readVInt();
    ImmutableList.Builder<String> indexBuilder=ImmutableList.builder();
    for (int j=0; j < indices; j++) {
      indexBuilder.add(in.readString());
    }
    ImmutableMap.Builder<ShardId,ShardRestoreStatus> builder=ImmutableMap.<ShardId,ShardRestoreStatus>builder();
    int shards=in.readVInt();
    for (int j=0; j < shards; j++) {
      ShardId shardId=ShardId.readShardId(in);
      ShardRestoreStatus shardState=ShardRestoreStatus.readShardRestoreStatus(in);
      builder.put(shardId,shardState);
    }
    entries[i]=new Entry(snapshotId,state,indexBuilder.build(),builder.build());
  }
  return new RestoreInProgress(entries);
}
