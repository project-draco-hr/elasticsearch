{
  currentMapper=null;
  Analyzer oldAnalyzer=analyzer;
  try {
    MapperService.SmartNameFieldMappers fieldMappers=parseContext.smartFieldMappers(field);
    if (fieldMappers != null) {
      if (!forcedAnalyzer) {
        analyzer=fieldMappers.searchAnalyzer();
      }
      currentMapper=fieldMappers.fieldMappers().mapper();
      if (currentMapper != null) {
        Query query=null;
        if (currentMapper.useFieldQueryWithQueryString()) {
          if (fieldMappers.hasDocMapper()) {
            String[] previousTypes=QueryParseContext.setTypesWithPrevious(new String[]{fieldMappers.docMapper().type()});
            try {
              query=currentMapper.prefixQuery(termStr,multiTermRewriteMethod,parseContext);
            }
  finally {
              QueryParseContext.setTypes(previousTypes);
            }
          }
 else {
            query=currentMapper.prefixQuery(termStr,multiTermRewriteMethod,parseContext);
          }
        }
        if (query == null) {
          query=super.getPrefixQuery(currentMapper.names().indexName(),termStr);
        }
        return wrapSmartNameQuery(query,fieldMappers,parseContext);
      }
    }
    return super.getPrefixQuery(field,termStr);
  }
  finally {
    analyzer=oldAnalyzer;
  }
}
