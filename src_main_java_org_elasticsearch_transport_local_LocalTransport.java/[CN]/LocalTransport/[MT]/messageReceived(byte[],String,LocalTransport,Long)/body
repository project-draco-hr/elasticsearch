{
  transportServiceAdapter.received(data.length);
  StreamInput stream=new BytesStreamInput(data,false);
  stream=CachedStreamInput.cachedHandles(stream);
  try {
    long requestId=stream.readLong();
    byte status=stream.readByte();
    boolean isRequest=TransportStatus.isRequest(status);
    if (isRequest) {
      handleRequest(stream,requestId,sourceTransport);
    }
 else {
      final TransportResponseHandler handler=transportServiceAdapter.remove(requestId);
      if (handler != null) {
        if (TransportStatus.isError(status)) {
          handlerResponseError(stream,handler);
        }
 else {
          handleResponse(stream,handler);
        }
      }
    }
  }
 catch (  Exception e) {
    if (sendRequestId != null) {
      TransportResponseHandler handler=transportServiceAdapter.remove(sendRequestId);
      if (handler != null) {
        handler.handleException(new RemoteTransportException(nodeName(),localAddress,action,e));
      }
    }
 else {
      logger.warn("Failed to receive message for action [" + action + "]",e);
    }
  }
}
