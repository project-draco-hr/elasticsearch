{
  XContentBuilder builder=XContentFactory.jsonBuilder().startObject().startArray("some_array").startObject().field("foo","bar").endObject().startObject().endObject().endArray().endObject();
  try (XContentParser parser=XContentFactory.xContent(XContentType.JSON).createParser(builder.string())){
    assertEquals(XContentParser.Token.START_OBJECT,parser.nextToken());
    assertEquals(XContentParser.Token.FIELD_NAME,parser.nextToken());
    assertEquals("some_array",parser.currentName());
    if (random().nextBoolean()) {
      assertEquals(XContentParser.Token.START_ARRAY,parser.nextToken());
    }
    assertEquals(Arrays.asList(ImmutableMap.of("foo","bar"),Collections.<String,Object>emptyMap()),parser.list());
  }
 }
