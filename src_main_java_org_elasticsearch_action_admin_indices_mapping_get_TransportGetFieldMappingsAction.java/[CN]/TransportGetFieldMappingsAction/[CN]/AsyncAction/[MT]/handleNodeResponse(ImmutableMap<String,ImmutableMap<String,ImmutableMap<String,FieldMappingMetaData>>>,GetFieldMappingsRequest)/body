{
  try {
    ArrayList<String> retryIndices=new ArrayList<String>();
    for (    String index : nodeRequest.indices()) {
      ImmutableMap<String,ImmutableMap<String,FieldMappingMetaData>> indexMapping=mappings.get(index);
      int id=mappingsIdPerIndex.get(index);
      if (indexMapping == null) {
        if (shardsPerIndex[id].nextOrNull() == null) {
          indexErrors.set(id,new IndexShardMissingException(shardsPerIndex[id].shardId()));
          retryIndices.clear();
          break;
        }
 else {
          retryIndices.add(index);
        }
      }
 else {
        indexMappings.set(id,indexMapping);
      }
    }
    if (retryIndices.size() != 0) {
      sendNodeRequestsForIndices(retryIndices.toArray(Strings.EMPTY_ARRAY));
    }
  }
  finally {
    if (pendingRequests.decrementAndGet() == 0) {
      finnishHim();
    }
  }
}
