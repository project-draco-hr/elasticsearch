{
  try {
    ArrayList<String> retryIndices=new ArrayList<String>();
    for (    String index : nodeRequest.indices()) {
      int id=mappingsIdPerIndex.get(index);
      if (shardsPerIndex[id].nextOrNull() == null) {
        indexErrors.set(id,exp);
        retryIndices.clear();
        break;
      }
 else {
        retryIndices.add(index);
      }
    }
    if (retryIndices.size() != 0) {
      sendNodeRequestsForIndices(retryIndices.toArray(Strings.EMPTY_ARRAY));
    }
  }
  finally {
    if (pendingRequests.decrementAndGet() == 0) {
      finnishHim();
    }
  }
}
