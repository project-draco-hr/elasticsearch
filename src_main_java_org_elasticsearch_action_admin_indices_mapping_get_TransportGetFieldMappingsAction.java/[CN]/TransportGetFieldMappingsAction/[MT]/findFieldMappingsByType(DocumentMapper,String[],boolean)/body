{
  MapBuilder<String,FieldMappingMetaData> fieldMappings=new MapBuilder<String,FieldMappingMetaData>();
  for (  String field : fields) {
    FieldMapper fieldMapper=documentMapper.mappers().smartNameFieldMapper(field);
    if (fieldMapper != null) {
      try {
        XContentBuilder builder=XContentFactory.contentBuilder(XContentType.JSON);
        builder.startObject();
        fieldMapper.toXContent(builder,includeDefaults ? includeDefaultsParams : ToXContent.EMPTY_PARAMS);
        builder.endObject();
        fieldMappings.put(field,new FieldMappingMetaData(fieldMapper.names().fullName(),builder.bytes()));
      }
 catch (      IOException e) {
        throw new ElasticSearchException("failed to serialize XContent of field [" + field + "]",e);
      }
    }
  }
  return fieldMappings.immutableMap();
}
