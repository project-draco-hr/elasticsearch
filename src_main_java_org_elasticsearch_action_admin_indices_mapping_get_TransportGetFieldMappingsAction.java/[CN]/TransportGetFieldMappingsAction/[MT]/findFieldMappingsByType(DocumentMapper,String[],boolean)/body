{
  MapBuilder<String,FieldMappingMetaData> fieldMappings=new MapBuilder<String,FieldMappingMetaData>();
  ImmutableList<FieldMapper> allFieldMappers=documentMapper.mappers().mappers();
  for (  String field : fields) {
    if (Regex.isMatchAllPattern(field)) {
      for (      FieldMapper fieldMapper : allFieldMappers) {
        addFieldMapper(fieldMapper.names().fullName(),fieldMapper,fieldMappings,includeDefaults);
      }
    }
 else     if (Regex.isSimpleMatchPattern(field)) {
      boolean[] resolved=new boolean[allFieldMappers.size()];
      for (int i=0; i < allFieldMappers.size(); i++) {
        FieldMapper fieldMapper=allFieldMappers.get(i);
        if (Regex.simpleMatch(field,fieldMapper.names().fullName())) {
          addFieldMapper(fieldMapper.names().fullName(),fieldMapper,fieldMappings,includeDefaults);
          resolved[i]=true;
        }
      }
      for (int i=0; i < allFieldMappers.size(); i++) {
        if (resolved[i]) {
          continue;
        }
        FieldMapper fieldMapper=allFieldMappers.get(i);
        if (Regex.simpleMatch(field,fieldMapper.names().indexName())) {
          addFieldMapper(fieldMapper.names().indexName(),fieldMapper,fieldMappings,includeDefaults);
          resolved[i]=true;
        }
      }
      for (int i=0; i < allFieldMappers.size(); i++) {
        if (resolved[i]) {
          continue;
        }
        FieldMapper fieldMapper=allFieldMappers.get(i);
        if (Regex.simpleMatch(field,fieldMapper.names().name())) {
          addFieldMapper(fieldMapper.names().name(),fieldMapper,fieldMappings,includeDefaults);
          resolved[i]=true;
        }
      }
    }
 else {
      FieldMapper fieldMapper=documentMapper.mappers().smartNameFieldMapper(field);
      if (fieldMapper != null) {
        addFieldMapper(field,fieldMapper,fieldMappings,includeDefaults);
      }
    }
  }
  return fieldMappings.immutableMap();
}
