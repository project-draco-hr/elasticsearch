{
  if (len == 0) {
    return 0;
  }
  if ((length - position) < len) {
    len=(int)(length - position);
  }
  if (len == 0) {
    return -1;
  }
  ByteBuffer bb=((this.bs == bs) ? this.bb : ByteBuffer.wrap(bs));
  bb.limit(Math.min(off + len,bb.capacity()));
  bb.position(off);
  this.bb=bb;
  this.bs=bs;
  int read=channel.read(bb,position);
  if (read > 0) {
    position+=read;
  }
  return read;
}
