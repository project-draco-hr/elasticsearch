{
  Set<AttachmentProcessor.Field> fields=EnumSet.noneOf(AttachmentProcessor.Field.class);
  List<String> fieldNames=new ArrayList<>();
  int numFields=scaledRandomIntBetween(1,AttachmentProcessor.Field.values().length);
  for (int i=0; i < numFields; i++) {
    AttachmentProcessor.Field field=AttachmentProcessor.Field.values()[i];
    fields.add(field);
    fieldNames.add(field.name().toLowerCase(Locale.ROOT));
  }
  Map<String,Object> config=new HashMap<>();
  config.put("source_field","_field");
  config.put("fields",fieldNames);
  AttachmentProcessor processor=factory.create(config);
  assertThat(processor.getSourceField(),equalTo("_field"));
  assertThat(processor.getFields(),equalTo(fields));
}
