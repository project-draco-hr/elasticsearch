{
  for (  FieldDataFieldsContext.FieldDataField field : context.getFetchSubPhaseContext(CONTEXT_FACTORY).fields()) {
    if (hitContext.hit().fieldsOrNull() == null) {
      hitContext.hit().fields(new HashMap<String,SearchHitField>(2));
    }
    SearchHitField hitField=hitContext.hit().fields().get(field.name());
    if (hitField == null) {
      hitField=new InternalSearchHitField(field.name(),new ArrayList<>(2));
      hitContext.hit().fields().put(field.name(),hitField);
    }
    MappedFieldType fieldType=context.mapperService().fullName(field.name());
    if (fieldType != null) {
      AtomicFieldData data=context.fieldData().getForField(fieldType).load(hitContext.readerContext());
      ScriptDocValues values=data.getScriptValues();
      values.setNextDocId(hitContext.docId());
      hitField.values().addAll(values.getValues());
    }
  }
}
