{
  InternalIndexShard shard=(InternalIndexShard)indicesService.indexServiceSafe(request.shardId().index().name()).shardSafe(request.shardId().id());
  PeerRecoveryStatus peerRecoveryStatus=onGoingRecoveries.get(shard.shardId());
  if (peerRecoveryStatus == null) {
    throw new IndexShardClosedException(shard.shardId());
  }
  peerRecoveryStatus.stage=PeerRecoveryStatus.Stage.FINALIZE;
  shard.performRecoveryFinalization(false,peerRecoveryStatus);
  peerRecoveryStatus.took=System.currentTimeMillis() - peerRecoveryStatus.startTime;
  peerRecoveryStatus.stage=PeerRecoveryStatus.Stage.DONE;
  channel.sendResponse(VoidStreamable.INSTANCE);
}
