{
  boolean changed=false;
  for (  RoutingNode routingNode : allocation.routingNodes()) {
    for (    MutableShardRouting shardRouting : routingNode) {
      if (!shardRouting.started()) {
        continue;
      }
      if (!allocation.deciders().canRemain(shardRouting,routingNode,allocation)) {
        logger.debug("[{}][{}] allocated on [{}], but can no longer be allocated on it, moving...",shardRouting.index(),shardRouting.id(),routingNode.node());
        boolean moved=shardsAllocators.move(shardRouting,routingNode,allocation);
        if (!moved) {
          logger.debug("[{}][{}] can't move",shardRouting.index(),shardRouting.id());
        }
 else {
          changed=true;
        }
      }
    }
  }
  return changed;
}
