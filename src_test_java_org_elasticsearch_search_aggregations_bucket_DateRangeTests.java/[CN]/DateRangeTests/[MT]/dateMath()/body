{
  DateRangeBuilder rangeBuilder=dateRange("range");
  if (randomBoolean()) {
    rangeBuilder.field("date");
  }
 else {
    rangeBuilder.script("doc['date'].value");
  }
  SearchResponse response=client().prepareSearch("idx").addAggregation(rangeBuilder.addUnboundedTo("a long time ago","now-50y").addRange("recently","now-50y","now-1y").addUnboundedFrom("last year","now-1y")).execute().actionGet();
  assertSearchResponse(response);
  DateRange range=response.getAggregations().get("range");
  assertThat(range,notNullValue());
  assertThat(range.getName(),equalTo("range"));
  assertThat(range.getBuckets().size(),equalTo(3));
  List<DateRange.Bucket> buckets=new ArrayList<DateRange.Bucket>(range.getBuckets());
  DateRange.Bucket bucket=buckets.get(0);
  assertThat(bucket.getKey(),equalTo("a long time ago"));
  assertThat(bucket.getDocCount(),equalTo(0L));
  bucket=buckets.get(1);
  assertThat(bucket.getKey(),equalTo("recently"));
  assertThat(bucket.getDocCount(),equalTo((long)numDocs));
  bucket=buckets.get(2);
  assertThat(bucket.getKey(),equalTo("last year"));
  assertThat(bucket.getDocCount(),equalTo(0L));
}
