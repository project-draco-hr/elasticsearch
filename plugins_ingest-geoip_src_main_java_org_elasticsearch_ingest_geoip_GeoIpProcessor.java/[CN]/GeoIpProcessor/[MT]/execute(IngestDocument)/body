{
  String ip=ingestDocument.getFieldValue(sourceField,String.class);
  final InetAddress ipAddress=InetAddresses.forString(ip);
  Map<String,Object> geoData;
switch (dbReader.getMetadata().getDatabaseType()) {
case "GeoLite2-City":
    try {
      geoData=retrieveCityGeoData(ipAddress);
    }
 catch (    AddressNotFoundRuntimeException e) {
      geoData=Collections.emptyMap();
    }
  break;
case "GeoLite2-Country":
try {
  geoData=retrieveCountryGeoData(ipAddress);
}
 catch (AddressNotFoundRuntimeException e) {
  geoData=Collections.emptyMap();
}
break;
default :
throw new ElasticsearchParseException("Unsupported database type [" + dbReader.getMetadata().getDatabaseType() + "]",new IllegalStateException());
}
ingestDocument.setFieldValue(targetField,geoData);
}
