{
  final String index="test";
  clusterService.setState(state(index,randomBoolean(),ShardRoutingState.STARTED));
  logger.debug("--> using initial state:\n{}",clusterService.state().prettyPrint());
  Future<BroadcastResponse> response=(broadcastReplicationAction.execute(new BroadcastRequest().indices(index)));
  for (  Tuple<ShardId,ActionListener<ActionWriteResponse>> shardRequests : broadcastReplicationAction.capturedShardRequests) {
    ActionWriteResponse actionWriteResponse=new ActionWriteResponse();
    actionWriteResponse.setShardInfo(new ActionWriteResponse.ShardInfo(1,1,new ActionWriteResponse.ShardInfo.Failure[0]));
    shardRequests.v2().onResponse(actionWriteResponse);
  }
  logger.info("total shards: {}, ",response.get().getTotalShards());
  assertBroadcastResponse(1,1,0,response.get(),null);
}
