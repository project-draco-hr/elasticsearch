{
  for (int runs=0; runs < NUMBER_OF_TESTBUILDERS; runs++) {
    T testItem=createTestItem();
    XContentBuilder builder=XContentFactory.contentBuilder(randomFrom(XContentType.values()));
    if (randomBoolean()) {
      builder.prettyPrint();
    }
    builder.startObject();
    testItem.toXContent(builder,ToXContent.EMPTY_PARAMS);
    builder.endObject();
    XContentParser itemParser=XContentHelper.createParser(builder.bytes());
    itemParser.nextToken();
    itemParser.nextToken();
    String elementName=itemParser.currentName();
    itemParser.nextToken();
    QueryParseContext context=new QueryParseContext(indicesQueriesRegistry);
    context.reset(itemParser);
    NamedWriteable<T> parsedItem=testItem.fromXContent(context,elementName);
    assertNotSame(testItem,parsedItem);
    assertEquals(testItem,parsedItem);
    assertEquals(testItem.hashCode(),parsedItem.hashCode());
  }
}
