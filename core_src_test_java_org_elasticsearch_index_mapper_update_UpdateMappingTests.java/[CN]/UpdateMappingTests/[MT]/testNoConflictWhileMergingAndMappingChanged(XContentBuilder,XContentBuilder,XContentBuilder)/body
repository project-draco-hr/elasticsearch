{
  IndexService indexService=createIndex("test",Settings.settingsBuilder().build(),"type",mapping);
  MergeResult mergeResult=indexService.mapperService().documentMapper("type").merge(indexService.mapperService().parse("type",new CompressedXContent(mappingUpdate.bytes()),true).mapping(),false,false);
  assertThat(mergeResult.buildConflicts().length,equalTo(0));
  CompressedXContent mappingAfterUpdate=indexService.mapperService().documentMapper("type").mappingSource();
  assertThat(mappingAfterUpdate.toString(),equalTo(expectedMapping.string()));
}
