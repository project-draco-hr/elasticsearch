{
  XContentBuilder mapping=XContentFactory.jsonBuilder().startObject().startObject("type").startObject("properties").startObject("foo").field("type","long").endObject().endObject().endObject().endObject();
  MapperService mapperService=createIndex("test",Settings.settingsBuilder().build(),"type",mapping).mapperService();
  XContentBuilder update=XContentFactory.jsonBuilder().startObject().startObject("type").startObject("properties").startObject("foo").field("type","double").endObject().endObject().endObject().endObject();
  try {
    mapperService.merge("type",new CompressedXContent(update.string()),MapperService.MergeReason.MAPPING_UPDATE,false);
    fail();
  }
 catch (  IllegalArgumentException e) {
    assertThat(e.getMessage(),containsString("mapper [foo] of different type, current_type [long], merged_type [double]"));
  }
  try {
    mapperService.merge("type",new CompressedXContent(update.string()),MapperService.MergeReason.MAPPING_UPDATE,false);
    fail();
  }
 catch (  IllegalArgumentException e) {
    assertThat(e.getMessage(),containsString("mapper [foo] of different type, current_type [long], merged_type [double]"));
  }
  assertTrue(mapperService.documentMapper("type").mapping().root().getMapper("foo") instanceof LongFieldMapper);
}
