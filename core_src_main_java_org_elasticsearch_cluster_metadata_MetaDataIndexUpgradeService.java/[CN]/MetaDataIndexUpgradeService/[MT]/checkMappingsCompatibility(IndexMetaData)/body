{
  Index index=new Index(indexMetaData.getIndex());
  Settings settings=indexMetaData.getSettings();
  try {
    IndexSettings indexSettings=new IndexSettings(new Index(indexMetaData.getIndex()),Settings.settingsBuilder().put(settings).put(indexMetaData.getSettings()).build(),Collections.EMPTY_LIST);
    SimilarityService similarityService=new SimilarityService(indexSettings,Collections.EMPTY_MAP);
    try (AnalysisService analysisService=new FakeAnalysisService(indexSettings)){
      try (MapperService mapperService=new MapperService(indexSettings,analysisService,similarityService,scriptService)){
        for (        ObjectCursor<MappingMetaData> cursor : indexMetaData.getMappings().values()) {
          MappingMetaData mappingMetaData=cursor.value;
          mapperService.merge(mappingMetaData.type(),mappingMetaData.source(),false,false);
        }
      }
     }
   }
 catch (  Exception ex) {
    throw new IllegalStateException("unable to upgrade the mappings for the index [" + indexMetaData.getIndex() + "], reason: ["+ ex.getMessage()+ "]",ex);
  }
}
