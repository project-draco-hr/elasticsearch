{
  if (isUpgraded(indexMetaData)) {
    return archiveBrokenIndexSettings(indexMetaData);
  }
  checkSupportedVersion(indexMetaData);
  IndexMetaData newMetaData=indexMetaData;
  checkMappingsCompatibility(newMetaData);
  newMetaData=markAsUpgraded(newMetaData);
  return archiveBrokenIndexSettings(newMetaData);
}
