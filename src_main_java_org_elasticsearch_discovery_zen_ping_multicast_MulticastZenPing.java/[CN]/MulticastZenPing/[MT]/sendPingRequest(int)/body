{
  try {
    BytesStreamOutput bStream=new BytesStreamOutput();
    StreamOutput out=new HandlesStreamOutput(bStream);
    out.writeBytes(INTERNAL_HEADER);
    Version.writeVersion(version,out);
    out.writeInt(id);
    clusterName.writeTo(out);
    nodesProvider.nodes().localNode().writeTo(out);
    out.close();
    multicastChannel.send(bStream.bytes());
    if (logger.isTraceEnabled()) {
      logger.trace("[{}] sending ping request",id);
    }
  }
 catch (  Exception e) {
    if (lifecycle.stoppedOrClosed()) {
      return;
    }
    if (logger.isDebugEnabled()) {
      logger.debug("failed to send multicast ping request",e);
    }
 else {
      logger.warn("failed to send multicast ping request: {}",ExceptionsHelper.detailedMessage(e));
    }
  }
}
