{
  docMap.setNextDocId(docId);
  sourceMap.setNextDocId(docId);
  if (sameDocCache != null) {
    sourceMap.parsedSource((Map<String,Object>)sameDocCache.get("parsedSource"));
  }
  if (vars == null) {
    vars=cachedVars.get().get();
    vars.clear();
  }
  vars.put("doc",docMap);
  vars.put("_source",sourceMap);
  Object retVal=scriptService.execute(script,vars);
  if (sameDocCache != null) {
    sameDocCache.put("parsedSource",sourceMap.parsedSource());
  }
  return retVal;
}
