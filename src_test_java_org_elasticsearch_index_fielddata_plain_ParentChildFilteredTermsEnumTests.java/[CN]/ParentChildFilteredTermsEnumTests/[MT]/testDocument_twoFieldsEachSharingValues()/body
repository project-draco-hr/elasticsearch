{
  Directory directory=newDirectory();
  RandomIndexWriter indexWriter=new RandomIndexWriter(random(),directory);
  for (int i=1; i <= 1000; i++) {
    Document document=new Document();
    document.add(new StringField("field1",format(i),Field.Store.NO));
    indexWriter.addDocument(document);
    for (int j=0; j < 10; j++) {
      document=new Document();
      document.add(new StringField("field2",format(i),Field.Store.NO));
      indexWriter.addDocument(document);
    }
  }
  IndexReader indexReader=DirectoryReader.open(indexWriter.w,false);
  TermsEnum[] compoundTermsEnums=new TermsEnum[]{new ParentChildIntersectTermsEnum(SlowCompositeReaderWrapper.wrap(indexReader),"field1","field2")};
  for (  TermsEnum termsEnum : compoundTermsEnums) {
    int expected=0;
    for (BytesRef term=termsEnum.next(); term != null; term=termsEnum.next()) {
      ++expected;
      assertThat(term.utf8ToString(),equalTo(format(expected)));
      DocsEnum docsEnum=termsEnum.docs(null,null);
      assertThat(docsEnum,notNullValue());
      int numDocs=0;
      for (int docId=docsEnum.nextDoc(); docId != DocsEnum.NO_MORE_DOCS; docId=docsEnum.nextDoc()) {
        numDocs++;
      }
      assertThat(numDocs,equalTo(11));
    }
  }
  indexWriter.close();
  indexReader.close();
  directory.close();
}
