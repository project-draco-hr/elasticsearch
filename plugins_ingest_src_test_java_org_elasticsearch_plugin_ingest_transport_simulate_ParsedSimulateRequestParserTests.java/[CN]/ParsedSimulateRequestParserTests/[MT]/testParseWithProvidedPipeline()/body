{
  ParsedSimulateRequest expectedRequest=new ParsedSimulateRequest(pipeline,Collections.singletonList(data),false);
  Map<String,Object> raw=new HashMap<>();
  List<Map<String,Object>> docs=new ArrayList<>();
  Map<String,Object> doc=new HashMap<>();
  doc.put("_index","_index");
  doc.put("_type","_type");
  doc.put("_id","_id");
  doc.put("_source",data.getDocument());
  docs.add(doc);
  Map<String,Object> processorConfig=new HashMap<>();
  processorConfig.put("uppercase",Arrays.asList("foo"));
  Map<String,Object> pipelineConfig=new HashMap<>();
  pipelineConfig.put("processors",Collections.singletonList(Collections.singletonMap("mutate",processorConfig)));
  raw.put("docs",docs);
  raw.put("pipeline",pipelineConfig);
  ParsedSimulateRequest actualRequest=parser.parse(raw,false,store);
  assertThat(actualRequest,equalTo(expectedRequest));
}
