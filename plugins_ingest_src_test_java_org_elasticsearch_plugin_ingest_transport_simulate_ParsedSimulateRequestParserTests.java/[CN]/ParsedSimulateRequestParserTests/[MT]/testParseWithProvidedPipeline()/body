{
  ParsedSimulateRequest expectedRequest=new ParsedSimulateRequest(pipeline,Collections.singletonList(data),false);
  Map<String,Object> raw=new HashMap<>();
  List<Map<String,Object>> docs=new ArrayList<>();
  Map<String,Object> doc=new HashMap<>();
  doc.put(Fields.INDEX,"_index");
  doc.put(Fields.TYPE,"_type");
  doc.put(Fields.ID,"_id");
  doc.put(Fields.SOURCE,data.getDocument());
  docs.add(doc);
  Map<String,Object> processorConfig=new HashMap<>();
  processorConfig.put("uppercase",Arrays.asList("foo"));
  Map<String,Object> pipelineConfig=new HashMap<>();
  pipelineConfig.put("processors",Collections.singletonList(Collections.singletonMap("mutate",processorConfig)));
  raw.put(Fields.DOCS,docs);
  raw.put(Fields.PIPELINE,pipelineConfig);
  ParsedSimulateRequest actualRequest=parser.parse(raw,false,store);
  assertThat(actualRequest,equalTo(expectedRequest));
}
