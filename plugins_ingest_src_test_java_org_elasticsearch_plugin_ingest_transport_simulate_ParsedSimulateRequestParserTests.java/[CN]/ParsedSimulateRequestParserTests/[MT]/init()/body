{
  parser=new ParsedSimulateRequest.Parser();
  List<String> uppercase=Collections.unmodifiableList(Collections.singletonList("foo"));
  Processor processor=new MutateProcessor(null,null,null,null,null,null,null,null,uppercase,null);
  pipeline=new Pipeline(ParsedSimulateRequest.Parser.SIMULATED_PIPELINE_ID,null,Collections.unmodifiableList(Arrays.asList(processor)));
  data=new Data("_index","_type","_id",Collections.singletonMap("foo","bar"));
  Map<String,Processor.Factory> processorRegistry=new HashMap<>();
  processorRegistry.put("mutate",new MutateProcessor.Factory());
  store=mock(PipelineStore.class);
  when(store.get("_id")).thenReturn(pipeline);
  when(store.getProcessorFactoryRegistry()).thenReturn(processorRegistry);
}
