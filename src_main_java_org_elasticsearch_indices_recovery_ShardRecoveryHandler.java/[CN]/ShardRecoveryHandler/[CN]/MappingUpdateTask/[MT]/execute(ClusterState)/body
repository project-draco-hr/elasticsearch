{
  if (cancellableThreads.isCancelled() == false) {
    IndexMetaData indexMetaData=clusterService.state().metaData().getIndices().get(indexService.index().getName());
    ImmutableOpenMap<String,MappingMetaData> metaDataMappings=null;
    if (indexMetaData != null) {
      metaDataMappings=indexMetaData.getMappings();
    }
    for (    DocumentMapper documentMapper : indexService.mapperService().docMappers(false)) {
      MappingMetaData mappingMetaData=metaDataMappings == null ? null : metaDataMappings.get(documentMapper.type());
      if (mappingMetaData == null || !documentMapper.refreshSource().equals(mappingMetaData.source())) {
        documentMappersToUpdate.add(documentMapper);
      }
    }
  }
  return currentState;
}
