{
  final Lock writeLock=directory.makeLock(lockName);
  boolean success=false;
  try {
    if (writeLock.obtain(timeout) == false) {
      throw new LockObtainFailedException("failed to obtain lock: " + writeLock);
    }
    success=true;
  }
  finally {
    if (success == false) {
      writeLock.close();
    }
  }
  return writeLock;
}
