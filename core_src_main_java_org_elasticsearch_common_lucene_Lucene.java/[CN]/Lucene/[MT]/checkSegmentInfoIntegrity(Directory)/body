{
  new SegmentInfos.FindSegmentsFile(directory){
    @Override protected Object doBody(    String segmentFileName) throws IOException {
      try (IndexInput input=directory.openInput(segmentFileName,IOContext.READ)){
        final int format=input.readInt();
        final int actualFormat;
        if (format == CodecUtil.CODEC_MAGIC) {
          actualFormat=CodecUtil.checkHeaderNoMagic(input,"segments",SegmentInfos.VERSION_40,Integer.MAX_VALUE);
          if (actualFormat >= SegmentInfos.VERSION_48) {
            CodecUtil.checksumEntireFile(input);
          }
        }
      }
       return null;
    }
  }
.run();
}
