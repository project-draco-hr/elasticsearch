{
  Tuple<Settings,Environment> tuple=InternalSettingsPerparer.prepareSettings(EMPTY_SETTINGS,true);
  try {
    Classes.getDefaultClassLoader().loadClass("org.apache.log4j.Logger");
    LogConfigurator.configure(tuple.v1());
  }
 catch (  ClassNotFoundException e) {
  }
catch (  NoClassDefFoundError e) {
  }
catch (  Exception e) {
    System.err.println("Failed to configure logging...");
    e.printStackTrace();
  }
  if (tuple.v1().get(JmxService.SettingsConstants.CREATE_CONNECTOR) == null) {
    Settings updated=settingsBuilder().put(tuple.v1()).put(JmxService.SettingsConstants.CREATE_CONNECTOR,true).build();
    tuple=new Tuple<Settings,Environment>(updated,tuple.v2());
  }
  ServerBuilder serverBuilder=ServerBuilder.serverBuilder().settings(tuple.v1()).loadConfigSettings(false);
  server=serverBuilder.build();
  if (addShutdownHook) {
    Runtime.getRuntime().addShutdownHook(new Thread(){
      @Override public void run(){
        server.close();
      }
    }
);
  }
}
