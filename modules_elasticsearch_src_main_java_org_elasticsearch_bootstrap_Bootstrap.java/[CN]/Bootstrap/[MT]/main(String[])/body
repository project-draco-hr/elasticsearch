{
  Bootstrap bootstrap=new Bootstrap();
  String pidFile=System.getProperty("es-pidfile");
  boolean foreground=System.getProperty("es-foreground") != null;
  Tuple<Settings,Environment> tuple=null;
  try {
    tuple=initialSettings();
    setupLogging(tuple);
  }
 catch (  Exception e) {
    String errorMessage=buildErrorMessage("Setup",e);
    System.err.println(errorMessage);
    System.err.flush();
    System.exit(3);
  }
  String stage="Initialization";
  try {
    if (!foreground) {
      Loggers.disableConsoleLogging();
      System.out.close();
    }
    bootstrap.setup(true,tuple);
    if (pidFile != null) {
      new File(pidFile).deleteOnExit();
    }
    stage="Startup";
    bootstrap.start();
    if (!foreground) {
      System.err.close();
    }
  }
 catch (  Throwable e) {
    Logger logger=Loggers.getLogger(Bootstrap.class);
    if (bootstrap.server != null) {
      logger=Loggers.getLogger(Bootstrap.class,bootstrap.server.settings().get("name"));
    }
    String errorMessage=buildErrorMessage(stage,e);
    if (foreground) {
      logger.error(errorMessage);
    }
 else {
      System.err.println(errorMessage);
      System.err.flush();
    }
    Loggers.disableConsoleLogging();
    if (logger.isDebugEnabled()) {
      logger.debug("Exception",e);
    }
    System.exit(3);
  }
}
