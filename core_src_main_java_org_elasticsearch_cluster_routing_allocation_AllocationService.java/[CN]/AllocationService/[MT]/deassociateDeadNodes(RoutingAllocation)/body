{
  boolean changed=false;
  for (RoutingNodes.RoutingNodesIterator it=allocation.routingNodes().nodes(); it.hasNext(); ) {
    RoutingNode node=it.next();
    if (allocation.nodes().dataNodes().containsKey(node.nodeId())) {
      continue;
    }
    changed=true;
    UnassignedInfo unassignedInfo=new UnassignedInfo(UnassignedInfo.Reason.NODE_LEFT,"node_left[" + node.nodeId() + "]");
    for (    ShardRouting shardRouting : node.copyShards()) {
      applyFailedShard(allocation,shardRouting,false,unassignedInfo);
    }
    it.remove();
  }
  return changed;
}
