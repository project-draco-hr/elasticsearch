{
  boolean changed=false;
  for (RoutingNodes.RoutingNodesIterator it=allocation.routingNodes().nodes(); it.hasNext(); ) {
    RoutingNode node=it.next();
    if (allocation.nodes().dataNodes().containsKey(node.nodeId())) {
      continue;
    }
    changed=true;
    for (    MutableShardRouting shardRouting : node.copyShards()) {
      applyFailedShard(allocation,shardRouting,false);
    }
    it.remove();
  }
  return changed;
}
