{
  RoutingNodes routingNodes=getMutableRoutingNodes(clusterState);
  routingNodes.unassigned().shuffle();
  RoutingAllocation allocation=new RoutingAllocation(allocationDeciders,routingNodes,clusterState.nodes(),clusterInfoService.getClusterInfo(),currentNanoTime());
  allocation.debugDecision(debug);
  if (!reroute(allocation)) {
    return new RoutingAllocation.Result(false,clusterState.routingTable(),clusterState.metaData());
  }
  RoutingAllocation.Result result=buildChangedResult(clusterState.metaData(),routingNodes);
  logClusterHealthStateChange(new ClusterStateHealth(clusterState),new ClusterStateHealth(clusterState.getMetaData(),result.routingTable()),reason);
  return result;
}
