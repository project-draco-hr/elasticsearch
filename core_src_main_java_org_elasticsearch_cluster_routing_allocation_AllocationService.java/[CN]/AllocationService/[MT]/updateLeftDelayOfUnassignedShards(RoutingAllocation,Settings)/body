{
  final RoutingNodes.UnassignedShards.UnassignedIterator unassignedIterator=allocation.routingNodes().unassigned().iterator();
  final MetaData metaData=allocation.metaData();
  while (unassignedIterator.hasNext()) {
    ShardRouting shardRouting=unassignedIterator.next();
    final IndexMetaData indexMetaData=metaData.getIndexSafe(shardRouting.index());
    UnassignedInfo previousUnassignedInfo=shardRouting.unassignedInfo();
    UnassignedInfo updatedUnassignedInfo=previousUnassignedInfo.updateDelay(allocation.getCurrentNanoTime(),settings,indexMetaData.getSettings());
    if (updatedUnassignedInfo != previousUnassignedInfo) {
      unassignedIterator.updateUnassignedInfo(updatedUnassignedInfo);
    }
  }
}
