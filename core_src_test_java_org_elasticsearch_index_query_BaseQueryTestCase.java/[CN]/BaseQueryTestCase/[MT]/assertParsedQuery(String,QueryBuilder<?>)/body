{
  XContentParser parser=XContentFactory.xContent(queryAsString).createParser(queryAsString);
  QueryParseContext context=createParseContext();
  context.reset(parser);
  assertQueryHeader(parser,expectedQuery.getName());
  QueryBuilder newQuery=queryParser(expectedQuery).fromXContent(context);
  assertNotSame(newQuery,expectedQuery);
  assertEquals(expectedQuery,newQuery);
  assertEquals(expectedQuery.hashCode(),newQuery.hashCode());
}
