{
  QB testQuery=createTestQueryBuilder();
  QueryParseContext context=createContext();
  context.setAllowUnmappedFields(true);
  Query expectedQuery=createExpectedQuery(testQuery,context);
  Query actualQuery=testQuery.toQuery(context);
  if (expectedQuery == null) {
    assertNull("Expected a null query, saw some object.",actualQuery);
  }
 else {
    assertThat(actualQuery,instanceOf(expectedQuery.getClass()));
    assertThat(actualQuery,equalTo(expectedQuery));
    assertLuceneQuery(testQuery,actualQuery,context);
  }
}
