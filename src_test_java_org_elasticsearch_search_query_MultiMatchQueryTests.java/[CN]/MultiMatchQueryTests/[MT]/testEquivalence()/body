{
  final int numDocs=(int)client().prepareCount("test").setQuery(matchAllQuery()).get().getCount();
  int numIters=atLeast(5);
  for (int i=0; i < numIters; i++) {
{
      MatchQueryBuilder.Type type=randomBoolean() ? null : MatchQueryBuilder.Type.BOOLEAN;
      SearchResponse left=client().prepareSearch("test").setSize(numDocs).setQuery(multiMatchQuery("marvel hero captain america","full_name","first_name","last_name","category").operator(MatchQueryBuilder.Operator.OR).type(type)).get();
      SearchResponse right=client().prepareSearch("test").setSize(numDocs).setQuery(disMaxQuery().add(matchQuery("full_name","marvel hero captain america")).add(matchQuery("first_name","marvel hero captain america")).add(matchQuery("last_name","marvel hero captain america")).add(matchQuery("category","marvel hero captain america"))).get();
      assertEquivalent("marvel hero captain america",left,right);
    }
{
      MatchQueryBuilder.Type type=randomBoolean() ? null : MatchQueryBuilder.Type.BOOLEAN;
      String minShouldMatch=randomBoolean() ? null : "" + between(0,1);
      MatchQueryBuilder.Operator op=randomBoolean() ? MatchQueryBuilder.Operator.AND : MatchQueryBuilder.Operator.OR;
      SearchResponse left=client().prepareSearch("test").setSize(numDocs).setQuery(multiMatchQuery("captain america","full_name","first_name","last_name","category").operator(op).useDisMax(false).minimumShouldMatch(minShouldMatch).type(type)).get();
      SearchResponse right=client().prepareSearch("test").setSize(numDocs).setQuery(boolQuery().minimumShouldMatch(minShouldMatch).should(randomBoolean() ? termQuery("full_name","captain america") : matchQuery("full_name","captain america").operator(op)).should(matchQuery("first_name","captain america").operator(op)).should(matchQuery("last_name","captain america").operator(op)).should(matchQuery("category","captain america").operator(op))).get();
      assertEquivalent("captain america",left,right);
    }
{
      String minShouldMatch=randomBoolean() ? null : "" + between(0,1);
      MatchQueryBuilder.Operator op=randomBoolean() ? MatchQueryBuilder.Operator.AND : MatchQueryBuilder.Operator.OR;
      SearchResponse left=client().prepareSearch("test").setSize(numDocs).setQuery(multiMatchQuery("capta","full_name","first_name","last_name","category").type(MatchQueryBuilder.Type.PHRASE_PREFIX).useDisMax(false).minimumShouldMatch(minShouldMatch)).get();
      SearchResponse right=client().prepareSearch("test").setSize(numDocs).setQuery(boolQuery().minimumShouldMatch(minShouldMatch).should(matchPhrasePrefixQuery("full_name","capta")).should(matchPhrasePrefixQuery("first_name","capta").operator(op)).should(matchPhrasePrefixQuery("last_name","capta").operator(op)).should(matchPhrasePrefixQuery("category","capta").operator(op))).get();
      assertEquivalent("capta",left,right);
    }
{
      String minShouldMatch=randomBoolean() ? null : "" + between(0,1);
      MatchQueryBuilder.Operator op=randomBoolean() ? MatchQueryBuilder.Operator.AND : MatchQueryBuilder.Operator.OR;
      SearchResponse left=client().prepareSearch("test").setSize(numDocs).setQuery(multiMatchQuery("captain america","full_name","first_name","last_name","category").type(MatchQueryBuilder.Type.PHRASE).useDisMax(false).minimumShouldMatch(minShouldMatch)).get();
      SearchResponse right=client().prepareSearch("test").setSize(numDocs).setQuery(boolQuery().minimumShouldMatch(minShouldMatch).should(matchPhraseQuery("full_name","captain america")).should(matchPhraseQuery("first_name","captain america").operator(op)).should(matchPhraseQuery("last_name","captain america").operator(op)).should(matchPhraseQuery("category","captain america").operator(op))).get();
      assertEquivalent("captain america",left,right);
    }
  }
}
