{
  TransportClient client=new TransportClient(ImmutableSettings.builder().put("client.transport.sniff",true).put("cluster.name","cluster1").put("client.transport.nodes_sampler_interval","1s").put(TransportModule.TRANSPORT_SERVICE_TYPE_KEY,InternalTransportService.class.getName()).put(HEADER_SETTINGS).build());
  client.addTransportAddress(address);
  InternalTransportService service=(InternalTransportService)client.injector.getInstance(TransportService.class);
  if (!service.clusterStateLatch.await(5,TimeUnit.SECONDS)) {
    fail("takes way too long to get the cluster state");
  }
  assertThat(client.connectedNodes().size(),is(1));
  assertThat(client.connectedNodes().get(0).getAddress(),is((TransportAddress)address));
}
