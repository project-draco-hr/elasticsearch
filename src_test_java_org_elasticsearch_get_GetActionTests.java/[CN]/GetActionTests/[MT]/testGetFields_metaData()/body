{
  client().admin().indices().prepareCreate("my-index").setSettings(ImmutableSettings.settingsBuilder().put("index.refresh_interval",-1)).get();
  client().prepareIndex("my-index","my-type1","1").setRouting("1").setSource(jsonBuilder().startObject().field("field1","value").endObject()).get();
  GetResponse getResponse=client().prepareGet("my-index","my-type1","1").setRouting("1").setFields("field1","_routing").get();
  assertThat(getResponse.isExists(),equalTo(true));
  assertThat(getResponse.getField("field1").isMetadataField(),equalTo(false));
  assertThat(getResponse.getField("field1").getValue().toString(),equalTo("value"));
  assertThat(getResponse.getField("_routing").isMetadataField(),equalTo(true));
  assertThat(getResponse.getField("_routing").getValue().toString(),equalTo("1"));
  client().admin().indices().prepareFlush("my-index").get();
  client().prepareGet("my-index","my-type1","1").setFields("field1","_routing").setRouting("1").get();
  assertThat(getResponse.isExists(),equalTo(true));
  assertThat(getResponse.getField("field1").isMetadataField(),equalTo(false));
  assertThat(getResponse.getField("field1").getValue().toString(),equalTo("value"));
  assertThat(getResponse.getField("_routing").isMetadataField(),equalTo(true));
  assertThat(getResponse.getField("_routing").getValue().toString(),equalTo("1"));
}
