{
  try {
    client().admin().indices().prepareDelete("test").execute().actionGet();
  }
 catch (  Exception e) {
  }
  String mapping1=XContentFactory.jsonBuilder().startObject().startObject("type1").startObject("properties").startObject("field").field("type","string").field("store","yes").endObject().endObject().endObject().endObject().string();
  String mapping2=XContentFactory.jsonBuilder().startObject().startObject("type2").startObject("properties").startObject("field").field("type","string").field("store","yes").endObject().endObject().startObject("_source").field("enabled",false).endObject().endObject().endObject().string();
  client().admin().indices().prepareCreate("test").addMapping("type1",mapping1).addMapping("type2",mapping2).setSettings(ImmutableSettings.settingsBuilder().put("index.refresh_interval",-1)).execute().actionGet();
  ensureGreen();
  GetResponse response=client().prepareGet("test","type1","1").execute().actionGet();
  assertThat(response.isExists(),equalTo(false));
  response=client().prepareGet("test","type2","1").execute().actionGet();
  assertThat(response.isExists(),equalTo(false));
  client().prepareIndex("test","type1","1").setSource(jsonBuilder().startObject().field("field","1","2").endObject()).execute().actionGet();
  client().prepareIndex("test","type2","1").setSource(jsonBuilder().startObject().field("field","1","2").endObject()).execute().actionGet();
  response=client().prepareGet("test","type1","1").setFields("field").execute().actionGet();
  assertThat(response.isExists(),equalTo(true));
  assertThat(response.getId(),equalTo("1"));
  assertThat(response.getType(),equalTo("type1"));
  assertThat(response.getFields().size(),equalTo(1));
  assertThat(response.getFields().get("field").getValues().size(),equalTo(2));
  assertThat(response.getFields().get("field").getValues().get(0).toString(),equalTo("1"));
  assertThat(response.getFields().get("field").getValues().get(1).toString(),equalTo("2"));
  response=client().prepareGet("test","type2","1").setFields("field").execute().actionGet();
  assertThat(response.isExists(),equalTo(true));
  assertThat(response.getType(),equalTo("type2"));
  assertThat(response.getId(),equalTo("1"));
  assertThat(response.getFields().size(),equalTo(1));
  assertThat(response.getFields().get("field").getValues().size(),equalTo(2));
  assertThat(response.getFields().get("field").getValues().get(0).toString(),equalTo("1"));
  assertThat(response.getFields().get("field").getValues().get(1).toString(),equalTo("2"));
  client().admin().indices().prepareRefresh("test").execute().actionGet();
  response=client().prepareGet("test","type1","1").setFields("field").execute().actionGet();
  assertThat(response.isExists(),equalTo(true));
  assertThat(response.getId(),equalTo("1"));
  assertThat(response.getFields().size(),equalTo(1));
  assertThat(response.getFields().get("field").getValues().size(),equalTo(2));
  assertThat(response.getFields().get("field").getValues().get(0).toString(),equalTo("1"));
  assertThat(response.getFields().get("field").getValues().get(1).toString(),equalTo("2"));
  response=client().prepareGet("test","type2","1").setFields("field").execute().actionGet();
  assertThat(response.isExists(),equalTo(true));
  assertThat(response.getId(),equalTo("1"));
  assertThat(response.getFields().size(),equalTo(1));
  assertThat(response.getFields().get("field").getValues().size(),equalTo(2));
  assertThat(response.getFields().get("field").getValues().get(0).toString(),equalTo("1"));
  assertThat(response.getFields().get("field").getValues().get(1).toString(),equalTo("2"));
}
