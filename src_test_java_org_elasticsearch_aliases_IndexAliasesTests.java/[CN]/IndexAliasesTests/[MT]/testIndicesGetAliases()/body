{
  Settings indexSettings=ImmutableSettings.settingsBuilder().put("index.number_of_shards",1).put("index.number_of_replicas",0).build();
  logger.info("--> creating indices [foobar, test, test123, foobarbaz, bazbar]");
  admin().indices().prepareCreate("foobar").setSettings(indexSettings).execute().actionGet();
  admin().indices().prepareCreate("test").setSettings(indexSettings).execute().actionGet();
  admin().indices().prepareCreate("test123").setSettings(indexSettings).execute().actionGet();
  admin().indices().prepareCreate("foobarbaz").setSettings(indexSettings).execute().actionGet();
  admin().indices().prepareCreate("bazbar").setSettings(indexSettings).execute().actionGet();
  ensureGreen();
  logger.info("--> creating aliases [alias1, alias2]");
  admin().indices().prepareAliases().addAlias("foobar","alias1").execute().actionGet();
  IndicesAliasesResponse indicesAliasesResponse=admin().indices().prepareAliases().addAlias("foobar","alias2").execute().actionGet();
  assertThat(indicesAliasesResponse.isAcknowledged(),equalTo(true));
  logger.info("--> getting alias1");
  GetAliasesResponse getResponse=admin().indices().prepareGetAliases("alias1").execute().actionGet();
  assertThat(getResponse,notNullValue());
  assertThat(getResponse.getAliases().size(),equalTo(1));
  assertThat(getResponse.getAliases().get("foobar").size(),equalTo(1));
  assertThat(getResponse.getAliases().get("foobar").get(0),notNullValue());
  assertThat(getResponse.getAliases().get("foobar").get(0).alias(),equalTo("alias1"));
  assertThat(getResponse.getAliases().get("foobar").get(0).getFilter(),nullValue());
  assertThat(getResponse.getAliases().get("foobar").get(0).getIndexRouting(),nullValue());
  assertThat(getResponse.getAliases().get("foobar").get(0).getSearchRouting(),nullValue());
  AliasesExistResponse existsResponse=admin().indices().prepareAliasesExist("alias1").execute().actionGet();
  assertThat(existsResponse.exists(),equalTo(true));
  logger.info("--> getting all aliases that start with alias*");
  getResponse=admin().indices().prepareGetAliases("alias*").execute().actionGet();
  assertThat(getResponse,notNullValue());
  assertThat(getResponse.getAliases().size(),equalTo(1));
  assertThat(getResponse.getAliases().get("foobar").size(),equalTo(2));
  assertThat(getResponse.getAliases().get("foobar").get(0),notNullValue());
  assertThat(getResponse.getAliases().get("foobar").get(0).alias(),equalTo("alias2"));
  assertThat(getResponse.getAliases().get("foobar").get(0).getFilter(),nullValue());
  assertThat(getResponse.getAliases().get("foobar").get(0).getIndexRouting(),nullValue());
  assertThat(getResponse.getAliases().get("foobar").get(0).getSearchRouting(),nullValue());
  assertThat(getResponse.getAliases().get("foobar").get(1),notNullValue());
  assertThat(getResponse.getAliases().get("foobar").get(1).alias(),equalTo("alias1"));
  assertThat(getResponse.getAliases().get("foobar").get(1).getFilter(),nullValue());
  assertThat(getResponse.getAliases().get("foobar").get(1).getIndexRouting(),nullValue());
  assertThat(getResponse.getAliases().get("foobar").get(1).getSearchRouting(),nullValue());
  existsResponse=admin().indices().prepareAliasesExist("alias*").execute().actionGet();
  assertThat(existsResponse.exists(),equalTo(true));
  logger.info("--> creating aliases [bar, baz, foo]");
  admin().indices().prepareAliases().addAlias("bazbar","bar").addAlias("bazbar","bac",termFilter("field","value")).addAlias("foobar","foo").execute().actionGet();
  indicesAliasesResponse=admin().indices().prepareAliases().addAliasAction(new AliasAction(AliasAction.Type.ADD,"foobar","bac").routing("bla")).execute().actionGet();
  assertThat(indicesAliasesResponse.isAcknowledged(),equalTo(true));
  logger.info("--> getting bar and baz for index bazbar");
  getResponse=admin().indices().prepareGetAliases("bar","bac").addIndices("bazbar").execute().actionGet();
  assertThat(getResponse,notNullValue());
  assertThat(getResponse.getAliases().size(),equalTo(1));
  assertThat(getResponse.getAliases().get("bazbar").size(),equalTo(2));
  assertThat(getResponse.getAliases().get("bazbar").get(0),notNullValue());
  assertThat(getResponse.getAliases().get("bazbar").get(0).alias(),equalTo("bac"));
  assertThat(getResponse.getAliases().get("bazbar").get(0).getFilter().string(),containsString("term"));
  assertThat(getResponse.getAliases().get("bazbar").get(0).getFilter().string(),containsString("field"));
  assertThat(getResponse.getAliases().get("bazbar").get(0).getFilter().string(),containsString("value"));
  assertThat(getResponse.getAliases().get("bazbar").get(0).getIndexRouting(),nullValue());
  assertThat(getResponse.getAliases().get("bazbar").get(0).getSearchRouting(),nullValue());
  assertThat(getResponse.getAliases().get("bazbar").get(1),notNullValue());
  assertThat(getResponse.getAliases().get("bazbar").get(1).alias(),equalTo("bar"));
  assertThat(getResponse.getAliases().get("bazbar").get(1).getFilter(),nullValue());
  assertThat(getResponse.getAliases().get("bazbar").get(1).getIndexRouting(),nullValue());
  assertThat(getResponse.getAliases().get("bazbar").get(1).getSearchRouting(),nullValue());
  existsResponse=admin().indices().prepareAliasesExist("bar","bac").addIndices("bazbar").execute().actionGet();
  assertThat(existsResponse.exists(),equalTo(true));
  logger.info("--> getting *b* for index baz*");
  getResponse=admin().indices().prepareGetAliases("*b*").addIndices("baz*").execute().actionGet();
  assertThat(getResponse,notNullValue());
  assertThat(getResponse.getAliases().size(),equalTo(1));
  assertThat(getResponse.getAliases().get("bazbar").size(),equalTo(2));
  assertThat(getResponse.getAliases().get("bazbar").get(0),notNullValue());
  assertThat(getResponse.getAliases().get("bazbar").get(0).alias(),equalTo("bac"));
  assertThat(getResponse.getAliases().get("bazbar").get(0).getFilter().string(),containsString("term"));
  assertThat(getResponse.getAliases().get("bazbar").get(0).getFilter().string(),containsString("field"));
  assertThat(getResponse.getAliases().get("bazbar").get(0).getFilter().string(),containsString("value"));
  assertThat(getResponse.getAliases().get("bazbar").get(0).getIndexRouting(),nullValue());
  assertThat(getResponse.getAliases().get("bazbar").get(0).getSearchRouting(),nullValue());
  assertThat(getResponse.getAliases().get("bazbar").get(1),notNullValue());
  assertThat(getResponse.getAliases().get("bazbar").get(1).alias(),equalTo("bar"));
  assertThat(getResponse.getAliases().get("bazbar").get(1).getFilter(),nullValue());
  assertThat(getResponse.getAliases().get("bazbar").get(1).getIndexRouting(),nullValue());
  assertThat(getResponse.getAliases().get("bazbar").get(1).getSearchRouting(),nullValue());
  existsResponse=admin().indices().prepareAliasesExist("*b*").addIndices("baz*").execute().actionGet();
  assertThat(existsResponse.exists(),equalTo(true));
  logger.info("--> getting *b* for index *bar");
  getResponse=admin().indices().prepareGetAliases("b*").addIndices("*bar").execute().actionGet();
  assertThat(getResponse,notNullValue());
  assertThat(getResponse.getAliases().size(),equalTo(2));
  assertThat(getResponse.getAliases().get("bazbar").size(),equalTo(2));
  assertThat(getResponse.getAliases().get("bazbar").get(0),notNullValue());
  assertThat(getResponse.getAliases().get("bazbar").get(0).alias(),equalTo("bac"));
  assertThat(getResponse.getAliases().get("bazbar").get(0).getFilter().string(),containsString("term"));
  assertThat(getResponse.getAliases().get("bazbar").get(0).getFilter().string(),containsString("field"));
  assertThat(getResponse.getAliases().get("bazbar").get(0).getFilter().string(),containsString("value"));
  assertThat(getResponse.getAliases().get("bazbar").get(0).getIndexRouting(),nullValue());
  assertThat(getResponse.getAliases().get("bazbar").get(0).getSearchRouting(),nullValue());
  assertThat(getResponse.getAliases().get("bazbar").get(1),notNullValue());
  assertThat(getResponse.getAliases().get("bazbar").get(1).alias(),equalTo("bar"));
  assertThat(getResponse.getAliases().get("bazbar").get(1).getFilter(),nullValue());
  assertThat(getResponse.getAliases().get("bazbar").get(1).getIndexRouting(),nullValue());
  assertThat(getResponse.getAliases().get("bazbar").get(1).getSearchRouting(),nullValue());
  assertThat(getResponse.getAliases().get("foobar").get(0),notNullValue());
  assertThat(getResponse.getAliases().get("foobar").get(0).alias(),equalTo("bac"));
  assertThat(getResponse.getAliases().get("foobar").get(0).getFilter(),nullValue());
  assertThat(getResponse.getAliases().get("foobar").get(0).getIndexRouting(),equalTo("bla"));
  assertThat(getResponse.getAliases().get("foobar").get(0).getSearchRouting(),equalTo("bla"));
  existsResponse=admin().indices().prepareAliasesExist("b*").addIndices("*bar").execute().actionGet();
  assertThat(existsResponse.exists(),equalTo(true));
  logger.info("--> getting f* for index *bar");
  getResponse=admin().indices().prepareGetAliases("f*").addIndices("*bar").execute().actionGet();
  assertThat(getResponse,notNullValue());
  assertThat(getResponse.getAliases().size(),equalTo(1));
  assertThat(getResponse.getAliases().get("foobar").get(0),notNullValue());
  assertThat(getResponse.getAliases().get("foobar").get(0).alias(),equalTo("foo"));
  assertThat(getResponse.getAliases().get("foobar").get(0).getFilter(),nullValue());
  assertThat(getResponse.getAliases().get("foobar").get(0).getIndexRouting(),nullValue());
  assertThat(getResponse.getAliases().get("foobar").get(0).getSearchRouting(),nullValue());
  existsResponse=admin().indices().prepareAliasesExist("f*").addIndices("*bar").execute().actionGet();
  assertThat(existsResponse.exists(),equalTo(true));
  logger.info("--> getting f* for index *bac");
  getResponse=admin().indices().prepareGetAliases("foo").addIndices("*bac").execute().actionGet();
  assertThat(getResponse,notNullValue());
  assertThat(getResponse.getAliases().size(),equalTo(1));
  assertThat(getResponse.getAliases().get("foobar").size(),equalTo(1));
  assertThat(getResponse.getAliases().get("foobar").get(0),notNullValue());
  assertThat(getResponse.getAliases().get("foobar").get(0).alias(),equalTo("foo"));
  assertThat(getResponse.getAliases().get("foobar").get(0).getFilter(),nullValue());
  assertThat(getResponse.getAliases().get("foobar").get(0).getIndexRouting(),nullValue());
  assertThat(getResponse.getAliases().get("foobar").get(0).getSearchRouting(),nullValue());
  existsResponse=admin().indices().prepareAliasesExist("foo").addIndices("*bac").execute().actionGet();
  assertThat(existsResponse.exists(),equalTo(true));
  logger.info("--> getting foo for index foobar");
  getResponse=admin().indices().prepareGetAliases("foo").addIndices("foobar").execute().actionGet();
  assertThat(getResponse,notNullValue());
  assertThat(getResponse.getAliases().size(),equalTo(1));
  assertThat(getResponse.getAliases().get("foobar").get(0),notNullValue());
  assertThat(getResponse.getAliases().get("foobar").get(0).alias(),equalTo("foo"));
  assertThat(getResponse.getAliases().get("foobar").get(0).getFilter(),nullValue());
  assertThat(getResponse.getAliases().get("foobar").get(0).getIndexRouting(),nullValue());
  assertThat(getResponse.getAliases().get("foobar").get(0).getSearchRouting(),nullValue());
  existsResponse=admin().indices().prepareAliasesExist("foo").addIndices("foobar").execute().actionGet();
  assertThat(existsResponse.exists(),equalTo(true));
  logger.info("--> getting * for index *bac");
  getResponse=admin().indices().prepareGetAliases("*").addIndices("*bac").execute().actionGet();
  assertThat(getResponse,notNullValue());
  assertThat(getResponse.getAliases().size(),equalTo(2));
  assertThat(getResponse.getAliases().get("foobar").size(),equalTo(4));
  assertThat(getResponse.getAliases().get("bazbar").size(),equalTo(2));
  existsResponse=admin().indices().prepareAliasesExist("*").addIndices("*bac").execute().actionGet();
  assertThat(existsResponse.exists(),equalTo(true));
  indicesAliasesResponse=admin().indices().prepareAliases().removeAlias("foobar","foo").execute().actionGet();
  assertThat(indicesAliasesResponse.isAcknowledged(),equalTo(true));
  getResponse=admin().indices().prepareGetAliases("foo").addIndices("foobar").execute().actionGet();
  assertThat(getResponse.getAliases().isEmpty(),equalTo(true));
  existsResponse=admin().indices().prepareAliasesExist("foo").addIndices("foobar").execute().actionGet();
  assertThat(existsResponse.exists(),equalTo(false));
}
