{
  logger.info("--> creating index [test]");
  createIndex("test");
  ensureGreen();
  logger.info("--> aliasing index [test] with [alias1]");
  admin().indices().prepareAliases().addAlias("test","alias1").execute().actionGet();
  logger.info("--> indexing against [alias1], should work now");
  IndexResponse indexResponse=client().index(indexRequest("alias1").type("type1").id("1").source(source("1","test"))).actionGet();
  assertThat(indexResponse.getIndex(),equalTo("test"));
  logger.info("--> creating index [test]");
  admin().indices().create(createIndexRequest("test_x")).actionGet();
  ensureGreen();
  logger.info("--> remove [alias1], Aliasing index [test_x] with [alias1]");
  admin().indices().aliases(indexAliasesRequest().removeAlias("test","alias1").addAlias("alias1","test_x")).actionGet();
  Thread.sleep(300);
  logger.info("--> indexing against [alias1], should work against [test_x]");
  indexResponse=client().index(indexRequest("alias1").type("type1").id("1").source(source("1","test"))).actionGet();
  assertThat(indexResponse.getIndex(),equalTo("test_x"));
}
