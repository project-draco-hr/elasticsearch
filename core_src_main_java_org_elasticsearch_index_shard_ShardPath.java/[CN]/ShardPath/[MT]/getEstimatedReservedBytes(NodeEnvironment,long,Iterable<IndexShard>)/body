{
  long totFreeSpace=0;
  for (  NodeEnvironment.NodePath nodePath : env.nodePaths()) {
    totFreeSpace+=nodePath.fileStore.getUsableSpace();
  }
  long estShardSizeInBytes=Math.max(avgShardSizeInBytes,(long)(totFreeSpace / 20.0));
  Map<Path,Long> reservedBytes=new HashMap<>();
  for (  IndexShard shard : shards) {
    Path dataPath=NodeEnvironment.shardStatePathToDataPath(shard.shardPath().getShardStatePath());
    Long curBytes=reservedBytes.get(dataPath);
    if (curBytes == null) {
      curBytes=0L;
    }
    reservedBytes.put(dataPath,curBytes + estShardSizeInBytes);
  }
  return reservedBytes;
}
