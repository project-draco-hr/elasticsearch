{
  Query query=new DeletionAwareConstantScoreQuery(filter);
  if (super.filter != null) {
    query=new FilteredQuery(query,super.filter);
  }
  Filter searchFilter=searchContext.mapperService().searchFilter(searchContext.types());
  if (searchFilter != null) {
    query=new FilteredQuery(query,searchContext.filterCache().cache(searchFilter));
  }
  TotalHitCountCollector collector=new TotalHitCountCollector();
  searchContext.searcher().search(query,collector);
  count=collector.getTotalHits();
}
