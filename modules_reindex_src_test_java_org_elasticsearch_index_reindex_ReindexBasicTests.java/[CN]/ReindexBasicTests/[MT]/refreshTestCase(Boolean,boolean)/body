{
  CreateIndexRequestBuilder create=client().admin().indices().prepareCreate("dest").setSettings("refresh_interval",-1);
  assertAcked(create);
  ensureYellow();
  indexRandom(true,client().prepareIndex("source","test","1").setSource("foo","a"),client().prepareIndex("source","test","2").setSource("foo","a"),client().prepareIndex("source","test","3").setSource("foo","b"),client().prepareIndex("source","test","4").setSource("foo","c"));
  assertHitCount(client().prepareSearch("source").setSize(0).get(),4);
  ReindexRequestBuilder copy=reindex().source("source").destination("dest","all");
  if (refresh != null) {
    copy.refresh(refresh);
  }
  assertThat(copy.get(),responseMatcher().created(4));
  assertHitCount(client().prepareSearch("dest").setTypes("all").setSize(0).get(),visible ? 4 : 0);
}
