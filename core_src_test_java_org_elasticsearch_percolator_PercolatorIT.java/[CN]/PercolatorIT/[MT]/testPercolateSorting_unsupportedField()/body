{
  client().admin().indices().prepareCreate("my-index").addMapping("my-type","field","type=string").addMapping(PercolatorService.TYPE_NAME,"level","type=integer","query","type=object,enabled=false").get();
  ensureGreen();
  client().prepareIndex("my-index",PercolatorService.TYPE_NAME,"1").setSource(jsonBuilder().startObject().field("query",matchAllQuery()).field("level",1).endObject()).get();
  client().prepareIndex("my-index",PercolatorService.TYPE_NAME,"2").setSource(jsonBuilder().startObject().field("query",matchAllQuery()).field("level",2).endObject()).get();
  refresh();
  PercolateResponse response=client().preparePercolate().setIndices("my-index").setDocumentType("my-type").setSize(2).setPercolateDoc(docBuilder().setDoc("field","value")).setPercolateQuery(QueryBuilders.functionScoreQuery(matchAllQuery(),fieldValueFactorFunction("level"))).addSort(SortBuilders.fieldSort("level")).get();
  assertThat(response.getShardFailures().length,equalTo(getNumShards("my-index").numPrimaries));
  assertThat(response.getShardFailures()[0].status(),equalTo(RestStatus.BAD_REQUEST));
  assertThat(response.getShardFailures()[0].reason(),containsString("Only _score desc is supported"));
}
