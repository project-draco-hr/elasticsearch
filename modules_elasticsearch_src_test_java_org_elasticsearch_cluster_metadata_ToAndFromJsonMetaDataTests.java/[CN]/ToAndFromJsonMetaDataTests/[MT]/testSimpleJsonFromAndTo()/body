{
  MetaData metaData=newMetaDataBuilder().maxNumberOfShardsPerNode(2).put(newIndexMetaDataBuilder("test1").numberOfShards(1).numberOfReplicas(2)).put(newIndexMetaDataBuilder("test2").settings(settingsBuilder().put("setting1","value1").put("setting2","value2")).numberOfShards(2).numberOfReplicas(3)).put(newIndexMetaDataBuilder("test3").numberOfShards(1).numberOfReplicas(2).putMapping("mapping1",MAPPING_SOURCE1)).put(newIndexMetaDataBuilder("test4").settings(settingsBuilder().put("setting1","value1").put("setting2","value2")).numberOfShards(1).numberOfReplicas(2).putMapping("mapping1",MAPPING_SOURCE1).putMapping("mapping2",MAPPING_SOURCE2)).build();
  String metaDataSource=MetaData.Builder.toXContent(metaData);
  System.out.println("ToJson: " + metaDataSource);
  MetaData parsedMetaData=MetaData.Builder.fromXContent(XContentFactory.xContent(XContentType.JSON).createParser(metaDataSource),null);
  assertThat(parsedMetaData.maxNumberOfShardsPerNode(),equalTo(2));
  IndexMetaData indexMetaData=metaData.index("test1");
  assertThat(indexMetaData.numberOfShards(),equalTo(1));
  assertThat(indexMetaData.numberOfReplicas(),equalTo(2));
  assertThat(indexMetaData.settings().getAsMap().size(),equalTo(2));
  assertThat(indexMetaData.mappings().size(),equalTo(0));
  indexMetaData=metaData.index("test2");
  assertThat(indexMetaData.numberOfShards(),equalTo(2));
  assertThat(indexMetaData.numberOfReplicas(),equalTo(3));
  assertThat(indexMetaData.settings().getAsMap().size(),equalTo(4));
  assertThat(indexMetaData.settings().get("setting1"),equalTo("value1"));
  assertThat(indexMetaData.settings().get("setting2"),equalTo("value2"));
  assertThat(indexMetaData.mappings().size(),equalTo(0));
  indexMetaData=metaData.index("test3");
  assertThat(indexMetaData.numberOfShards(),equalTo(1));
  assertThat(indexMetaData.numberOfReplicas(),equalTo(2));
  assertThat(indexMetaData.settings().getAsMap().size(),equalTo(2));
  assertThat(indexMetaData.mappings().size(),equalTo(1));
  assertThat(indexMetaData.mappings().get("mapping1"),equalTo(MAPPING_SOURCE1));
  indexMetaData=metaData.index("test4");
  assertThat(indexMetaData.numberOfShards(),equalTo(1));
  assertThat(indexMetaData.numberOfReplicas(),equalTo(2));
  assertThat(indexMetaData.settings().getAsMap().size(),equalTo(4));
  assertThat(indexMetaData.settings().get("setting1"),equalTo("value1"));
  assertThat(indexMetaData.settings().get("setting2"),equalTo("value2"));
  assertThat(indexMetaData.mappings().size(),equalTo(2));
  assertThat(indexMetaData.mappings().get("mapping1"),equalTo(MAPPING_SOURCE1));
  assertThat(indexMetaData.mappings().get("mapping2"),equalTo(MAPPING_SOURCE2));
}
