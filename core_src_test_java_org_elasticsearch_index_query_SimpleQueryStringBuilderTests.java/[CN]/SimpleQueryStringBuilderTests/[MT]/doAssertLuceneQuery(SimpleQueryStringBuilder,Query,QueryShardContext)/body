{
  assertThat(query,notNullValue());
  if ("".equals(queryBuilder.value())) {
    assertTrue("Query should have been MatchNoDocsQuery but was " + query.getClass().getName(),query instanceof MatchNoDocsQuery);
  }
 else   if (queryBuilder.fields().size() > 1) {
    assertTrue("Query should have been BooleanQuery but was " + query.getClass().getName(),query instanceof BooleanQuery);
    BooleanQuery boolQuery=(BooleanQuery)query;
    if (queryBuilder.lowercaseExpandedTerms()) {
      for (      BooleanClause clause : boolQuery.clauses()) {
        if (clause.getQuery() instanceof TermQuery) {
          TermQuery inner=(TermQuery)clause.getQuery();
          assertThat(inner.getTerm().bytes().toString(),is(inner.getTerm().bytes().toString().toLowerCase(Locale.ROOT)));
        }
      }
    }
    assertThat(boolQuery.clauses().size(),equalTo(queryBuilder.fields().size()));
    Iterator<String> fields=queryBuilder.fields().keySet().iterator();
    for (    BooleanClause booleanClause : boolQuery) {
      assertThat(booleanClause.getQuery(),instanceOf(TermQuery.class));
      TermQuery termQuery=(TermQuery)booleanClause.getQuery();
      assertThat(termQuery.getTerm().field(),equalTo(fields.next()));
      assertThat(termQuery.getTerm().text().toLowerCase(Locale.ROOT),equalTo(queryBuilder.value().toLowerCase(Locale.ROOT)));
    }
    if (queryBuilder.minimumShouldMatch() != null) {
      assertThat(boolQuery.getMinimumNumberShouldMatch(),greaterThan(0));
    }
  }
 else   if (queryBuilder.fields().size() <= 1) {
    assertTrue("Query should have been TermQuery but was " + query.getClass().getName(),query instanceof TermQuery);
    TermQuery termQuery=(TermQuery)query;
    String field;
    if (queryBuilder.fields().size() == 0) {
      field=MetaData.ALL;
    }
 else {
      field=queryBuilder.fields().keySet().iterator().next();
    }
    assertThat(termQuery.getTerm().field(),equalTo(field));
    assertThat(termQuery.getTerm().text().toLowerCase(Locale.ROOT),equalTo(queryBuilder.value().toLowerCase(Locale.ROOT)));
  }
 else {
    fail("Encountered lucene query type we do not have a validation implementation for in our " + SimpleQueryStringBuilderTests.class.getSimpleName());
  }
}
