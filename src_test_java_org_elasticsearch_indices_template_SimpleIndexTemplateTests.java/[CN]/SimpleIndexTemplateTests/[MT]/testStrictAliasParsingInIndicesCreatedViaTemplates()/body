{
  client().admin().indices().preparePutTemplate("template1").setTemplate("a").setOrder(0).addMapping("test","field","type=string").addAlias(new Alias("alias1").filter(termFilter("field","value"))).get();
  client().admin().indices().preparePutTemplate("template2").setTemplate("b").setOrder(0).addMapping("_default_","field","type=string").addMapping("test").addAlias(new Alias("alias2").filter(termFilter("field","value"))).get();
  client().admin().indices().preparePutTemplate("template3").setTemplate("c").setOrder(0).addMapping("_default_","field","type=string").addAlias(new Alias("alias3").filter(termFilter("field","value"))).get();
  client().admin().indices().preparePutTemplate("template4").setTemplate("d").setOrder(0).addAlias(new Alias("alias4").filter(termFilter("field","value"))).get();
  client().prepareIndex("a","test","test").setSource("{}").get();
  client().prepareIndex("b","test","test").setSource("{}").get();
  client().prepareIndex("c","test","test").setSource("{}").get();
  try {
    client().prepareIndex("d","test","test").setSource("{}").get();
    fail();
  }
 catch (  Exception e) {
    assertThat(ExceptionsHelper.unwrapCause(e),instanceOf(ElasticsearchIllegalArgumentException.class));
    assertThat(e.getMessage(),containsString("failed to parse filter for alias [alias4]"));
  }
}
