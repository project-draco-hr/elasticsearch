{
  IndexService indexService=indicesService.indexServiceSafe(request.getIndex());
  IndexShard indexShard=indexService.shardSafe(shardId);
  if (request.isRefresh() && !request.isRealtime()) {
    indexShard.refresh(new Engine.Refresh(false));
  }
  MultiGetShardResponse response=new MultiGetShardResponse();
  for (int i=0; i < request.locations.size(); i++) {
    String type=request.types.get(i);
    String id=request.ids.get(i);
    String[] fields=request.fields.get(i);
    try {
      GetResult getResult=indexShard.getService().get(type,id,fields,request.isRealtime());
      response.add(request.locations.get(i),new GetResponse(getResult));
    }
 catch (    Exception e) {
      logger.debug("[{}][{}] failed to execute multi_get for [{}]/[{}]",e,request.getIndex(),shardId,type,id);
      response.add(request.locations.get(i),new MultiGetResponse.Failure(request.getIndex(),type,id,ExceptionsHelper.detailedMessage(e)));
    }
  }
  return response;
}
