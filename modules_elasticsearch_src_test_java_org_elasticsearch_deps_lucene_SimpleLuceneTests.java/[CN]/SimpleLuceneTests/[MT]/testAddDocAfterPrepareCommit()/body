{
  Directory dir=new RAMDirectory();
  IndexWriter indexWriter=new IndexWriter(dir,Lucene.STANDARD_ANALYZER,true,IndexWriter.MaxFieldLength.UNLIMITED);
  indexWriter.addDocument(doc().add(field("_id","1")).build());
  IndexReader reader=indexWriter.getReader();
  assertThat(reader.numDocs(),equalTo(1));
  indexWriter.prepareCommit();
  reader=indexWriter.getReader();
  assertThat(reader.numDocs(),equalTo(1));
  indexWriter.addDocument(doc().add(field("_id","2")).build());
  indexWriter.commit();
  reader=indexWriter.getReader();
  assertThat(reader.numDocs(),equalTo(2));
}
