{
  Directory dir=new RAMDirectory();
  IndexWriter indexWriter=new IndexWriter(dir,Lucene.STANDARD_ANALYZER,true,IndexWriter.MaxFieldLength.UNLIMITED);
  indexWriter.addDocument(doc().add(field("_id","1")).add(field("#id","1")).build());
  IndexSearcher searcher=new IndexSearcher(indexWriter.getReader());
  TopDocs topDocs=searcher.search(new TermQuery(new Term("_id","1")),1);
  final ArrayList<String> fieldsOrder=new ArrayList<String>();
  Document doc=searcher.doc(topDocs.scoreDocs[0].doc,new FieldSelector(){
    @Override public FieldSelectorResult accept(    String fieldName){
      fieldsOrder.add(fieldName);
      return FieldSelectorResult.LOAD;
    }
  }
);
  assertThat(fieldsOrder.size(),equalTo(2));
  assertThat(fieldsOrder.get(0),equalTo("_id"));
  assertThat(fieldsOrder.get(1),equalTo("#id"));
  indexWriter.close();
}
