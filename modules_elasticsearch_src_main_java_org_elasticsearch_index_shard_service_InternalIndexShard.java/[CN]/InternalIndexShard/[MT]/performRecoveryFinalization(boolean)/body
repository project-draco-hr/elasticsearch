{
  if (withFlush) {
    engine.flush(new Engine.Flush());
  }
synchronized (mutex) {
    logger.debug("state: [{}]->[{}], reason [post recovery]",state,IndexShardState.STARTED);
    state=IndexShardState.STARTED;
  }
  startScheduledTasksIfNeeded();
  engine.refresh(new Engine.Refresh(true));
  translog.clearUnreferenced();
  indicesLifecycle.afterIndexShardStarted(this);
}
