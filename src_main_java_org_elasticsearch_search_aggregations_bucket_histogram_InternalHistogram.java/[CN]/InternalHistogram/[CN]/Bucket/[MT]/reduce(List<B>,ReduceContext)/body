{
  List<InternalAggregations> aggregations=new ArrayList<>(buckets.size());
  long docCount=0;
  for (  Bucket bucket : buckets) {
    docCount+=bucket.docCount;
    aggregations.add((InternalAggregations)bucket.getAggregations());
  }
  InternalAggregations aggs=InternalAggregations.reduce(aggregations,context);
  return (B)getFactory().createBucket(key,docCount,aggs,keyed,formatter);
}
