{
  List<B> reducedBuckets=reduceBuckets(aggregations,reduceContext);
  if (minDocCount == 0) {
    addEmptyBuckets(reducedBuckets);
  }
  if (order == InternalOrder.KEY_ASC) {
  }
 else   if (order == InternalOrder.KEY_DESC) {
    reducedBuckets=Lists.reverse(reducedBuckets);
  }
 else {
    CollectionUtil.introSort(reducedBuckets,order.comparator());
  }
  return getFactory().create(getName(),reducedBuckets,order,minDocCount,emptyBucketInfo,formatter,keyed,getMetaData());
}
