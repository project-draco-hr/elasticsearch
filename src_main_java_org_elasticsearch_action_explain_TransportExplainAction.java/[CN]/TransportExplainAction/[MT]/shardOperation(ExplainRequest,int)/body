{
  IndexService indexService=indicesService.indexService(request.index());
  IndexShard indexShard=indexService.shardSafe(shardId);
  Term uidTerm=new Term(UidFieldMapper.NAME,Uid.createUidAsBytes(request.type(),request.id()));
  Engine.GetResult result=indexShard.get(new Engine.Get(false,uidTerm));
  if (!result.exists()) {
    return new ExplainResponse(false);
  }
  SearchContext context=new SearchContext(0,new ShardSearchRequest().types(new String[]{request.type()}).filteringAliases(request.filteringAlias()),null,result.searcher(),indexService,indexShard,scriptService);
  SearchContext.setCurrent(context);
  try {
    context.parsedQuery(parseQuery(request,indexService));
    context.preProcess();
    int topLevelDocId=result.docIdAndVersion().docId + result.docIdAndVersion().reader.docBase;
    Explanation explanation=context.searcher().explain(context.query(),topLevelDocId);
    if (request.fields() != null) {
      if (request.fields().length == 1 && "_source".equals(request.fields()[0])) {
        request.fields(null);
      }
      GetResult getResult=indexShard.getService().get(result,request.id(),request.type(),request.fields());
      return new ExplainResponse(true,explanation,getResult);
    }
 else {
      return new ExplainResponse(true,explanation);
    }
  }
 catch (  IOException e) {
    throw new ElasticSearchException("Could not explain",e);
  }
 finally {
    context.release();
    SearchContext.removeCurrent();
  }
}
