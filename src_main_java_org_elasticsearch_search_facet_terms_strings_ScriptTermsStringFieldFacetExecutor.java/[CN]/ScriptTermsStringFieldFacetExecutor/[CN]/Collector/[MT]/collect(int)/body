{
  script.setNextDocId(doc);
  Object o=script.run();
  if (o == null) {
    missing++;
    return;
  }
  if (o instanceof Iterable) {
    boolean found=false;
    for (    Object o1 : ((Iterable)o)) {
      String value=o1.toString();
      if (match(value)) {
        found=true;
        facets.addTo(new BytesRef(value),1);
        total++;
      }
    }
    if (!found) {
      missing++;
    }
  }
 else   if (o instanceof Object[]) {
    boolean found=false;
    for (    Object o1 : ((Object[])o)) {
      String value=o1.toString();
      if (match(value)) {
        found=true;
        facets.addTo(new BytesRef(value),1);
        total++;
      }
    }
    if (!found) {
      missing++;
    }
  }
 else {
    String value=o.toString();
    if (match(value)) {
      facets.addTo(new BytesRef(value),1);
      total++;
    }
 else {
      missing++;
    }
  }
}
