{
  AggregatorParsers parser=getInstanceFromNode(AggregatorParsers.class);
  XContentParser aggParser=JsonXContent.jsonXContent.createParser(agg);
  aggParser.nextToken();
  SearchContext searchContext=createSearchContext(index);
  final AggregatorFactories factories=parser.parseAggregators(aggParser,searchContext);
  AggregationContext aggregationContext=new AggregationContext(searchContext);
  factories.init(aggregationContext);
  final Aggregator[] aggregators=factories.createTopLevelAggregators();
  assertEquals(1,aggregators.length);
  return aggregators[0].needsScores();
}
