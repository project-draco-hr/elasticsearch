{
  if (filters.size() == 1) {
    return filters.get(0).getDocIdSet(reader);
  }
  List sets=Lists.newArrayListWithExpectedSize(filters.size());
  boolean allAreDocSet=true;
  for (  Filter filter : filters) {
    DocIdSet set=filter.getDocIdSet(reader);
    if (set == null) {
      continue;
    }
    if (!(set instanceof DocSet)) {
      allAreDocSet=false;
    }
    sets.add(set);
  }
  if (sets.size() == 0) {
    return DocSet.EMPTY_DOC_SET;
  }
  if (sets.size() == 1) {
    return (DocIdSet)sets.get(0);
  }
  if (allAreDocSet) {
    return new OrDocSet(sets);
  }
  return new OrDocIdSet(sets);
}
