{
  client().admin().indices().prepareCreate("idx").setSettings(indexSettings()).addMapping("type",jsonBuilder().startObject().field("type").startObject().field("properties").startObject().field("string").startObject().field("type","string").endObject().field("long").startObject().field("type","long").endObject().field("double").startObject().field("type","double").endObject().endObject().endObject()).execute().actionGet();
  client().admin().cluster().prepareHealth().setWaitForEvents(Priority.LANGUID).setWaitForGreenStatus().execute().actionGet();
  for (int i=0; i < 10; i++) {
    client().prepareIndex("idx","type","" + i).setSource(jsonBuilder().startObject().field("foo","bar").endObject()).execute().actionGet();
  }
  flushAndRefresh();
  SearchResponse searchResponse=client().prepareSearch().setQuery(matchAllQuery()).addFacet(termsFacet("string").field("string").size(10)).addFacet(termsFacet("long").field("long").size(10)).addFacet(termsFacet("double").field("double").size(10)).execute().actionGet();
  TermsFacet facet=searchResponse.getFacets().facet("string");
  assertThat(facet.getName(),equalTo("string"));
  assertThat(facet.getEntries().size(),is(0));
  assertThat(facet.getTotalCount(),is(0l));
  assertThat(facet.getMissingCount(),is(10l));
  facet=searchResponse.getFacets().facet("long");
  assertThat(facet.getName(),equalTo("long"));
  assertThat(facet.getEntries().size(),is(0));
  assertThat(facet.getTotalCount(),is(0l));
  assertThat(facet.getMissingCount(),is(10l));
  facet=searchResponse.getFacets().facet("double");
  assertThat(facet.getName(),equalTo("double"));
  assertThat(facet.getEntries().size(),is(0));
  assertThat(facet.getTotalCount(),is(0l));
  assertThat(facet.getMissingCount(),is(10l));
}
