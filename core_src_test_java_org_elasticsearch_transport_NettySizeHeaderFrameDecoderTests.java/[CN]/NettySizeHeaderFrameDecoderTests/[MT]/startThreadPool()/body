{
  threadPool=new ThreadPool(settings);
  threadPool.setNodeSettingsService(new ClusterSettings(settings,ClusterSettings.BUILT_IN_CLUSTER_SETTINGS));
  NetworkService networkService=new NetworkService(settings);
  BigArrays bigArrays=new MockBigArrays(new MockPageCacheRecycler(settings,threadPool),new NoneCircuitBreakerService());
  nettyTransport=new NettyTransport(settings,threadPool,networkService,bigArrays,Version.CURRENT,new NamedWriteableRegistry());
  nettyTransport.start();
  TransportService transportService=new TransportService(nettyTransport,threadPool);
  nettyTransport.transportServiceAdapter(transportService.createAdapter());
  InetSocketTransportAddress transportAddress=(InetSocketTransportAddress)randomFrom(nettyTransport.boundAddress().boundAddresses());
  port=transportAddress.address().getPort();
  host=transportAddress.address().getAddress();
}
