{
  threadPool=new ThreadPool(settings);
  threadPool.setClusterSettings(new ClusterSettings(settings,ClusterSettings.BUILT_IN_CLUSTER_SETTINGS));
  NetworkService networkService=new NetworkService(settings);
  BigArrays bigArrays=new MockBigArrays(new MockPageCacheRecycler(settings),new NoneCircuitBreakerService());
  nettyTransport=new NettyTransport(settings,threadPool,networkService,bigArrays,Version.CURRENT,new NamedWriteableRegistry(),new NoneCircuitBreakerService());
  nettyTransport.start();
  TransportService transportService=new TransportService(nettyTransport,threadPool,ClusterName.DEFAULT);
  nettyTransport.transportServiceAdapter(transportService.createAdapter());
  TransportAddress[] boundAddresses=nettyTransport.boundAddress().boundAddresses();
  InetSocketTransportAddress transportAddress=(InetSocketTransportAddress)randomFrom(boundAddresses);
  port=transportAddress.address().getPort();
  host=transportAddress.address().getAddress();
}
