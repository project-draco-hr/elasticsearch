{
  if (Files.exists(dir.resolve(PluginInfo.ES_PLUGIN_PROPERTIES))) {
    return dir;
  }
 else {
    final Path[] topLevelFiles=FileSystemUtils.files(dir);
    if (topLevelFiles.length == 1 && Files.isDirectory(topLevelFiles[0])) {
      Path subdir=topLevelFiles[0];
      if (Files.exists(subdir.resolve(PluginInfo.ES_PLUGIN_PROPERTIES))) {
        return subdir;
      }
    }
  }
  throw new RuntimeException("Could not find plugin descriptor '" + PluginInfo.ES_PLUGIN_PROPERTIES + "' in plugin zip");
}
