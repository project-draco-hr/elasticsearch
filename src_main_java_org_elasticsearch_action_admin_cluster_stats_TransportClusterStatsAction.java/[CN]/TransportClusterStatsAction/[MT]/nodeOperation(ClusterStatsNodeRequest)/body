{
  NodeInfo nodeInfo=nodeService.info(false,true,false,true,false,false,true,false,true);
  NodeStats nodeStats=nodeService.stats(CommonStatsFlags.NONE,false,true,true,false,false,true,false,false);
  List<ShardStats> shardsStats=new ArrayList<ShardStats>();
  for (  String index : indicesService.indices()) {
    IndexService indexService=indicesService.indexService(index);
    if (indexService == null) {
      continue;
    }
    for (    IndexShard indexShard : indexService) {
      logger.warn("" + indexShard.shardId() + " "+ indexShard.state());
      if (indexShard.routingEntry().active()) {
        shardsStats.add(new ShardStats(indexShard,SHARD_STATS_FLAGS));
      }
    }
  }
  return new ClusterStatsNodeResponse(nodeInfo.getNode(),nodeInfo,nodeStats,shardsStats.toArray(new ShardStats[shardsStats.size()]));
}
