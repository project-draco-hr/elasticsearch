{
  try (ReleasableLock lock=readLock.acquire()){
    final TranslogReader reader;
    if (current.getGeneration() == location.generation) {
      reader=current;
    }
 else     if (currentCommittingTranslog != null && currentCommittingTranslog.getGeneration() == location.generation) {
      reader=currentCommittingTranslog;
    }
 else {
      throw new IllegalStateException("Can't read from translog location" + location);
    }
    return reader.read(location);
  }
 catch (  IOException e) {
    throw new ElasticsearchException("failed to read source from translog location " + location,e);
  }
}
