{
  ensureOpen();
  ImmutableTranslogReader toClose=null;
  try (ReleasableLock lock=writeLock.acquire()){
    if (currentCommittingTranslog == null) {
      prepareCommit();
    }
    current.sync();
    lastCommittedTranslogFileGeneration=current.getGeneration();
    if (recoveredTranslogs.isEmpty() == false) {
      IOUtils.close(recoveredTranslogs);
      recoveredTranslogs.clear();
    }
    toClose=this.currentCommittingTranslog;
    this.currentCommittingTranslog=null;
  }
  finally {
    IOUtils.close(toClose);
  }
}
