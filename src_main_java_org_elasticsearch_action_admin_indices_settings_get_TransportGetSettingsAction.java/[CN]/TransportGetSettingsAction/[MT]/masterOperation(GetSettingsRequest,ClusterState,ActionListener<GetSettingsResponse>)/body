{
  request.indices(state.metaData().concreteIndices(request.indices(),request.indicesOptions()));
  ImmutableOpenMap.Builder<String,Settings> indexToSettingsBuilder=ImmutableOpenMap.builder();
  for (  String concreteIndex : request.indices()) {
    IndexMetaData indexMetaData=state.getMetaData().index(concreteIndex);
    if (indexMetaData == null) {
      continue;
    }
    Settings settings=settingsFilter.filterSettings(indexMetaData.settings());
    if (request.prefix() != null) {
      ImmutableSettings.Builder settingsBuilder=ImmutableSettings.builder();
      for (      Map.Entry<String,String> entry : settings.getAsMap().entrySet()) {
        if (entry.getKey().startsWith(request.prefix())) {
          settingsBuilder.put(entry.getKey(),entry.getValue());
        }
      }
      settings=settingsBuilder.build();
    }
    indexToSettingsBuilder.put(concreteIndex,settings);
  }
  listener.onResponse(new GetSettingsResponse(indexToSettingsBuilder.build()));
}
