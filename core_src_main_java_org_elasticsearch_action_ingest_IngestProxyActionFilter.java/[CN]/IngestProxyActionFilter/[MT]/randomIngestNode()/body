{
  ClusterState state=clusterService.state();
  List<DiscoveryNode> ingestNodes=new ArrayList<>();
  for (  DiscoveryNode node : state.nodes()) {
    if (IngestModule.isIngestEnabled(node.getAttributes())) {
      ingestNodes.add(node);
    }
  }
  if (ingestNodes.isEmpty()) {
    throw new IllegalStateException("There are no ingest nodes in this cluster, unable to forward request to an ingest node.");
  }
  int index=getNodeNumber();
  return ingestNodes.get((index) % ingestNodes.size());
}
