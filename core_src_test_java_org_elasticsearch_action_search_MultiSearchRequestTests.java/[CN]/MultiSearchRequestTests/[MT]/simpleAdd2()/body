{
  IndicesQueriesRegistry registry=new IndicesQueriesRegistry(Settings.EMPTY,Collections.singleton(new MatchAllQueryParser()),new NamedWriteableRegistry());
  byte[] data=StreamsUtils.copyToBytesFromClasspath("/org/elasticsearch/action/search/simple-msearch2.json");
  MultiSearchRequest request=RestMultiSearchAction.parseRequest(new MultiSearchRequest(),new BytesArray(data),false,null,null,null,null,IndicesOptions.strictExpandOpenAndForbidClosed(),true,registry);
  assertThat(request.requests().size(),equalTo(5));
  assertThat(request.requests().get(0).indices()[0],equalTo("test"));
  assertThat(request.requests().get(0).types().length,equalTo(0));
  assertThat(request.requests().get(1).indices()[0],equalTo("test"));
  assertThat(request.requests().get(1).types()[0],equalTo("type1"));
  assertThat(request.requests().get(2).indices(),nullValue());
  assertThat(request.requests().get(2).types().length,equalTo(0));
  assertThat(request.requests().get(3).indices(),nullValue());
  assertThat(request.requests().get(3).types().length,equalTo(0));
  assertThat(request.requests().get(3).searchType(),equalTo(SearchType.DFS_QUERY_THEN_FETCH));
  assertThat(request.requests().get(4).indices(),nullValue());
  assertThat(request.requests().get(4).types().length,equalTo(0));
}
