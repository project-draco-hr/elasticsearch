{
  byte[] data=StreamsUtils.copyToBytesFromClasspath("/org/elasticsearch/action/search/simple-msearch1.json");
  MultiSearchRequest request=new MultiSearchRequest().add(data,0,data.length,null,null,null);
  assertThat(request.requests().size(),equalTo(8));
  assertThat(request.requests().get(0).indices()[0],equalTo("test"));
  assertThat(request.requests().get(0).indicesOptions(),equalTo(IndicesOptions.fromOptions(true,true,true,true,IndicesOptions.strictExpandOpenAndForbidClosed())));
  assertThat(request.requests().get(0).types().length,equalTo(0));
  assertThat(request.requests().get(1).indices()[0],equalTo("test"));
  assertThat(request.requests().get(1).indicesOptions(),equalTo(IndicesOptions.fromOptions(false,true,true,true,IndicesOptions.strictExpandOpenAndForbidClosed())));
  assertThat(request.requests().get(1).types()[0],equalTo("type1"));
  assertThat(request.requests().get(2).indices()[0],equalTo("test"));
  assertThat(request.requests().get(2).indicesOptions(),equalTo(IndicesOptions.fromOptions(false,true,true,false,IndicesOptions.strictExpandOpenAndForbidClosed())));
  assertThat(request.requests().get(3).indices()[0],equalTo("test"));
  assertThat(request.requests().get(3).indicesOptions(),equalTo(IndicesOptions.fromOptions(true,true,true,true,IndicesOptions.strictExpandOpenAndForbidClosed())));
  assertThat(request.requests().get(4).indices()[0],equalTo("test"));
  assertThat(request.requests().get(4).indicesOptions(),equalTo(IndicesOptions.fromOptions(true,false,false,true,IndicesOptions.strictExpandOpenAndForbidClosed())));
  assertThat(request.requests().get(5).indices(),nullValue());
  assertThat(request.requests().get(5).types().length,equalTo(0));
  assertThat(request.requests().get(6).indices(),nullValue());
  assertThat(request.requests().get(6).types().length,equalTo(0));
  assertThat(request.requests().get(6).searchType(),equalTo(SearchType.DFS_QUERY_THEN_FETCH));
  assertThat(request.requests().get(7).indices(),nullValue());
  assertThat(request.requests().get(7).types().length,equalTo(0));
}
