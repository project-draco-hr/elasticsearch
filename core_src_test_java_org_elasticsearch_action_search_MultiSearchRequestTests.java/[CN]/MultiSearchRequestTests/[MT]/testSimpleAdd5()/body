{
  IndicesQueriesRegistry registry=new IndicesQueriesRegistry(Settings.EMPTY,Collections.singleton(new MatchAllQueryParser()),new NamedWriteableRegistry());
  byte[] data=StreamsUtils.copyToBytesFromClasspath("/org/elasticsearch/action/search/simple-msearch5.json");
  MultiSearchRequest request=RestMultiSearchAction.parseRequest(new MultiSearchRequest(),new BytesArray(data),true,null,null,null,null,IndicesOptions.strictExpandOpenAndForbidClosed(),true,registry,ParseFieldMatcher.EMPTY);
  assertThat(request.requests().size(),equalTo(3));
  assertThat(request.requests().get(0).indices()[0],equalTo("test0"));
  assertThat(request.requests().get(0).indices()[1],equalTo("test1"));
  assertThat(request.requests().get(0).requestCache(),equalTo(true));
  assertThat(request.requests().get(0).preference(),nullValue());
  assertThat(request.requests().get(1).indices()[0],equalTo("test2"));
  assertThat(request.requests().get(1).indices()[1],equalTo("test3"));
  assertThat(request.requests().get(1).types()[0],equalTo("type1"));
  assertThat(request.requests().get(1).requestCache(),nullValue());
  assertThat(request.requests().get(1).preference(),equalTo("_local"));
  assertThat(request.requests().get(2).indices()[0],equalTo("test4"));
  assertThat(request.requests().get(2).indices()[1],equalTo("test1"));
  assertThat(request.requests().get(2).types()[0],equalTo("type2"));
  assertThat(request.requests().get(2).types()[1],equalTo("type1"));
  assertThat(request.requests().get(2).routing(),equalTo("123"));
  assertNotNull(request.requests().get(0).template());
  assertNotNull(request.requests().get(1).template());
  assertNotNull(request.requests().get(2).template());
  assertEquals(ScriptService.ScriptType.INLINE,request.requests().get(0).template().getType());
  assertEquals(ScriptService.ScriptType.INLINE,request.requests().get(1).template().getType());
  assertEquals(ScriptService.ScriptType.INLINE,request.requests().get(2).template().getType());
  assertEquals("{\"query\":{\"match_{{template}}\":{}}}",request.requests().get(0).template().getScript());
  assertEquals("{\"query\":{\"match_{{template}}\":{}}}",request.requests().get(1).template().getScript());
  assertEquals("{\"query\":{\"match_{{template}}\":{}}}",request.requests().get(2).template().getScript());
  assertEquals(1,request.requests().get(0).template().getParams().size());
  assertEquals(1,request.requests().get(1).template().getParams().size());
  assertEquals(1,request.requests().get(2).template().getParams().size());
}
