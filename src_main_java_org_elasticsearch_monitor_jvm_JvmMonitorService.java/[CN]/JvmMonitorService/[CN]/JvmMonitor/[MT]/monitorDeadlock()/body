{
  DeadlockAnalyzer.Deadlock[] deadlocks=deadlockAnalyzer().findDeadlocks();
  if (deadlocks != null && deadlocks.length > 0) {
    ImmutableSet<DeadlockAnalyzer.Deadlock> asSet=new ImmutableSet.Builder<DeadlockAnalyzer.Deadlock>().add(deadlocks).build();
    if (!asSet.equals(lastSeenDeadlocks)) {
      DumpGenerator.Result genResult=dumpMonitorService.generateDump("deadlock",null,SUMMARY,THREAD_DUMP);
      StringBuilder sb=new StringBuilder("Detected Deadlock(s)");
      for (      DeadlockAnalyzer.Deadlock deadlock : asSet) {
        sb.append("\n   ----> ").append(deadlock);
      }
      sb.append("\nDump generated [").append(genResult.location()).append("]");
      logger.error(sb.toString());
      lastSeenDeadlocks.clear();
      lastSeenDeadlocks.addAll(asSet);
    }
  }
 else {
    lastSeenDeadlocks.clear();
  }
}
