{
  disableCache=cacheSizeInBytes == 0;
  if (!disableCache && cacheSizeInBytes < bufferSizeInBytes) {
    throw new IllegalArgumentException("Cache size [" + cacheSizeInBytes + "] is smaller than buffer size ["+ bufferSizeInBytes+ "]");
  }
  this.bufferSizeInBytes=bufferSizeInBytes;
  int numberOfCacheEntries=cacheSizeInBytes / bufferSizeInBytes;
  this.cache=disableCache ? null : new ArrayBlockingQueue<ByteBuffer>(numberOfCacheEntries);
  this.cacheSizeInBytes=disableCache ? 0 : numberOfCacheEntries * bufferSizeInBytes;
  this.direct=direct;
  setLockFactory(new SingleInstanceLockFactory());
  if (!disableCache && warmCache) {
    for (int i=0; i < numberOfCacheEntries; i++) {
      cache.add(createBuffer());
    }
  }
}
