{
  String[] fieldNames={"field_that_should_not_be_requested","field_with_positions","field_with_offsets","field_with_only_tv","field_with_positions_offsets","field_with_positions_payloads"};
  run(addMapping(prepareCreate("test"),"type1",new Object[]{fieldNames[0],"type","string","term_vector","with_positions_offsets"},new Object[]{fieldNames[1],"type","string","term_vector","with_positions"},new Object[]{fieldNames[2],"type","string","term_vector","with_offsets"},new Object[]{fieldNames[3],"type","string","store_term_vectors","yes"},new Object[]{fieldNames[4],"type","string","term_vector","with_positions_offsets"},new Object[]{fieldNames[5],"type","string","term_vector","with_positions_payloads","analyzer","tv_test"}).setSettings(ImmutableSettings.settingsBuilder().put("index.analysis.analyzer.tv_test.tokenizer","standard").putArray("index.analysis.analyzer.tv_test.filter","type_as_payload","lowercase")));
  ensureYellow();
  String[] fieldContent={"the quick shard jumps over the stupid brain","here is another field","And yet another field withut any use.","I am out of ideas on what to type here.","The last field for which offsets are stored but not positons.","The last field for which offsets are stored but not positons."};
  boolean[] storeOffsets={true,false,true,false,true,false};
  boolean[] storePositions={true,true,false,false,true,true};
  boolean[] storePayloads={false,false,false,false,false,true};
  Map<String,Object> testSource=new HashMap<String,Object>();
  for (int i=0; i < fieldNames.length; i++) {
    testSource.put(fieldNames[i],fieldContent[i]);
  }
  client().prepareIndex("test","type1","1").setSource(testSource).execute().actionGet();
  refresh();
  String[] selectedFields={fieldNames[1],fieldNames[2],fieldNames[3],fieldNames[4],fieldNames[5]};
  testForConfig(fieldNames,fieldContent,storeOffsets,storePositions,storePayloads,selectedFields,false,false,false);
  testForConfig(fieldNames,fieldContent,storeOffsets,storePositions,storePayloads,selectedFields,true,false,false);
  testForConfig(fieldNames,fieldContent,storeOffsets,storePositions,storePayloads,selectedFields,false,true,false);
  testForConfig(fieldNames,fieldContent,storeOffsets,storePositions,storePayloads,selectedFields,true,true,false);
  testForConfig(fieldNames,fieldContent,storeOffsets,storePositions,storePayloads,selectedFields,true,false,true);
  testForConfig(fieldNames,fieldContent,storeOffsets,storePositions,storePayloads,selectedFields,true,true,true);
}
