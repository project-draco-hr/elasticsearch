{
  for (  ScriptFieldsContext.ScriptField scriptField : context.scriptFields().fields()) {
    scriptField.script().setNextReader(reader);
    Object value=scriptField.script().execute(docId);
    if (hit.fieldsOrNull() == null) {
      hit.fields(new HashMap<String,SearchHitField>(2));
    }
    SearchHitField hitField=hit.fields().get(scriptField.name());
    if (hitField == null) {
      hitField=new InternalSearchHitField(scriptField.name(),new ArrayList<Object>(2));
      hit.fields().put(scriptField.name(),hitField);
    }
    hitField.values().add(value);
  }
}
