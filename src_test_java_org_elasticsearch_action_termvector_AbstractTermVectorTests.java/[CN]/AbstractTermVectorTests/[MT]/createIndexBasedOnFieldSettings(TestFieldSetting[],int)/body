{
  wipeIndices("test");
  XContentBuilder mappingBuilder=jsonBuilder();
  mappingBuilder.startObject().startObject("type1").startObject("properties");
  for (  TestFieldSetting field : fieldSettings) {
    field.addToMappings(mappingBuilder);
  }
  ImmutableSettings.Builder settings=ImmutableSettings.settingsBuilder().put("index.analysis.analyzer.tv_test.tokenizer","standard").putArray("index.analysis.analyzer.tv_test.filter","type_as_payload","lowercase");
  if (number_of_shards > 0) {
    settings.put("number_of_shards",number_of_shards);
  }
  mappingBuilder.endObject().endObject().endObject();
  prepareCreate("test").addMapping("type1",mappingBuilder).setSettings(settings).get();
  ensureYellow();
}
