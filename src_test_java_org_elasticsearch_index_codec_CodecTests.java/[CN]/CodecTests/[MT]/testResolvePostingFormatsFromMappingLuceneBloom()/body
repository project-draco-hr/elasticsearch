{
  String mapping=XContentFactory.jsonBuilder().startObject().startObject("type").startObject("properties").startObject("field1").field("type","string").field("postings_format","bloom_default").endObject().startObject("field2").field("type","string").field("postings_format","bloom_pulsing").endObject().startObject("field3").field("type","string").field("postings_format","my_format1").endObject().endObject().endObject().endObject().string();
  Settings indexSettings=ImmutableSettings.settingsBuilder().put("index.codec.postings_format.my_format1.type","bloom_filter_lucene").put("index.codec.postings_format.my_format1.desired_max_saturation",0.2f).put("index.codec.postings_format.my_format1.saturation_limit",0.8f).put("index.codec.postings_format.my_format1.delegate","delegate1").put("index.codec.postings_format.delegate1.type","direct").put("index.codec.postings_format.delegate1.min_skip_count",16).put("index.codec.postings_format.delegate1.low_freq_cutoff",64).build();
  CodecService codecService=createCodecService(indexSettings);
  DocumentMapper documentMapper=codecService.mapperService().documentMapperParser().parse(mapping);
  assertThat(documentMapper.mappers().name("field1").mapper().postingsFormatProvider(),instanceOf(PreBuiltPostingsFormatProvider.class));
  if (PostingFormats.luceneBloomFilter) {
    assertThat(documentMapper.mappers().name("field1").mapper().postingsFormatProvider().get(),instanceOf(BloomFilteringPostingsFormat.class));
  }
 else {
    assertThat(documentMapper.mappers().name("field1").mapper().postingsFormatProvider().get(),instanceOf(BloomFilterPostingsFormat.class));
  }
  assertThat(documentMapper.mappers().name("field2").mapper().postingsFormatProvider(),instanceOf(PreBuiltPostingsFormatProvider.class));
  if (PostingFormats.luceneBloomFilter) {
    assertThat(documentMapper.mappers().name("field2").mapper().postingsFormatProvider().get(),instanceOf(BloomFilteringPostingsFormat.class));
  }
 else {
    assertThat(documentMapper.mappers().name("field2").mapper().postingsFormatProvider().get(),instanceOf(BloomFilterPostingsFormat.class));
  }
  assertThat(documentMapper.mappers().name("field3").mapper().postingsFormatProvider(),instanceOf(BloomFilterLucenePostingsFormatProvider.class));
  BloomFilterLucenePostingsFormatProvider provider=(BloomFilterLucenePostingsFormatProvider)documentMapper.mappers().name("field3").mapper().postingsFormatProvider();
  assertThat(provider.desiredMaxSaturation(),equalTo(0.2f));
  assertThat(provider.saturationLimit(),equalTo(0.8f));
  assertThat(provider.delegate(),instanceOf(DirectPostingsFormatProvider.class));
  DirectPostingsFormatProvider delegate=(DirectPostingsFormatProvider)provider.delegate();
  assertThat(delegate.minSkipCount(),equalTo(16));
  assertThat(delegate.lowFreqCutoff(),equalTo(64));
}
