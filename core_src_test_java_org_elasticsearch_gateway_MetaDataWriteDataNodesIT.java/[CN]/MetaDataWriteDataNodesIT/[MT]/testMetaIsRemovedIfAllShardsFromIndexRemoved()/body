{
  String masterNode=internalCluster().startMasterOnlyNode(Settings.EMPTY);
  Future<String> nodeName1=internalCluster().startDataOnlyNodeAsync();
  Future<String> nodeName2=internalCluster().startDataOnlyNodeAsync();
  String node1=nodeName1.get();
  String node2=nodeName2.get();
  String index="index";
  assertAcked(prepareCreate(index).setSettings(Settings.builder().put("index.number_of_replicas",0).put(FilterAllocationDecider.INDEX_ROUTING_INCLUDE_GROUP + "_name",node1)));
  index(index,"doc","1",jsonBuilder().startObject().field("text","some text").endObject());
  ensureGreen();
  assertIndexInMetaState(node1,index);
  assertIndexNotInMetaState(node2,index);
  assertIndexInMetaState(masterNode,index);
  logger.debug("relocating index...");
  client().admin().indices().prepareUpdateSettings(index).setSettings(Settings.builder().put(FilterAllocationDecider.INDEX_ROUTING_INCLUDE_GROUP + "_name",node2)).get();
  client().admin().cluster().prepareHealth().setWaitForRelocatingShards(0).get();
  ensureGreen();
  assertIndexNotInMetaState(node1,index);
  assertIndexInMetaState(node2,index);
  assertIndexInMetaState(masterNode,index);
}
