{
  assertAcked(prepareCreate("test").addMapping("type",jsonBuilder().startObject().startObject("type").startObject("properties").startObject("test").field("type","string").endObject().startObject("num").field("type","double").endObject().endObject().endObject().endObject()));
  ensureYellow();
  client().index(indexRequest("test").type("type").source(jsonBuilder().startObject().field("test","value").field("num",1.0).endObject())).actionGet();
  refresh();
  XContentBuilder query=XContentFactory.jsonBuilder();
  query.startObject().startObject("function_score").startArray("functions").startObject().field("boost_factor","1.3").endObject().endArray().field("boost_factor","1").endObject().endObject();
  try {
    client().search(searchRequest().source(searchSource().query(query))).actionGet();
    fail("Search should result in SearchPhaseExecutionException");
  }
 catch (  SearchPhaseExecutionException e) {
    logger.info(e.shardFailures()[0].reason());
    assertThat(e.shardFailures()[0].reason(),containsString("already found [functions] array, now encountering [boost_factor]. did you mean [boost] instead?"));
  }
  query=XContentFactory.jsonBuilder();
  query.startObject().startObject("function_score").field("boost_factor","1").startArray("functions").startObject().field("boost_factor","1.3").endObject().endArray().endObject().endObject();
  try {
    client().search(searchRequest().source(searchSource().query(query))).actionGet();
    fail("Search should result in SearchPhaseExecutionException");
  }
 catch (  SearchPhaseExecutionException e) {
    logger.info(e.shardFailures()[0].reason());
    assertThat(e.shardFailures()[0].reason(),containsString("already found [boost_factor], now encountering [functions]. did you mean [boost] instead?"));
  }
  query=XContentFactory.jsonBuilder();
  query.startObject().startObject("function_score").startObject("random_score").field("seed",3).endObject().startArray("functions").startObject().startObject("random_score").field("seed",3).endObject().endObject().endArray().endObject().endObject();
  try {
    client().search(searchRequest().source(searchSource().query(query))).actionGet();
    fail("Search should result in SearchPhaseExecutionException");
  }
 catch (  SearchPhaseExecutionException e) {
    logger.info(e.shardFailures()[0].reason());
    assertThat(e.shardFailures()[0].reason(),containsString("already found [random_score], now encountering [functions]"));
    assertThat(e.shardFailures()[0].reason(),not(containsString("did you mean [boost] instead?")));
  }
}
