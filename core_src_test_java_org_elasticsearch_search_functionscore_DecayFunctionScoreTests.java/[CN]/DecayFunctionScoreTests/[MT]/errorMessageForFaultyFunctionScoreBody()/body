{
  assertAcked(prepareCreate("test").addMapping("type",jsonBuilder().startObject().startObject("type").startObject("properties").startObject("test").field("type","string").endObject().startObject("num").field("type","double").endObject().endObject().endObject().endObject()));
  ensureYellow();
  client().index(indexRequest("test").type("type").source(jsonBuilder().startObject().field("test","value").field("num",1.0).endObject())).actionGet();
  refresh();
  XContentBuilder query=XContentFactory.jsonBuilder();
  query.startObject().startObject("function_score").startArray("functions").startObject().field("boost_factor","1.3").endObject().endArray().field("boost_factor","1").endObject().endObject();
  try {
    client().search(searchRequest().source(searchSource().query(query))).actionGet();
    fail("Search should result in SearchPhaseExecutionException");
  }
 catch (  SearchPhaseExecutionException e) {
    logger.info(e.shardFailures()[0].reason());
    assertTrue(e.shardFailures()[0].reason().contains("Found \"functions\": [...] already, now encountering \"boost_factor\". Did you mean \"boost\" instead?"));
  }
  query=XContentFactory.jsonBuilder();
  query.startObject().startObject("function_score").field("boost_factor","1").startArray("functions").startObject().field("boost_factor","1.3").endObject().endArray().endObject().endObject();
  try {
    client().search(searchRequest().source(searchSource().query(query))).actionGet();
    fail("Search should result in SearchPhaseExecutionException");
  }
 catch (  SearchPhaseExecutionException e) {
    logger.info(e.shardFailures()[0].reason());
    assertTrue(e.shardFailures()[0].reason().contains("Found \"boost_factor\" already, now encountering \"functions\": [...]. Did you mean \"boost\" instead?"));
  }
  query=XContentFactory.jsonBuilder();
  query.startObject().startObject("function_score").startObject("random_score").field("seed",3).endObject().startArray("functions").startObject().startObject("random_score").field("seed",3).endObject().endObject().endArray().endObject().endObject();
  try {
    client().search(searchRequest().source(searchSource().query(query))).actionGet();
    fail("Search should result in SearchPhaseExecutionException");
  }
 catch (  SearchPhaseExecutionException e) {
    logger.info(e.shardFailures()[0].reason());
    assertTrue(e.shardFailures()[0].reason().contains("Found \"random_score\" already, now encountering \"functions\": [...]."));
    assertFalse(e.shardFailures()[0].reason().contains("Did you mean \"boost\" instead?"));
  }
}
