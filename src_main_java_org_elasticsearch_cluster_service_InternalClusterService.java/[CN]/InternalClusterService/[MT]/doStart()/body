{
  add(localNodeMasterListeners);
  this.clusterState=ClusterState.builder(clusterState).blocks(initialBlocks).build();
  this.updateTasksExecutor=EsExecutors.newSinglePrioritizing(daemonThreadFactory(settings,"clusterService#updateTask"));
  this.reconnectToNodes=threadPool.schedule(reconnectInterval,ThreadPool.Names.GENERIC,new ReconnectToNodes());
  discoveryService.addLifecycleListener(new LifecycleListener(){
    @Override public void afterStart(){
      submitStateUpdateTask("update local node",Priority.IMMEDIATE,new ClusterStateNonMasterUpdateTask(){
        @Override public ClusterState execute(        ClusterState currentState) throws Exception {
          return ClusterState.builder(currentState).nodes(DiscoveryNodes.builder(currentState.nodes()).put(localNode()).localNodeId(localNode().id())).build();
        }
        @Override public void onFailure(        String source,        Throwable t){
          logger.warn("failed to update local node",t);
        }
      }
);
    }
  }
);
}
