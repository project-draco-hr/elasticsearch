{
  if (!ackedUpdateTask.mustAck(node)) {
    if (!node.equals(clusterState.nodes().masterNode())) {
      return;
    }
  }
  if (t == null) {
    logger.trace("ack received from node [{}], cluster_state update (version: {})",node,clusterState.version());
  }
 else {
    this.lastFailure=t;
    logger.debug("ack received from node [{}], cluster_state update (version: {})",t,node,clusterState.version());
  }
  if (countDown.countDown()) {
    logger.trace("all expected nodes acknowledged cluster_state update (version: {})",clusterState.version());
    ackTimeoutCallback.cancel(true);
    ackedUpdateTask.onAllNodesAcked(lastFailure);
  }
}
