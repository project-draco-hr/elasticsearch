{
  Filter intersectsFilter=createIntersectsFilter(shape);
  Geometry shapeGeometry=ShapeBuilder.toJTSGeometry(shape);
  Geometry buffer=BufferOp.bufferOp(shapeGeometry,WITHIN_BUFFER_DISTANCE,BUFFER_PARAMETERS);
  Shape bufferedShape=new JtsGeometry(buffer.difference(shapeGeometry),GeoShapeConstants.SPATIAL_CONTEXT,true);
  Filter bufferedFilter=createIntersectsFilter(bufferedShape);
  XBooleanFilter filter=new XBooleanFilter();
  filter.add(intersectsFilter,BooleanClause.Occur.SHOULD);
  filter.add(bufferedFilter,BooleanClause.Occur.MUST_NOT);
  return filter;
}
