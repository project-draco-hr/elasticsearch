{
  XContentParser.Token token=parser.currentToken();
  if (token == XContentParser.Token.START_ARRAY) {
    boolean added=false;
    while ((token=parser.nextToken()) != XContentParser.Token.END_ARRAY) {
      String name=parser.text();
      if (name.contains("_source.") || name.contains("doc[")) {
        SearchScript searchScript=context.scriptService().search(context.lookup(),"mvel",name,null);
        context.scriptFields().add(new ScriptFieldsContext.ScriptField(name,searchScript,true));
      }
 else {
        added=true;
        context.fieldNames().add(name);
      }
    }
    if (!added) {
      context.emptyFieldNames();
    }
  }
 else   if (token == XContentParser.Token.VALUE_STRING) {
    String name=parser.text();
    if (name.contains("_source.") || name.contains("doc[")) {
      SearchScript searchScript=context.scriptService().search(context.lookup(),"mvel",name,null);
      context.scriptFields().add(new ScriptFieldsContext.ScriptField(name,searchScript,true));
    }
 else {
      context.fieldNames().add(name);
    }
  }
}
