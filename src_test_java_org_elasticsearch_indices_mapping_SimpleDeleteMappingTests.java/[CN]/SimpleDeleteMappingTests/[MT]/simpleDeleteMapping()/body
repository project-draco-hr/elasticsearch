{
  for (int i=0; i < 10; i++) {
    client().prepareIndex("test","type1",Integer.toString(i)).setSource(jsonBuilder().startObject().field("value","test" + i).endObject()).execute().actionGet();
  }
  ensureGreen();
  refresh();
  for (int i=0; i < 10; i++) {
    CountResponse countResponse=client().prepareCount().setQuery(matchAllQuery()).execute().actionGet();
    assertThat(countResponse.getCount(),equalTo(10l));
  }
  ClusterState clusterState=client().admin().cluster().prepareState().execute().actionGet().getState();
  assertThat(clusterState.metaData().index("test").mappings().containsKey("type1"),equalTo(true));
  GetMappingsResponse mappingsResponse=client().admin().indices().prepareGetMappings("test").setTypes("type1").execute().actionGet();
  assertThat(mappingsResponse.getMappings().get("test").get("type1"),notNullValue());
  ElasticsearchAssertions.assertAcked(client().admin().indices().prepareDeleteMapping().setIndices("test").setType("type1"));
  for (int i=0; i < 10; i++) {
    CountResponse countResponse=client().prepareCount().setQuery(matchAllQuery()).execute().actionGet();
    assertThat(countResponse.getCount(),equalTo(0l));
  }
  clusterState=client().admin().cluster().prepareState().execute().actionGet().getState();
  assertThat(clusterState.metaData().index("test").mappings().containsKey("type1"),equalTo(false));
  mappingsResponse=client().admin().indices().prepareGetMappings("test").setTypes("type1").execute().actionGet();
  assertThat(mappingsResponse.getMappings().get("test"),nullValue());
}
