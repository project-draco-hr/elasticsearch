{
  Builder builder=ImmutableSettings.settingsBuilder().put(indexSettings());
  if (shards > 0) {
    builder.put(SETTING_NUMBER_OF_SHARDS,shards);
  }
  assertAcked(prepareCreate("test").addMapping("type1",jsonBuilder().startObject().startObject("type1").startObject("properties").startObject("field1").field("analyzer",analyzer).field("type","string").endObject().endObject().endObject().endObject()).setSettings(builder));
  int numDocs=atLeast(100);
  IndexRequestBuilder[] docs=new IndexRequestBuilder[numDocs];
  for (int i=0; i < numDocs; i++) {
    docs[i]=client().prepareIndex("test","type1",String.valueOf(i)).setSource("field1",English.intToEnglish(i));
  }
  indexRandom(true,docs);
  ensureGreen();
  return numDocs;
}
