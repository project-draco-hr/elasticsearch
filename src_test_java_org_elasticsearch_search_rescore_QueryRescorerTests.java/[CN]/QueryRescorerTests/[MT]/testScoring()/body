{
  int numDocs=indexRandomNumbers("keyword");
  String[] scoreModes=new String[]{"max","min","avg","total","multiply",""};
  float primaryWeight=1.1f;
  float secondaryWeight=1.6f;
  for (  String scoreMode : scoreModes) {
    for (int i=0; i < numDocs - 4; i++) {
      String[] intToEnglish=new String[]{English.intToEnglish(i),English.intToEnglish(i + 1),English.intToEnglish(i + 2),English.intToEnglish(i + 3)};
      QueryRescorer rescoreQuery=RescoreBuilder.queryRescorer(QueryBuilders.boolQuery().disableCoord(true).should(QueryBuilders.functionScoreQuery(QueryBuilders.termQuery("field1",intToEnglish[0])).boostMode(CombineFunction.REPLACE).add(ScoreFunctionBuilders.scriptFunction(new Script("5.0f")))).should(QueryBuilders.functionScoreQuery(QueryBuilders.termQuery("field1",intToEnglish[1])).boostMode(CombineFunction.REPLACE).add(ScoreFunctionBuilders.scriptFunction(new Script("7.0f")))).should(QueryBuilders.functionScoreQuery(QueryBuilders.termQuery("field1",intToEnglish[3])).boostMode(CombineFunction.REPLACE).add(ScoreFunctionBuilders.scriptFunction(new Script("0.0f"))))).setQueryWeight(primaryWeight).setRescoreQueryWeight(secondaryWeight);
      if (!"".equals(scoreMode)) {
        rescoreQuery.setScoreMode(scoreMode);
      }
      SearchResponse rescored=client().prepareSearch().setPreference("test").setQuery(QueryBuilders.boolQuery().disableCoord(true).should(QueryBuilders.functionScoreQuery(QueryBuilders.termQuery("field1",intToEnglish[0])).boostMode(CombineFunction.REPLACE).add(ScoreFunctionBuilders.scriptFunction(new Script("2.0f")))).should(QueryBuilders.functionScoreQuery(QueryBuilders.termQuery("field1",intToEnglish[1])).boostMode(CombineFunction.REPLACE).add(ScoreFunctionBuilders.scriptFunction(new Script("3.0f")))).should(QueryBuilders.functionScoreQuery(QueryBuilders.termQuery("field1",intToEnglish[2])).boostMode(CombineFunction.REPLACE).add(ScoreFunctionBuilders.scriptFunction(new Script("5.0f")))).should(QueryBuilders.functionScoreQuery(QueryBuilders.termQuery("field1",intToEnglish[3])).boostMode(CombineFunction.REPLACE).add(ScoreFunctionBuilders.scriptFunction(new Script("0.2f"))))).setFrom(0).setSize(10).setRescorer(rescoreQuery).setRescoreWindow(50).execute().actionGet();
      assertHitCount(rescored,4);
      if ("total".equals(scoreMode) || "".equals(scoreMode)) {
        assertFirstHit(rescored,hasId(String.valueOf(i + 1)));
        assertSecondHit(rescored,hasId(String.valueOf(i)));
        assertThirdHit(rescored,hasId(String.valueOf(i + 2)));
        assertThat(rescored.getHits().getHits()[0].getScore(),equalTo(3.0f * primaryWeight + 7.0f * secondaryWeight));
        assertThat(rescored.getHits().getHits()[1].getScore(),equalTo(2.0f * primaryWeight + 5.0f * secondaryWeight));
        assertThat(rescored.getHits().getHits()[2].getScore(),equalTo(5.0f * primaryWeight));
        assertThat(rescored.getHits().getHits()[3].getScore(),equalTo(0.2f * primaryWeight + 0.0f * secondaryWeight));
      }
 else       if ("max".equals(scoreMode)) {
        assertFirstHit(rescored,hasId(String.valueOf(i + 1)));
        assertSecondHit(rescored,hasId(String.valueOf(i)));
        assertThirdHit(rescored,hasId(String.valueOf(i + 2)));
        assertThat(rescored.getHits().getHits()[0].getScore(),equalTo(7.0f * secondaryWeight));
        assertThat(rescored.getHits().getHits()[1].getScore(),equalTo(5.0f * secondaryWeight));
        assertThat(rescored.getHits().getHits()[2].getScore(),equalTo(5.0f * primaryWeight));
        assertThat(rescored.getHits().getHits()[3].getScore(),equalTo(0.2f * primaryWeight));
      }
 else       if ("min".equals(scoreMode)) {
        assertFirstHit(rescored,hasId(String.valueOf(i + 2)));
        assertSecondHit(rescored,hasId(String.valueOf(i + 1)));
        assertThirdHit(rescored,hasId(String.valueOf(i)));
        assertThat(rescored.getHits().getHits()[0].getScore(),equalTo(5.0f * primaryWeight));
        assertThat(rescored.getHits().getHits()[1].getScore(),equalTo(3.0f * primaryWeight));
        assertThat(rescored.getHits().getHits()[2].getScore(),equalTo(2.0f * primaryWeight));
        assertThat(rescored.getHits().getHits()[3].getScore(),equalTo(0.0f * secondaryWeight));
      }
 else       if ("avg".equals(scoreMode)) {
        assertFirstHit(rescored,hasId(String.valueOf(i + 1)));
        assertSecondHit(rescored,hasId(String.valueOf(i + 2)));
        assertThirdHit(rescored,hasId(String.valueOf(i)));
        assertThat(rescored.getHits().getHits()[0].getScore(),equalTo((3.0f * primaryWeight + 7.0f * secondaryWeight) / 2.0f));
        assertThat(rescored.getHits().getHits()[1].getScore(),equalTo(5.0f * primaryWeight));
        assertThat(rescored.getHits().getHits()[2].getScore(),equalTo((2.0f * primaryWeight + 5.0f * secondaryWeight) / 2.0f));
        assertThat(rescored.getHits().getHits()[3].getScore(),equalTo((0.2f * primaryWeight) / 2.0f));
      }
 else       if ("multiply".equals(scoreMode)) {
        assertFirstHit(rescored,hasId(String.valueOf(i + 1)));
        assertSecondHit(rescored,hasId(String.valueOf(i)));
        assertThirdHit(rescored,hasId(String.valueOf(i + 2)));
        assertThat(rescored.getHits().getHits()[0].getScore(),equalTo(3.0f * primaryWeight * 7.0f* secondaryWeight));
        assertThat(rescored.getHits().getHits()[1].getScore(),equalTo(2.0f * primaryWeight * 5.0f* secondaryWeight));
        assertThat(rescored.getHits().getHits()[2].getScore(),equalTo(5.0f * primaryWeight));
        assertThat(rescored.getHits().getHits()[3].getScore(),equalTo(0.2f * primaryWeight * 0.0f* secondaryWeight));
      }
    }
  }
}
