{
  try {
    if (scriptService != null) {
      ExecutableScript script=scriptService.executable(request.script,ScriptContext.Standard.UPDATE,request);
      script.setNextVar("ctx",ctx);
      script.run();
      ctx=(Map<String,Object>)script.unwrap(ctx);
    }
  }
 catch (  Exception e) {
    throw new IllegalArgumentException("failed to execute script",e);
  }
  return ctx;
}
