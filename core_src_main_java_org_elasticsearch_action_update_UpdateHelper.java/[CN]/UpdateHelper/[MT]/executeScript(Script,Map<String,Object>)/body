{
  try {
    if (scriptService != null) {
      ClusterState state=clusterService.state();
      ExecutableScript executableScript=scriptService.executable(script,ScriptContext.Standard.UPDATE,Collections.emptyMap(),state);
      executableScript.setNextVar("ctx",ctx);
      executableScript.run();
      ctx=(Map<String,Object>)executableScript.unwrap(ctx);
    }
  }
 catch (  Exception e) {
    throw new IllegalArgumentException("failed to execute script",e);
  }
  return ctx;
}
