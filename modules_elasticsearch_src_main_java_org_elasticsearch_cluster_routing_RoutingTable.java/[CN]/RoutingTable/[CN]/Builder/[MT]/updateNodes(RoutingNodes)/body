{
  Map<String,IndexRoutingTable.Builder> indexRoutingTableBuilders=newHashMap();
  for (  RoutingNode routingNode : routingNodes) {
    for (    MutableShardRouting shardRoutingEntry : routingNode) {
      if (shardRoutingEntry.state() == ShardRoutingState.INITIALIZING && shardRoutingEntry.relocatingNodeId() != null)       continue;
      String index=shardRoutingEntry.index();
      IndexRoutingTable.Builder indexBuilder=indexRoutingTableBuilders.get(index);
      if (indexBuilder == null) {
        indexBuilder=new IndexRoutingTable.Builder(index);
        indexRoutingTableBuilders.put(index,indexBuilder);
      }
      indexBuilder.addShard(new ImmutableShardRouting(shardRoutingEntry));
    }
  }
  for (  MutableShardRouting shardRoutingEntry : routingNodes.unassigned()) {
    String index=shardRoutingEntry.index();
    IndexRoutingTable.Builder indexBuilder=indexRoutingTableBuilders.get(index);
    if (indexBuilder == null) {
      indexBuilder=new IndexRoutingTable.Builder(index);
      indexRoutingTableBuilders.put(index,indexBuilder);
    }
    indexBuilder.addShard(new ImmutableShardRouting(shardRoutingEntry));
  }
  for (  IndexRoutingTable.Builder indexBuilder : indexRoutingTableBuilders.values()) {
    add(indexBuilder);
  }
  return this;
}
