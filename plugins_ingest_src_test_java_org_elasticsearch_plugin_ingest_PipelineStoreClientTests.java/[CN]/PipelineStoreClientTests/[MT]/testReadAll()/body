{
  PipelineStoreClient reader=new PipelineStoreClient(Settings.EMPTY,node().injector());
  reader.start();
  createIndex(PipelineStore.INDEX);
  int numDocs=scaledRandomIntBetween(32,128);
  for (int i=0; i < numDocs; i++) {
    client().prepareIndex(PipelineStore.INDEX,PipelineStore.TYPE,Integer.toString(i)).setSource("field","value" + i).get();
  }
  client().admin().indices().prepareRefresh().get();
  int i=0;
  for (  SearchHit hit : reader.readAllPipelines()) {
    assertThat(hit.getId(),equalTo(Integer.toString(i)));
    assertThat(hit.getVersion(),equalTo(1l));
    assertThat(hit.getSource().get("field"),equalTo("value" + i));
    i++;
  }
  assertThat(i,equalTo(numDocs));
}
