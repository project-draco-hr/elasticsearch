{
  int shardSize=this.shardSize;
  if (shardSize == 0) {
    shardSize=Integer.MAX_VALUE;
  }
  int requiredSize=this.requiredSize;
  if (requiredSize == 0) {
    requiredSize=Integer.MAX_VALUE;
  }
  if (shardSize < 0) {
    shardSize=BucketUtils.suggestShardSideQueueSize(requiredSize,context.searchContext().numberOfShards());
  }
  if (shardSize < requiredSize) {
    shardSize=requiredSize;
  }
  return new GeoHashGridAggregatorFactory(name,type,config,precision,requiredSize,shardSize);
}
