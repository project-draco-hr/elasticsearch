{
  InternalAggregations subAggs=buildEmptySubAggregations();
  List<org.elasticsearch.search.aggregations.bucket.range.Range.Bucket> buckets=Lists.newArrayListWithCapacity(ranges.length);
  for (int i=0; i < ranges.length; i++) {
    Range range=ranges[i];
    org.elasticsearch.search.aggregations.bucket.range.Range.Bucket bucket=rangeFactory.createBucket(range.key,range.from,range.to,0,subAggs,valuesSource.formatter());
    buckets.add(bucket);
  }
  ValueFormatter formatter=valuesSource != null ? valuesSource.formatter() : null;
  return rangeFactory.create(name,buckets,formatter,keyed,false);
}
