{
  InternalAggregations subAggs=buildEmptySubAggregations();
  List<RangeBase.Bucket> buckets=Lists.newArrayListWithCapacity(ranges.length);
  for (int i=0; i < ranges.length; i++) {
    Range range=ranges[i];
    RangeBase.Bucket bucket=rangeFactory.createBucket(range.key,range.from,range.to,0,subAggs,valuesSource.formatter());
    buckets.add(bucket);
  }
  ValueFormatter formatter=valuesSource != null ? valuesSource.formatter() : null;
  return rangeFactory.create(name,buckets,formatter,keyed);
}
