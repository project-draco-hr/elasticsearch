{
  String json="/org/elasticsearch/index/analysis/pattern_capture.json";
  Settings settings=settingsBuilder().put("path.home",createTempDir()).loadFromStream(json,getClass().getResourceAsStream(json)).put(IndexMetaData.SETTING_VERSION_CREATED,Version.CURRENT).build();
  IndexSettings idxSettings=IndexSettingsModule.newIndexSettings(new Index("index"),settings,Collections.emptyList());
  AnalysisService analysisService=new AnalysisRegistry(null,new Environment(settings)).build(idxSettings);
  NamedAnalyzer analyzer1=analysisService.analyzer("single");
  assertTokenStreamContents(analyzer1.tokenStream("test","foobarbaz"),new String[]{"foobarbaz","foobar","foo"});
  NamedAnalyzer analyzer2=analysisService.analyzer("multi");
  assertTokenStreamContents(analyzer2.tokenStream("test","abc123def"),new String[]{"abc123def","abc","123","def"});
  NamedAnalyzer analyzer3=analysisService.analyzer("preserve");
  assertTokenStreamContents(analyzer3.tokenStream("test","foobarbaz"),new String[]{"foobar","foo"});
}
