{
  SearchRequest searchRequest=new SearchRequest();
  searchRequest.indices("_all");
  try {
    String query="{ \"template\" : { \"query\": {\"match_all\": {}}, \"size\" : \"{{my_size}}\"  } }";
    BytesReference bytesRef=new BytesArray(query);
    searchRequest.templateSource(bytesRef);
    client().search(searchRequest).get();
    fail("expected exception");
  }
 catch (  Exception ex) {
  }
  String query="{ \"template\" : { \"query\": {\"match_all\": {}}, \"size\" : \"{{my_size}}\"  }, \"params\" : { \"my_size\": 1 } }";
  BytesReference bytesRef=new BytesArray(query);
  searchRequest.templateSource(bytesRef);
  SearchResponse searchResponse=client().search(searchRequest).get();
  assertThat(searchResponse.getHits().hits().length,equalTo(1));
}
