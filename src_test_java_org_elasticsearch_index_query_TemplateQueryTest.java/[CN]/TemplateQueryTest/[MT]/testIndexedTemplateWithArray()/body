{
  createIndex(ScriptService.SCRIPT_INDEX);
  ensureGreen(ScriptService.SCRIPT_INDEX);
  List<IndexRequestBuilder> builders=new ArrayList<>();
  String multiQuery="{\"query\":{\"terms\":{\"theField\":[\"{{#fieldParam}}\",\"{{.}}\",\"{{/fieldParam}}\"]}}}";
  builders.add(client().prepareIndex(ScriptService.SCRIPT_INDEX,"mustache","4").setSource(jsonBuilder().startObject().field("template",multiQuery).endObject()));
  indexRandom(true,builders);
  builders.clear();
  builders.add(client().prepareIndex("test","type","1").setSource("{\"theField\":\"foo\"}"));
  builders.add(client().prepareIndex("test","type","2").setSource("{\"theField\":\"foo 2\"}"));
  builders.add(client().prepareIndex("test","type","3").setSource("{\"theField\":\"foo 3\"}"));
  builders.add(client().prepareIndex("test","type","4").setSource("{\"theField\":\"foo 4\"}"));
  builders.add(client().prepareIndex("test","type","5").setSource("{\"theField\":\"bar\"}"));
  indexRandom(true,builders);
  Map<String,Object> arrayTemplateParams=new HashMap<>();
  String[] fieldParams={"foo","bar"};
  arrayTemplateParams.put("fieldParam",fieldParams);
  SearchResponse searchResponse=client().prepareSearch("test").setTypes("type").setTemplateName("/mustache/4").setTemplateType(ScriptService.ScriptType.INDEXED).setTemplateParams(arrayTemplateParams).get();
  assertHitCount(searchResponse,5);
}
