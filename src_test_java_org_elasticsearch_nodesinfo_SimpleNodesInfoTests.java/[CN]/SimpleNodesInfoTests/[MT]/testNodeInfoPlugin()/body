{
  String server1NodeId=startNodeWithPlugins(1);
  String server2NodeId=startNodeWithPlugins(2);
  String server3NodeId=startNodeWithPlugins(3,TestPlugin.class.getName());
  String server4NodeId=startNodeWithPlugins(4,TestNoVersionPlugin.class.getName());
  ClusterHealthResponse clusterHealth=client().admin().cluster().health(clusterHealthRequest().waitForGreenStatus()).actionGet();
  logger.info("--> done cluster_health, status " + clusterHealth.getStatus());
  NodesInfoResponse response=client().admin().cluster().prepareNodesInfo().clear().setPlugins(true).execute().actionGet();
  logger.info("--> full json answer, status " + response.toString());
  assertNodeContainsPlugins(response,server1NodeId,Collections.EMPTY_LIST,Collections.EMPTY_LIST,Collections.EMPTY_LIST,Collections.EMPTY_LIST,Collections.EMPTY_LIST,Collections.EMPTY_LIST);
  assertNodeContainsPlugins(response,server2NodeId,Collections.EMPTY_LIST,Collections.EMPTY_LIST,Collections.EMPTY_LIST,Lists.newArrayList(Fields.SITE_PLUGIN),Lists.newArrayList(Fields.SITE_PLUGIN_DESCRIPTION),Lists.newArrayList(Fields.SITE_PLUGIN_VERSION));
  assertNodeContainsPlugins(response,server3NodeId,Lists.newArrayList(TestPlugin.Fields.NAME),Lists.newArrayList(TestPlugin.Fields.DESCRIPTION),Lists.newArrayList(PluginInfo.VERSION_NOT_AVAILABLE),Collections.EMPTY_LIST,Collections.EMPTY_LIST,Collections.EMPTY_LIST);
  assertNodeContainsPlugins(response,server4NodeId,Lists.newArrayList(TestNoVersionPlugin.Fields.NAME),Lists.newArrayList(TestNoVersionPlugin.Fields.DESCRIPTION),Lists.newArrayList(PluginInfo.VERSION_NOT_AVAILABLE),Lists.newArrayList(Fields.SITE_PLUGIN,TestNoVersionPlugin.Fields.NAME),Lists.newArrayList(PluginInfo.DESCRIPTION_NOT_AVAILABLE),Lists.newArrayList(PluginInfo.VERSION_NOT_AVAILABLE));
}
