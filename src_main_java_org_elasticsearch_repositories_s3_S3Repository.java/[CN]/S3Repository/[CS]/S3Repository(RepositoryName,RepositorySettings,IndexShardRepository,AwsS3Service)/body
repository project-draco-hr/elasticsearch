{
  super(name.getName(),repositorySettings,indexShardRepository);
  String bucket=repositorySettings.settings().get("bucket",componentSettings.get("bucket"));
  if (bucket == null) {
    throw new RepositoryException(name.name(),"No bucket defined for s3 gateway");
  }
  String endpoint=repositorySettings.settings().get("endpoint",componentSettings.get("endpoint"));
  String region=repositorySettings.settings().get("region",componentSettings.get("region"));
  if (region == null) {
    String regionSetting=repositorySettings.settings().get("cloud.aws.region",settings.get("cloud.aws.region"));
    if (regionSetting != null) {
      regionSetting=regionSetting.toLowerCase(Locale.ENGLISH);
      if ("us-east".equals(regionSetting)) {
        region=null;
      }
 else       if ("us-east-1".equals(regionSetting)) {
        region=null;
      }
 else       if ("us-west".equals(regionSetting)) {
        region="us-west-1";
      }
 else       if ("us-west-1".equals(regionSetting)) {
        region="us-west-1";
      }
 else       if ("us-west-2".equals(regionSetting)) {
        region="us-west-2";
      }
 else       if ("ap-southeast".equals(regionSetting)) {
        region="ap-southeast-1";
      }
 else       if ("ap-southeast-1".equals(regionSetting)) {
        region="ap-southeast-1";
      }
 else       if ("ap-southeast-2".equals(regionSetting)) {
        region="ap-southeast-2";
      }
 else       if ("ap-northeast".equals(regionSetting)) {
        region="ap-northeast-1";
      }
 else       if ("ap-northeast-1".equals(regionSetting)) {
        region="ap-northeast-1";
      }
 else       if ("eu-west".equals(regionSetting)) {
        region="EU";
      }
 else       if ("eu-west-1".equals(regionSetting)) {
        region="EU";
      }
 else       if ("sa-east".equals(regionSetting)) {
        region="sa-east-1";
      }
 else       if ("sa-east-1".equals(regionSetting)) {
        region="sa-east-1";
      }
    }
  }
  boolean serverSideEncryption=repositorySettings.settings().getAsBoolean("server_side_encryption",componentSettings.getAsBoolean("server_side_encryption",false));
  ByteSizeValue bufferSize=repositorySettings.settings().getAsBytesSize("buffer_size",componentSettings.getAsBytesSize("buffer_size",null));
  Integer maxRetries=repositorySettings.settings().getAsInt("max_retries",componentSettings.getAsInt("max_retries",3));
  this.chunkSize=repositorySettings.settings().getAsBytesSize("chunk_size",componentSettings.getAsBytesSize("chunk_size",new ByteSizeValue(100,ByteSizeUnit.MB)));
  this.compress=repositorySettings.settings().getAsBoolean("compress",componentSettings.getAsBoolean("compress",false));
  logger.debug("using bucket [{}], region [{}], endpoint [{}], chunk_size [{}], server_side_encryption [{}], buffer_size [{}], max_retries [{}]",bucket,region,endpoint,chunkSize,serverSideEncryption,bufferSize,maxRetries);
  blobStore=new S3BlobStore(settings,s3Service.client(endpoint,region,repositorySettings.settings().get("access_key"),repositorySettings.settings().get("secret_key"),maxRetries),bucket,region,serverSideEncryption,bufferSize,maxRetries);
  String basePath=repositorySettings.settings().get("base_path",null);
  if (Strings.hasLength(basePath)) {
    BlobPath path=new BlobPath();
    for (    String elem : Strings.splitStringToArray(basePath,'/')) {
      path=path.add(elem);
    }
    this.basePath=path;
  }
 else {
    this.basePath=BlobPath.cleanPath();
  }
}
