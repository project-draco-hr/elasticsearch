{
  TestFieldSetting[] testFieldSettings=getFieldSettings();
  createIndexBasedOnFieldSettings(testFieldSettings,-1);
  TestDoc[] testDocs=generateTestDocs(5,testFieldSettings);
  DirectoryReader directoryReader=indexDocsWithLucene(testDocs);
  TestConfig[] testConfigs=generateTestConfigs(20,testDocs,testFieldSettings);
  for (  TestConfig test : testConfigs) {
    try {
      TermVectorRequestBuilder request=getRequestForConfig(test);
      if (test.expectedException != null) {
        assertThrows(request,test.expectedException);
        continue;
      }
      TermVectorResponse response=run(request);
      Fields luceneTermVectors=getTermVectorsFromLucene(directoryReader,test.doc);
      validateResponse(response,luceneTermVectors,test);
    }
 catch (    Throwable t) {
      throw new Exception("Test exception while running " + test.toString(),t);
    }
  }
}
