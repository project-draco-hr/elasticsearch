{
  logger.info("testing preference for tribe {}",tribe);
  logger.info("create 2 indices, test1 on t1, and test2 on t2");
  assertAcked(internalCluster().client().admin().indices().prepareCreate("conflict"));
  assertAcked(cluster2.client().admin().indices().prepareCreate("conflict"));
  assertAcked(internalCluster().client().admin().indices().prepareCreate("test1"));
  assertAcked(cluster2.client().admin().indices().prepareCreate("test2"));
  setupTribeNode(Settings.builder().put("tribe.on_conflict","prefer_" + tribe).build());
  logger.info("wait till tribe has the same nodes as the 2 clusters");
  awaitSameNodeCounts();
  logger.info("wait till test1 and test2 exists in the tribe node state");
  awaitIndicesInClusterState("test1","test2","conflict");
  assertThat(tribeClient.admin().cluster().prepareState().get().getState().getMetaData().index("test1").getSettings().get(TribeService.TRIBE_NAME),equalTo("t1"));
  assertThat(tribeClient.admin().cluster().prepareState().get().getState().getMetaData().index("test2").getSettings().get(TribeService.TRIBE_NAME),equalTo("t2"));
  assertThat(tribeClient.admin().cluster().prepareState().get().getState().getMetaData().index("conflict").getSettings().get(TribeService.TRIBE_NAME),equalTo(tribe));
}
