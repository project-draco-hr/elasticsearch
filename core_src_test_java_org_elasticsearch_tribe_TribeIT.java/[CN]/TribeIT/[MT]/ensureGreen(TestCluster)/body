{
  ClusterHealthResponse actionGet=testCluster.client().admin().cluster().health(Requests.clusterHealthRequest().waitForGreenStatus().waitForEvents(Priority.LANGUID).waitForNoRelocatingShards(true)).actionGet();
  if (actionGet.isTimedOut()) {
    logger.info("ensureGreen timed out, cluster state:\n{}\n{}",testCluster.client().admin().cluster().prepareState().get().getState().prettyPrint(),testCluster.client().admin().cluster().preparePendingClusterTasks().get().prettyPrint());
    assertThat("timed out waiting for green state",actionGet.isTimedOut(),equalTo(false));
  }
  assertThat(actionGet.getStatus(),equalTo(ClusterHealthStatus.GREEN));
}
