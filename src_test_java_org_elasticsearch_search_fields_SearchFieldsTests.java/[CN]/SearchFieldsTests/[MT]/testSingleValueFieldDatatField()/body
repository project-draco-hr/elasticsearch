{
  createIndex("test");
  indexRandom(true,client().prepareIndex("test","type","1").setSource("test_field","foobar"));
  refresh();
  SearchResponse searchResponse=client().prepareSearch("test").setTypes("type").setSource(new BytesArray(new BytesRef("{\"query\":{\"match_all\":{}},\"fielddata_fields\": \"test_field\"}"))).get();
  assertHitCount(searchResponse,1);
  Map<String,SearchHitField> fields=searchResponse.getHits().getHits()[0].getFields();
  assertThat((String)fields.get("test_field").value(),equalTo("foobar"));
}
