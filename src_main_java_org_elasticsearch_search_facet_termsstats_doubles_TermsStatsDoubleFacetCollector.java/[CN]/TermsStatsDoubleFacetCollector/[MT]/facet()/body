{
  if (aggregator.entries.isEmpty()) {
    return new InternalTermsStatsDoubleFacet(facetName,comparatorType,size,ImmutableList.<InternalTermsStatsDoubleFacet.DoubleEntry>of(),aggregator.missing);
  }
  if (size == 0) {
    return new InternalTermsStatsDoubleFacet(facetName,comparatorType,0,aggregator.entries.valueCollection(),aggregator.missing);
  }
  Object[] values=aggregator.entries.internalValues();
  Arrays.sort(values,(Comparator)comparatorType.comparator());
  int limit=size;
  List<InternalTermsStatsDoubleFacet.DoubleEntry> ordered=Lists.newArrayList();
  for (int i=0; i < limit; i++) {
    InternalTermsStatsDoubleFacet.DoubleEntry value=(InternalTermsStatsDoubleFacet.DoubleEntry)values[i];
    if (value == null) {
      break;
    }
    ordered.add(value);
  }
  CacheRecycler.pushDoubleObjectMap(aggregator.entries);
  return new InternalTermsStatsDoubleFacet(facetName,comparatorType,size,ordered,aggregator.missing);
}
