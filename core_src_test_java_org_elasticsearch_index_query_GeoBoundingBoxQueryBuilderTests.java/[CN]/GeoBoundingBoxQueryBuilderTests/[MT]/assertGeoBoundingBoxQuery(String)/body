{
  Query parsedQuery=parseQuery(query).toQuery(createShardContext());
  if (queryShardContext().indexVersionCreated().before(Version.V_2_2_0)) {
    InMemoryGeoBoundingBoxQuery filter=(InMemoryGeoBoundingBoxQuery)parsedQuery;
    assertThat(filter.fieldName(),equalTo(GEO_POINT_FIELD_NAME));
    assertThat(filter.topLeft().lat(),closeTo(40,1E-5));
    assertThat(filter.topLeft().lon(),closeTo(-70,1E-5));
    assertThat(filter.bottomRight().lat(),closeTo(30,1E-5));
    assertThat(filter.bottomRight().lon(),closeTo(-80,1E-5));
  }
 else {
    GeoPointInBBoxQuery q=(GeoPointInBBoxQuery)parsedQuery;
    assertThat(q.getField(),equalTo(GEO_POINT_FIELD_NAME));
    assertThat(q.getMaxLat(),closeTo(40,1E-5));
    assertThat(q.getMinLon(),closeTo(-70,1E-5));
    assertThat(q.getMinLat(),closeTo(30,1E-5));
    assertThat(q.getMaxLon(),closeTo(-80,1E-5));
  }
}
