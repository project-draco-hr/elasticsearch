{
  try {
    List<Failure> failures=new ArrayList<Failure>();
    Set<String> destinationIndicesThisBatch=new HashSet<>();
    for (    BulkItemResponse item : response) {
      if (item.isFailed()) {
        recordFailure(item.getFailure(),failures);
        continue;
      }
switch (item.getOpType()) {
case "index":
case "create":
        IndexResponse ir=item.getResponse();
      if (ir.isCreated()) {
        task.countCreated();
      }
 else {
        task.countUpdated();
      }
    break;
case "delete":
  task.countDeleted();
break;
default :
throw new IllegalArgumentException("Unknown op type:  " + item.getOpType());
}
destinationIndices.add(item.getIndex());
}
destinationIndices.addAll(destinationIndicesThisBatch);
if (false == failures.isEmpty()) {
startNormalTermination(unmodifiableList(failures),emptyList());
return;
}
if (mainRequest.getSize() != SIZE_ALL_MATCHES && task.getSuccessfullyProcessed() >= mainRequest.getSize()) {
startNormalTermination(emptyList(),emptyList());
return;
}
startNextScrollRequest();
}
 catch (Throwable t) {
finishHim(t);
}
}
