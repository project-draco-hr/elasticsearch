{
  final Cast cast=AnalyzerCaster.getLegalCast(location,actual,expected,explicit,internal);
  if (cast == null) {
    if (constant == null || this instanceof EConstant) {
      return this;
    }
 else {
      final EConstant econstant=new EConstant(location,constant);
      econstant.analyze(variables);
      if (!expected.equals(econstant.actual)) {
        throw createError(new IllegalStateException("Illegal tree structure."));
      }
      return econstant;
    }
  }
 else {
    if (constant == null) {
      final ECast ecast=new ECast(location,this,cast);
      ecast.statement=statement;
      ecast.actual=expected;
      ecast.isNull=isNull;
      return ecast;
    }
 else {
      if (expected.sort.constant) {
        constant=AnalyzerCaster.constCast(location,constant,cast);
        final EConstant econstant=new EConstant(location,constant);
        econstant.analyze(variables);
        if (!expected.equals(econstant.actual)) {
          throw createError(new IllegalStateException("Illegal tree structure."));
        }
        return econstant;
      }
 else       if (this instanceof EConstant) {
        final ECast ecast=new ECast(location,this,cast);
        ecast.actual=expected;
        return ecast;
      }
 else {
        final EConstant econstant=new EConstant(location,constant);
        econstant.analyze(variables);
        if (!actual.equals(econstant.actual)) {
          throw createError(new IllegalStateException("Illegal tree structure."));
        }
        final ECast ecast=new ECast(location,econstant,cast);
        ecast.actual=expected;
        return ecast;
      }
    }
  }
}
