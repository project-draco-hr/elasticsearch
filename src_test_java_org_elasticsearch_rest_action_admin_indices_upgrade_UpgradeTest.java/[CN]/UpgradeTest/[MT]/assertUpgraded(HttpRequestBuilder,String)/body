{
  for (  UpgradeStatus status : getUpgradeStatus(httpClient,upgradePath(index))) {
    assertTrue("index " + status.indexName + " should not be zero sized",status.totalBytes != 0);
    assertEquals("index " + status.indexName + " should be upgraded",0,status.toUpgradeBytes);
  }
  IndicesSegmentResponse segsRsp;
  if (index == null) {
    segsRsp=client().admin().indices().prepareSegments().execute().actionGet();
  }
 else {
    segsRsp=client().admin().indices().prepareSegments(index).execute().actionGet();
  }
  for (  IndexSegments indexSegments : segsRsp.getIndices().values()) {
    for (    IndexShardSegments shard : indexSegments) {
      for (      ShardSegments segs : shard.getShards()) {
        for (        Segment seg : segs.getSegments()) {
          assertEquals("Index " + indexSegments.getIndex() + " has unupgraded segment "+ seg.toString(),Version.CURRENT.luceneVersion,seg.version);
        }
      }
    }
  }
}
