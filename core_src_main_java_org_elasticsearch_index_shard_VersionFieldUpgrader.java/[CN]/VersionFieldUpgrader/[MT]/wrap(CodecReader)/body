{
  final FieldInfos fieldInfos=reader.getFieldInfos();
  final FieldInfo versionInfo=fieldInfos.fieldInfo(VersionFieldMapper.NAME);
  if (versionInfo != null && versionInfo.getDocValuesType() != DocValuesType.NONE) {
    return reader;
  }
  final Terms terms=reader.terms(UidFieldMapper.NAME);
  if (terms == null || !terms.hasPayloads()) {
    return reader;
  }
  return new VersionFieldUpgrader(reader);
}
