{
  if (shardRouting.primary()) {
    boolean primaryUnassigned=false;
    for (    MutableShardRouting shard : allocation.routingNodes().unassigned()) {
      if (shard.shardId().equals(shardRouting.shardId())) {
        primaryUnassigned=true;
      }
    }
    if (primaryUnassigned) {
      int primariesInRecovery=0;
      for (      MutableShardRouting shard : node) {
        if (shard.state() == ShardRoutingState.INITIALIZING && shard.primary()) {
          primariesInRecovery++;
        }
      }
      if (primariesInRecovery >= concurrentRecoveries) {
        return Decision.THROTTLE;
      }
 else {
        return Decision.YES;
      }
    }
  }
  int currentRecoveries=0;
  for (  MutableShardRouting shard : node) {
    if (shard.state() == ShardRoutingState.INITIALIZING || shard.state() == ShardRoutingState.RELOCATING) {
      currentRecoveries++;
    }
  }
  if (currentRecoveries >= concurrentRecoveries) {
    return Decision.THROTTLE;
  }
 else {
    return Decision.YES;
  }
}
