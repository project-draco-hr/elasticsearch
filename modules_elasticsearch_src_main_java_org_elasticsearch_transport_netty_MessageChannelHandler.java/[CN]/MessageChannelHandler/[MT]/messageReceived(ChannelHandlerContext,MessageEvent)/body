{
  ChannelBuffer buffer=(ChannelBuffer)event.getMessage();
  StreamInput streamIn=new ChannelBufferStreamInput(buffer);
  streamIn=HandlesStreamInput.Cached.cached(streamIn);
  long requestId=buffer.readLong();
  byte status=buffer.readByte();
  boolean isRequest=isRequest(status);
  if (isRequest) {
    handleRequest(buffer,event,streamIn,requestId);
  }
 else {
    final TransportResponseHandler handler=transportServiceAdapter.remove(requestId);
    if (handler != null) {
      if (isError(status)) {
        handlerResponseError(buffer,streamIn,handler);
      }
 else {
        handleResponse(buffer,streamIn,handler);
      }
    }
 else {
      buffer.skipBytes(buffer.readableBytes());
    }
  }
}
