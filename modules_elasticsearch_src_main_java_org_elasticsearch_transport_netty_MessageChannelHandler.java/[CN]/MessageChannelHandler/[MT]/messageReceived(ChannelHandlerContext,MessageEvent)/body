{
  ChannelBufferInputStream buffer=(ChannelBufferInputStream)event.getMessage();
  long requestId=buffer.readLong();
  byte status=buffer.readByte();
  boolean isRequest=isRequest(status);
  if (isRequest) {
    handleRequest(event,buffer,requestId);
  }
 else {
    final TransportResponseHandler handler=transportServiceAdapter.remove(requestId);
    if (handler == null) {
      throw new ResponseHandlerNotFoundTransportException(requestId);
    }
    if (isError(status)) {
      handlerResponseError(buffer,handler);
    }
 else {
      handleResponse(buffer,handler);
    }
  }
}
