{
  ChannelBuffer buffer=(ChannelBuffer)event.getMessage();
  StreamInput streamIn=new ChannelBufferStreamInput(buffer);
  streamIn=HandlesStreamInput.Cached.cached(streamIn);
  long requestId=buffer.readLong();
  byte status=buffer.readByte();
  boolean isRequest=isRequest(status);
  if (isRequest) {
    handleRequest(event,streamIn,requestId);
  }
 else {
    final TransportResponseHandler handler=transportServiceAdapter.remove(requestId);
    if (handler == null) {
      throw new ResponseHandlerNotFoundTransportException(requestId);
    }
    if (isError(status)) {
      handlerResponseError(streamIn,handler);
    }
 else {
      handleResponse(streamIn,handler);
    }
  }
}
