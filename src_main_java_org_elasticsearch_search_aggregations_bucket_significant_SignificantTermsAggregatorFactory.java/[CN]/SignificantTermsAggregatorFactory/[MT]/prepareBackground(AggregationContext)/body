{
  if (termsEnum != null) {
    return termsEnum.getNumDocs();
  }
  SearchContext searchContext=context.searchContext();
  IndexReader reader=searchContext.searcher().getIndexReader();
  try {
    if (numberOfAggregatorsCreated == 1) {
      termsEnum=new FilterableTermsEnum(reader,indexedFieldName,DocsEnum.FLAG_NONE,filter);
    }
 else {
      termsEnum=new FreqTermsEnum(reader,indexedFieldName,true,false,filter,searchContext.bigArrays());
    }
  }
 catch (  IOException e) {
    throw new ElasticsearchException("failed to build terms enumeration",e);
  }
  return termsEnum.getNumDocs();
}
