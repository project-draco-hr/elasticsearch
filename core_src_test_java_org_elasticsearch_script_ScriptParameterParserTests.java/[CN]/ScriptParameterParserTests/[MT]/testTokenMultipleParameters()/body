{
  XContentParser parser=XContentHelper.createParser(new BytesArray("{ \"foo\" : \"fooScriptValue\", \"bar_file\" : \"barScriptValue\", \"baz_id\" : \"bazScriptValue\" }"));
  Set<String> parameters=new HashSet<>();
  parameters.add("foo");
  parameters.add("bar");
  parameters.add("baz");
  ScriptParameterParser paramParser=new ScriptParameterParser(parameters);
  assertThat(paramParser.getScriptParameterValue("foo"),nullValue());
  assertThat(paramParser.getScriptParameterValue("bar"),nullValue());
  assertThat(paramParser.getScriptParameterValue("baz"),nullValue());
  assertThat(paramParser.getScriptParameterValue("bar_file"),nullValue());
  assertThat(paramParser.getScriptParameterValue("baz_id"),nullValue());
  assertThat(paramParser.lang(),nullValue());
  Token token=parser.nextToken();
  while (token != Token.VALUE_STRING) {
    token=parser.nextToken();
  }
  assertThat(paramParser.token(parser.currentName(),parser.currentToken(),parser,ParseFieldMatcher.STRICT),equalTo(true));
  assertParameterValue(paramParser,"foo","fooScriptValue",ScriptType.INLINE);
  assertThat(paramParser.getScriptParameterValue("bar"),nullValue());
  assertThat(paramParser.getScriptParameterValue("baz"),nullValue());
  assertThat(paramParser.getScriptParameterValue("bar_file"),nullValue());
  assertThat(paramParser.getScriptParameterValue("baz_id"),nullValue());
  assertThat(paramParser.lang(),nullValue());
  token=parser.nextToken();
  while (token != Token.VALUE_STRING) {
    token=parser.nextToken();
  }
  assertThat(paramParser.token(parser.currentName(),parser.currentToken(),parser,ParseFieldMatcher.STRICT),equalTo(true));
  assertParameterValue(paramParser,"foo","fooScriptValue",ScriptType.INLINE);
  assertParameterValue(paramParser,"bar","barScriptValue",ScriptType.FILE);
  assertThat(paramParser.getScriptParameterValue("baz"),nullValue());
  assertThat(paramParser.getScriptParameterValue("bar_file"),nullValue());
  assertThat(paramParser.getScriptParameterValue("baz_id"),nullValue());
  assertThat(paramParser.lang(),nullValue());
  token=parser.nextToken();
  while (token != Token.VALUE_STRING) {
    token=parser.nextToken();
  }
  assertThat(paramParser.token(parser.currentName(),parser.currentToken(),parser,ParseFieldMatcher.STRICT),equalTo(true));
  assertParameterValue(paramParser,"foo","fooScriptValue",ScriptType.INLINE);
  assertParameterValue(paramParser,"bar","barScriptValue",ScriptType.FILE);
  assertParameterValue(paramParser,"baz","bazScriptValue",ScriptType.INDEXED);
  assertThat(paramParser.getScriptParameterValue("bar_file"),nullValue());
  assertThat(paramParser.getScriptParameterValue("baz_id"),nullValue());
  assertThat(paramParser.lang(),nullValue());
}
