{
  createIndex("test-blocks");
  ensureGreen("test-blocks");
  for (  String blockSetting : Arrays.asList(SETTING_BLOCKS_READ,SETTING_BLOCKS_WRITE)) {
    try {
      assertAcked(client().admin().indices().preparePutWarmer("warmer_block").setSearchRequest(client().prepareSearch("test-blocks").setTypes("a1").setQuery(QueryBuilders.matchAllQuery())));
      enableIndexBlock("test-blocks",blockSetting);
      assertAcked(client().admin().indices().prepareDeleteWarmer().setIndices("test-blocks").setNames("warmer_block"));
    }
  finally {
      disableIndexBlock("test-blocks",blockSetting);
    }
  }
  for (  String blockSetting : Arrays.asList(SETTING_READ_ONLY,SETTING_BLOCKS_METADATA)) {
    try {
      assertAcked(client().admin().indices().preparePutWarmer("warmer_block").setSearchRequest(client().prepareSearch("test-blocks").setTypes("a1").setQuery(QueryBuilders.matchAllQuery())));
      enableIndexBlock("test-blocks",blockSetting);
      assertBlocked(client().admin().indices().prepareDeleteWarmer().setIndices("test-blocks").setNames("warmer_block"));
    }
  finally {
      disableIndexBlock("test-blocks",blockSetting);
    }
  }
}
