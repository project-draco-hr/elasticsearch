{
  createIndex("test-blocks");
  ensureGreen("test-blocks");
  assertAcked(client().admin().indices().preparePutWarmer("warmer_block").setSearchRequest(client().prepareSearch("test-blocks").setTypes("a1").setQuery(QueryBuilders.matchAllQuery())));
  for (  String blockSetting : Arrays.asList(SETTING_BLOCKS_READ,SETTING_BLOCKS_WRITE,SETTING_READ_ONLY)) {
    try {
      enableIndexBlock("test-blocks",blockSetting);
      GetWarmersResponse response=client().admin().indices().prepareGetWarmers("test-blocks").get();
      assertThat(response.warmers().size(),equalTo(1));
      ObjectObjectCursor<String,ImmutableList<IndexWarmersMetaData.Entry>> entry=response.warmers().iterator().next();
      assertThat(entry.key,equalTo("test-blocks"));
      assertThat(entry.value.size(),equalTo(1));
      assertThat(entry.value.iterator().next().name(),equalTo("warmer_block"));
    }
  finally {
      disableIndexBlock("test-blocks",blockSetting);
    }
  }
  try {
    enableIndexBlock("test-blocks",SETTING_BLOCKS_METADATA);
    assertBlocked(client().admin().indices().prepareGetWarmers("test-blocks"),INDEX_METADATA_BLOCK);
  }
  finally {
    disableIndexBlock("test-blocks",SETTING_BLOCKS_METADATA);
  }
}
