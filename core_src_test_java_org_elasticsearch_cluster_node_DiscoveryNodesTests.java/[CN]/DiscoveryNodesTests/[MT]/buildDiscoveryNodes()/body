{
  int numNodes=randomIntBetween(1,10);
  DiscoveryNodes.Builder discoBuilder=DiscoveryNodes.builder();
  List<DiscoveryNode> nodesList=new ArrayList<>();
  for (int i=0; i < numNodes; i++) {
    Map<String,String> attributes=new HashMap<>();
    if (randomBoolean()) {
      attributes.put("master",Boolean.toString(randomBoolean()));
      attributes.put("data",Boolean.toString(randomBoolean()));
      attributes.put("ingest",Boolean.toString(randomBoolean()));
    }
 else {
      attributes.put("client","true");
    }
    if (frequently()) {
      attributes.put("custom",randomBoolean() ? "match" : randomAsciiOfLengthBetween(3,5));
    }
    final DiscoveryNode node=newNode(i,attributes);
    discoBuilder=discoBuilder.put(node);
    nodesList.add(node);
  }
  discoBuilder.localNodeId(randomFrom(nodesList).id());
  discoBuilder.masterNodeId(randomFrom(nodesList).id());
  return discoBuilder.build();
}
