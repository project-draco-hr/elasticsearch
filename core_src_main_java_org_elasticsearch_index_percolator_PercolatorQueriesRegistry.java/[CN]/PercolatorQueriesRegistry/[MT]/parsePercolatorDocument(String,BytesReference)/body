{
  try (XContentParser sourceParser=XContentHelper.createParser(source)){
    String currentFieldName=null;
    XContentParser.Token token=sourceParser.nextToken();
    if (token != XContentParser.Token.START_OBJECT) {
      throw new ElasticsearchException("failed to parse query [" + id + "], not starting with OBJECT");
    }
    while ((token=sourceParser.nextToken()) != XContentParser.Token.END_OBJECT) {
      if (token == XContentParser.Token.FIELD_NAME) {
        currentFieldName=sourceParser.currentName();
      }
 else       if (token == XContentParser.Token.START_OBJECT) {
        if ("query".equals(currentFieldName)) {
          return parseQuery(queryShardContext,mapUnmappedFieldsAsString,sourceParser);
        }
 else {
          sourceParser.skipChildren();
        }
      }
 else       if (token == XContentParser.Token.START_ARRAY) {
        sourceParser.skipChildren();
      }
    }
  }
 catch (  Exception e) {
    throw new PercolatorException(shardId().getIndex(),"failed to parse query [" + id + "]",e);
  }
  return null;
}
