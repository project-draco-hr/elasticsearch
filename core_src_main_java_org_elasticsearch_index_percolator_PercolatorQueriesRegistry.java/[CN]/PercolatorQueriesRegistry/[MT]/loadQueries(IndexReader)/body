{
  logger.trace("loading percolator queries...");
  final int loadedQueries;
  try {
    Query query=new TermQuery(new Term(TypeFieldMapper.NAME,PercolatorService.TYPE_NAME));
    QueriesLoaderCollector queryCollector=new QueriesLoaderCollector(PercolatorQueriesRegistry.this,logger,mapperService,indexFieldDataService);
    IndexSearcher indexSearcher=new IndexSearcher(reader);
    indexSearcher.setQueryCache(null);
    indexSearcher.search(query,queryCollector);
    Map<BytesRef,Query> queries=queryCollector.queries();
    for (    Map.Entry<BytesRef,Query> entry : queries.entrySet()) {
      percolateQueries.put(entry.getKey(),entry.getValue());
      numberOfQueries.inc();
    }
    loadedQueries=queries.size();
  }
 catch (  Exception e) {
    throw new PercolatorException(shardId.index(),"failed to load queries from percolator index",e);
  }
  logger.debug("done loading [{}] percolator queries",loadedQueries);
}
