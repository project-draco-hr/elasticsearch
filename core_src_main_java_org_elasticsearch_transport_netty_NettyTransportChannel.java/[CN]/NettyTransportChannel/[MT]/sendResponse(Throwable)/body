{
  close();
  BytesStreamOutput stream=new BytesStreamOutput();
  stream.skip(NettyHeader.HEADER_SIZE);
  RemoteTransportException tx=new RemoteTransportException(transport.nodeName(),transport.wrapAddress(channel.getLocalAddress()),action,error);
  stream.writeThrowable(tx);
  byte status=0;
  status=TransportStatus.setResponse(status);
  status=TransportStatus.setError(status);
  BytesReference bytes=stream.bytes();
  ChannelBuffer buffer=bytes.toChannelBuffer();
  NettyHeader.writeHeader(buffer,requestId,status,version);
  channel.write(buffer);
  transportServiceAdapter.onResponseSent(requestId,action,error);
}
