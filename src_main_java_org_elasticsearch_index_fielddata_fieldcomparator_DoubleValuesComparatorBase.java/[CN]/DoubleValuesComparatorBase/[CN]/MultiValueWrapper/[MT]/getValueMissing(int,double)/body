{
  DoubleValues.Iter iter=delegate.getIter(docId);
  if (!iter.hasNext()) {
    return missing;
  }
  double currentVal=iter.next();
  double relevantVal=currentVal;
  int counter=1;
  while (iter.hasNext()) {
    currentVal=iter.next();
    int cmp=Double.compare(currentVal,relevantVal);
switch (sortMode) {
case SUM:
      relevantVal+=currentVal;
    break;
case AVG:
  relevantVal+=currentVal;
counter++;
break;
case MIN:
if (cmp < 0) {
relevantVal=currentVal;
}
break;
case MAX:
if (cmp > 0) {
relevantVal=currentVal;
}
break;
}
}
if (sortMode == SortMode.AVG) {
return relevantVal / counter;
}
 else {
return relevantVal;
}
}
