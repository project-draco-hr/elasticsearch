{
  if (event.state().blocks().disableStatePersistence()) {
    return;
  }
  if (!event.metaDataChanged()) {
    return;
  }
  if (lastSettingsApplied != null && event.state().metaData().settings().equals(lastSettingsApplied)) {
    return;
  }
  for (  Listener listener : listeners) {
    try {
      listener.onRefreshSettings(event.state().metaData().settings());
    }
 catch (    Exception e) {
      logger.warn("failed to refresh settings for [{}]",e,listener);
    }
  }
  try {
    for (    Map.Entry<String,String> entry : event.state().metaData().settings().getAsMap().entrySet()) {
      if (entry.getKey().startsWith("logger.")) {
        String component=entry.getKey().substring("logger.".length());
        if ("_root".equals(component)) {
          ESLoggerFactory.getRootLogger().setLevel(entry.getValue());
        }
 else {
          ESLoggerFactory.getLogger(component).setLevel(entry.getValue());
        }
      }
    }
  }
 catch (  Exception e) {
    logger.warn("failed to refresh settings for [{}]",e,"logger");
  }
  lastSettingsApplied=event.state().metaData().settings();
  globalSettings=lastSettingsApplied;
}
