{
  Directory dir=new RAMDirectory();
  IndexWriter indexWriter=new IndexWriter(dir,new IndexWriterConfig(Lucene.STANDARD_ANALYZER));
  FieldType allFt=getAllFieldType();
  Document doc=new Document();
  doc.add(new Field("_id","1",StoredField.TYPE));
  doc.add(new AllField("_all","something",1.0f,allFt));
  doc.add(new AllField("_all","else",1.0f,allFt));
  indexWriter.addDocument(doc);
  doc=new Document();
  doc.add(new Field("_id","2",StoredField.TYPE));
  doc.add(new AllField("_all","else",2.0f,allFt));
  doc.add(new AllField("_all","something",1.0f,allFt));
  indexWriter.addDocument(doc);
  IndexReader reader=DirectoryReader.open(indexWriter);
  IndexSearcher searcher=new IndexSearcher(reader);
  Query query=new AllTermQuery(new Term("_all","else"));
  TopDocs docs=searcher.search(query,10);
  assertThat(docs.totalHits,equalTo(2));
  assertThat(docs.scoreDocs[0].doc,equalTo(1));
  assertExplanationScore(searcher,query,docs.scoreDocs[0]);
  assertThat(docs.scoreDocs[1].doc,equalTo(0));
  assertExplanationScore(searcher,query,docs.scoreDocs[1]);
  query=new AllTermQuery(new Term("_all","something"));
  docs=searcher.search(query,10);
  assertThat(docs.totalHits,equalTo(2));
  assertThat(docs.scoreDocs[0].doc,equalTo(0));
  assertExplanationScore(searcher,query,docs.scoreDocs[0]);
  assertThat(docs.scoreDocs[1].doc,equalTo(1));
  assertExplanationScore(searcher,query,docs.scoreDocs[1]);
  indexWriter.close();
}
