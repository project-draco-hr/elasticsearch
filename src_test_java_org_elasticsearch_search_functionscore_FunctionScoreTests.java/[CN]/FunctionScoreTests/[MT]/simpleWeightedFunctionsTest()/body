{
  assertAcked(prepareCreate(INDEX).addMapping(TYPE,MAPPING_WITH_DOUBLE_AND_GEO_POINT_AND_TEXT_FIELD));
  ensureYellow();
  index(INDEX,TYPE,"1",SIMPLE_DOC);
  refresh();
  SearchResponse response=client().search(searchRequest().source(searchSource().query(functionScoreQuery(constantScoreQuery(termQuery(TEXT_FIELD,"value"))).add(gaussDecayFunction(GEO_POINT_FIELD,new GeoPoint(10,20),"1000km")).add(fieldValueFactorFunction(DOUBLE_FIELD).modifier(FieldValueFactorFunction.Modifier.LN)).add(scriptFunction("_index['" + TEXT_FIELD + "']['value'].tf()"))))).actionGet();
  SearchResponse responseWithWeights=client().search(searchRequest().source(searchSource().query(functionScoreQuery(constantScoreQuery(termQuery(TEXT_FIELD,"value"))).add(gaussDecayFunction(GEO_POINT_FIELD,new GeoPoint(10,20),"1000km").setWeight(2)).add(fieldValueFactorFunction(DOUBLE_FIELD).modifier(FieldValueFactorFunction.Modifier.LN).setWeight(2)).add(scriptFunction("_index['" + TEXT_FIELD + "']['value'].tf()").setWeight(2))))).actionGet();
  assertSearchResponse(response);
  assertThat(response.getHits().getAt(0).getScore(),is(1.0f));
  assertThat(responseWithWeights.getHits().getAt(0).getScore(),is(8.0f));
}
