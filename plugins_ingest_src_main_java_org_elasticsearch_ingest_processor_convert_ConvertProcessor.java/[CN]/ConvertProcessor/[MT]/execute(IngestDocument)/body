{
  for (  Map.Entry<String,Type> entry : fields.entrySet()) {
    Type type=entry.getValue();
    Object oldValue=document.getFieldValue(entry.getKey(),Object.class);
    Object newValue;
    if (oldValue == null) {
      throw new IllegalArgumentException("Field [" + entry.getKey() + "] is null, cannot be converted to type ["+ type+ "]");
    }
    if (oldValue instanceof List) {
      List<?> list=(List<?>)oldValue;
      List<Object> newList=new ArrayList<>();
      for (      Object value : list) {
        newList.add(type.convert(value));
      }
      newValue=newList;
    }
 else {
      newValue=type.convert(oldValue);
    }
    document.setFieldValue(entry.getKey(),newValue);
  }
}
