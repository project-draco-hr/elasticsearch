{
  Path translogFile=getDataPath("/org/elasticsearch/index/translog/translog-v0.binary");
  assertThat("test file should exist",Files.exists(translogFile),equalTo(true));
  try (ImmutableTranslogReader reader=openReader(translogFile,0)){
    assertThat("a version0 stream is returned",reader instanceof LegacyTranslogReader,equalTo(true));
    try (final Translog.Snapshot snapshot=reader.newSnapshot()){
      final Translog.Operation operation=snapshot.next();
      assertThat("operation is the correct type correctly",operation.opType() == Translog.Operation.Type.INDEX,equalTo(true));
      Translog.Index op=(Translog.Index)operation;
      assertThat(op.id(),equalTo("1"));
      assertThat(op.type(),equalTo("doc"));
      assertThat(op.source().toUtf8(),equalTo("{\"body\": \"worda wordb wordc wordd \\\"worde\\\" wordf\"}"));
      assertThat(op.routing(),equalTo(null));
      assertThat(op.parent(),equalTo(null));
      assertThat(op.version(),equalTo(1L));
      assertThat(op.timestamp(),equalTo(1407312091791L));
      assertThat(op.ttl(),equalTo(-1L));
      assertThat(op.versionType(),equalTo(VersionType.INTERNAL));
      assertNull(snapshot.next());
    }
   }
 }
