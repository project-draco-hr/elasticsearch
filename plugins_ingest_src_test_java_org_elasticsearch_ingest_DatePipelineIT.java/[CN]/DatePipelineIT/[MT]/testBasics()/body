{
  new PutPipelineRequestBuilder(client(),PutPipelineAction.INSTANCE).setId("_id").setSource(jsonBuilder().startObject().field("description","my_pipeline").startArray("processors").startObject().startObject("date").field("timezone","UTC").field("locale","en").field("match_field","my_date_field").startArray("match_formats").value("yyyy MMM dd HH:mm:ss Z").endArray().endObject().endObject().endArray().endObject().bytes()).get();
  assertBusy(new Runnable(){
    @Override public void run(){
      GetPipelineResponse response=new GetPipelineRequestBuilder(client(),GetPipelineAction.INSTANCE).setIds("_id").get();
      assertThat(response.isFound(),is(true));
      assertThat(response.pipelines().get("_id"),notNullValue());
    }
  }
);
  createIndex("test");
  client().prepareIndex("test","type","1").setSource("my_date_field","2015 Nov 24 01:29:01 -0800").putHeader("ingest","_id").get();
  assertBusy(new Runnable(){
    @Override public void run(){
      Map<String,Object> doc=client().prepareGet("test","type","1").get().getSourceAsMap();
      assertThat(doc.get("@timestamp"),equalTo("2015-11-24T09:29:01.000Z"));
    }
  }
);
}
