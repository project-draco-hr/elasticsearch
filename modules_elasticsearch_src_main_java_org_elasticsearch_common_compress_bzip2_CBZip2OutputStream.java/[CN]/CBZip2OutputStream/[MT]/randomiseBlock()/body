{
  final boolean[] inUse=this.data.inUse;
  final byte[] block=this.data.block;
  final int lastShadow=this.last;
  for (int i=256; --i >= 0; )   inUse[i]=false;
  int rNToGo=0;
  int rTPos=0;
  for (int i=0, j=1; i <= lastShadow; i=j, j++) {
    if (rNToGo == 0) {
      rNToGo=(char)BZip2Constants.rNums[rTPos];
      if (++rTPos == 512) {
        rTPos=0;
      }
    }
    rNToGo--;
    block[j]^=((rNToGo == 1) ? 1 : 0);
    inUse[block[j] & 0xff]=true;
  }
  this.blockRandomised=true;
}
