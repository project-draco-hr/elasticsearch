{
  request.request().routing(state.metaData().resolveIndexRouting(request.request().routing(),request.request().index()));
  if (state.metaData().hasIndex(request.concreteIndex())) {
    MappingMetaData mappingMd=state.metaData().index(request.concreteIndex()).mappingOrDefault(request.request().type());
    if (mappingMd != null && mappingMd.routing().required()) {
      if (request.request().routing() == null) {
        if (request.request().versionType() != VersionType.INTERNAL) {
          throw new ElasticsearchIllegalArgumentException("routing value is required for deleting documents of type [" + request.request().type() + "] while using version_type ["+ request.request().versionType()+ "]");
        }
        throw new RoutingMissingException(request.concreteIndex(),request.request().type(),request.request().id());
      }
    }
  }
}
