{
  request.setRouting(state.metaData().resolveIndexRouting(request.getRouting(),request.getIndex()));
  request.setIndex(state.metaData().concreteIndex(request.getIndex()));
  if (state.metaData().hasIndex(request.getIndex())) {
    MappingMetaData mappingMd=state.metaData().index(request.getIndex()).mappingOrDefault(request.getType());
    if (mappingMd != null && mappingMd.routing().required()) {
      if (request.getRouting() == null) {
        indexDeleteAction.execute(new IndexDeleteRequest(request),new ActionListener<IndexDeleteResponse>(){
          @Override public void onResponse(          IndexDeleteResponse indexDeleteResponse){
            long version=0;
            boolean found=false;
            for (            ShardDeleteResponse deleteResponse : indexDeleteResponse.getResponses()) {
              if (!deleteResponse.isNotFound()) {
                found=true;
                version=deleteResponse.getVersion();
                break;
              }
            }
            listener.onResponse(new DeleteResponse(request.getIndex(),request.getType(),request.getId(),version,!found));
          }
          @Override public void onFailure(          Throwable e){
            listener.onFailure(e);
          }
        }
);
        return false;
      }
    }
  }
  return true;
}
