{
  boolean newMaster=!event.previousState().nodes().localNodeMaster();
  SnapshotMetaData snapshotMetaData=event.state().getMetaData().custom(SnapshotMetaData.TYPE);
  if (snapshotMetaData == null) {
    return false;
  }
  for (  SnapshotMetaData.Entry snapshot : snapshotMetaData.entries()) {
    if (newMaster && (snapshot.state() == State.SUCCESS || snapshot.state() == State.INIT)) {
      return true;
    }
    for (    DiscoveryNode node : event.nodesDelta().removedNodes()) {
      for (      ShardSnapshotStatus shardStatus : snapshot.shards().values()) {
        if (!shardStatus.state().completed() && node.getId().equals(shardStatus.nodeId())) {
          return true;
        }
      }
    }
  }
  return false;
}
