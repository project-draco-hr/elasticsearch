{
  Set<String> indices=null;
  for (  ImmutableMap.Entry<ShardId,SnapshotMetaData.ShardSnapshotStatus> entry : shards.entrySet()) {
    if (entry.getValue().state() == State.MISSING) {
      if (indices == null) {
        indices=newHashSet();
      }
      indices.add(entry.getKey().getIndex());
    }
  }
  return indices;
}
