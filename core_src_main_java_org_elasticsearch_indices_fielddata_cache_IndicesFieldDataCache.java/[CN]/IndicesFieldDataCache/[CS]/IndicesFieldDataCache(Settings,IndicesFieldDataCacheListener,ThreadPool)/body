{
  super(settings);
  this.threadPool=threadPool;
  this.indicesFieldDataCacheListener=indicesFieldDataCacheListener;
  final long sizeInBytes=INDICES_FIELDDATA_CACHE_SIZE_KEY.get(settings).bytes();
  CacheBuilder<Key,Accountable> cacheBuilder=CacheBuilder.<Key,Accountable>builder().removalListener(this);
  if (sizeInBytes > 0) {
    cacheBuilder.setMaximumWeight(sizeInBytes).weigher(new FieldDataWeigher());
  }
  logger.debug("using size [{}]",new ByteSizeValue(sizeInBytes));
  cache=cacheBuilder.build();
  this.cleanInterval=INDICES_FIELDDATA_CLEAN_INTERVAL_SETTING.get(settings);
  threadPool.schedule(this.cleanInterval,ThreadPool.Names.SAME,new FieldDataCacheCleaner(this.cache,this.logger,this.threadPool,this.cleanInterval));
}
