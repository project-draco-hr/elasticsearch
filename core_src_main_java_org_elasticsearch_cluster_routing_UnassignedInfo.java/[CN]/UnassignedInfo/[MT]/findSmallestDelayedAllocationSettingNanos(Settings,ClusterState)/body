{
  long minDelaySetting=Long.MAX_VALUE;
  for (  ShardRouting shard : state.routingTable().shardsWithState(ShardRoutingState.UNASSIGNED)) {
    if (shard.primary() == false) {
      IndexMetaData indexMetaData=state.metaData().index(shard.getIndexName());
      boolean delayed=shard.unassignedInfo().getLastComputedLeftDelayNanos() > 0;
      long delayTimeoutSetting=shard.unassignedInfo().getAllocationDelayTimeoutSettingNanos(settings,indexMetaData.getSettings());
      if (delayed && delayTimeoutSetting > 0 && delayTimeoutSetting < minDelaySetting) {
        minDelaySetting=delayTimeoutSetting;
      }
    }
  }
  return minDelaySetting == Long.MAX_VALUE ? 0l : minDelaySetting;
}
