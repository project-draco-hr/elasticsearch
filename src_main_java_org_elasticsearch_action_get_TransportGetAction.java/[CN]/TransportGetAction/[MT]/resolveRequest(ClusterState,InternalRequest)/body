{
  if (request.request().realtime == null) {
    request.request().realtime=this.realtime;
  }
  request.request().routing(state.metaData().resolveIndexRouting(request.request().routing(),request.request().index()));
  if (request.request().routing() == null && state.getMetaData().routingRequired(request.concreteIndex(),request.request().type())) {
    throw new RoutingMissingException(request.concreteIndex(),request.request().type(),request.request().id());
  }
}
