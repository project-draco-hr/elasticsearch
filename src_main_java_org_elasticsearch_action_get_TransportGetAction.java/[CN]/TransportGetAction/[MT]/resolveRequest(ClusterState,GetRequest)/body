{
  if (request.realtime == null) {
    request.realtime=this.realtime;
  }
  request.routing(state.metaData().resolveIndexRouting(request.routing(),request.index()));
  request.index(state.metaData().concreteIndex(request.index()));
  if (request.routing() == null && state.getMetaData().routingRequired(request.index(),request.type())) {
    throw new RoutingMissingException(request.index(),request.type(),request.id());
  }
}
