{
  try (XContentParser qSourceParser=XContentFactory.xContent(queryBuilder.source()).createParser(queryBuilder.source())){
    final QueryShardContext contextCopy=new QueryShardContext(context.index(),context.indexQueryParserService());
    contextCopy.reset(qSourceParser);
    QueryBuilder result=contextCopy.parseContext().parseInnerQueryBuilder();
    context.combineNamedQueries(contextCopy);
    Query expected=result.toQuery(context);
    if (expected != null) {
      expected.setBoost(AbstractQueryBuilder.DEFAULT_BOOST);
    }
    assertThat(query,equalTo(expected));
  }
 }
