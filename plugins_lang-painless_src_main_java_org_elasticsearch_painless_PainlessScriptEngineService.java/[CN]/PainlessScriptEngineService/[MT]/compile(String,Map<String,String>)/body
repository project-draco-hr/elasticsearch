{
  final CompilerSettings compilerSettings;
  if (params.isEmpty()) {
    compilerSettings=DEFAULT_COMPILER_SETTINGS;
  }
 else {
    compilerSettings=new CompilerSettings();
    Map<String,String> copy=new HashMap<>(params);
    String value=copy.remove(CompilerSettings.NUMERIC_OVERFLOW);
    if (value != null) {
      compilerSettings.setNumericOverflow(Boolean.parseBoolean(value));
    }
    value=copy.remove(CompilerSettings.MAX_LOOP_COUNTER);
    if (value != null) {
      compilerSettings.setMaxLoopCounter(Integer.parseInt(value));
    }
    if (!copy.isEmpty()) {
      throw new IllegalArgumentException("Unrecognized compile-time parameter(s): " + copy);
    }
  }
  final SecurityManager sm=System.getSecurityManager();
  if (sm != null) {
    sm.checkPermission(new SpecialPermission());
  }
  final Compiler.Loader loader=AccessController.doPrivileged(new PrivilegedAction<Compiler.Loader>(){
    @Override public Compiler.Loader run(){
      return new Compiler.Loader(getClass().getClassLoader());
    }
  }
);
  return AccessController.doPrivileged(new PrivilegedAction<Executable>(){
    @Override public Executable run(){
      return Compiler.compile(loader,"unknown",script,definition,compilerSettings);
    }
  }
,COMPILATION_CONTEXT);
}
