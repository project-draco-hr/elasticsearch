{
  List<String> nodesIds=internalCluster().startNodesAsync(2).get();
  final String node_1=nodesIds.get(0);
  final String node_2=nodesIds.get(1);
  ClusterHealthResponse clusterHealth=client().admin().cluster().prepareHealth().setWaitForGreenStatus().setWaitForNodes("2").get();
  logger.info("--> done cluster_health, status " + clusterHealth.getStatus());
  String server1NodeId=internalCluster().getInstance(ClusterService.class,node_1).state().nodes().localNodeId();
  String server2NodeId=internalCluster().getInstance(ClusterService.class,node_2).state().nodes().localNodeId();
  logger.info("--> started nodes: " + server1NodeId + " and "+ server2NodeId);
  NodesInfoResponse response=client().admin().cluster().prepareNodesInfo().execute().actionGet();
  assertThat(response.getNodes().length,is(2));
  assertThat(response.getNodesMap().get(server1NodeId),notNullValue());
  assertThat(response.getNodesMap().get(server2NodeId),notNullValue());
  response=client().admin().cluster().nodesInfo(nodesInfoRequest()).actionGet();
  assertThat(response.getNodes().length,is(2));
  assertThat(response.getNodesMap().get(server1NodeId),notNullValue());
  assertThat(response.getNodesMap().get(server2NodeId),notNullValue());
  response=client().admin().cluster().nodesInfo(nodesInfoRequest(server1NodeId)).actionGet();
  assertThat(response.getNodes().length,is(1));
  assertThat(response.getNodesMap().get(server1NodeId),notNullValue());
  response=client().admin().cluster().nodesInfo(nodesInfoRequest(server1NodeId)).actionGet();
  assertThat(response.getNodes().length,is(1));
  assertThat(response.getNodesMap().get(server1NodeId),notNullValue());
  response=client().admin().cluster().nodesInfo(nodesInfoRequest(server2NodeId)).actionGet();
  assertThat(response.getNodes().length,is(1));
  assertThat(response.getNodesMap().get(server2NodeId),notNullValue());
  response=client().admin().cluster().nodesInfo(nodesInfoRequest(server2NodeId)).actionGet();
  assertThat(response.getNodes().length,is(1));
  assertThat(response.getNodesMap().get(server2NodeId),notNullValue());
}
