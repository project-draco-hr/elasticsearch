{
  String indexName="index-0.90.6";
  loadIndex(indexName);
  assertMinVersion(indexName,org.apache.lucene.util.Version.parse("4.5.1"));
  UpgradeIT.assertNotUpgraded(client(),indexName);
  assertTrue(UpgradeIT.hasAncientSegments(client(),indexName));
  assertNoFailures(client().admin().indices().prepareUpgrade(indexName).setUpgradeOnlyAncientSegments(true).get());
  assertFalse(UpgradeIT.hasAncientSegments(client(),indexName));
  UpgradeIT.assertUpgraded(client(),indexName);
  assertEquals(Version.CURRENT.luceneVersion.toString(),client().admin().indices().prepareGetSettings(indexName).get().getSetting(indexName,IndexMetaData.SETTING_VERSION_MINIMUM_COMPATIBLE));
  assertMinVersion(indexName,Version.CURRENT.luceneVersion);
  assertEquals(client().admin().indices().prepareGetSettings(indexName).get().getSetting(indexName,IndexMetaData.SETTING_VERSION_UPGRADED),Integer.toString(Version.CURRENT.id));
}
