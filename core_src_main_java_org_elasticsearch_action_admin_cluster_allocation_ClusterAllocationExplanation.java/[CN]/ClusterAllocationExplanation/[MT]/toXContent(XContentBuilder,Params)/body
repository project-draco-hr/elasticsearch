{
  builder.startObject();
{
    builder.startObject("shard");
{
      builder.field("index",shard.getIndexName());
      builder.field("index_uuid",shard.getIndex().getUUID());
      builder.field("id",shard.getId());
      builder.field("primary",primary);
    }
    builder.endObject();
    builder.field("assigned",this.assignedNodeId != null);
    if (assignedNodeId != null) {
      builder.field("assigned_node_id",this.assignedNodeId);
    }
    if (unassignedInfo != null) {
      unassignedInfo.toXContent(builder,params);
      long delay=unassignedInfo.getLastComputedLeftDelayNanos();
      builder.field("allocation_delay",TimeValue.timeValueNanos(delay));
      builder.field("allocation_delay_ms",TimeValue.timeValueNanos(delay).millis());
      builder.field("remaining_delay",TimeValue.timeValueNanos(remainingDelayNanos));
      builder.field("remaining_delay_ms",TimeValue.timeValueNanos(remainingDelayNanos).millis());
    }
    builder.startObject("nodes");
    for (    Map.Entry<DiscoveryNode,Float> entry : nodeWeights.entrySet()) {
      DiscoveryNode node=entry.getKey();
      builder.startObject(node.getId());
{
        builder.field("node_name",node.getName());
        builder.startObject("node_attributes");
{
          for (          Map.Entry<String,String> attrEntry : node.getAttributes().entrySet()) {
            builder.field(attrEntry.getKey(),attrEntry.getValue());
          }
        }
        builder.endObject();
        Decision d=nodeToDecision.get(node);
        String finalDecision=node.getId().equals(assignedNodeId) ? "CURRENTLY_ASSIGNED" : d.type().toString();
        IndicesShardStoresResponse.StoreStatus storeStatus=getNodeStoreStatus().get(node);
        builder.startObject("store");
{
          if (storeStatus != null) {
            final Throwable storeErr=storeStatus.getStoreException();
            if (storeErr != null) {
              builder.field("store_exception",ExceptionsHelper.detailedMessage(storeErr));
              finalDecision="STORE_ERROR";
            }
            if (activeAllocationIds.isEmpty() || activeAllocationIds.contains(storeStatus.getAllocationId())) {
              builder.field("shard_copy",storeStatus.getAllocationStatus());
            }
 else {
              builder.field("shard_copy","STALE_COPY");
              finalDecision="STORE_STALE";
            }
          }
        }
        builder.endObject();
        builder.field("final_decision",finalDecision);
        builder.field("weight",entry.getValue());
        d.toXContent(builder,params);
      }
      builder.endObject();
    }
    builder.endObject();
  }
  builder.endObject();
  return builder;
}
