{
  boolean hasSameComparator=fromSortedSet || hasSameComparator(elements,comparator);
  if (hasSameComparator && (elements instanceof ImmutableSortedSet)) {
    @SuppressWarnings("unchecked") ImmutableSortedSet<E> result=(ImmutableSortedSet<E>)elements;
    if (!result.hasPartialArray()) {
      return result;
    }
  }
  Object[] array=newObjectArray(elements);
  if (array.length == 0) {
    return emptySet(comparator);
  }
  for (  Object e : array) {
    checkNotNull(e);
  }
  if (!hasSameComparator) {
    sort(array,comparator);
    array=removeDupes(array,comparator);
  }
  return new RegularImmutableSortedSet<E>(array,comparator);
}
