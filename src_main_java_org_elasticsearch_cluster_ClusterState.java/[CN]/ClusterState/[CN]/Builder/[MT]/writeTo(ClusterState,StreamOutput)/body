{
  if (out.getVersion().onOrAfter(Version.V_1_1_1)) {
    out.writeBoolean(state.clusterName != null);
    if (state.clusterName != null) {
      state.clusterName.writeTo(out);
    }
  }
  out.writeLong(state.version());
  MetaData.Builder.writeTo(state.metaData(),out);
  RoutingTable.Builder.writeTo(state.routingTable(),out);
  DiscoveryNodes.Builder.writeTo(state.nodes(),out);
  ClusterBlocks.Builder.writeClusterBlocks(state.blocks(),out);
  if (out.getVersion().before(Version.V_1_1_0)) {
    AllocationExplanation.EMPTY.writeTo(out);
  }
  out.writeVInt(state.customs().size());
  for (  ObjectObjectCursor<String,Custom> cursor : state.customs()) {
    out.writeString(cursor.key);
    lookupFactorySafe(cursor.key).writeTo(cursor.value,out);
  }
}
