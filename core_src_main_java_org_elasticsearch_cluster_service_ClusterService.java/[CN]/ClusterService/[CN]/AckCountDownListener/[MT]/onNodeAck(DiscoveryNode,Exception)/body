{
  if (!ackedTaskListener.mustAck(node)) {
    if (!node.equals(nodes.getMasterNode())) {
      return;
    }
  }
  if (e == null) {
    logger.trace("ack received from node [{}], cluster_state update (version: {})",node,clusterStateVersion);
  }
 else {
    this.lastFailure=e;
    logger.debug(new ParameterizedMessage("ack received from node [{}], cluster_state update (version: {})",node,clusterStateVersion),e);
  }
  if (countDown.countDown()) {
    logger.trace("all expected nodes acknowledged cluster_state update (version: {})",clusterStateVersion);
    FutureUtils.cancel(ackTimeoutCallback);
    ackedTaskListener.onAllNodesAcked(lastFailure);
  }
}
