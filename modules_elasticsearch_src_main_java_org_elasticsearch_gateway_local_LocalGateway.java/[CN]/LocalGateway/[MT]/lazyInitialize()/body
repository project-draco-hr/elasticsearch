{
  if (initialized) {
    return;
  }
  initialized=true;
  if (!clusterService.localNode().masterNode() && !clusterService.localNode().dataNode()) {
    location=null;
  }
 else {
    this.location=new File(nodeEnv.nodeDataLocations()[0],"_state");
    FileSystemUtils.mkdirs(this.location);
    if (clusterService.localNode().masterNode()) {
      try {
        long version=findLatestMetaStateVersion();
        if (version != -1) {
          File file=new File(location,"metadata-" + version);
          logger.debug("[find_latest_state]: loading metadata from [{}]",file.getAbsolutePath());
          this.currentMetaState=readMetaState(Streams.copyToByteArray(new FileInputStream(file)));
        }
 else {
          logger.debug("[find_latest_state]: no metadata state loaded");
        }
      }
 catch (      Exception e) {
        logger.warn("failed to read local state (metadata)",e);
      }
    }
    if (clusterService.localNode().dataNode()) {
      try {
        long version=findLatestStartedShardsVersion();
        if (version != -1) {
          File file=new File(location,"shards-" + version);
          logger.debug("[find_latest_state]: loading started shards from [{}]",file.getAbsolutePath());
          this.currentStartedShards=readStartedShards(Streams.copyToByteArray(new FileInputStream(file)));
        }
 else {
          logger.debug("[find_latest_state]: no started shards loaded");
        }
      }
 catch (      Exception e) {
        logger.warn("failed to read local state (started shards)",e);
      }
    }
  }
}
