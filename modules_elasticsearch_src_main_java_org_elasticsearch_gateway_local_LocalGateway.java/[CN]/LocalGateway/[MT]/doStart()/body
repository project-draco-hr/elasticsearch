{
  if (!clusterService.state().nodes().localNode().masterNode() || !clusterService.state().nodes().localNode().dataNode()) {
    location=null;
    return;
  }
  this.location=new File(nodeEnv.nodeFile(),"_state");
  this.location.mkdirs();
  try {
    long version=findLatestStateVersion();
    if (version != -1) {
      this.currentState=readState(Streams.copyToByteArray(new FileInputStream(new File(location,"state-" + version))));
    }
  }
 catch (  Exception e) {
    logger.warn("failed to read local state",e);
  }
  clusterService.add(this);
}
