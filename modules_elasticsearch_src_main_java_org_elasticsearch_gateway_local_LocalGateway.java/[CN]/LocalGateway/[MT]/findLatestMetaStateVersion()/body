{
  long index=-1;
  for (  File stateFile : location.listFiles()) {
    if (logger.isTraceEnabled()) {
      logger.trace("[findLatestState]: Processing [" + stateFile.getName() + "]");
    }
    String name=stateFile.getName();
    if (!name.startsWith("metadata-")) {
      continue;
    }
    long fileIndex=Long.parseLong(name.substring(name.indexOf('-') + 1));
    if (fileIndex >= index) {
      try {
        byte[] data=Streams.copyToByteArray(new FileInputStream(stateFile));
        if (data.length == 0) {
          logger.debug("[findLatestState]: not data for [" + name + "], ignoring...");
          continue;
        }
        readMetaState(data);
        index=fileIndex;
      }
 catch (      IOException e) {
        logger.warn("[findLatestState]: Failed to read state from [" + name + "], ignoring...",e);
      }
    }
  }
  return index;
}
