{
  DiscoveryNodes.Builder discoBuilder=DiscoveryNodes.builder();
  for (  DiscoveryNode node : allNodes) {
    discoBuilder.put(node);
  }
  if (masterNode != null) {
    discoBuilder.masterNodeId(masterNode.id());
  }
  discoBuilder.localNodeId(localNode.id());
  ClusterState.Builder state=ClusterState.builder(new ClusterName("test"));
  state.nodes(discoBuilder);
  state.metaData(MetaData.builder().generateClusterUuidIfNeeded());
  return state.build();
}
