{
  AnalyzingCompletionLookupProvider provider=new AnalyzingCompletionLookupProvider(true,false,true,true);
  RAMDirectory dir=new RAMDirectory();
  IndexOutput output=dir.createOutput("foo.txt",IOContext.DEFAULT);
  FieldsConsumer consumer=provider.consumer(output);
  consumer.write(new Fields(){
    @Override public Iterator<String> iterator(){
      return Arrays.asList("foo").iterator();
    }
    @Override public Terms terms(    String field) throws IOException {
      return null;
    }
    @Override public int size(){
      return 1;
    }
  }
);
  consumer.close();
  output.close();
  IndexInput input=dir.openInput("foo.txt",IOContext.DEFAULT);
  LookupFactory load=provider.load(input);
  CompletionFieldMapper.CompletionFieldType fieldType=FIELD_TYPE.clone();
  fieldType.setProvider(provider);
  assertNull(load.getLookup(fieldType,new CompletionSuggestionContext(null)));
  dir.close();
}
