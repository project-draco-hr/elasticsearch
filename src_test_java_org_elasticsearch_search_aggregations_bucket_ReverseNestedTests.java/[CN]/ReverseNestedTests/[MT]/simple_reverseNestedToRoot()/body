{
  SearchResponse response=client().prepareSearch("idx").setTypes("type1").addAggregation(nested("nested1").path("nested1").subAggregation(terms("field2").field("nested1.field2").subAggregation(reverseNested("nested1_to_field1").subAggregation(terms("field1").field("field1").collectMode(randomFrom(SubAggCollectionMode.values())))))).get();
  verifyResults(response);
}
