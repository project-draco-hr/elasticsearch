{
  SearchResponse response=client().prepareSearch("idx").addAggregation(nested("nested1").path("nested1.nested2").subAggregation(terms("field2").field("nested1.nested2.field2").collectMode(randomFrom(SubAggCollectionMode.values())).subAggregation(reverseNested("nested1_to_field1").path("nested1").subAggregation(terms("field1").field("nested1.field1").collectMode(randomFrom(SubAggCollectionMode.values())))))).get();
  verifyResults(response);
}
