{
  if (before == null) {
    throw new IllegalArgumentException(error("Illegal array access made without target."));
  }
  final Sort sort=before.sort;
  if (sort == Sort.ARRAY) {
    index.expected=Definition.INT_TYPE;
    index.analyze(variables);
    index=index.cast(variables);
    after=Definition.getType(before.struct,before.dimensions - 1);
    return this;
  }
 else   if (sort == Sort.DEF) {
    return new LDefArray(line,offset,location,index).copy(this).analyze(variables);
  }
 else   if (Map.class.isAssignableFrom(before.clazz)) {
    return new LMapShortcut(line,offset,location,index).copy(this).analyze(variables);
  }
 else   if (List.class.isAssignableFrom(before.clazz)) {
    return new LListShortcut(line,offset,location,index).copy(this).analyze(variables);
  }
  throw new IllegalArgumentException(error("Illegal array access on type [" + before.name + "]."));
}
