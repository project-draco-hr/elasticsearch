{
  super.setUp();
  transport=new CapturingTransport();
  clusterService=createClusterService(threadPool);
  transportService=new TransportService(transport,threadPool,clusterService.state().getClusterName());
  transportService.start();
  transportService.acceptIncomingRequests();
  localNode=new DiscoveryNode("local_node",DummyTransportAddress.INSTANCE,Collections.emptyMap(),Collections.singleton(DiscoveryNode.Role.MASTER),Version.CURRENT);
  remoteNode=new DiscoveryNode("remote_node",DummyTransportAddress.INSTANCE,Collections.emptyMap(),Collections.singleton(DiscoveryNode.Role.MASTER),Version.CURRENT);
  allNodes=new DiscoveryNode[]{localNode,remoteNode};
}
