{
  HashMap<String,T> builder=new HashMap<>();
  builder.putAll(map);
  for (  String part : deletes) {
    builder.remove(part);
  }
  for (  Map.Entry<String,Diff<T>> diff : diffs.entrySet()) {
    builder.put(diff.getKey(),diff.getValue().apply(builder.get(diff.getKey())));
  }
  for (  Map.Entry<String,T> additon : adds.entrySet()) {
    builder.put(additon.getKey(),additon.getValue());
  }
  return ImmutableMap.copyOf(builder);
}
