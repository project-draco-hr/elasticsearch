{
  if (sourceQuery instanceof SpanTermQuery) {
    super.flatten(new TermQuery(((SpanTermQuery)sourceQuery).getTerm()),reader,flatQueries);
  }
 else   if (sourceQuery instanceof ConstantScoreQuery) {
    flatten(((ConstantScoreQuery)sourceQuery).getQuery(),reader,flatQueries);
  }
 else   if (sourceQuery instanceof FunctionScoreQuery) {
    flatten(((FunctionScoreQuery)sourceQuery).getSubQuery(),reader,flatQueries);
  }
 else   if (sourceQuery instanceof FilteredQuery) {
    flatten(((FilteredQuery)sourceQuery).getQuery(),reader,flatQueries);
    flatten(((FilteredQuery)sourceQuery).getFilter(),reader,flatQueries);
  }
 else   if (sourceQuery instanceof MultiPhrasePrefixQuery) {
    flatten(sourceQuery.rewrite(reader),reader,flatQueries);
  }
 else   if (sourceQuery instanceof FiltersFunctionScoreQuery) {
    flatten(((FiltersFunctionScoreQuery)sourceQuery).getSubQuery(),reader,flatQueries);
  }
 else   if (sourceQuery instanceof MultiPhraseQuery) {
    MultiPhraseQuery q=((MultiPhraseQuery)sourceQuery);
    convertMultiPhraseQuery(0,new int[q.getTermArrays().size()],q,q.getTermArrays(),q.getPositions(),reader,flatQueries);
  }
 else   if (sourceQuery instanceof BlendedTermQuery) {
    final BlendedTermQuery blendedTermQuery=(BlendedTermQuery)sourceQuery;
    flatten(blendedTermQuery.rewrite(reader),reader,flatQueries);
  }
 else {
    super.flatten(sourceQuery,reader,flatQueries);
  }
}
