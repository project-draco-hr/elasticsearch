{
  builder.startObject();
  if (ranges.isEmpty()) {
    throw new SearchSourceBuilderException("at least one range must be defined for geo_distance aggregation [" + getName() + "]");
  }
  if (point == null) {
    throw new SearchSourceBuilderException("center point must be defined for geo_distance aggregation [" + getName() + "]");
  }
  if (field != null) {
    builder.field("field",field);
  }
  if (unit != null) {
    builder.field("unit",unit);
  }
  if (distanceType != null) {
    builder.field("distance_type",distanceType.name().toLowerCase(Locale.ROOT));
  }
  builder.startObject("center").field("lat",point.lat()).field("lon",point.lon()).endObject();
  builder.startArray("ranges");
  for (  Range range : ranges) {
    range.toXContent(builder,params);
  }
  builder.endArray();
  return builder.endObject();
}
