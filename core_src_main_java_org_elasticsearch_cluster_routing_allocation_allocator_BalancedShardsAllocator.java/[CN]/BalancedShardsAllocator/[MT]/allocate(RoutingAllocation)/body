{
  if (allocation.routingNodes().size() == 0) {
    return false;
  }
  final Balancer balancer=new Balancer(logger,allocation,weightFunction,threshold);
  boolean changed=balancer.allocateUnassigned();
  changed|=balancer.moveShards();
  changed|=balancer.balance();
  return changed;
}
