{
  QueryShardContext shardContext=createShardContext();
  HasChildQueryBuilder hasChildQueryBuilder=new HasChildQueryBuilder(CHILD_TYPE,new TermQueryBuilder("custom_string","value"));
  HasChildQueryBuilder.LateParsingQuery query=(HasChildQueryBuilder.LateParsingQuery)hasChildQueryBuilder.toQuery(shardContext);
  Similarity expected=SimilarityService.BUILT_IN.get(similarity).apply(similarity,Settings.EMPTY).get();
  assertThat(((PerFieldSimilarityWrapper)query.getSimilarity()).get("custom_string"),instanceOf(expected.getClass()));
}
