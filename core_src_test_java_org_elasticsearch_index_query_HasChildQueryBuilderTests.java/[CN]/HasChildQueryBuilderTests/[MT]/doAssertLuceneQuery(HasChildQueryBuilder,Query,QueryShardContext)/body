{
  QueryBuilder innerQueryBuilder=queryBuilder.query();
  if (innerQueryBuilder instanceof EmptyQueryBuilder) {
    assertNull(query);
  }
 else   if (context.indexVersionCreated().onOrAfter(Version.V_2_0_0_beta1)) {
    assertThat(query,instanceOf(HasChildQueryBuilder.LateParsingQuery.class));
    HasChildQueryBuilder.LateParsingQuery lpq=(HasChildQueryBuilder.LateParsingQuery)query;
    assertEquals(queryBuilder.minChildren(),lpq.getMinChildren());
    assertEquals(queryBuilder.maxChildren(),lpq.getMaxChildren());
    assertEquals(HasChildQueryBuilder.scoreTypeToScoreMode(queryBuilder.scoreType()),lpq.getScoreMode());
  }
 else {
    assertThat(query,instanceOf(ChildrenQuery.class));
    ChildrenQuery lpq=(ChildrenQuery)query;
    assertEquals(queryBuilder.minChildren(),lpq.getMinChildren());
    assertEquals(queryBuilder.maxChildren(),lpq.getMaxChildren());
    assertEquals(queryBuilder.scoreType(),lpq.getScoreType());
    assertEquals(queryBuilder.shortCircuitCutoff(),lpq.getShortCircuitParentDocSet());
  }
  if (queryBuilder.innerHit() != null) {
    assertNotNull(SearchContext.current());
    if (query != null) {
      assertNotNull(SearchContext.current().innerHits());
      assertEquals(1,SearchContext.current().innerHits().getInnerHits().size());
      assertTrue(SearchContext.current().innerHits().getInnerHits().containsKey("inner_hits_name"));
      InnerHitsContext.BaseInnerHits innerHits=SearchContext.current().innerHits().getInnerHits().get("inner_hits_name");
      assertEquals(innerHits.size(),100);
      assertEquals(innerHits.sort().getSort().length,1);
      assertEquals(innerHits.sort().getSort()[0].getField(),STRING_FIELD_NAME);
    }
 else {
      assertNull(SearchContext.current().innerHits());
    }
  }
}
