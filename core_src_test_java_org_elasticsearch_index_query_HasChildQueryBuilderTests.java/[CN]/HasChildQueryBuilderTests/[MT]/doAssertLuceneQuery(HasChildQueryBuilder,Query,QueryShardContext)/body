{
  QueryBuilder<?> innerQueryBuilder=queryBuilder.query();
  if (innerQueryBuilder instanceof EmptyQueryBuilder) {
    assertNull(query);
  }
 else {
    assertThat(query,instanceOf(HasChildQueryBuilder.LateParsingQuery.class));
    HasChildQueryBuilder.LateParsingQuery lpq=(HasChildQueryBuilder.LateParsingQuery)query;
    assertEquals(queryBuilder.minChildren(),lpq.getMinChildren());
    assertEquals(queryBuilder.maxChildren(),lpq.getMaxChildren());
    assertEquals(queryBuilder.scoreMode(),lpq.getScoreMode());
  }
  if (queryBuilder.innerHit() != null) {
    assertNotNull(SearchContext.current());
    if (query != null) {
      assertNotNull(SearchContext.current().innerHits());
      assertEquals(1,SearchContext.current().innerHits().getInnerHits().size());
      assertTrue(SearchContext.current().innerHits().getInnerHits().containsKey(queryBuilder.innerHit().getName()));
      InnerHitsContext.BaseInnerHits innerHits=SearchContext.current().innerHits().getInnerHits().get(queryBuilder.innerHit().getName());
      assertEquals(innerHits.size(),queryBuilder.innerHit().getSize());
      assertEquals(innerHits.sort().getSort().length,1);
      assertEquals(innerHits.sort().getSort()[0].getField(),STRING_FIELD_NAME_2);
    }
 else {
      assertThat(SearchContext.current().innerHits().getInnerHits().size(),equalTo(0));
    }
  }
}
