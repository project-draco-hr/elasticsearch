{
  if (lastSettingsApplied != null && newSettings.equals(lastSettingsApplied)) {
    return newSettings;
  }
  final Settings current=Settings.builder().put(this.settings).put(newSettings).build();
  final Settings previous=Settings.builder().put(this.settings).put(this.lastSettingsApplied).build();
  try {
    List<Runnable> applyRunnables=new ArrayList<>();
    for (    SettingUpdater<?> settingUpdater : settingUpdaters) {
      try {
        applyRunnables.add(settingUpdater.updater(current,previous));
      }
 catch (      Exception ex) {
        logger.warn("failed to prepareCommit settings for [{}]",ex,settingUpdater);
        throw ex;
      }
    }
    for (    Runnable settingUpdater : applyRunnables) {
      settingUpdater.run();
    }
  }
 catch (  Exception ex) {
    logger.warn("failed to apply settings",ex);
    throw ex;
  }
 finally {
  }
  return lastSettingsApplied=newSettings;
}
