{
  String mapping=XContentFactory.jsonBuilder().startObject().startObject("bar").startObject("properties").endObject().endObject().endObject().string();
  prepareCreate("foo",2,ImmutableSettings.builder().put("index.number_of_replicas",0).put("index.number_of_shards",2)).addMapping("bar",mapping).execute().actionGet();
  ensureGreen();
  client().prepareIndex("foo","bar","1").setSource(jsonBuilder().startObject().startObject("foo").field("bar","boz").endObject()).setRouting("4000").execute().actionGet();
  client().admin().indices().prepareRefresh("foo").execute().actionGet();
  SearchResponse searchResponse=client().prepareMoreLikeThis("foo","bar","1").setRouting("4000").execute().actionGet();
  assertNoFailures(searchResponse);
  assertThat(searchResponse,notNullValue());
}
