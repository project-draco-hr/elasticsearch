{
  IndexSettingsService service=new IndexSettingsService(new Index("test"),EMPTY_SETTINGS);
  LogDocMergePolicyProvider mp=new LogDocMergePolicyProvider(createStore(EMPTY_SETTINGS),service);
  assertEquals(mp.getMergePolicy().getMaxMergeDocs(),LogDocMergePolicy.DEFAULT_MAX_MERGE_DOCS);
  service.refreshSettings(Settings.builder().put(LogDocMergePolicyProvider.INDEX_MERGE_POLICY_MAX_MERGE_DOCS,LogDocMergePolicy.DEFAULT_MAX_MERGE_DOCS / 2).build());
  assertEquals(mp.getMergePolicy().getMaxMergeDocs(),LogDocMergePolicy.DEFAULT_MAX_MERGE_DOCS / 2);
  assertEquals(mp.getMergePolicy().getMinMergeDocs(),LogDocMergePolicy.DEFAULT_MIN_MERGE_DOCS);
  service.refreshSettings(Settings.builder().put(LogDocMergePolicyProvider.INDEX_MERGE_POLICY_MIN_MERGE_DOCS,LogDocMergePolicy.DEFAULT_MIN_MERGE_DOCS / 2).build());
  assertEquals(mp.getMergePolicy().getMinMergeDocs(),LogDocMergePolicy.DEFAULT_MIN_MERGE_DOCS / 2);
  assertTrue(mp.getMergePolicy().getCalibrateSizeByDeletes());
  service.refreshSettings(Settings.builder().put(LogDocMergePolicyProvider.INDEX_MERGE_POLICY_CALIBRATE_SIZE_BY_DELETES,false).build());
  assertFalse(mp.getMergePolicy().getCalibrateSizeByDeletes());
  assertEquals(mp.getMergePolicy().getMergeFactor(),LogDocMergePolicy.DEFAULT_MERGE_FACTOR);
  service.refreshSettings(Settings.builder().put(LogDocMergePolicyProvider.INDEX_MERGE_POLICY_MERGE_FACTOR,LogDocMergePolicy.DEFAULT_MERGE_FACTOR * 2).build());
  assertEquals(mp.getMergePolicy().getMergeFactor(),LogDocMergePolicy.DEFAULT_MERGE_FACTOR * 2);
  service.refreshSettings(EMPTY_SETTINGS);
  assertEquals(mp.getMergePolicy().getMaxMergeDocs(),LogDocMergePolicy.DEFAULT_MAX_MERGE_DOCS / 2);
  assertEquals(mp.getMergePolicy().getMinMergeDocs(),LogDocMergePolicy.DEFAULT_MIN_MERGE_DOCS / 2);
  assertFalse(mp.getMergePolicy().getCalibrateSizeByDeletes());
  assertEquals(mp.getMergePolicy().getMergeFactor(),LogByteSizeMergePolicy.DEFAULT_MERGE_FACTOR * 2);
  service=new IndexSettingsService(new Index("test"),EMPTY_SETTINGS);
  mp=new LogDocMergePolicyProvider(createStore(Settings.builder().put(LogDocMergePolicyProvider.INDEX_MERGE_POLICY_MAX_MERGE_DOCS,LogByteSizeMergePolicy.DEFAULT_MAX_MERGE_DOCS / 2).put(LogDocMergePolicyProvider.INDEX_MERGE_POLICY_MERGE_FACTOR,LogByteSizeMergePolicy.DEFAULT_MERGE_FACTOR / 2).put(LogDocMergePolicyProvider.INDEX_MERGE_POLICY_CALIBRATE_SIZE_BY_DELETES,false).put(LogDocMergePolicyProvider.INDEX_MERGE_POLICY_MIN_MERGE_DOCS,LogDocMergePolicy.DEFAULT_MIN_MERGE_DOCS - 1).build()),service);
  assertEquals(mp.getMergePolicy().getMinMergeDocs(),LogDocMergePolicy.DEFAULT_MIN_MERGE_DOCS - 1);
  assertFalse(mp.getMergePolicy().getCalibrateSizeByDeletes());
  assertEquals(mp.getMergePolicy().getMergeFactor(),LogByteSizeMergePolicy.DEFAULT_MERGE_FACTOR / 2);
  assertEquals(mp.getMergePolicy().getMaxMergeDocs(),LogByteSizeMergePolicy.DEFAULT_MAX_MERGE_DOCS / 2);
}
