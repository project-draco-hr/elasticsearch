{
  final Map<ShardId,FilterCacheStats> stats=new HashMap<>();
  for (  Map.Entry<ShardId,Stats> entry : shardStats.entrySet()) {
    stats.put(entry.getKey(),entry.getValue().toQueryCacheStats());
  }
  FilterCacheStats shardStats=new FilterCacheStats();
  FilterCacheStats info=stats.get(shard);
  if (info == null) {
    info=new FilterCacheStats();
  }
  shardStats.add(info);
  long totalSize=0;
  for (  FilterCacheStats s : stats.values()) {
    totalSize+=s.getCacheSize();
  }
  final double weight=totalSize == 0 ? 1d / stats.size() : shardStats.getCacheSize() / totalSize;
  final long additionalRamBytesUsed=Math.round(weight * sharedRamBytesUsed);
  shardStats.add(new FilterCacheStats(additionalRamBytesUsed,0,0,0,0));
  return shardStats;
}
