{
  createIndex("foo");
  ClusterUpdateSettingsResponse updateSettingsResponse=client().admin().cluster().prepareUpdateSettings().setTransientSettings(ImmutableSettings.settingsBuilder().put("cluster.blocks.read_only",true).build()).get();
  assertThat(updateSettingsResponse.isAcknowledged(),is(true));
  UpdateSettingsResponse indexSettingsResponse=client().admin().indices().prepareUpdateSettings("foo").setSettings(ImmutableSettings.settingsBuilder().put("index.blocks.read_only",true)).get();
  assertThat(indexSettingsResponse.isAcknowledged(),is(true));
  ClusterStateResponse clusterStateResponseUnfiltered=client().admin().cluster().prepareState().clear().setBlocks(true).get();
  assertThat(clusterStateResponseUnfiltered.getState().blocks().global(),hasSize(1));
  assertThat(clusterStateResponseUnfiltered.getState().blocks().indices().size(),is(1));
  ClusterStateResponse clusterStateResponse=client().admin().cluster().prepareState().clear().get();
  assertThat(clusterStateResponse.getState().blocks().global(),hasSize(0));
  assertThat(clusterStateResponse.getState().blocks().indices().size(),is(0));
  assertAcked(client().admin().cluster().prepareUpdateSettings().setTransientSettings(ImmutableSettings.settingsBuilder().put("cluster.blocks.read_only",false).build()).get());
}
