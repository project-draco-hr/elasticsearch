{
  String[] nodesIds=Strings.splitStringByCommaToArray(request.param("nodeId"));
  NodesShutdownRequest nodesShutdownRequest=new NodesShutdownRequest(nodesIds);
  nodesShutdownRequest.listenerThreaded(false);
  nodesShutdownRequest.delay(request.paramAsTime("delay",nodesShutdownRequest.delay()));
  nodesShutdownRequest.exit(request.paramAsBoolean("exit",nodesShutdownRequest.exit()));
  client.admin().cluster().nodesShutdown(nodesShutdownRequest,new RestBuilderListener<NodesShutdownResponse>(channel){
    @Override public RestResponse buildResponse(    NodesShutdownResponse response,    XContentBuilder builder) throws Exception {
      builder.startObject();
      builder.field("cluster_name",response.getClusterName().value());
      builder.startObject("nodes");
      for (      DiscoveryNode node : response.getNodes()) {
        builder.startObject(node.id(),XContentBuilder.FieldCaseConversion.NONE);
        builder.field("name",node.name(),XContentBuilder.FieldCaseConversion.NONE);
        builder.endObject();
      }
      builder.endObject();
      builder.endObject();
      return new BytesRestResponse(RestStatus.OK,builder);
    }
  }
);
}
