{
  int shardId=Math.abs(hash(type,id)) % indexMetaData(clusterState).numberOfShards();
  IndexShardRoutingTable indexShard=indexRoutingTable(clusterState).shard(shardId);
  if (indexShard == null) {
    throw new IndexShardMissingException(new ShardId(index,shardId));
  }
  return indexShard;
}
