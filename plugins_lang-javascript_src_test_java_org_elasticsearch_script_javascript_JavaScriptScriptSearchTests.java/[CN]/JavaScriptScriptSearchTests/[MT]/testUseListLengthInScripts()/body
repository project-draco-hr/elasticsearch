{
  createIndex("index");
  index("index","testtype","1",jsonBuilder().startObject().field("f",42).endObject());
  ensureSearchable("index");
  refresh();
  SearchResponse response=client().prepareSearch().addScriptField("foobar",new Script("doc['f'].values.length",ScriptService.ScriptType.INLINE,"js",null)).get();
  assertSearchResponse(response);
  assertHitCount(response,1);
  assertThat((Integer)response.getHits().getAt(0).getFields().get("foobar").value(),equalTo(1));
}
