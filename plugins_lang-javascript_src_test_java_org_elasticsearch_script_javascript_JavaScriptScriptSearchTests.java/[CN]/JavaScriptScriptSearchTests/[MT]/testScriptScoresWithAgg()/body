{
  createIndex("index");
  ensureYellow();
  index("index","testtype","1",jsonBuilder().startObject().field("dummy_field",1).endObject());
  refresh();
  SearchResponse response=client().search(searchRequest().source(searchSource().query(functionScoreQuery().add(scriptFunction("_score.doubleValue()").lang("js"))).aggregation(terms("score_agg").script("_score.doubleValue()").lang("js")))).actionGet();
  assertSearchResponse(response);
  assertThat(response.getHits().getAt(0).score(),equalTo(1.0f));
  assertThat(((Terms)response.getAggregations().asMap().get("score_agg")).getBuckets().get(0).getKeyAsNumber().floatValue(),is(1f));
  assertThat(((Terms)response.getAggregations().asMap().get("score_agg")).getBuckets().get(0).getDocCount(),is(1l));
}
