{
  XContentBuilder source=jsonBuilder().startObject().startObject("doc").field("field1","value1").endObject().endObject();
  Mockito.when(request.source()).thenReturn(source.bytes());
  PercolateContext context=new PercolateContext(request,new SearchShardTarget("_node","_index",0),mapperService);
  ParsedDocument parsedDocument=parser.parse(request,context,mapperService,queryShardContext);
  assertThat(parsedDocument.rootDoc().get("field1"),equalTo("value1"));
}
