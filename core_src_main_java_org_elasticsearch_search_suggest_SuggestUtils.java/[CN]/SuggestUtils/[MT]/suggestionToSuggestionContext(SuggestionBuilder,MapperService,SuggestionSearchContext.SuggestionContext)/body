{
  String analyzerName=suggestionBuilder.analyzer();
  if (analyzerName != null) {
    Analyzer analyzer=mapperService.analysisService().analyzer(analyzerName);
    if (analyzer == null) {
      throw new IllegalArgumentException("Analyzer [" + analyzerName + "] doesn't exists");
    }
    suggestionContext.setAnalyzer(analyzer);
  }
  if (suggestionBuilder.field() != null) {
    suggestionContext.setField(suggestionBuilder.field());
  }
  if (suggestionBuilder.size() != null) {
    suggestionContext.setSize(suggestionBuilder.size());
  }
  if (suggestionBuilder.shardSize() != null) {
    suggestionContext.setShardSize(suggestionBuilder.shardSize());
  }
 else {
    suggestionContext.setShardSize(Math.max(suggestionContext.getSize(),5));
  }
  String text=suggestionBuilder.text();
  if (text != null) {
    suggestionContext.setText(BytesRefs.toBytesRef(text));
  }
  String prefix=suggestionBuilder.prefix();
  if (prefix != null) {
    suggestionContext.setText(BytesRefs.toBytesRef(prefix));
  }
  String regex=suggestionBuilder.regex();
  if (regex != null) {
    suggestionContext.setText(BytesRefs.toBytesRef(regex));
  }
  if (text != null && prefix == null) {
    suggestionContext.setPrefix(BytesRefs.toBytesRef(text));
  }
 else   if (text == null && prefix != null) {
    suggestionContext.setText(BytesRefs.toBytesRef(prefix));
  }
 else   if (text == null && regex != null) {
    suggestionContext.setText(BytesRefs.toBytesRef(regex));
  }
}
