{
  if (randomBoolean()) {
    SearchRequestBuilder builder=client().prepareSearch().setSize(0);
    if (suggestText != null) {
      builder.setSuggestText(suggestText);
    }
    for (    SuggestionBuilder<?> suggestion : suggestions) {
      builder.addSuggestion(suggestion);
    }
    SearchResponse actionGet=builder.execute().actionGet();
    assertThat(Arrays.toString(actionGet.getShardFailures()),actionGet.getFailedShards(),equalTo(expectShardsFailed));
    return actionGet.getSuggest();
  }
 else {
    SuggestRequestBuilder builder=client().prepareSuggest();
    if (suggestText != null) {
      builder.setSuggestText(suggestText);
    }
    for (    SuggestionBuilder<?> suggestion : suggestions) {
      builder.addSuggestion(suggestion);
    }
    SuggestResponse actionGet=builder.execute().actionGet();
    assertThat(Arrays.toString(actionGet.getShardFailures()),actionGet.getFailedShards(),equalTo(expectShardsFailed));
    if (expectShardsFailed > 0) {
      throw new SearchPhaseExecutionException("suggest","Suggest execution failed",new ShardSearchFailure[0]);
    }
    return actionGet.getSuggest();
  }
}
