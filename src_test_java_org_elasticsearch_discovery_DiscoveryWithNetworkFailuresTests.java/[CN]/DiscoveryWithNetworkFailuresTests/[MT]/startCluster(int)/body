{
  Settings settings=ImmutableSettings.builder().put("discovery.zen.ping_timeout","0.5s").put("discovery.zen.fd.ping_timeout","1s").put("discovery.zen.fd.ping_retries","1").put(DiscoverySettings.PUBLISH_TIMEOUT,"1s").put("http.enabled",false).put(TransportModule.TRANSPORT_SERVICE_TYPE_KEY,MockTransportService.class.getName()).put(ElectMasterService.DISCOVERY_ZEN_MINIMUM_MASTER_NODES,numberOfNodes / 2 + 1).build();
  if (discoveryConfig == null) {
    if (randomBoolean()) {
      discoveryConfig=new ClusterDiscoveryConfiguration.UnicastZen(numberOfNodes,numberOfNodes,settings);
    }
 else {
      discoveryConfig=new ClusterDiscoveryConfiguration(numberOfNodes,settings);
    }
  }
  List<String> nodes=internalCluster().startNodesAsync(numberOfNodes).get();
  ensureStableCluster(numberOfNodes);
  return nodes;
}
