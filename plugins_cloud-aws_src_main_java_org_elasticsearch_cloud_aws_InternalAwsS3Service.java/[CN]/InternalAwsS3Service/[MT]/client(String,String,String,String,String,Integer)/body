{
  if (region != null && endpoint == null) {
    endpoint=getEndpoint(region);
    logger.debug("using s3 region [{}], with endpoint [{}]",region,endpoint);
  }
 else   if (endpoint == null) {
    endpoint=getDefaultEndpoint();
  }
  if (account == null || key == null) {
    account=settings.get("cloud.aws.access_key",settings.get("cloud.account"));
    key=settings.get("cloud.aws.secret_key",settings.get("cloud.key"));
  }
  return getClient(endpoint,protocol,account,key,maxRetries);
}
