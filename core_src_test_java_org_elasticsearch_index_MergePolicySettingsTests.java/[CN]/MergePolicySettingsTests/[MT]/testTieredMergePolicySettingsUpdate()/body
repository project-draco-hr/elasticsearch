{
  MergePolicyConfig mp=new MergePolicyConfig(logger,indexSettings(EMPTY_SETTINGS));
  assertThat(mp.getMergePolicy().getNoCFSRatio(),equalTo(0.1));
  assertEquals(((TieredMergePolicy)mp.getMergePolicy()).getForceMergeDeletesPctAllowed(),MergePolicyConfig.DEFAULT_EXPUNGE_DELETES_ALLOWED,0.0d);
  IndexSettings indexSettings=indexSettings(Settings.EMPTY);
  indexSettings.updateIndexMetaData(newIndexMeta("index",Settings.builder().put(MergePolicyConfig.INDEX_MERGE_POLICY_EXPUNGE_DELETES_ALLOWED_SETTING.getKey(),MergePolicyConfig.DEFAULT_EXPUNGE_DELETES_ALLOWED + 1.0d).build()));
  assertEquals(((TieredMergePolicy)indexSettings.getMergePolicy()).getForceMergeDeletesPctAllowed(),MergePolicyConfig.DEFAULT_EXPUNGE_DELETES_ALLOWED + 1.0d,0.0d);
  assertEquals(((TieredMergePolicy)indexSettings.getMergePolicy()).getFloorSegmentMB(),MergePolicyConfig.DEFAULT_FLOOR_SEGMENT.mbFrac(),0);
  indexSettings.updateIndexMetaData(newIndexMeta("index",Settings.builder().put(MergePolicyConfig.INDEX_MERGE_POLICY_FLOOR_SEGMENT_SETTING.getKey(),new ByteSizeValue(MergePolicyConfig.DEFAULT_FLOOR_SEGMENT.mb() + 1,ByteSizeUnit.MB)).build()));
  assertEquals(((TieredMergePolicy)indexSettings.getMergePolicy()).getFloorSegmentMB(),new ByteSizeValue(MergePolicyConfig.DEFAULT_FLOOR_SEGMENT.mb() + 1,ByteSizeUnit.MB).mbFrac(),0.001);
  assertEquals(((TieredMergePolicy)indexSettings.getMergePolicy()).getMaxMergeAtOnce(),MergePolicyConfig.DEFAULT_MAX_MERGE_AT_ONCE);
  indexSettings.updateIndexMetaData(newIndexMeta("index",Settings.builder().put(MergePolicyConfig.INDEX_MERGE_POLICY_MAX_MERGE_AT_ONCE_SETTING.getKey(),MergePolicyConfig.DEFAULT_MAX_MERGE_AT_ONCE - 1).build()));
  assertEquals(((TieredMergePolicy)indexSettings.getMergePolicy()).getMaxMergeAtOnce(),MergePolicyConfig.DEFAULT_MAX_MERGE_AT_ONCE - 1);
  assertEquals(((TieredMergePolicy)mp.getMergePolicy()).getMaxMergeAtOnceExplicit(),MergePolicyConfig.DEFAULT_MAX_MERGE_AT_ONCE_EXPLICIT);
  mp.onRefreshSettings(Settings.builder().put(MergePolicyConfig.INDEX_MERGE_POLICY_MAX_MERGE_AT_ONCE_EXPLICIT,MergePolicyConfig.DEFAULT_MAX_MERGE_AT_ONCE_EXPLICIT - 1).build());
  assertEquals(((TieredMergePolicy)mp.getMergePolicy()).getMaxMergeAtOnceExplicit(),MergePolicyConfig.DEFAULT_MAX_MERGE_AT_ONCE_EXPLICIT - 1);
  assertEquals(((TieredMergePolicy)mp.getMergePolicy()).getMaxMergedSegmentMB(),MergePolicyConfig.DEFAULT_MAX_MERGED_SEGMENT.mbFrac(),0.0001);
  mp.onRefreshSettings(Settings.builder().put(MergePolicyConfig.INDEX_MERGE_POLICY_MAX_MERGED_SEGMENT,new ByteSizeValue(MergePolicyConfig.DEFAULT_MAX_MERGED_SEGMENT.bytes() + 1)).build());
  assertEquals(((TieredMergePolicy)mp.getMergePolicy()).getMaxMergedSegmentMB(),new ByteSizeValue(MergePolicyConfig.DEFAULT_MAX_MERGED_SEGMENT.bytes() + 1).mbFrac(),0.0001);
  assertEquals(((TieredMergePolicy)mp.getMergePolicy()).getReclaimDeletesWeight(),MergePolicyConfig.DEFAULT_RECLAIM_DELETES_WEIGHT,0);
  mp.onRefreshSettings(Settings.builder().put(MergePolicyConfig.INDEX_MERGE_POLICY_RECLAIM_DELETES_WEIGHT,MergePolicyConfig.DEFAULT_RECLAIM_DELETES_WEIGHT + 1).build());
  assertEquals(((TieredMergePolicy)mp.getMergePolicy()).getReclaimDeletesWeight(),MergePolicyConfig.DEFAULT_RECLAIM_DELETES_WEIGHT + 1,0);
  assertEquals(((TieredMergePolicy)mp.getMergePolicy()).getSegmentsPerTier(),MergePolicyConfig.DEFAULT_SEGMENTS_PER_TIER,0);
  mp.onRefreshSettings(Settings.builder().put(MergePolicyConfig.INDEX_MERGE_POLICY_SEGMENTS_PER_TIER,MergePolicyConfig.DEFAULT_SEGMENTS_PER_TIER + 1).build());
  assertEquals(((TieredMergePolicy)mp.getMergePolicy()).getSegmentsPerTier(),MergePolicyConfig.DEFAULT_SEGMENTS_PER_TIER + 1,0);
  mp.onRefreshSettings(EMPTY_SETTINGS);
  indexSettings.updateIndexMetaData(newIndexMeta("index",EMPTY_SETTINGS));
  assertEquals(((TieredMergePolicy)indexSettings.getMergePolicy()).getForceMergeDeletesPctAllowed(),MergePolicyConfig.DEFAULT_EXPUNGE_DELETES_ALLOWED,0.0d);
  assertEquals(((TieredMergePolicy)indexSettings.getMergePolicy()).getFloorSegmentMB(),new ByteSizeValue(MergePolicyConfig.DEFAULT_FLOOR_SEGMENT.mb(),ByteSizeUnit.MB).mbFrac(),0.00);
  assertEquals(((TieredMergePolicy)indexSettings.getMergePolicy()).getMaxMergeAtOnce(),MergePolicyConfig.DEFAULT_MAX_MERGE_AT_ONCE);
  assertEquals(((TieredMergePolicy)mp.getMergePolicy()).getMaxMergeAtOnceExplicit(),MergePolicyConfig.DEFAULT_MAX_MERGE_AT_ONCE_EXPLICIT - 1);
  assertEquals(((TieredMergePolicy)mp.getMergePolicy()).getMaxMergedSegmentMB(),new ByteSizeValue(MergePolicyConfig.DEFAULT_MAX_MERGED_SEGMENT.bytes() + 1).mbFrac(),0.0001);
  assertEquals(((TieredMergePolicy)mp.getMergePolicy()).getReclaimDeletesWeight(),MergePolicyConfig.DEFAULT_RECLAIM_DELETES_WEIGHT + 1,0);
  assertEquals(((TieredMergePolicy)mp.getMergePolicy()).getSegmentsPerTier(),MergePolicyConfig.DEFAULT_SEGMENTS_PER_TIER + 1,0);
}
