{
  MetaDataCreateIndexService createIndexService=new MetaDataCreateIndexService(Settings.EMPTY,null,null,null,null,null,Version.CURRENT,null,Sets.<IndexTemplateFilter>newHashSet(),null,null);
  MetaDataIndexTemplateService service=new MetaDataIndexTemplateService(Settings.EMPTY,null,createIndexService,null);
  PutRequest request=new PutRequest("test","test_shards");
  request.template("test_shards*");
  Map<String,Object> map=Maps.newHashMap();
  map.put(IndexMetaData.SETTING_NUMBER_OF_SHARDS,"0");
  request.settings(Settings.settingsBuilder().put(map).build());
  final List<Throwable> throwables=Lists.newArrayList();
  service.putTemplate(request,new MetaDataIndexTemplateService.PutListener(){
    @Override public void onResponse(    MetaDataIndexTemplateService.PutResponse response){
    }
    @Override public void onFailure(    Throwable t){
      throwables.add(t);
    }
  }
);
  assertEquals(throwables.size(),1);
  assertTrue(throwables.get(0) instanceof InvalidIndexTemplateException);
  assertTrue(throwables.get(0).getMessage().contains("index must have 1 or more primary shards"));
}
