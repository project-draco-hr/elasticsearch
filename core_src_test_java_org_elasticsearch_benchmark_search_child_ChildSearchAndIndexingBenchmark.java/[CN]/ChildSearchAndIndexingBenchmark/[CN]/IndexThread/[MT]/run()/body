{
  while (run) {
    int childIdLimit=PARENT_COUNT * NUM_CHILDREN_PER_PARENT;
    for (int childId=1; run && childId < childIdLimit; ) {
      try {
        for (int j=0; j < 8; j++) {
          GetResponse getResponse=client.prepareGet(indexName,"child",String.valueOf(++childId)).setFields("_source","_parent").setRouting("1").get();
          client.prepareIndex(indexName,"child",Integer.toString(childId) + "_" + j).setParent(getResponse.getField("_parent").getValue().toString()).setSource(getResponse.getSource()).get();
        }
        client.admin().indices().prepareRefresh(indexName).execute().actionGet();
        Thread.sleep(1000);
        if (childId % 500 == 0) {
          NodesStatsResponse statsResponse=client.admin().cluster().prepareNodesStats().clear().setIndices(true).execute().actionGet();
          System.out.println("Deleted docs: " + statsResponse.getAt(0).getIndices().getDocs().getDeleted());
        }
      }
 catch (      Throwable e) {
        e.printStackTrace();
      }
    }
  }
}
