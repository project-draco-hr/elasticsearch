{
  Map<String,Object> vars=new HashMap<>();
  vars.put("ctx",document.getSourceAndMetadata());
  CompiledScript compiledScript=scriptService.compile(script,ScriptContext.Standard.INGEST,emptyMap(),clusterService.state());
  ExecutableScript executableScript=scriptService.executable(compiledScript,vars);
  Object value=executableScript.run();
  if (field != null) {
    document.setFieldValue(field,value);
  }
}
