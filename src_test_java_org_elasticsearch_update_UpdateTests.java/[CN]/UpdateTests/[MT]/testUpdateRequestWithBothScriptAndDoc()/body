{
  createIndex();
  ensureGreen();
  try {
    client().prepareUpdate("test","type1","1").setDoc(XContentFactory.jsonBuilder().startObject().field("field",1).endObject()).setInlineScript("ctx._source.field += 1").execute().actionGet();
    fail("Should have thrown ActionRequestValidationException");
  }
 catch (  ActionRequestValidationException e) {
    assertThat(e.validationErrors().size(),equalTo(1));
    assertThat(e.validationErrors().get(0),containsString("can't provide both script and doc"));
    assertThat(e.getMessage(),containsString("can't provide both script and doc"));
  }
}
