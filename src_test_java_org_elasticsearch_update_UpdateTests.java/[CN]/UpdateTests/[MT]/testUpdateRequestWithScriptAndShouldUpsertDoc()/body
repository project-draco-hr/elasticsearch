{
  createIndex();
  ensureGreen();
  try {
    client().prepareUpdate("test","type1","1").setInlineScript("ctx._source.field += 1").setDocAsUpsert(true).execute().actionGet();
    fail("Should have thrown ActionRequestValidationException");
  }
 catch (  ActionRequestValidationException e) {
    assertThat(e.validationErrors().size(),equalTo(1));
    assertThat(e.validationErrors().get(0),containsString("doc must be specified if doc_as_upsert is enabled"));
    assertThat(e.getMessage(),containsString("doc must be specified if doc_as_upsert is enabled"));
  }
}
