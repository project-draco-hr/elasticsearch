{
  assertAcked(prepareCreate("test1").addMapping("test","value","type=long"));
  assertAcked(prepareCreate("test2").addMapping("test","value","type=long"));
  assertAcked(prepareCreate("test3").addMapping("test","value","type=long"));
  ensureGreen("test1","test2","test3");
  indexRange("test1",-10,100);
  indexRange("test2",101,200);
  indexRange("test3",201,300);
  FieldStatsResponse response=client().prepareFieldStats().setFields("value").setIndexContraints(new IndexConstraint("value",MIN,GTE,"200"),new IndexConstraint("value",MAX,LTE,"300")).setLevel("indices").get();
  assertAllSuccessful(response);
  assertThat(response.getAllFieldStats(),nullValue());
  assertThat(response.getIndicesMergedFieldStats().size(),equalTo(1));
  assertThat(response.getIndicesMergedFieldStats().get("test3").get("value").getMinValue(),equalTo(201L));
  assertThat(response.getIndicesMergedFieldStats().get("test3").get("value").getMaxValue(),equalTo(300L));
  response=client().prepareFieldStats().setFields("value").setIndexContraints(new IndexConstraint("value",MAX,LTE,"200")).setLevel("indices").get();
  assertAllSuccessful(response);
  assertThat(response.getAllFieldStats(),nullValue());
  assertThat(response.getIndicesMergedFieldStats().size(),equalTo(2));
  assertThat(response.getIndicesMergedFieldStats().get("test1").get("value").getMinValue(),equalTo(-10L));
  assertThat(response.getIndicesMergedFieldStats().get("test1").get("value").getMaxValue(),equalTo(100L));
  assertThat(response.getIndicesMergedFieldStats().get("test2").get("value").getMinValue(),equalTo(101L));
  assertThat(response.getIndicesMergedFieldStats().get("test2").get("value").getMaxValue(),equalTo(200L));
  response=client().prepareFieldStats().setFields("value").setIndexContraints(new IndexConstraint("value",MIN,GTE,"100")).setLevel("indices").get();
  assertAllSuccessful(response);
  assertThat(response.getAllFieldStats(),nullValue());
  assertThat(response.getIndicesMergedFieldStats().size(),equalTo(2));
  assertThat(response.getIndicesMergedFieldStats().get("test2").get("value").getMinValue(),equalTo(101L));
  assertThat(response.getIndicesMergedFieldStats().get("test2").get("value").getMaxValue(),equalTo(200L));
  assertThat(response.getIndicesMergedFieldStats().get("test3").get("value").getMinValue(),equalTo(201L));
  assertThat(response.getIndicesMergedFieldStats().get("test3").get("value").getMaxValue(),equalTo(300L));
  response=client().prepareFieldStats().setFields("value").setIndexContraints(new IndexConstraint("value",MIN,GTE,"-20"),new IndexConstraint("value",MAX,LT,"-10")).setLevel("indices").get();
  assertAllSuccessful(response);
  assertThat(response.getAllFieldStats(),nullValue());
  assertThat(response.getIndicesMergedFieldStats().size(),equalTo(0));
  response=client().prepareFieldStats().setFields("value").setIndexContraints(new IndexConstraint("value",MIN,GTE,"-100"),new IndexConstraint("value",MAX,LTE,"-20")).setLevel("indices").get();
  assertAllSuccessful(response);
  assertThat(response.getAllFieldStats(),nullValue());
  assertThat(response.getIndicesMergedFieldStats().size(),equalTo(0));
  response=client().prepareFieldStats().setFields("value").setIndexContraints(new IndexConstraint("value",MIN,GTE,"100"),new IndexConstraint("value",MAX,LTE,"200")).setLevel("indices").get();
  assertAllSuccessful(response);
  assertThat(response.getAllFieldStats(),nullValue());
  assertThat(response.getIndicesMergedFieldStats().size(),equalTo(1));
  assertThat(response.getIndicesMergedFieldStats().get("test2").get("value").getMinValue(),equalTo(101L));
  assertThat(response.getIndicesMergedFieldStats().get("test2").get("value").getMaxValue(),equalTo(200L));
  response=client().prepareFieldStats().setFields("value").setIndexContraints(new IndexConstraint("value",MIN,GTE,"150"),new IndexConstraint("value",MAX,LTE,"300")).setLevel("indices").get();
  assertAllSuccessful(response);
  assertThat(response.getAllFieldStats(),nullValue());
  assertThat(response.getIndicesMergedFieldStats().size(),equalTo(1));
  assertThat(response.getIndicesMergedFieldStats().get("test3").get("value").getMinValue(),equalTo(201L));
  assertThat(response.getIndicesMergedFieldStats().get("test3").get("value").getMaxValue(),equalTo(300L));
}
