{
  XContentBuilder builder=jsonBuilder().startObject().startObject("type").startObject("_timestamp").field("enabled",true).field("path","last_modified").endObject().endObject().endObject();
  assertAcked(prepareCreate("test").addMapping("type",builder).setSettings(IndexMetaData.SETTING_VERSION_CREATED,Version.V_1_4_2_ID));
  String brokenBuildRequestData="{\"index\": {\"_id\": \"1\"}}\n" + "{\"name\": \"Malformed}\n" + "{\"index\": {\"_id\": \"2\"}}\n"+ "{\"name\": \"Good\", \"last_modified\" : \"2013-04-05\"}\n";
  BulkResponse bulkResponse=client().prepareBulk().add(brokenBuildRequestData.getBytes(Charsets.UTF_8),0,brokenBuildRequestData.length(),"test","type").setRefresh(true).get();
  assertThat(bulkResponse.getItems().length,is(2));
  assertThat(bulkResponse.getItems()[0].isFailed(),is(true));
  assertThat(bulkResponse.getItems()[1].isFailed(),is(false));
  assertExists(get("test","type","2"));
}
