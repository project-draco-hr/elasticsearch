{
  if ((force && bulkRequest.numberOfActions() > 0) || bulkRequest.numberOfActions() >= bulkSize) {
    try {
      bulkRequest.execute(new ActionListener<BulkResponse>(){
        @Override public void onResponse(        BulkResponse bulkResponse){
          logger.trace("bulk took " + bulkResponse.getTookInMillis() + "ms");
        }
        @Override public void onFailure(        Throwable e){
          logger.warn("failed to execute bulk");
        }
      }
);
    }
 catch (    Exception e) {
      logger.warn("failed to process bulk",e);
    }
    bulkRequest=client.prepareBulk();
  }
  return bulkRequest;
}
