{
  startServer("server1");
  client=new TransportClient(ImmutableSettings.settingsBuilder().put("discovery.enabled",true).build());
  Thread.sleep(1000);
  client.admin().indices().create(createIndexRequest("test")).actionGet();
  Thread.sleep(500);
  client.admin().cluster().ping(pingSingleRequest("test").type("person").id("1")).actionGet();
  startServer("server2");
  Thread.sleep(1000);
  client.admin().cluster().ping(pingSingleRequest("test").type("person").id("1")).actionGet();
  closeServer("server1");
  Thread.sleep(10000);
  client.admin().cluster().ping(pingSingleRequest("test").type("person").id("1")).actionGet();
  closeServer("server2");
  client.admin().cluster().ping(pingSingleRequest("test").type("person").id("1")).actionGet();
}
