{
  assertAcked(client().admin().indices().prepareCreate("idx").addMapping("type","f","type=string,index=not_analyzed"));
  indexRandom(true,client().prepareIndex("idx","type","1").setSource("f","foo"),client().prepareIndex("idx","type","2").setSource("f",null),client().prepareIndex("idx","type","3").setSource("g","bar"),client().prepareIndex("idx","type","4").setSource("f","bar"));
  SearchResponse resp=client().prepareSearch("idx").setQuery(QueryBuilders.missingQuery("f",true,true)).get();
  assertSearchHits(resp,"2","3");
  resp=client().prepareSearch("idx").setQuery(QueryBuilders.missingQuery("f",false,true)).get();
  assertSearchHits(resp,"2","3");
  resp=client().prepareSearch("idx").setQuery(QueryBuilders.missingQuery("f",true,false)).get();
  assertSearchHits(resp);
  try {
    client().prepareSearch("idx").setQuery(QueryBuilders.missingQuery("f",false,false)).get();
    fail("both existence and null_value can't be false");
  }
 catch (  IllegalArgumentException e) {
  }
}
