{
  if (!rehash) {
    LongValues hashValues=((NumericValuesSource)valuesSource).longValues();
    return new DirectCollector(counts,hashValues);
  }
  if (valuesSource instanceof NumericValuesSource) {
    NumericValuesSource source=(NumericValuesSource)valuesSource;
    LongValues hashValues=source.isFloatingPoint() ? MurmurHash3Values.wrap(source.doubleValues()) : MurmurHash3Values.wrap(source.longValues());
    return new DirectCollector(counts,hashValues);
  }
  final BytesValues bytesValues=valuesSource.bytesValues();
  if (bytesValues instanceof BytesValues.WithOrdinals) {
    BytesValues.WithOrdinals values=(BytesValues.WithOrdinals)bytesValues;
    final long maxOrd=values.ordinals().getMaxOrd();
    final long ordinalsMemoryUsage=OrdinalsCollector.memoryOverhead(maxOrd);
    final long countsMemoryUsage=HyperLogLogPlusPlus.memoryUsage(precision);
    if (ordinalsMemoryUsage < countsMemoryUsage / 4) {
      return new OrdinalsCollector(counts,values,bigArrays);
    }
  }
  return new DirectCollector(counts,MurmurHash3Values.wrap(bytesValues));
}
