{
  MoreLikeThisQueryParser parser=(MoreLikeThisQueryParser)queryParser.queryParser("more_like_this");
  parser.setFetchService(new MockMoreLikeThisFetchService());
  IndexQueryParserService queryParser=queryParser();
  String query=copyToStringFromClasspath("/org/elasticsearch/index/query/mlt-items.json");
  BooleanQuery parsedQuery=(BooleanQuery)queryParser.parse(query).query();
  MoreLikeThisQuery mltQuery=(MoreLikeThisQuery)parsedQuery.getClauses()[0].getQuery();
  mltQuery.setPercentTermsToMatch(1.0f);
  mltQuery.setMinWordLen(0);
  mltQuery.setMinDocFreq(0);
  MemoryIndex index=new MemoryIndex();
  index.addField("name.first","apache lucene",new WhitespaceAnalyzer());
  index.addField("name.last","1 2 3 4",new WhitespaceAnalyzer());
  BooleanQuery luceneQuery=(BooleanQuery)mltQuery.rewrite(index.createSearcher().getIndexReader());
  BooleanClause[] clauses=luceneQuery.getClauses();
  int minNumberShouldMatch=((BooleanQuery)(clauses[0].getQuery())).getMinimumNumberShouldMatch();
  assertThat(minNumberShouldMatch,is(4));
  minNumberShouldMatch=((BooleanQuery)(clauses[1].getQuery())).getMinimumNumberShouldMatch();
  assertThat(minNumberShouldMatch,is(2));
}
