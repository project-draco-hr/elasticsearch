{
  String query=copyToStringFromClasspath("/org/elasticsearch/index/query/bool-query-with-empty-clauses-for-parsing.json");
  IndexService indexService=createIndex("testidx",client().admin().indices().prepareCreate("testidx").addMapping("foo").addMapping("test","_parent","type=foo"));
  SearchContext.setCurrent(createSearchContext(indexService));
  IndexQueryParserService queryParser=indexService.queryParserService();
  Query parsedQuery=queryParser.parse(query).query();
  assertThat(parsedQuery,instanceOf(XConstantScoreQuery.class));
  assertThat(((XConstantScoreQuery)parsedQuery).getFilter(),instanceOf(CustomQueryWrappingFilter.class));
  assertThat(((CustomQueryWrappingFilter)((XConstantScoreQuery)parsedQuery).getFilter()).getQuery(),instanceOf(ParentConstantScoreQuery.class));
  assertThat(((CustomQueryWrappingFilter)((XConstantScoreQuery)parsedQuery).getFilter()).getQuery().toString(),equalTo("parent_filter[foo](filtered(*:*)->cache(_type:foo))"));
  SearchContext.removeCurrent();
}
