{
  String query=copyToStringFromClasspath("/org/elasticsearch/index/query/bool-query-with-empty-clauses-for-parsing.json");
  IndexService indexService=createIndex("testidx",client().admin().indices().prepareCreate("testidx").addMapping("foo","nested","type=nested"));
  SearchContext.setCurrent(createSearchContext(indexService));
  IndexQueryParserService queryParser=indexService.queryParserService();
  Query parsedQuery=queryParser.parse(query).query();
  assertThat(parsedQuery,instanceOf(ConstantScoreQuery.class));
  assertThat(((ConstantScoreQuery)parsedQuery).getQuery(),instanceOf(ToParentBlockJoinQuery.class));
  assertThat(((ConstantScoreQuery)parsedQuery).getQuery().toString(),equalTo("ToParentBlockJoinQuery (+*:* #random_access(QueryWrapperFilter(_type:__nested)))"));
  SearchContext.removeCurrent();
}
