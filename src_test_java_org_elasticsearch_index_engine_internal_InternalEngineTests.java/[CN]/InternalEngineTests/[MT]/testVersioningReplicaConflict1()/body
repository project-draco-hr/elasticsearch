{
  ParsedDocument doc=testParsedDocument("1","1","test",null,-1,-1,testDocument(),Lucene.STANDARD_ANALYZER,B_1,false);
  Engine.Index index=new Engine.Index(null,newUid("1"),doc);
  engine.index(index);
  assertThat(index.version(),equalTo(1l));
  index=new Engine.Index(null,newUid("1"),doc);
  engine.index(index);
  assertThat(index.version(),equalTo(2l));
  index=new Engine.Index(null,newUid("1"),doc).version(index.version()).versionType(VersionType.INTERNAL.versionTypeForReplicationAndRecovery()).origin(REPLICA);
  replicaEngine.index(index);
  assertThat(index.version(),equalTo(2l));
  index=new Engine.Index(null,newUid("1"),doc).version(1l).versionType(VersionType.INTERNAL.versionTypeForReplicationAndRecovery()).origin(REPLICA);
  try {
    replicaEngine.index(index);
    fail();
  }
 catch (  VersionConflictEngineException e) {
  }
  try {
    index=new Engine.Index(null,newUid("1"),doc).version(2l).versionType(VersionType.INTERNAL.versionTypeForReplicationAndRecovery()).origin(REPLICA);
    replicaEngine.index(index);
    assertThat(index.version(),equalTo(2l));
  }
 catch (  VersionConflictEngineException e) {
  }
}
