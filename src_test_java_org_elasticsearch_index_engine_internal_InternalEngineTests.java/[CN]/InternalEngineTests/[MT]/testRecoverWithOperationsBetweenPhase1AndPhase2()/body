{
  ParsedDocument doc1=testParsedDocument("1","1","test",null,-1,-1,testDocumentWithTextField(),B_1,false);
  engine.create(new Engine.Create(fakeType,newUid("1"),doc1));
  engine.flush(Engine.FlushType.COMMIT_TRANSLOG,false,false);
  ParsedDocument doc2=testParsedDocument("2","2","test",null,-1,-1,testDocumentWithTextField(),B_2,false);
  engine.create(new Engine.Create(fakeType,newUid("2"),doc2));
  engine.recover(new Engine.RecoveryHandler(){
    @Override public void phase1(    SnapshotIndexCommit snapshot) throws EngineException {
    }
    @Override public void phase2(    Translog.Snapshot snapshot) throws EngineException {
      Translog.Create create=(Translog.Create)snapshot.next();
      assertThat("translog snapshot should not read null",create != null,equalTo(true));
      assertThat(create.source().toBytesArray(),equalTo(B_2));
      assertThat(snapshot.next(),equalTo(null));
    }
    @Override public void phase3(    Translog.Snapshot snapshot) throws EngineException {
      MatcherAssert.assertThat(snapshot,TranslogSizeMatcher.translogSize(0));
    }
  }
);
  engine.flush(Engine.FlushType.COMMIT_TRANSLOG,false,false);
  engine.close();
}
