{
  ConcurrentMergeSchedulerProvider mergeSchedulerProvider=new ConcurrentMergeSchedulerProvider(shardId,EMPTY_SETTINGS,threadPool,new IndexSettingsService(shardId.index(),EMPTY_SETTINGS));
  final Engine engine=createEngine(engineSettingsService,store,createTranslog(),mergeSchedulerProvider);
  final AtomicBoolean startPending=new AtomicBoolean(true);
  Thread thread=new Thread(){
    public void run(){
      try {
        Thread.yield();
        engine.start();
      }
  finally {
        startPending.set(false);
      }
    }
  }
;
  thread.start();
  while (startPending.get()) {
    try {
      engine.acquireSearcher("foobar").close();
      break;
    }
 catch (    EngineClosedException ex) {
    }
  }
  engine.close();
}
