{
  ParsedDocument doc=testParsedDocument("1","1","test",null,-1,-1,testDocument(),B_1,false);
  Engine.Index index=new Engine.Index(fakeType,newUid("1"),doc);
  engine.index(index);
  assertThat(index.version(),equalTo(1l));
  index=new Engine.Index(fakeType,newUid("1"),doc,1l,VersionType.INTERNAL.versionTypeForReplicationAndRecovery(),REPLICA,0);
  replicaEngine.index(index);
  assertThat(index.version(),equalTo(1l));
  index=new Engine.Index(fakeType,newUid("1"),doc);
  engine.index(index);
  assertThat(index.version(),equalTo(2l));
  Engine.Delete delete=new Engine.Delete("test","1",newUid("1"));
  engine.delete(delete);
  assertThat(delete.version(),equalTo(3l));
  delete=new Engine.Delete("test","1",newUid("1"),3l,VersionType.INTERNAL.versionTypeForReplicationAndRecovery(),REPLICA,0,false);
  replicaEngine.delete(delete);
  assertThat(delete.version(),equalTo(3l));
  try {
    delete=new Engine.Delete("test","1",newUid("1"),3l,VersionType.INTERNAL.versionTypeForReplicationAndRecovery(),REPLICA,0,false);
    replicaEngine.delete(delete);
    fail("excepted VersionConflictEngineException to be thrown");
  }
 catch (  VersionConflictEngineException e) {
  }
  try {
    index=new Engine.Index(fakeType,newUid("1"),doc,2l,VersionType.INTERNAL.versionTypeForReplicationAndRecovery(),REPLICA,0);
    replicaEngine.index(index);
    fail("excepted VersionConflictEngineException to be thrown");
  }
 catch (  VersionConflictEngineException e) {
  }
}
