{
  super.setUp();
  defaultSettings=ImmutableSettings.builder().put(EngineConfig.INDEX_COMPOUND_ON_FLUSH,randomBoolean()).put(EngineConfig.INDEX_GC_DELETES_SETTING,"1h").put(EngineConfig.INDEX_FAIL_ON_CORRUPTION_SETTING,randomBoolean()).build();
  threadPool=new ThreadPool(getClass().getName());
  store=createStore();
  store.deleteContent();
  storeReplica=createStore();
  storeReplica.deleteContent();
  engineSettingsService=new IndexSettingsService(shardId.index(),ImmutableSettings.builder().put(defaultSettings).put(IndexMetaData.SETTING_VERSION_CREATED,Version.CURRENT).build());
  engine=createEngine(engineSettingsService,store,createTranslog());
  if (randomBoolean()) {
    ((InternalEngine)engine).config().setEnableGcDeletes(false);
  }
  replicaSettingsService=new IndexSettingsService(shardId.index(),ImmutableSettings.builder().put(defaultSettings).put(IndexMetaData.SETTING_VERSION_CREATED,Version.CURRENT).build());
  replicaEngine=createEngine(replicaSettingsService,storeReplica,createTranslogReplica());
  if (randomBoolean()) {
    ((InternalEngine)engine).config().setEnableGcDeletes(false);
  }
}
