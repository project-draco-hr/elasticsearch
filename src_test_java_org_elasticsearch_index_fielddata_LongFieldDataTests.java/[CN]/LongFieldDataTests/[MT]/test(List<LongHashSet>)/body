{
  StringField id=new StringField("_id","",Field.Store.NO);
  for (int i=0; i < values.size(); ++i) {
    Document doc=new Document();
    id.setStringValue("" + i);
    doc.add(id);
    final LongHashSet v=values.get(i);
    for (    LongCursor c : v) {
      LongField value=new LongField("value",c.value,Field.Store.NO);
      doc.add(value);
    }
    writer.addDocument(doc);
  }
  writer.forceMerge(1,true);
  final IndexNumericFieldData indexFieldData=getForField("value");
  final AtomicNumericFieldData atomicFieldData=indexFieldData.load(refreshReader());
  final SortedNumericDocValues data=atomicFieldData.getLongValues();
  final SortedNumericDoubleValues doubleData=atomicFieldData.getDoubleValues();
  final LongHashSet set=new LongHashSet();
  final DoubleHashSet doubleSet=new DoubleHashSet();
  for (int i=0; i < values.size(); ++i) {
    final LongHashSet v=values.get(i);
    data.setDocument(i);
    assertThat(data.count() > 0,equalTo(!v.isEmpty()));
    doubleData.setDocument(i);
    assertThat(doubleData.count() > 0,equalTo(!v.isEmpty()));
    set.clear();
    data.setDocument(i);
    int numValues=data.count();
    for (int j=0; j < numValues; j++) {
      set.add(data.valueAt(j));
    }
    assertThat(set,equalTo(v));
    final DoubleHashSet doubleV=new DoubleHashSet();
    for (    LongCursor c : v) {
      doubleV.add(c.value);
    }
    doubleSet.clear();
    doubleData.setDocument(i);
    numValues=doubleData.count();
    double prev=0;
    for (int j=0; j < numValues; j++) {
      double current;
      doubleSet.add(current=doubleData.valueAt(j));
      if (j > 0) {
        assertThat(prev,lessThan(current));
      }
      prev=current;
    }
    assertThat(doubleSet,equalTo(doubleV));
  }
}
