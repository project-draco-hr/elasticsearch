{
  if (!scheduledFuture.isCancelled()) {
    scheduledFuture.cancel(false);
  }
  final ReentrantLock mainLock=this.mainLock;
  mainLock.lock();
  try {
    int state=runState;
    if (state < STOP)     runState=STOP;
    try {
      for (      Worker w : workers) {
        w.interruptNow();
      }
    }
 catch (    SecurityException se) {
      runState=state;
      throw se;
    }
    List<Runnable> tasks=drainQueue();
    tryTerminate();
    return tasks;
  }
  finally {
    mainLock.unlock();
  }
}
