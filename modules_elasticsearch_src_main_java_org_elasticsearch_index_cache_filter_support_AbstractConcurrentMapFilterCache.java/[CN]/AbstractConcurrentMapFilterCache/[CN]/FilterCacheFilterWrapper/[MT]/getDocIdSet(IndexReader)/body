{
  ConcurrentMap<Filter,DocIdSet> cachedFilters=cache.get(reader);
  if (cachedFilters == null) {
    cachedFilters=buildMap();
    cache.putIfAbsent(reader,cachedFilters);
  }
  DocIdSet docIdSet=cachedFilters.get(filter);
  if (docIdSet != null) {
    return docIdSet;
  }
  docIdSet=filter.getDocIdSet(reader);
  docIdSet=cacheable(reader,docIdSet);
  cachedFilters.putIfAbsent(filter,docIdSet);
  return docIdSet;
}
