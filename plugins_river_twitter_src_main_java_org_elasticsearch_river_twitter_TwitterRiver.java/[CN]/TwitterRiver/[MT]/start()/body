{
  if (stream == null) {
    return;
  }
  logger.info("starting twitter stream");
  try {
    String mapping=XContentFactory.jsonBuilder().startObject().startObject(typeName).startObject("properties").startObject("location").field("type","geo_point").endObject().startObject("user").startObject("properties").startObject("screen_name").field("type","string").field("index","not_analyzed").endObject().endObject().endObject().startObject("mention").startObject("properties").startObject("screen_name").field("type","string").field("index","not_analyzed").endObject().endObject().endObject().startObject("in_reply").startObject("properties").startObject("user_screen_name").field("type","string").field("index","not_analyzed").endObject().endObject().endObject().endObject().endObject().endObject().string();
    client.admin().indices().prepareCreate(indexName).addMapping(typeName,mapping).execute().actionGet();
  }
 catch (  Exception e) {
    if (ExceptionsHelper.unwrapCause(e) instanceof IndexAlreadyExistsException) {
    }
 else     if (ExceptionsHelper.unwrapCause(e) instanceof ClusterBlockException) {
    }
 else {
      logger.warn("failed to create index [{}], disabling river...",e,indexName);
      return;
    }
  }
  currentRequest=client.prepareBulk();
  if (streamType.equals("filter") || filterQuery != null) {
    try {
      stream.filter(filterQuery);
    }
 catch (    TwitterException e) {
      logger.warn("failed to create filter stream based on query, disabling river....");
    }
  }
 else   if (streamType.equals("firehose")) {
    stream.firehose(0);
  }
 else {
    stream.sample();
  }
}
