{
  if (closed) {
    return;
  }
  try {
    stream.cleanUp();
  }
 catch (  Exception e) {
    logger.debug("failed to cleanup after failure",e);
  }
  try {
    stream.shutdown();
  }
 catch (  Exception e) {
    logger.debug("failed to shutdown after failure",e);
  }
  if (closed) {
    return;
  }
  try {
    ConfigurationBuilder cb=new ConfigurationBuilder();
    if (oauthAccessToken != null && oauthConsumerKey != null && oauthConsumerSecret != null && oauthAccessTokenSecret != null) {
      cb.setOAuthConsumerKey(oauthConsumerKey).setOAuthConsumerSecret(oauthConsumerSecret).setOAuthAccessToken(oauthAccessToken).setOAuthAccessTokenSecret(oauthAccessTokenSecret);
    }
 else {
      cb.setUser(user).setPassword(password);
    }
    stream=new TwitterStreamFactory(cb.build()).getInstance();
    stream.addListener(new StatusHandler());
    if (streamType.equals("filter") || filterQuery != null) {
      stream.filter(filterQuery);
    }
 else     if (streamType.equals("firehose")) {
      stream.firehose(0);
    }
 else {
      stream.sample();
    }
  }
 catch (  Exception e) {
    if (closed) {
      close();
      return;
    }
    logger.warn("failed to connect after failure, throttling",e);
    threadPool.schedule(TimeValue.timeValueSeconds(10),ThreadPool.Names.CACHED,new Runnable(){
      @Override public void run(){
        reconnect();
      }
    }
);
  }
}
