{
  if (set == null) {
    return DocSet.EMPTY_DOC_SET;
  }
  if (set == DocIdSet.EMPTY_DOCIDSET) {
    return DocSet.EMPTY_DOC_SET;
  }
  DocIdSetIterator it=set.iterator();
  if (it == null) {
    return DocSet.EMPTY_DOC_SET;
  }
  int doc=it.nextDoc();
  if (doc == DocIdSetIterator.NO_MORE_DOCS) {
    return DocSet.EMPTY_DOC_SET;
  }
  if (set.isCacheable() && (set instanceof DocSet)) {
    return (DocSet)set;
  }
  if (set instanceof FixedBitSet) {
    return new FixedBitDocSet((FixedBitSet)set);
  }
  if (set instanceof OpenBitSet) {
    return new OpenBitDocSet((OpenBitSet)set);
  }
  FixedBitSet fixedBitSet=new FixedBitSet(reader.maxDoc());
  fixedBitSet.set(doc);
  while ((doc=it.nextDoc()) != DocIdSetIterator.NO_MORE_DOCS) {
    fixedBitSet.set(doc);
  }
  return new FixedBitDocSet(fixedBitSet);
}
