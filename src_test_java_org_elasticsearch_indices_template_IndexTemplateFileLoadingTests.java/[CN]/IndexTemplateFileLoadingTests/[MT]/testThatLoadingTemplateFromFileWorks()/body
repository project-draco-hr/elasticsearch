{
  final int iters=atLeast(5);
  Set<String> indices=new HashSet<String>();
  for (int i=0; i < iters; i++) {
    String indexName="foo" + randomRealisticUnicodeOfLengthBetween(0,5);
    if (indices.contains(indexName)) {
      continue;
    }
    indices.add(indexName);
    createIndex(indexName);
    ensureYellow();
    ClusterStateResponse stateResponse=client().admin().cluster().prepareState().setIndices(indexName).get();
    assertThat(stateResponse.getState().getMetaData().indices().get(indexName).getNumberOfShards(),is(10));
    assertThat(stateResponse.getState().getMetaData().indices().get(indexName).getNumberOfReplicas(),is(0));
    assertThat(stateResponse.getState().getMetaData().indices().get(indexName).aliases().size(),equalTo(1));
    String aliasName=indexName + "-alias";
    assertThat(stateResponse.getState().getMetaData().indices().get(indexName).aliases().get(aliasName).alias(),equalTo(aliasName));
  }
}
