{
  final Repository repository=repository(repositoryName);
  try {
    final String verificationToken=repository.startVerification();
    if (verificationToken != null) {
      try {
        verifyAction.verify(repositoryName,verificationToken,new ActionListener<VerifyResponse>(){
          @Override public void onResponse(          VerifyResponse verifyResponse){
            try {
              repository.endVerification(verificationToken);
            }
 catch (            Throwable t) {
              logger.warn("[{}] failed to finish repository verification",t,repositoryName);
              listener.onFailure(t);
              return;
            }
            listener.onResponse(verifyResponse);
          }
          @Override public void onFailure(          Throwable e){
            listener.onFailure(e);
          }
        }
);
      }
 catch (      Throwable t) {
        try {
          repository.endVerification(verificationToken);
        }
 catch (        Throwable t1) {
          logger.warn("[{}] failed to finish repository verification",t1,repositoryName);
        }
        listener.onFailure(t);
      }
    }
 else {
      listener.onResponse(new VerifyResponse(new DiscoveryNode[0],new VerificationFailure[0]));
    }
  }
 catch (  Throwable t) {
    listener.onFailure(t);
  }
}
