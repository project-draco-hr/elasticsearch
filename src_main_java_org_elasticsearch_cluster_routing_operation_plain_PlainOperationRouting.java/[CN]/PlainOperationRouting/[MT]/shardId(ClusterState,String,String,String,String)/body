{
  if (routing == null) {
    if (!useType) {
      return Math.abs(hash(id) % indexMetaData(clusterState,index).numberOfShards());
    }
 else {
      return Math.abs(hash(type,id) % indexMetaData(clusterState,index).numberOfShards());
    }
  }
  return Math.abs(hash(routing) % indexMetaData(clusterState,index).numberOfShards());
}
