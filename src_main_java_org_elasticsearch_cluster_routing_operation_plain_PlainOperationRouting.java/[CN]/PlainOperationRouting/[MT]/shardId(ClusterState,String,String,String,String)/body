{
  if (routing == null) {
    if (!useType) {
      return MathUtils.mod(hash(id),indexMetaData(clusterState,index).numberOfShards());
    }
 else {
      return MathUtils.mod(hash(type,id),indexMetaData(clusterState,index).numberOfShards());
    }
  }
  return MathUtils.mod(hash(routing),indexMetaData(clusterState,index).numberOfShards());
}
