{
  try {
    if (!Lucene.indexExists(store.directory())) {
      return;
    }
    CheckIndex checkIndex=new CheckIndex(store.directory());
    BytesStreamOutput os=new BytesStreamOutput();
    PrintStream out=new PrintStream(os,false,Charsets.UTF_8.name());
    checkIndex.setInfoStream(out);
    out.flush();
    CheckIndex.Status status=checkIndex.checkIndex();
    if (!status.clean) {
      logger.warn("check index [failure]\n{}",new String(os.bytes().toBytes(),Charsets.UTF_8));
      throw new IndexShardException(shardId,"index check failure");
    }
 else {
      if (logger.isDebugEnabled()) {
        logger.debug("check index [success]\n{}",new String(os.bytes().toBytes(),Charsets.UTF_8));
      }
    }
  }
 catch (  Exception e) {
    logger.warn("failed to check index",e);
  }
}
