{
  clusterService.addLast(this);
  clusterService.submitStateUpdateTask("gateway_initial_state_recovery",new ClusterStateUpdateTask(){
    @Override public ClusterState execute(    ClusterState currentState) throws Exception {
      checkStateMeetsSettingsAndMaybeRecover(currentState);
      return currentState;
    }
    @Override public boolean runOnlyOnMaster(){
      return false;
    }
    @Override public void onFailure(    String source,    Throwable t){
      logger.warn("unexpected failure while checking if state can be recovered. another attempt will be made with the next cluster state change",t);
    }
  }
);
}
