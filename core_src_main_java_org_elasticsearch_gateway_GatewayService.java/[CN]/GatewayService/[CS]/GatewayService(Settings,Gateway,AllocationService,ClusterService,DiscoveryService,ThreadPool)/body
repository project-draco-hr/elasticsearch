{
  super(settings);
  this.gateway=gateway;
  this.allocationService=allocationService;
  this.clusterService=clusterService;
  this.discoveryService=discoveryService;
  this.threadPool=threadPool;
  this.expectedNodes=this.settings.getAsInt("gateway.expected_nodes",-1);
  this.expectedDataNodes=this.settings.getAsInt("gateway.expected_data_nodes",-1);
  this.expectedMasterNodes=this.settings.getAsInt("gateway.expected_master_nodes",-1);
  TimeValue defaultRecoverAfterTime=null;
  if (expectedNodes >= 0 || expectedDataNodes >= 0 || expectedMasterNodes >= 0) {
    defaultRecoverAfterTime=DEFAULT_RECOVER_AFTER_TIME_IF_EXPECTED_NODES_IS_SET;
  }
  this.recoverAfterTime=this.settings.getAsTime("gateway.recover_after_time",defaultRecoverAfterTime);
  this.recoverAfterNodes=this.settings.getAsInt("gateway.recover_after_nodes",-1);
  this.recoverAfterDataNodes=this.settings.getAsInt("gateway.recover_after_data_nodes",-1);
  this.recoverAfterMasterNodes=this.settings.getAsInt("gateway.recover_after_master_nodes",settings.getAsInt("discovery.zen.minimum_master_nodes",-1));
  this.clusterService.addInitialStateBlock(STATE_NOT_RECOVERED_BLOCK);
}
