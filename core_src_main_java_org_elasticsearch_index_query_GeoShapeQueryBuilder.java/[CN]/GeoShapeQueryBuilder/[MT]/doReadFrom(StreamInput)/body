{
  String fieldName=in.readString();
  GeoShapeQueryBuilder builder;
  if (in.readBoolean()) {
    BytesReference shapeBytes=in.readBytesReference();
    builder=new GeoShapeQueryBuilder(fieldName,shapeBytes);
  }
 else {
    String indexedShapeId=in.readOptionalString();
    String indexedShapeType=in.readOptionalString();
    String indexedShapeIndex=in.readOptionalString();
    String indexedShapePath=in.readOptionalString();
    builder=new GeoShapeQueryBuilder(fieldName,indexedShapeId,indexedShapeType);
    if (indexedShapeIndex != null) {
      builder.indexedShapeIndex=indexedShapeIndex;
    }
    if (indexedShapePath != null) {
      builder.indexedShapePath=indexedShapePath;
    }
  }
  builder.relation=ShapeRelation.DISJOINT.readFrom(in);
  if (in.readBoolean()) {
    builder.strategy=SpatialStrategy.RECURSIVE.readFrom(in);
  }
  return builder;
}
