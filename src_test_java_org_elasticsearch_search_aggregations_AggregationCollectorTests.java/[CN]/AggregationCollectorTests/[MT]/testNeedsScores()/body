{
  IndexService index=createIndex("idx");
  client().prepareIndex("idx","type","1").setSource("f",5).execute().get();
  client().admin().indices().prepareRefresh("idx").get();
  String fieldAgg="{ \"my_terms\": {\"terms\": {\"field\": \"f\"}}}";
  assertFalse(needsScores(index,fieldAgg));
  String scriptAgg="{ \"my_terms\": {\"terms\": {\"script\": \"doc['f'].value\"}}}";
  assertTrue(needsScores(index,scriptAgg));
  String subFieldAgg="{ \"my_outer_terms\": { \"terms\": { \"field\": \"f\" }, \"aggs\": " + fieldAgg + "}}";
  assertFalse(needsScores(index,subFieldAgg));
  String subScriptAgg="{ \"my_outer_terms\": { \"terms\": { \"field\": \"f\" }, \"aggs\": " + scriptAgg + "}}";
  assertTrue(needsScores(index,subScriptAgg));
  String topHitsAgg="{ \"my_hits\": {\"top_hits\": {}}}";
  assertTrue(needsScores(index,topHitsAgg));
}
