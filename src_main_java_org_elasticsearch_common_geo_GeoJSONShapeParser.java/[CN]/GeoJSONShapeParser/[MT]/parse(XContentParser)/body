{
  if (parser.currentToken() != XContentParser.Token.START_OBJECT) {
    throw new ElasticSearchParseException("Shape must be an object consisting of type and coordinates");
  }
  String shapeType=null;
  CoordinateNode node=null;
  XContentParser.Token token;
  while ((token=parser.nextToken()) != XContentParser.Token.END_OBJECT) {
    if (token == XContentParser.Token.FIELD_NAME) {
      String fieldName=parser.currentName();
      if ("type".equals(fieldName)) {
        token=parser.nextToken();
        shapeType=parser.text().toLowerCase(Locale.ENGLISH);
        if (shapeType == null) {
          throw new ElasticSearchParseException("Unknown Shape type [" + parser.text() + "]");
        }
      }
 else       if ("coordinates".equals(fieldName)) {
        token=parser.nextToken();
        node=parseCoordinates(parser);
      }
    }
  }
  if (shapeType == null) {
    throw new ElasticSearchParseException("Shape type not included");
  }
 else   if (node == null) {
    throw new ElasticSearchParseException("Coordinates not included");
  }
  return buildShape(shapeType,node);
}
