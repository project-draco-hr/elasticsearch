{
  XContentType contentType=XContentFactory.xContentType(doc);
  if (contentType == builder.contentType()) {
    builder.rawField("doc",doc);
  }
 else {
    try (XContentParser parser=XContentFactory.xContent(contentType).createParser(doc)){
      parser.nextToken();
      builder.field("doc");
      builder.copyCurrentStructure(parser);
    }
   }
  return builder;
}
