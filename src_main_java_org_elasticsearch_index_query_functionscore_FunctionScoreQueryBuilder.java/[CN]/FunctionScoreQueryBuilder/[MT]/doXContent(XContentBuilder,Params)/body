{
  builder.startObject(FunctionScoreQueryParser.NAME);
  if (queryBuilder != null) {
    builder.field("query");
    queryBuilder.toXContent(builder,params);
  }
 else   if (filterBuilder != null) {
    builder.field("filter");
    filterBuilder.toXContent(builder,params);
  }
 else {
    throw new ElasticSearchException(FunctionScoreQueryParser.NAME + " builder requires that either a filter or a query is defined!");
  }
  if (filters.size() == 1 && filters.get(0) == null) {
    scoreFunctions.get(0).toXContent(builder,params);
  }
 else {
    builder.startArray("functions");
    for (int i=0; i < filters.size(); i++) {
      builder.startObject();
      builder.field("filter");
      if (filters.get(i) == null) {
        FilterBuilders.matchAllFilter().toXContent(builder,params);
      }
 else {
        filters.get(i).toXContent(builder,params);
      }
      scoreFunctions.get(i).toXContent(builder,params);
      builder.endObject();
    }
    builder.endArray();
  }
  if (scoreMode != null) {
    builder.field("score_mode",scoreMode);
  }
  if (boostMode != null) {
    builder.field("boost_mode",boostMode);
  }
  if (maxBoost != null) {
    builder.field("max_boost",maxBoost);
  }
  if (boost != null) {
    builder.field("boost",boost);
  }
  builder.endObject();
}
