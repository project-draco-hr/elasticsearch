{
  ObjectMapper.Dynamic dynamic=parentMapper.dynamic();
  if (dynamic == null) {
    dynamic=dynamicOrDefault(context.root().dynamic());
  }
  if (dynamic == ObjectMapper.Dynamic.STRICT) {
    throw new StrictDynamicMappingException(parentMapper.fullPath(),currentFieldName);
  }
  if (dynamic == ObjectMapper.Dynamic.FALSE) {
    return null;
  }
  final String path=context.path().pathAsText(currentFieldName);
  final Mapper.BuilderContext builderContext=new Mapper.BuilderContext(context.indexSettings(),context.path());
  final MappedFieldType existingFieldType=context.mapperService().fullName(path);
  Mapper.Builder builder=null;
  if (existingFieldType != null) {
    builder=createBuilderFromFieldType(context,existingFieldType,currentFieldName);
  }
  if (builder == null) {
    builder=createBuilderFromDynamicValue(context,token,currentFieldName);
  }
  Mapper mapper=builder.build(builderContext);
  if (existingFieldType != null) {
    mapper=mapper.updateFieldType(Collections.singletonMap(path,existingFieldType));
  }
  mapper=parseAndMergeUpdate(mapper,context);
  ObjectMapper update=null;
  if (mapper != null) {
    update=parentMapper.mappingUpdate(mapper);
  }
  return update;
}
