{
  validateType(source);
  source.type(docMapper.type());
  final Mapping mapping=docMapper.mapping();
  final ParseContext.InternalParseContext context=cache.get();
  XContentParser parser=null;
  try {
    parser=parser(source);
    context.reset(parser,new ParseContext.Document(),source);
    validateStart(parser);
    internalParseDocument(mapping,context,parser);
    validateEnd(source,parser);
  }
 catch (  Throwable t) {
    throw wrapInMapperParsingException(source,t);
  }
 finally {
    if (internalParser(source,parser)) {
      parser.close();
    }
  }
  String remainingPath=context.path().pathAsText("");
  if (remainingPath.isEmpty() == false) {
    throw new IllegalStateException("found leftover path elements: " + remainingPath);
  }
  reverseOrder(context);
  ParsedDocument doc=parsedDocument(source,context,createDynamicUpdate(mapping,docMapper,context.getDynamicMappers()));
  context.reset(null,null,null);
  return doc;
}
