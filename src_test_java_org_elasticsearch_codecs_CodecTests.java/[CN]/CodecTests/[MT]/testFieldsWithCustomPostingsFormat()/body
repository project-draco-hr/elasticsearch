{
  try {
    client().admin().indices().prepareDelete("test").execute().actionGet();
  }
 catch (  Exception e) {
  }
  assertAcked(prepareCreate("test").addMapping("type1",jsonBuilder().startObject().startObject("type1").startObject("properties").startObject("field1").field("postings_format","test1").field("index_options","docs").field("type","string").endObject().endObject().endObject().endObject()).setSettings(ImmutableSettings.settingsBuilder().put(indexSettings()).put("index.codec.postings_format.test1.type","pulsing")));
  client().prepareIndex("test","type1","1").setSource("field1","quick brown fox","field2","quick brown fox").execute().actionGet();
  client().prepareIndex("test","type1","2").setSource("field1","quick lazy huge brown fox","field2","quick lazy huge brown fox").setRefresh(true).execute().actionGet();
  SearchResponse searchResponse=client().prepareSearch().setQuery(QueryBuilders.matchQuery("field2","quick brown").type(MatchQueryBuilder.Type.PHRASE).slop(0)).execute().actionGet();
  assertThat(searchResponse.getHits().totalHits(),equalTo(1l));
  try {
    client().prepareSearch().setQuery(QueryBuilders.matchQuery("field1","quick brown").type(MatchQueryBuilder.Type.PHRASE).slop(0)).execute().actionGet();
  }
 catch (  SearchPhaseExecutionException e) {
    assertThat(e.getMessage(),endsWith("IllegalStateException[field \"field1\" was indexed without position data; cannot run PhraseQuery (term=quick)]; }"));
  }
}
