{
  try {
    client().admin().indices().prepareDelete("test").execute().actionGet();
  }
 catch (  Exception e) {
  }
  client().admin().indices().prepareCreate("test").addMapping("test",jsonBuilder().startObject().startObject("test").startObject("_version").field("doc_values_format","disk").endObject().startObject("properties").startObject("field").field("type","long").field("doc_values_format","dvf").endObject().endObject().endObject().endObject()).setSettings(ImmutableSettings.settingsBuilder().put("index.codec.doc_values_format.dvf.type","disk").build());
  for (int i=10; i >= 0; --i) {
    client().prepareIndex("test","test",Integer.toString(i)).setSource("field",randomLong()).setRefresh(i == 0 || rarely()).execute().actionGet();
  }
  SearchResponse searchResponse=client().prepareSearch().setQuery(QueryBuilders.matchAllQuery()).addSort(new FieldSortBuilder("field")).execute().actionGet();
  assertThat(searchResponse.getFailedShards(),equalTo(0));
}
