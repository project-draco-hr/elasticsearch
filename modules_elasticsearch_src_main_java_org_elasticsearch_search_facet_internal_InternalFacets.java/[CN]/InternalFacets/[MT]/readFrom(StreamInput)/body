{
  int size=in.readVInt();
  if (size == 0) {
    facets=ImmutableList.of();
    facetsAsMap=ImmutableMap.of();
  }
 else {
    facets=Lists.newArrayListWithCapacity(size);
    for (int i=0; i < size; i++) {
      int id=in.readVInt();
      if (id == Facet.Type.TERMS.id()) {
        facets.add(InternalTermsFacet.readTermsFacet(in));
      }
 else       if (id == Facet.Type.QUERY.id()) {
        facets.add(InternalQueryFacet.readCountFacet(in));
      }
 else       if (id == Facet.Type.STATISTICAL.id()) {
        facets.add(InternalStatisticalFacet.readStatisticalFacet(in));
      }
 else       if (id == Facet.Type.HISTOGRAM.id()) {
        facets.add(InternalHistogramFacet.readHistogramFacet(in));
      }
 else       if (id == Facet.Type.GEO_DISTANCE.id()) {
        facets.add(InternalGeoDistanceFacet.readGeoDistanceFacet(in));
      }
 else       if (id == Facet.Type.RANGE.id()) {
        facets.add(InternalRangeFacet.readRangeFacet(in));
      }
 else       if (id == Facet.Type.FILTER.id()) {
        facets.add(InternalFilterFacet.readFilterFacet(in));
      }
 else {
        throw new IOException("Can't handle facet type with id [" + id + "]");
      }
    }
  }
}
