{
  List<Connection> connections=getConnections();
  if (connections.isEmpty()) {
    throw new IllegalStateException("no connections available in the connection pool");
  }
  List<Connection> sortedConnections=new ArrayList<>(connections);
  Collections.rotate(sortedConnections,sortedConnections.size() - lastConnectionIndex.getAndIncrement());
  Iterator<Connection> connectionIterator=sortedConnections.iterator();
  while (connectionIterator.hasNext()) {
    Connection connection=connectionIterator.next();
    if (connection.isAlive() == false && connection.shouldBeRetried() == false) {
      connectionIterator.remove();
    }
  }
  return connectionIterator;
}
