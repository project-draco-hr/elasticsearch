{
  Number keyValue=(Number)keyFunction.execute(doc,params);
  long bucket;
  if (interval == 0) {
    bucket=keyValue.longValue();
  }
 else {
    bucket=bucket(keyValue.doubleValue(),interval);
  }
  double value=((Number)valueFunction.execute(doc,params)).doubleValue();
  counts.adjustOrPutValue(bucket,1,1);
  totals.adjustOrPutValue(bucket,value,value);
}
