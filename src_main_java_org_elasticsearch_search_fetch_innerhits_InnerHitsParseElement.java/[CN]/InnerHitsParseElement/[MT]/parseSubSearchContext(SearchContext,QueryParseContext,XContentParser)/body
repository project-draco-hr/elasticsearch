{
  Query query=null;
  Map<String,InnerHitsContext.BaseInnerHits> childInnerHits=null;
  SubSearchContext subSearchContext=new SubSearchContext(searchContext);
  String fieldName=null;
  XContentParser.Token token;
  while ((token=parser.nextToken()) != XContentParser.Token.END_OBJECT) {
    if (token == XContentParser.Token.FIELD_NAME) {
      fieldName=parser.currentName();
    }
 else     if (token == XContentParser.Token.START_OBJECT) {
      if ("query".equals(fieldName)) {
        query=searchContext.queryParserService().parseInnerQuery(parseContext);
      }
 else       if ("inner_hits".equals(fieldName)) {
        childInnerHits=parseInnerHits(parser,parseContext,searchContext);
      }
 else {
        parseCommonInnerHitOptions(parser,token,fieldName,subSearchContext,sortParseElement,sourceParseElement,highlighterParseElement,scriptFieldsParseElement,fieldDataFieldsParseElement);
      }
    }
 else {
      parseCommonInnerHitOptions(parser,token,fieldName,subSearchContext,sortParseElement,sourceParseElement,highlighterParseElement,scriptFieldsParseElement,fieldDataFieldsParseElement);
    }
  }
  if (query == null) {
    query=new MatchAllDocsQuery();
  }
  return new ParseResult(subSearchContext,query,childInnerHits);
}
