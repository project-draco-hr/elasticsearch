{
  Node node1=NodeBuilder.nodeBuilder().node();
  Node node2=NodeBuilder.nodeBuilder().node();
  node1.start();
  node2.start();
  Client client=node1.client();
  String key1="indices.cache.filter.size";
  int value1=10;
  String key2="cluster.routing.allocation.disable_allocation";
  boolean value2=true;
  Settings transientSettings1=ImmutableSettings.builder().put(key1,value1).build();
  Settings persistentSettings1=ImmutableSettings.builder().put(key2,value2).build();
  ClusterUpdateSettingsResponse response1=client.admin().cluster().prepareUpdateSettings().setTransientSettings(transientSettings1).setPersistentSettings(persistentSettings1).execute().actionGet();
  assertThat(response1.getTransientSettings().get(key1),notNullValue());
  assertThat(response1.getTransientSettings().get(key2),nullValue());
  assertThat(response1.getPersistentSettings().get(key1),nullValue());
  assertThat(response1.getPersistentSettings().get(key2),notNullValue());
  Settings transientSettings2=ImmutableSettings.builder().put(key1,value1).put(key2,value2).build();
  Settings persistentSettings2=ImmutableSettings.EMPTY;
  ClusterUpdateSettingsResponse response2=client.admin().cluster().prepareUpdateSettings().setTransientSettings(transientSettings2).setPersistentSettings(persistentSettings2).execute().actionGet();
  assertThat(response2.getTransientSettings().get(key1),notNullValue());
  assertThat(response2.getTransientSettings().get(key2),notNullValue());
  assertThat(response2.getPersistentSettings().get(key1),nullValue());
  assertThat(response2.getPersistentSettings().get(key2),nullValue());
  Settings transientSettings3=ImmutableSettings.EMPTY;
  Settings persistentSettings3=ImmutableSettings.builder().put(key1,value1).put(key2,value2).build();
  ClusterUpdateSettingsResponse response3=client.admin().cluster().prepareUpdateSettings().setTransientSettings(transientSettings3).setPersistentSettings(persistentSettings3).execute().actionGet();
  assertThat(response3.getTransientSettings().get(key1),nullValue());
  assertThat(response3.getTransientSettings().get(key2),nullValue());
  assertThat(response3.getPersistentSettings().get(key1),notNullValue());
  assertThat(response3.getPersistentSettings().get(key2),notNullValue());
  node1.stop();
  node2.stop();
}
