{
  clusterService.submitStateUpdateTask("remove-mapping [" + request.mappingType + "]",new ClusterStateUpdateTask(){
    @Override public ClusterState execute(    ClusterState currentState){
      if (request.indices.length == 0) {
        throw new IndexMissingException(new Index("_all"));
      }
      logger.info("[{}] remove_mapping [{}]",request.indices,request.mappingType);
      MetaData.Builder builder=newMetaDataBuilder().metaData(currentState.metaData());
      for (      String indexName : request.indices) {
        if (currentState.metaData().hasIndex(indexName)) {
          builder.put(newIndexMetaDataBuilder(currentState.metaData().index(indexName)).removeMapping(request.mappingType));
        }
      }
      return ClusterState.builder().state(currentState).metaData(builder).build();
    }
  }
);
}
