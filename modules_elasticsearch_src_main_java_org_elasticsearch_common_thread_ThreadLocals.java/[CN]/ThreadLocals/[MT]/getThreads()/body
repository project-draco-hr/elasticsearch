{
  ThreadGroup tg=Thread.currentThread().getThreadGroup();
  while (tg.getParent() != null) {
    tg=tg.getParent();
  }
  int threadCountGuess=tg.activeCount() + 50;
  Thread[] threads=new Thread[threadCountGuess];
  int threadCountActual=tg.enumerate(threads);
  while (threadCountActual == threadCountGuess) {
    threadCountGuess*=2;
    threads=new Thread[threadCountGuess];
    threadCountActual=tg.enumerate(threads);
  }
  return threads;
}
