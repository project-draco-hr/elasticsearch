{
  try {
    if (!routingTableDirty) {
      return;
    }
    if (lifecycle.stopped()) {
      return;
    }
    clusterService.submitStateUpdateTask(CLUSTER_UPDATE_TASK_SOURCE,new ClusterStateUpdateTask(){
      @Override public ClusterState execute(      ClusterState currentState){
        RoutingTable newRoutingTable=shardsAllocation.reroute(currentState);
        if (newRoutingTable == currentState.routingTable()) {
          return currentState;
        }
        return newClusterStateBuilder().state(currentState).routingTable(newRoutingTable).build();
      }
    }
);
    routingTableDirty=false;
  }
 catch (  Exception e) {
    logger.warn("Failed to reroute routing table",e);
  }
}
