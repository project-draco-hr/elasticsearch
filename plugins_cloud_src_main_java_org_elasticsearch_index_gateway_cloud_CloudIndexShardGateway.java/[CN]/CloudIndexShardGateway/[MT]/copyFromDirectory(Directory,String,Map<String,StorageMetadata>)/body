{
  IndexInput indexInput=dir.openInput(fileName);
  try {
    Blob blob=blobStoreContext.getBlobStore().newBlob(shardIndexDirectory + "/" + fileName);
    InputStreamIndexInput is=new InputStreamIndexInput(indexInput,chunkSize.bytes());
    blob.setPayload(is);
    blob.setContentLength(is.actualSizeToRead());
    blobStoreContext.getBlobStore().putBlob(container,blob);
    int part=1;
    while (indexInput.getFilePointer() < indexInput.length()) {
      is=new InputStreamIndexInput(indexInput,chunkSize.bytes());
      if (is.actualSizeToRead() <= 0) {
        break;
      }
      blob=blobStoreContext.getBlobStore().newBlob(shardIndexDirectory + "/" + fileName+ ".part"+ part);
      blob.setPayload(is);
      blob.setContentLength(is.actualSizeToRead());
      blobStoreContext.getBlobStore().putBlob(container,blob);
      part++;
    }
  }
  finally {
    try {
      indexInput.close();
    }
 catch (    Exception e) {
    }
  }
}
