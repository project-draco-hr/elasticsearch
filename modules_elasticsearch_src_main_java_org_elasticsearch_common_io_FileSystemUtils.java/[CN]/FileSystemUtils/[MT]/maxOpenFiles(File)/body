{
  boolean dirCreated=false;
  if (!testDir.exists()) {
    dirCreated=true;
    testDir.mkdirs();
  }
  List<RandomAccessFile> files=new ArrayList<RandomAccessFile>();
  try {
    while (true) {
      files.add(new RandomAccessFile(new File(testDir,"tmp" + files.size()),"rw"));
    }
  }
 catch (  IOException ioe) {
    int i=0;
    for (    RandomAccessFile raf : files) {
      try {
        raf.close();
      }
 catch (      IOException e) {
      }
      new File(testDir,"tmp" + i++).delete();
    }
    if (dirCreated) {
      deleteRecursively(testDir);
    }
  }
  return files.size();
}
