{
  super(facetName);
  this.dateTime=dateTime;
  this.comparatorType=comparatorType;
  this.fieldDataCache=context.fieldDataCache();
  MapperService.SmartNameFieldMappers smartMappers=context.mapperService().smartName(fieldName);
  if (smartMappers == null || !smartMappers.hasMapper()) {
    throw new FacetPhaseExecutionException(facetName,"No mapping found for field [" + fieldName + "]");
  }
  if (smartMappers.hasDocMapper()) {
    setFilter(context.filterCache().cache(smartMappers.docMapper().typeFilter()));
  }
  this.valueScript=new SearchScript(context.lookup(),scriptLang,valueScript,params,context.scriptService());
  FieldMapper mapper=smartMappers.mapper();
  indexFieldName=mapper.names().indexName();
  fieldDataType=mapper.fieldDataType();
  if (interval == 1) {
    histoProc=new DateHistogramProc(this.valueScript);
  }
 else {
    histoProc=new IntervalDateHistogramProc(interval,this.valueScript);
  }
}
