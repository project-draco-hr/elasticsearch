{
  if (dir instanceof FSDirectory) {
    if (!copyTo.exists()) {
      copyTo.createNewFile();
    }
    FileChannel source=null;
    FileChannel destination=null;
    try {
      source=new FileInputStream(new File(((FSDirectory)dir).getFile(),fileName)).getChannel();
      destination=new FileOutputStream(copyTo).getChannel();
      destination.transferFrom(source,0,source.size());
    }
  finally {
      if (source != null) {
        source.close();
      }
      if (destination != null) {
        destination.close();
      }
    }
  }
 else {
    copyFromDirectory(dir.openInput(fileName),new FileOutputStream(copyTo));
  }
  FileSystemUtils.syncFile(copyTo);
}
