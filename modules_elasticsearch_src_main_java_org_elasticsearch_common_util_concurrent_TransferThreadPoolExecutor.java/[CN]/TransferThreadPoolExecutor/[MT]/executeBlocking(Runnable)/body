{
  int currentCapacity=queueSize.getAndIncrement();
  boolean succeeded=workQueue.tryTransfer(command);
  if (succeeded) {
    return;
  }
  int currentPoolSize=poolSize.get();
  if (currentPoolSize < maximumPoolSize) {
    if (poolSize.compareAndSet(currentPoolSize,currentPoolSize + 1)) {
      Thread t=addWorker();
      if (t == null) {
        poolSize.decrementAndGet();
        workQueue.add(command);
      }
 else {
        t.start();
        succeeded=workQueue.tryTransfer(command);
        if (!succeeded) {
          transferOrAddBlocking(command,currentCapacity);
        }
      }
    }
 else {
      succeeded=workQueue.tryTransfer(command);
      if (!succeeded) {
        transferOrAddBlocking(command,currentCapacity);
      }
    }
  }
 else {
    transferOrAddBlocking(command,currentCapacity);
  }
}
