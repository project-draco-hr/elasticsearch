{
  prepareCreate("test").setSettings(ImmutableSettings.settingsBuilder().put("index.number_of_shards",1).put("index.number_of_replicas",0).build()).get();
  ensureGreen();
  index("test","type","1","text","value");
  Map<String,Object> params=Maps.newHashMap();
  params.put("foo","SETVALUE");
  client().prepareUpdate("test","type","1").setScript("custom").setScriptLang("native").setScriptParams(params).get();
  Map<String,Object> data=client().prepareGet("test","type","1").get().getSource();
  assertThat(data,hasKey("foo"));
  assertThat(data.get("foo").toString(),is("SETVALUE"));
}
