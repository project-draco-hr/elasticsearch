{
  try (NodeEnvironment nodeEnvironment=newNodeEnvironment()){
    String uuid=Strings.randomBase64UUID();
    final ShardId shardId=new ShardId("foo",0);
    ShardStateMetaData.FORMAT.write(new ShardStateMetaData(1,true,uuid),1,nodeEnvironment.availableShardPaths(shardId));
    MultiDataPathUpgrader helper=new MultiDataPathUpgrader(nodeEnvironment);
    boolean multiDataPaths=nodeEnvironment.nodeDataPaths().length > 1;
    boolean needsUpgrading=helper.needsUpgrading(shardId);
    if (multiDataPaths) {
      assertTrue(needsUpgrading);
    }
 else {
      assertFalse(needsUpgrading);
    }
  }
 }
