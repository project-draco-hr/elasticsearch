{
  createIndex("test");
  ensureGreen();
  client().prepareIndex("test","type","1").setSource("field",2).execute().actionGet();
  client().prepareIndex("test","type","2").setSource("field",1).execute().actionGet();
  client().prepareIndex("test","type","3").setSource("field",0).execute().actionGet();
  refresh();
  SearchResponse searchResponse=client().prepareSearch("test").setQuery(QueryBuilders.functionScoreQuery(matchAllQuery(),ScoreFunctionBuilders.scriptFunction(new Script("_source.field")))).execute().actionGet();
  assertThat(searchResponse.getHits().getAt(0).getId(),equalTo("1"));
  assertThat(searchResponse.getHits().getAt(1).score(),Matchers.lessThan(searchResponse.getHits().getAt(0).score()));
  assertThat(searchResponse.getHits().getAt(1).getId(),equalTo("2"));
  assertThat(searchResponse.getHits().getAt(2).score(),Matchers.lessThan(searchResponse.getHits().getAt(1).score()));
  assertThat(searchResponse.getHits().getAt(2).getId(),equalTo("3"));
  searchResponse=client().prepareSearch("test").setQuery(QueryBuilders.functionScoreQuery(matchAllQuery(),ScoreFunctionBuilders.scriptFunction(new Script("_source.field")))).addSort("_score",SortOrder.DESC).execute().actionGet();
  assertThat(searchResponse.getHits().getAt(0).getId(),equalTo("1"));
  assertThat(searchResponse.getHits().getAt(1).score(),Matchers.lessThan(searchResponse.getHits().getAt(0).score()));
  assertThat(searchResponse.getHits().getAt(1).getId(),equalTo("2"));
  assertThat(searchResponse.getHits().getAt(2).score(),Matchers.lessThan(searchResponse.getHits().getAt(1).score()));
  assertThat(searchResponse.getHits().getAt(2).getId(),equalTo("3"));
  searchResponse=client().prepareSearch("test").setQuery(QueryBuilders.functionScoreQuery(matchAllQuery(),ScoreFunctionBuilders.scriptFunction(new Script("_source.field")))).addSort("_score",SortOrder.DESC).execute().actionGet();
  assertThat(searchResponse.getHits().getAt(2).getId(),equalTo("3"));
  assertThat(searchResponse.getHits().getAt(1).getId(),equalTo("2"));
  assertThat(searchResponse.getHits().getAt(0).getId(),equalTo("1"));
}
