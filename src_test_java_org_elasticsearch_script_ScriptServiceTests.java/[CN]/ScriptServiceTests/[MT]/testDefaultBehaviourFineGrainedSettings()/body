{
  ImmutableSettings.Builder builder=ImmutableSettings.builder();
  if (rarely()) {
    builder.put("script.file",randomFrom(ScriptModesTests.ENABLE_VALUES));
  }
  if (rarely()) {
    builder.put("script.indexed",ScriptMode.SANDBOX);
  }
  if (rarely()) {
    builder.put("script.inline",ScriptMode.SANDBOX);
  }
  buildScriptService(builder.build());
  createFileScripts("groovy","expression","mustache","test");
  for (  ScriptContext scriptContext : ScriptContext.values()) {
    assertCompileRejected(GroovyScriptEngineService.NAME,"script",ScriptType.INLINE,scriptContext);
    assertCompileRejected(GroovyScriptEngineService.NAME,"script",ScriptType.INDEXED,scriptContext);
    assertCompileAccepted(GroovyScriptEngineService.NAME,"file_script",ScriptType.FILE,scriptContext);
    assertCompileAccepted(ExpressionScriptEngineService.NAME,"script",ScriptType.INLINE,scriptContext);
    assertCompileAccepted(ExpressionScriptEngineService.NAME,"script",ScriptType.INDEXED,scriptContext);
    assertCompileAccepted(ExpressionScriptEngineService.NAME,"file_script",ScriptType.FILE,scriptContext);
    assertCompileAccepted(MustacheScriptEngineService.NAME,"script",ScriptType.INLINE,scriptContext);
    assertCompileAccepted(MustacheScriptEngineService.NAME,"script",ScriptType.INDEXED,scriptContext);
    assertCompileAccepted(MustacheScriptEngineService.NAME,"file_script",ScriptType.FILE,scriptContext);
    assertCompileAccepted("test","script",ScriptType.INLINE,scriptContext);
    assertCompileAccepted("test","script",ScriptType.INDEXED,scriptContext);
    assertCompileAccepted("test","file_script",ScriptType.FILE,scriptContext);
  }
}
