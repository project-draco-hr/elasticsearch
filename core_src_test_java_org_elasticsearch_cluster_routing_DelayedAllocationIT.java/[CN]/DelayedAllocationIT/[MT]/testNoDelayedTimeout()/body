{
  internalCluster().startNodesAsync(3).get();
  prepareCreate("test").setSettings(Settings.builder().put(IndexMetaData.SETTING_NUMBER_OF_SHARDS,1).put(IndexMetaData.SETTING_NUMBER_OF_REPLICAS,1).put(UnassignedInfo.INDEX_DELAYED_NODE_LEFT_TIMEOUT_SETTING,0)).get();
  ensureGreen("test");
  indexRandomData();
  internalCluster().stopRandomNode(InternalTestCluster.nameFilter(findNodeWithShard()));
  assertThat(client().admin().cluster().prepareHealth().get().getDelayedUnassignedShards(),equalTo(0));
  ensureGreen("test");
}
