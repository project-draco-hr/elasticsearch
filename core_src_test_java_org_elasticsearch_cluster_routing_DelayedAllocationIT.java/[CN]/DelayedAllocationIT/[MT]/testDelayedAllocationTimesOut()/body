{
  internalCluster().startNodesAsync(3).get();
  prepareCreate("test").setSettings(Settings.builder().put(IndexMetaData.SETTING_NUMBER_OF_SHARDS,1).put(IndexMetaData.SETTING_NUMBER_OF_REPLICAS,1).put(UnassignedInfo.INDEX_DELAYED_NODE_LEFT_TIMEOUT_SETTING,TimeValue.timeValueMillis(100))).get();
  ensureGreen("test");
  indexRandomData();
  internalCluster().stopRandomNode(InternalTestCluster.nameFilter(findNodeWithShard()));
  ensureGreen("test");
  internalCluster().startNode();
  assertAcked(client().admin().indices().prepareUpdateSettings("test").setSettings(Settings.builder().put(UnassignedInfo.INDEX_DELAYED_NODE_LEFT_TIMEOUT_SETTING,TimeValue.timeValueMillis(100))).get());
  internalCluster().stopRandomNode(InternalTestCluster.nameFilter(findNodeWithShard()));
  ensureGreen("test");
}
