{
  stream.defaultReadObject();
  int entryCount=stream.readInt();
  ImmutableMap.Builder<E,Integer> builder=ImmutableMap.builder();
  long tmpSize=0;
  for (int i=0; i < entryCount; i++) {
    @SuppressWarnings("unchecked") E element=(E)stream.readObject();
    int count=stream.readInt();
    if (count <= 0) {
      throw new InvalidObjectException("Invalid count " + count);
    }
    builder.put(element,count);
    tmpSize+=count;
  }
  FieldSettersHolder.MAP_FIELD_SETTER.set(this,builder.build());
  FieldSettersHolder.SIZE_FIELD_SETTER.set(this,(int)Math.min(tmpSize,Integer.MAX_VALUE));
}
