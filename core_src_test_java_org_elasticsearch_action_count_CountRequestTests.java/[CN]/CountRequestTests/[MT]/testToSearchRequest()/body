{
  CountRequest countRequest;
  if (randomBoolean()) {
    countRequest=new CountRequest(randomStringArray());
  }
 else {
    countRequest=new CountRequest();
  }
  if (randomBoolean()) {
    countRequest.indicesOptions(IndicesOptions.fromOptions(randomBoolean(),randomBoolean(),randomBoolean(),randomBoolean()));
  }
  if (randomBoolean()) {
    countRequest.types(randomStringArray());
  }
  if (randomBoolean()) {
    countRequest.routing(randomStringArray());
  }
  if (randomBoolean()) {
    countRequest.preference(randomAsciiOfLengthBetween(1,10));
  }
  final boolean querySet;
  if (querySet=randomBoolean()) {
    countRequest.query(QueryBuilders.termQuery("field","value"));
  }
  if (randomBoolean()) {
    countRequest.minScore(randomFloat());
  }
  if (randomBoolean()) {
    countRequest.terminateAfter(randomIntBetween(1,1000));
  }
  SearchRequest searchRequest=countRequest.toSearchRequest();
  assertThat(searchRequest.indices(),equalTo(countRequest.indices()));
  assertThat(searchRequest.indicesOptions(),equalTo(countRequest.indicesOptions()));
  assertThat(searchRequest.types(),equalTo(countRequest.types()));
  assertThat(searchRequest.routing(),equalTo(countRequest.routing()));
  assertThat(searchRequest.preference(),equalTo(countRequest.preference()));
  BytesArray array=new BytesArray(XContentHelper.toString(searchRequest.source()));
  Map<String,Object> sourceMap=XContentHelper.convertToMap(array,false).v2();
  int count=1;
  assertThat(sourceMap.get("size"),equalTo(0));
  if (querySet) {
    count++;
    assertThat(sourceMap.get("query"),notNullValue());
  }
 else {
    assertNull(sourceMap.get("query"));
  }
  if (countRequest.minScore() == CountRequest.DEFAULT_MIN_SCORE) {
    assertThat(sourceMap.get("min_score"),nullValue());
  }
 else {
    assertThat(((Number)sourceMap.get("min_score")).floatValue(),equalTo(countRequest.minScore()));
    count++;
  }
  if (countRequest.terminateAfter() == SearchContext.DEFAULT_TERMINATE_AFTER) {
    assertThat(sourceMap.get("terminate_after"),nullValue());
  }
 else {
    assertThat(sourceMap.get("terminate_after"),equalTo(countRequest.terminateAfter()));
    count++;
  }
  assertThat(sourceMap.toString(),sourceMap.size(),equalTo(count));
}
