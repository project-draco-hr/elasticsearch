{
  if (loaded) {
    return;
  }
  loaded=true;
  Environment environment=new Environment(settings);
  Settings.Builder settingsBuilder=settingsBuilder().put(settings);
  resolveConfig(environment,settingsBuilder);
  settingsBuilder.putProperties("elasticsearch.",System.getProperties()).putProperties("es.",System.getProperties()).replacePropertyPlaceholders();
  Properties props=new Properties();
  for (  Map.Entry<String,String> entry : settingsBuilder.build().getAsMap().entrySet()) {
    String key="log4j." + entry.getKey();
    String value=entry.getValue();
    value=REPLACEMENTS.getOrDefault(value,value);
    if (key.endsWith(".value")) {
      props.setProperty(key.substring(0,key.length() - ".value".length()),value);
    }
 else     if (key.endsWith(".type")) {
      props.setProperty(key.substring(0,key.length() - ".type".length()),value);
    }
 else {
      props.setProperty(key,value);
    }
  }
  props.setProperty("log4j.path.logs",cleanPath(environment.logsFile().toAbsolutePath().toString()));
  PropertyConfigurator.configure(props);
}
