{
  ExecutorService executor=EsExecutors.newSinglePrioritizingThreadExecutor(Executors.defaultThreadFactory());
  List<Integer> results=new ArrayList<Integer>(7);
  CountDownLatch awaitingLatch=new CountDownLatch(1);
  CountDownLatch finishedLatch=new CountDownLatch(7);
  executor.submit(new AwaitingJob(awaitingLatch));
  executor.submit(new CallableJob(6,Priority.LANGUID,results,finishedLatch));
  executor.submit(new Job(4,Priority.LOW,results,finishedLatch));
  executor.submit(new CallableJob(1,Priority.HIGH,results,finishedLatch));
  executor.submit(new Job(5,Priority.LOW,results,finishedLatch));
  executor.submit(new CallableJob(0,Priority.URGENT,results,finishedLatch));
  executor.submit(new Job(3,Priority.NORMAL,results,finishedLatch));
  executor.submit(new CallableJob(2,Priority.HIGH,results,finishedLatch));
  awaitingLatch.countDown();
  finishedLatch.await();
  assertThat(results.size(),equalTo(7));
  assertThat(results.get(0),equalTo(0));
  assertThat(results.get(1),equalTo(1));
  assertThat(results.get(2),equalTo(2));
  assertThat(results.get(3),equalTo(3));
  assertThat(results.get(4),equalTo(4));
  assertThat(results.get(5),equalTo(5));
  assertThat(results.get(6),equalTo(6));
}
