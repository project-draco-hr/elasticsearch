{
  client().admin().indices().prepareCreate("my-index").setSettings(ImmutableSettings.settingsBuilder().put("index.refresh_interval",-1)).execute().actionGet();
  ensureGreen();
  client().prepareIndex("my-index","_percolator","1").setSource(jsonBuilder().startObject().field("query",matchAllQuery()).field("level",1).endObject()).execute().actionGet();
  PercolateResponse response=client().preparePercolate().setIndices("my-index").setDocumentType("my-type").setSort(true).setSize(2).setPercolateDoc(docBuilder().setDoc("field","value")).setPercolateQuery(QueryBuilders.functionScoreQuery(matchAllQuery()).add(new ScriptScoreFunctionBuilder().script("doc['level'].value"))).execute().actionGet();
  assertNoFailures(response);
  assertThat(response.getCount(),equalTo(0l));
}
