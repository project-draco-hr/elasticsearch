{
  try (ReleasableLock lock=writeLock.acquire()){
    ensureOpen();
    operationCounter++;
    final long offset=totalOffset;
    if (data.length() >= buffer.length) {
      flush();
      data.writeTo(channel);
      writtenOffset+=data.length();
      totalOffset+=data.length();
      return new Translog.Location(generation,offset,data.length());
    }
    if (data.length() > buffer.length - bufferCount) {
      flush();
    }
    data.writeTo(bufferOs);
    totalOffset+=data.length();
    return new Translog.Location(generation,offset,data.length());
  }
 }
