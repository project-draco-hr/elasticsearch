{
  super(name.getName(),repositorySettings,indexShardRepository);
  if (URL_SETTING.exists(repositorySettings.settings()) == false && REPOSITORIES_URL_SETTING.exists(settings) == false) {
    throw new RepositoryException(name.name(),"missing url");
  }
  supportedProtocols=SUPPORTED_PROTOCOLS_SETTING.get(settings);
  urlWhiteList=ALLOWED_URLS_SETTING.get(settings).toArray(new URIPattern[]{});
  this.environment=environment;
  listDirectories=LIST_DIRECTORIES_SETTING.exists(repositorySettings.settings()) ? LIST_DIRECTORIES_SETTING.get(repositorySettings.settings()) : REPOSITORIES_LIST_DIRECTORIES_SETTING.get(settings);
  URL url=URL_SETTING.exists(repositorySettings.settings()) ? URL_SETTING.get(repositorySettings.settings()) : REPOSITORIES_URL_SETTING.get(settings);
  URL normalizedURL=checkURL(url);
  blobStore=new URLBlobStore(settings,normalizedURL);
  basePath=BlobPath.cleanPath();
}
