{
  ShardRouting primaryShard=TestShardRouting.newShardRouting(shardId.getIndex(),shardId.getId(),node1.getId(),true,ShardRoutingState.STARTED);
  MetaData metaData=MetaData.builder().put(IndexMetaData.builder(shardId.getIndexName()).settings(settings(Version.CURRENT)).numberOfShards(1).numberOfReplicas(1).putActiveAllocationIds(0,Sets.newHashSet(primaryShard.allocationId().getId()))).build();
  RoutingTable routingTable=RoutingTable.builder().add(IndexRoutingTable.builder(shardId.getIndex()).addIndexShard(new IndexShardRoutingTable.Builder(shardId).addShard(primaryShard).addShard(TestShardRouting.newShardRouting(shardId.getIndex(),shardId.getId(),node2.getId(),null,null,false,ShardRoutingState.INITIALIZING,new UnassignedInfo(UnassignedInfo.Reason.CLUSTER_RECOVERED,null))).build())).build();
  ClusterState state=ClusterState.builder(org.elasticsearch.cluster.ClusterName.DEFAULT).metaData(metaData).routingTable(routingTable).nodes(DiscoveryNodes.builder().put(node1).put(node2).put(node3)).build();
  return new RoutingAllocation(deciders,new RoutingNodes(state,false),state.nodes(),ClusterInfo.EMPTY,System.nanoTime());
}
