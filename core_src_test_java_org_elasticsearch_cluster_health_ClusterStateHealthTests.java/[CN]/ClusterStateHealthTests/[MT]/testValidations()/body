{
  RoutingTableGenerator routingTableGenerator=new RoutingTableGenerator();
  IndexMetaData indexMetaData=IndexMetaData.builder("test").settings(settings(Version.CURRENT)).numberOfShards(2).numberOfReplicas(2).build();
  RoutingTableGenerator.ShardCounter counter=new RoutingTableGenerator.ShardCounter();
  IndexRoutingTable indexRoutingTable=routingTableGenerator.genIndexRoutingTable(indexMetaData,counter);
  indexMetaData=IndexMetaData.builder("test").settings(settings(Version.CURRENT)).numberOfShards(2).numberOfReplicas(3).build();
  ClusterIndexHealth indexHealth=new ClusterIndexHealth(indexMetaData,indexRoutingTable);
  assertThat(indexHealth.getValidationFailures(),Matchers.hasSize(2));
  RoutingTable.Builder routingTable=RoutingTable.builder();
  MetaData.Builder metaData=MetaData.builder();
  metaData.put(indexMetaData,true);
  routingTable.add(indexRoutingTable);
  ClusterState clusterState=ClusterState.builder(ClusterName.DEFAULT).metaData(metaData).routingTable(routingTable.build()).build();
  String[] concreteIndices=indexNameExpressionResolver.concreteIndices(clusterState,IndicesOptions.strictExpand(),(String[])null);
  ClusterStateHealth clusterStateHealth=new ClusterStateHealth(clusterState,concreteIndices);
  clusterStateHealth=maybeSerialize(clusterStateHealth);
  assertThat(clusterStateHealth.getValidationFailures(),Matchers.hasSize(0));
}
