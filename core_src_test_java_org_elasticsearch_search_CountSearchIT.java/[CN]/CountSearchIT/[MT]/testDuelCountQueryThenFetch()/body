{
  createIndex("idx");
  ensureYellow();
  indexRandom(true,client().prepareIndex("idx","type","1").setSource("foo","bar","bar",3),client().prepareIndex("idx","type","2").setSource("foo","baz","bar",10),client().prepareIndex("idx","type","3").setSource("foo","foo","bar",7));
  final SearchResponse resp1=client().prepareSearch("idx").setSize(0).addAggregation(AggregationBuilders.sum("bar").field("bar")).execute().get();
  assertSearchResponse(resp1);
  final SearchResponse resp2=client().prepareSearch("idx").setSearchType(SearchType.COUNT).addAggregation(AggregationBuilders.sum("bar").field("bar")).execute().get();
  assertSearchResponse(resp2);
  assertEquals(resp1.getHits().getTotalHits(),resp2.getHits().getTotalHits());
  Sum sum1=resp1.getAggregations().get("bar");
  Sum sum2=resp2.getAggregations().get("bar");
  assertEquals(sum1.getValue(),sum2.getValue(),0d);
}
