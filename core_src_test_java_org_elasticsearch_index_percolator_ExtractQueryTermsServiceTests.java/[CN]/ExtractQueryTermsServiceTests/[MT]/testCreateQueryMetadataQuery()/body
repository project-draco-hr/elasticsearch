{
  MemoryIndex memoryIndex=new MemoryIndex(false);
  memoryIndex.addField("field1","the quick brown fox jumps over the lazy dog",new WhitespaceAnalyzer());
  memoryIndex.addField("field2","some more text",new WhitespaceAnalyzer());
  memoryIndex.addField("_field3","unhide me",new WhitespaceAnalyzer());
  memoryIndex.addField("field4","123",new WhitespaceAnalyzer());
  IndexReader indexReader=memoryIndex.createSearcher().getIndexReader();
  Query query=ExtractQueryTermsService.createQueryTermsQuery(indexReader,QUERY_TERMS_FIELD,UNKNOWN_QUERY_FIELD);
  assertThat(query,instanceOf(TermsQuery.class));
  BooleanQuery booleanQuery=(BooleanQuery)((ConstantScoreQuery)query.rewrite(indexReader)).getQuery();
  assertThat(booleanQuery.clauses().size(),equalTo(15));
  assertClause(booleanQuery,0,QUERY_TERMS_FIELD,"_field3\u0000me");
  assertClause(booleanQuery,1,QUERY_TERMS_FIELD,"_field3\u0000unhide");
  assertClause(booleanQuery,2,QUERY_TERMS_FIELD,"field1\u0000brown");
  assertClause(booleanQuery,3,QUERY_TERMS_FIELD,"field1\u0000dog");
  assertClause(booleanQuery,4,QUERY_TERMS_FIELD,"field1\u0000fox");
  assertClause(booleanQuery,5,QUERY_TERMS_FIELD,"field1\u0000jumps");
  assertClause(booleanQuery,6,QUERY_TERMS_FIELD,"field1\u0000lazy");
  assertClause(booleanQuery,7,QUERY_TERMS_FIELD,"field1\u0000over");
  assertClause(booleanQuery,8,QUERY_TERMS_FIELD,"field1\u0000quick");
  assertClause(booleanQuery,9,QUERY_TERMS_FIELD,"field1\u0000the");
  assertClause(booleanQuery,10,QUERY_TERMS_FIELD,"field2\u0000more");
  assertClause(booleanQuery,11,QUERY_TERMS_FIELD,"field2\u0000some");
  assertClause(booleanQuery,12,QUERY_TERMS_FIELD,"field2\u0000text");
  assertClause(booleanQuery,13,QUERY_TERMS_FIELD,"field4\u0000123");
  assertClause(booleanQuery,14,UNKNOWN_QUERY_FIELD,"");
}
