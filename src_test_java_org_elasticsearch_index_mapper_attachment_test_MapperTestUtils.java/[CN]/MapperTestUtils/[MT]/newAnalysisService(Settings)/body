{
  Injector parentInjector=new ModulesBuilder().add(new SettingsModule(indexSettings),new EnvironmentModule(new Environment(ImmutableSettings.Builder.EMPTY_SETTINGS)),new IndicesAnalysisModule()).createInjector();
  Index index=new Index("test");
  Injector injector=new ModulesBuilder().add(new IndexSettingsModule(index,indexSettings),new IndexNameModule(index),new AnalysisModule(indexSettings,parentInjector.getInstance(IndicesAnalysisService.class))).createChildInjector(parentInjector);
  return injector.getInstance(AnalysisService.class);
}
