{
  ImmutableLevelHolder[] holders=new ImmutableLevelHolder[3];
  for (  ClusterBlockLevel level : ClusterBlockLevel.values()) {
    ImmutableMap.Builder<String,ImmutableSet<ClusterBlock>> indicesBuilder=ImmutableMap.builder();
    for (    Map.Entry<String,Set<ClusterBlock>> entry : levelHolders[level.id()].indices().entrySet()) {
      indicesBuilder.put(entry.getKey(),ImmutableSet.copyOf(entry.getValue()));
    }
    holders[level.id()]=new ImmutableLevelHolder(ImmutableSet.copyOf(levelHolders[level.id()].global()),indicesBuilder.build());
  }
  return new ClusterBlocks(holders);
}
