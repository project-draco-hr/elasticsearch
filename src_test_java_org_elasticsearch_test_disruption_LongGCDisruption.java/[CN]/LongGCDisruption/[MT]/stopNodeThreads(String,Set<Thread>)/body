{
  Set<Thread> allThreadsSet=Thread.getAllStackTraces().keySet();
  boolean stopped=false;
  final String nodeThreadNamePart="[" + node + "]";
  for (  Thread thread : allThreadsSet) {
    String name=thread.getName();
    if (name.contains(nodeThreadNamePart)) {
      if (thread.isAlive() && nodeThreads.add(thread)) {
        stopped=true;
        thread.suspend();
        boolean safe=true;
        safe:         for (        StackTraceElement stackElement : thread.getStackTrace()) {
          String className=stackElement.getClassName();
          for (          Pattern unsafePattern : unsafeClasses) {
            if (unsafePattern.matcher(className).find()) {
              safe=false;
              break safe;
            }
          }
        }
        if (!safe) {
          thread.resume();
          nodeThreads.remove(thread);
        }
      }
    }
  }
  return stopped;
}
