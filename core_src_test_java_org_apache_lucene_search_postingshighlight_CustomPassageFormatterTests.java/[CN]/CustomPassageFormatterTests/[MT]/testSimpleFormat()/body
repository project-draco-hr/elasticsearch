{
  String content="This is a really cool highlighter. Postings highlighter gives nice snippets back. No matches here.";
  CustomPassageFormatter passageFormatter=new CustomPassageFormatter("<em>","</em>",new DefaultEncoder());
  Passage[] passages=new Passage[3];
  String match="highlighter";
  BytesRef matchBytesRef=new BytesRef(match);
  Passage passage1=new Passage();
  int start=content.indexOf(match);
  int end=start + match.length();
  passage1.startOffset=0;
  passage1.endOffset=end + 2;
  passage1.addMatch(start,end,matchBytesRef);
  passages[0]=passage1;
  Passage passage2=new Passage();
  start=content.lastIndexOf(match);
  end=start + match.length();
  passage2.startOffset=passage1.endOffset;
  passage2.endOffset=end + 26;
  passage2.addMatch(start,end,matchBytesRef);
  passages[1]=passage2;
  Passage passage3=new Passage();
  passage3.startOffset=passage2.endOffset;
  passage3.endOffset=content.length();
  passages[2]=passage3;
  Snippet[] fragments=passageFormatter.format(passages,content);
  assertThat(fragments,notNullValue());
  assertThat(fragments.length,equalTo(3));
  assertThat(fragments[0].getText(),equalTo("This is a really cool <em>highlighter</em>."));
  assertThat(fragments[0].isHighlighted(),equalTo(true));
  assertThat(fragments[1].getText(),equalTo("Postings <em>highlighter</em> gives nice snippets back."));
  assertThat(fragments[1].isHighlighted(),equalTo(true));
  assertThat(fragments[2].getText(),equalTo("No matches here."));
  assertThat(fragments[2].isHighlighted(),equalTo(false));
}
