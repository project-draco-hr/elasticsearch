{
synchronized (mutex) {
    Shared shared=sharedChannels.get(config);
    if (shared != null) {
      shared.incRef();
      ((MultiListener)shared.listener).add(listener);
      return new Delegate(listener,shared);
    }
    MultiListener multiListener=new MultiListener();
    multiListener.add(listener);
    shared=new Shared(multiListener,new Plain(multiListener,"#shared#",config));
    sharedChannels.put(config,shared);
    return shared;
  }
}
