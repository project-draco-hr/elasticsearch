{
  if (tru != null || fals != null) {
    if (operation == Operation.AND) {
      Label localfals=fals == null ? new Label() : fals;
      left.fals=localfals;
      right.tru=tru;
      right.fals=fals;
      left.write(writer);
      right.write(writer);
      if (fals == null) {
        writer.mark(localfals);
      }
    }
 else     if (operation == Operation.OR) {
      Label localtru=tru == null ? new Label() : tru;
      left.tru=localtru;
      right.tru=tru;
      right.fals=fals;
      left.write(writer);
      right.write(writer);
      if (tru == null) {
        writer.mark(localtru);
      }
    }
 else {
      throw new IllegalStateException(error("Illegal tree structure."));
    }
  }
 else {
    if (operation == Operation.AND) {
      Label localfals=new Label();
      Label end=new Label();
      left.fals=localfals;
      right.fals=localfals;
      left.write(writer);
      right.write(writer);
      writer.push(true);
      writer.goTo(end);
      writer.mark(localfals);
      writer.push(false);
      writer.mark(end);
    }
 else     if (operation == Operation.OR) {
      Label localtru=new Label();
      Label localfals=new Label();
      Label end=new Label();
      left.tru=localtru;
      right.fals=localfals;
      left.write(writer);
      right.write(writer);
      writer.mark(localtru);
      writer.push(true);
      writer.goTo(end);
      writer.mark(localfals);
      writer.push(false);
      writer.mark(end);
    }
 else {
      throw new IllegalStateException(error("Illegal tree structure."));
    }
  }
}
