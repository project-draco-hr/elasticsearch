{
  IndexRequest indexRequest=new IndexRequest("_index","_type","_id");
  indexRequest.source("field","value");
  indexRequest.putHeader(IngestPlugin.PIPELINE_ID_PARAM,"_id");
  ActionListener actionListener=mock(ActionListener.class);
  ActionFilterChain actionFilterChain=mock(ActionFilterChain.class);
  Answer answer=new Answer(){
    @Override public Object answer(    InvocationOnMock invocationOnMock) throws Throwable {
      IngestDocument ingestDocument=(IngestDocument)invocationOnMock.getArguments()[0];
      PipelineExecutionService.Listener listener=(PipelineExecutionService.Listener)invocationOnMock.getArguments()[2];
      listener.executed(ingestDocument);
      return null;
    }
  }
;
  doAnswer(answer).when(executionService).execute(any(IngestDocument.class),eq("_id"),any(PipelineExecutionService.Listener.class));
  filter.apply("_action",indexRequest,actionListener,actionFilterChain);
  verify(executionService).execute(any(IngestDocument.class),eq("_id"),any(PipelineExecutionService.Listener.class));
  verify(actionFilterChain).proceed("_action",indexRequest,actionListener);
  verifyZeroInteractions(actionListener);
}
