{
  try {
    System.setProperty("es.node.zone","foo");
    Settings settings=settingsBuilder().put("node.zone","bar").put(baseEnvSettings).build();
    Environment env=InternalSettingsPreparer.prepareEnvironment(settings,null);
    assertThat(env.settings().get("node.zone"),equalTo("foo"));
    settings=settingsBuilder().put(InternalSettingsPreparer.IGNORE_SYSTEM_PROPERTIES_SETTING,true).put("node.zone","bar").put(baseEnvSettings).build();
    env=InternalSettingsPreparer.prepareEnvironment(settings,null);
    assertThat(env.settings().get("node.zone"),equalTo("bar"));
  }
  finally {
    System.clearProperty("es.node.zone");
  }
}
