{
  try {
    System.setProperty("es.node.zone","foo");
    Settings settings=settingsBuilder().put("node.zone","bar").put(baseEnvSettings).build();
    Tuple<Settings,Environment> tuple=InternalSettingsPreparer.prepareSettingsAndEnvironment(settings,null);
    assertThat(tuple.v1().get("node.zone"),equalTo("foo"));
    settings=settingsBuilder().put(InternalSettingsPreparer.IGNORE_SYSTEM_PROPERTIES_SETTING,true).put("node.zone","bar").put(baseEnvSettings).build();
    tuple=InternalSettingsPreparer.prepareSettingsAndEnvironment(settings,null);
    assertThat(tuple.v1().get("node.zone"),equalTo("bar"));
  }
  finally {
    System.clearProperty("es.node.zone");
  }
}
