{
  try {
    System.setProperty("name","sys-prop-name");
    Settings settings=settingsBuilder().put("node.name","node-name").put(baseEnvSettings).build();
    Tuple<Settings,Environment> tuple=InternalSettingsPreparer.prepareSettingsAndEnvironment(settings,null);
    assertThat(tuple.v1().get("name"),equalTo("sys-prop-name"));
    settings=settingsBuilder().put("name","name-in-settings").put("node.name","node-name").put(baseEnvSettings).build();
    tuple=InternalSettingsPreparer.prepareSettingsAndEnvironment(settings,null);
    assertThat(tuple.v1().get("name"),equalTo("name-in-settings"));
    System.clearProperty("name");
    settings=settingsBuilder().put("node.name","node-name").put(baseEnvSettings).build();
    tuple=InternalSettingsPreparer.prepareSettingsAndEnvironment(settings,null);
    assertThat(tuple.v1().get("name"),equalTo("node-name"));
    tuple=InternalSettingsPreparer.prepareSettingsAndEnvironment(baseEnvSettings,null);
    assertThat(tuple.v1().get("name"),not("name-in-settings"));
    assertThat(tuple.v1().get("name"),not("sys-prop-name"));
    assertThat(tuple.v1().get("name"),not("node-name"));
    assertThat(tuple.v1().get("name"),notNullValue());
  }
  finally {
    System.clearProperty("name");
  }
}
