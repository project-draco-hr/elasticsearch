{
  Settings settings=settingsBuilder().put("node.name","node-name").put("path.home",createTempDir().toString()).build();
  Tuple<Settings,Environment> tuple=InternalSettingsPreparer.prepareSettings(settings,true);
  assertThat(tuple.v1().get("name"),equalTo("sys-prop-name"));
  settings=settingsBuilder().put("name","name-in-settings").put("node.name","node-name").put("path.home",createTempDir().toString()).build();
  tuple=InternalSettingsPreparer.prepareSettings(settings,true);
  assertThat(tuple.v1().get("name"),equalTo("name-in-settings"));
  System.clearProperty("name");
  settings=settingsBuilder().put("node.name","node-name").put("path.home",createTempDir().toString()).build();
  tuple=InternalSettingsPreparer.prepareSettings(settings,true);
  assertThat(tuple.v1().get("name"),equalTo("node-name"));
  settings=settingsBuilder().put("path.home",createTempDir().toString()).build();
  tuple=InternalSettingsPreparer.prepareSettings(settings,true);
  assertThat(tuple.v1().get("name"),not("name-in-settings"));
  assertThat(tuple.v1().get("name"),not("sys-prop-name"));
  assertThat(tuple.v1().get("name"),not("node-name"));
  assertThat(tuple.v1().get("name"),notNullValue());
}
