{
  if (proxy == null || proxy.type() == Proxy.Type.DIRECT) {
    return null;
  }
  if (proxy.type() != Proxy.Type.HTTP) {
    throw new IllegalArgumentException("Only DIRECT and HTTP Proxies are supported!");
  }
  final SocketAddress sa=proxy.address();
  if (!(sa instanceof InetSocketAddress)) {
    throw new IllegalArgumentException("Only Internet Address sockets are supported!");
  }
  InetSocketAddress isa=(InetSocketAddress)sa;
  if (isa.isUnresolved()) {
    return new ProxyServer(isa.getHostName(),isa.getPort());
  }
 else {
    return new ProxyServer(isa.getAddress().getHostAddress(),isa.getPort());
  }
}
