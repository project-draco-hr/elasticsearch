{
  Settings nodeSettings=settingsBuilder().put("path.home",createTempDir()).build();
  IndexSettings settings=IndexSettingsModule.newIndexSettings(new Index("_na"),nodeSettings);
  SimilarityService similarityService=new SimilarityService(settings,Collections.emptyMap());
  AnalysisService analysisService=new AnalysisRegistry(null,new Environment(nodeSettings)).build(settings);
  MapperRegistry mapperRegistry=new MapperRegistry(Collections.emptyMap(),Collections.emptyMap());
  MapperService service=new MapperService(settings,analysisService,similarityService,mapperRegistry);
  return new CodecService(service,ESLoggerFactory.getLogger("test"));
}
