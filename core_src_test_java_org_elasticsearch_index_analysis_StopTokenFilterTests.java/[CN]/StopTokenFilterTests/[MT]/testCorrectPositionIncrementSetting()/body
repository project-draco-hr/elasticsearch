{
  Builder builder=Settings.settingsBuilder().put("index.analysis.filter.my_stop.type","stop");
  int thingToDo=random().nextInt(3);
  if (thingToDo == 0) {
    builder.put("index.analysis.filter.my_stop.version",Version.LATEST);
  }
 else   if (thingToDo == 1) {
    builder.put("index.analysis.filter.my_stop.version",Version.LUCENE_4_0);
    if (random().nextBoolean()) {
      builder.put("index.analysis.filter.my_stop.enable_position_increments",true);
    }
  }
 else {
  }
  builder.put("path.home",createTempDir().toString());
  AnalysisService analysisService=AnalysisTestsHelper.createAnalysisServiceFromSettings(builder.build());
  TokenFilterFactory tokenFilter=analysisService.tokenFilter("my_stop");
  assertThat(tokenFilter,instanceOf(StopTokenFilterFactory.class));
  Tokenizer tokenizer=new WhitespaceTokenizer();
  tokenizer.setReader(new StringReader("foo bar"));
  TokenStream create=tokenFilter.create(tokenizer);
  if (thingToDo == 1) {
    assertThat(create,instanceOf(Lucene43StopFilter.class));
  }
 else {
    assertThat(create,instanceOf(StopFilter.class));
  }
}
