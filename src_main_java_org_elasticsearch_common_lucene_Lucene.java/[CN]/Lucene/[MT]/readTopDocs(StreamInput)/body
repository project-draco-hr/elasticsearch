{
  if (!in.readBoolean()) {
    return null;
  }
  if (in.readBoolean()) {
    int totalHits=in.readVInt();
    float maxScore=in.readFloat();
    SortField[] fields=new SortField[in.readVInt()];
    for (int i=0; i < fields.length; i++) {
      String field=null;
      if (in.readBoolean()) {
        field=in.readString();
      }
      fields[i]=new SortField(field,readSortType(in),in.readBoolean());
    }
    FieldDoc[] fieldDocs=new FieldDoc[in.readVInt()];
    for (int i=0; i < fieldDocs.length; i++) {
      fieldDocs[i]=readFieldDoc(in);
    }
    return new TopFieldDocs(totalHits,fieldDocs,fields,maxScore);
  }
 else {
    int totalHits=in.readVInt();
    float maxScore=in.readFloat();
    ScoreDoc[] scoreDocs=new ScoreDoc[in.readVInt()];
    for (int i=0; i < scoreDocs.length; i++) {
      scoreDocs[i]=new ScoreDoc(in.readVInt(),in.readFloat());
    }
    return new TopDocs(totalHits,scoreDocs,maxScore);
  }
}
