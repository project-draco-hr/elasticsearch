{
  from=Math.min(from,topDocs.scoreDocs.length);
  if (topDocs instanceof TopFieldDocs) {
    out.writeBoolean(true);
    TopFieldDocs topFieldDocs=(TopFieldDocs)topDocs;
    out.writeVInt(topDocs.totalHits);
    out.writeFloat(topDocs.getMaxScore());
    out.writeVInt(topFieldDocs.fields.length);
    for (    SortField sortField : topFieldDocs.fields) {
      if (sortField.getField() == null) {
        out.writeBoolean(false);
      }
 else {
        out.writeBoolean(true);
        out.writeString(sortField.getField());
      }
      if (sortField.getComparatorSource() != null) {
        writeSortType(out,((IndexFieldData.XFieldComparatorSource)sortField.getComparatorSource()).reducedType());
      }
 else {
        writeSortType(out,sortField.getType());
      }
      out.writeBoolean(sortField.getReverse());
    }
    out.writeVInt(topDocs.scoreDocs.length - from);
    for (int i=from; i < topFieldDocs.scoreDocs.length; ++i) {
      ScoreDoc doc=topFieldDocs.scoreDocs[i];
      writeFieldDoc(out,(FieldDoc)doc);
    }
  }
 else {
    out.writeBoolean(false);
    out.writeVInt(topDocs.totalHits);
    out.writeFloat(topDocs.getMaxScore());
    out.writeVInt(topDocs.scoreDocs.length - from);
    for (int i=from; i < topDocs.scoreDocs.length; ++i) {
      ScoreDoc doc=topDocs.scoreDocs[i];
      writeScoreDoc(out,doc);
    }
  }
}
