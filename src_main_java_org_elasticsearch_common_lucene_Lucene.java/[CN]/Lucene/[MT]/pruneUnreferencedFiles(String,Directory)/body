{
  final SegmentInfos si=readSegmentInfos(segmentsFileName,directory);
  while (true) {
    String lastSegmentsFile=SegmentInfos.getLastCommitSegmentsFileName(directory);
    if (lastSegmentsFile == null) {
      throw new IllegalStateException("no commit found in the directory");
    }
    if (lastSegmentsFile.equals(si.getSegmentsFileName())) {
      break;
    }
    directory.deleteFile(lastSegmentsFile);
  }
  final CommitPoint cp=new CommitPoint(si,directory);
  try (IndexWriter _=new IndexWriter(directory,new IndexWriterConfig(Lucene.STANDARD_ANALYZER).setIndexCommit(cp).setCommitOnClose(false).setMergePolicy(NoMergePolicy.INSTANCE).setOpenMode(IndexWriterConfig.OpenMode.APPEND))){
  }
   return si;
}
