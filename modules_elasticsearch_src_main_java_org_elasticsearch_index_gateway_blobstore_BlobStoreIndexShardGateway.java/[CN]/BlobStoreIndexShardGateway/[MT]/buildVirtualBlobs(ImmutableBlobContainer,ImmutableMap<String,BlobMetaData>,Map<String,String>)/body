{
  Set<String> names=Sets.newHashSet();
  for (  BlobMetaData blob : blobs.values()) {
    if (blob.name().endsWith(".md5")) {
      names.add(blob.name().substring(0,blob.name().lastIndexOf(".md5")));
    }
  }
  ImmutableMap.Builder<String,BlobMetaData> builder=ImmutableMap.builder();
  for (  String name : names) {
    long sizeInBytes=0;
    if (blobs.containsKey(name)) {
      sizeInBytes=blobs.get(name).sizeInBytes();
    }
 else {
      int part=0;
      while (true) {
        BlobMetaData md=blobs.get(name + ".part" + part);
        if (md == null) {
          break;
        }
        sizeInBytes+=md.sizeInBytes();
        part++;
      }
    }
    if (cachedMd5 != null && cachedMd5.containsKey(name)) {
      builder.put(name,new PlainBlobMetaData(name,sizeInBytes,cachedMd5.get(name)));
    }
 else {
      try {
        String md5=Digest.md5HexFromByteArray(container.readBlobFully(name + ".md5"));
        if (cachedMd5 != null) {
          cachedMd5.put(name,md5);
        }
        builder.put(name,new PlainBlobMetaData(name,sizeInBytes,md5));
      }
 catch (      IOException e) {
      }
    }
  }
  return builder.build();
}
