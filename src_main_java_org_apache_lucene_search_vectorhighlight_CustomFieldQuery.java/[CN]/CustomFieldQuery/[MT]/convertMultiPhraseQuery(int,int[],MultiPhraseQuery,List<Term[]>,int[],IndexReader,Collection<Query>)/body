{
  if (currentPos == 0) {
    int numTerms=0;
    for (    Term[] currentPosTerm : terms) {
      numTerms+=currentPosTerm.length;
    }
    if (numTerms > 16) {
      for (      Term[] currentPosTerm : terms) {
        for (        Term term : currentPosTerm) {
          super.flatten(new TermQuery(term),reader,flatQueries);
        }
      }
      return;
    }
  }
  if (currentPos == terms.size()) {
    PhraseQuery query=new PhraseQuery();
    query.setBoost(orig.getBoost());
    query.setSlop(orig.getSlop());
    for (int i=0; i < termsIdx.length; i++) {
      query.add(terms.get(i)[termsIdx[i]],pos[i]);
    }
    this.flatten(query,reader,flatQueries);
  }
 else {
    Term[] t=terms.get(currentPos);
    for (int i=0; i < t.length; i++) {
      termsIdx[currentPos]=i;
      convertMultiPhraseQuery(currentPos + 1,termsIdx,orig,terms,pos,reader,flatQueries);
    }
  }
}
