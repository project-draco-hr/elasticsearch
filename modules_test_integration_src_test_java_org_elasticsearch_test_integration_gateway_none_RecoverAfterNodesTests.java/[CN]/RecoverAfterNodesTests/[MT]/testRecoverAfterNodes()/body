{
  logger.info("--> start node (1)");
  startNode("node1",settingsBuilder().put("gateway.recover_after_nodes",3));
  assertThat(client("node1").admin().cluster().prepareState().setLocal(true).execute().actionGet().state().blocks().global(ClusterBlockLevel.METADATA),hasItem(GatewayService.NOT_RECOVERED_FROM_GATEWAY_BLOCK));
  logger.info("--> start node (2)");
  startNode("node2",settingsBuilder().put("gateway.recover_after_nodes",3));
  assertThat(client("node1").admin().cluster().prepareState().setLocal(true).execute().actionGet().state().blocks().global(ClusterBlockLevel.METADATA),hasItem(GatewayService.NOT_RECOVERED_FROM_GATEWAY_BLOCK));
  assertThat(client("node2").admin().cluster().prepareState().setLocal(true).execute().actionGet().state().blocks().global(ClusterBlockLevel.METADATA),hasItem(GatewayService.NOT_RECOVERED_FROM_GATEWAY_BLOCK));
  logger.info("--> start node (3)");
  startNode("node3",settingsBuilder().put("gateway.recover_after_nodes",3));
  assertThat(client("node1").admin().cluster().prepareState().setLocal(true).execute().actionGet().state().blocks().global(ClusterBlockLevel.METADATA).isEmpty(),equalTo(true));
  assertThat(client("node2").admin().cluster().prepareState().setLocal(true).execute().actionGet().state().blocks().global(ClusterBlockLevel.METADATA).isEmpty(),equalTo(true));
  assertThat(client("node3").admin().cluster().prepareState().setLocal(true).execute().actionGet().state().blocks().global(ClusterBlockLevel.METADATA).isEmpty(),equalTo(true));
}
