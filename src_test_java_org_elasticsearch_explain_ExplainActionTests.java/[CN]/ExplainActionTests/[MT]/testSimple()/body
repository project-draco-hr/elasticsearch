{
  client().admin().indices().prepareCreate("test").setSettings(ImmutableSettings.settingsBuilder().put("index.refresh_interval",-1)).execute().actionGet();
  client().admin().cluster().prepareHealth("test").setWaitForGreenStatus().execute().actionGet();
  client().prepareIndex("test","test","1").setSource("field","value1").execute().actionGet();
  ExplainResponse response=client().prepareExplain("test","test","1").setQuery(QueryBuilders.matchAllQuery()).execute().actionGet();
  assertNotNull(response);
  assertFalse(response.isExists());
  assertThat(response.getIndex(),equalTo("test"));
  assertThat(response.getType(),equalTo("test"));
  assertThat(response.getId(),equalTo("1"));
  assertFalse(response.isMatch());
  client().admin().indices().prepareRefresh("test").execute().actionGet();
  response=client().prepareExplain("test","test","1").setQuery(QueryBuilders.matchAllQuery()).execute().actionGet();
  assertNotNull(response);
  assertTrue(response.isMatch());
  assertNotNull(response.getExplanation());
  assertTrue(response.getExplanation().isMatch());
  assertThat(response.getIndex(),equalTo("test"));
  assertThat(response.getType(),equalTo("test"));
  assertThat(response.getId(),equalTo("1"));
  assertThat(response.getExplanation().getValue(),equalTo(1.0f));
  client().admin().indices().prepareRefresh("test").execute().actionGet();
  response=client().prepareExplain("test","test","1").setQuery(QueryBuilders.termQuery("field","value2")).execute().actionGet();
  assertNotNull(response);
  assertTrue(response.isExists());
  assertFalse(response.isMatch());
  assertThat(response.getIndex(),equalTo("test"));
  assertThat(response.getType(),equalTo("test"));
  assertThat(response.getId(),equalTo("1"));
  assertNotNull(response.getExplanation());
  assertFalse(response.getExplanation().isMatch());
  client().admin().indices().prepareRefresh("test").execute().actionGet();
  response=client().prepareExplain("test","test","1").setQuery(QueryBuilders.boolQuery().must(QueryBuilders.termQuery("field","value1")).must(QueryBuilders.termQuery("field","value2"))).execute().actionGet();
  assertNotNull(response);
  assertTrue(response.isExists());
  assertFalse(response.isMatch());
  assertThat(response.getIndex(),equalTo("test"));
  assertThat(response.getType(),equalTo("test"));
  assertThat(response.getId(),equalTo("1"));
  assertNotNull(response.getExplanation());
  assertFalse(response.getExplanation().isMatch());
  assertThat(response.getExplanation().getDetails().length,equalTo(2));
  response=client().prepareExplain("test","test","2").setQuery(QueryBuilders.matchAllQuery()).execute().actionGet();
  assertNotNull(response);
  assertFalse(response.isExists());
  assertFalse(response.isMatch());
  assertThat(response.getIndex(),equalTo("test"));
  assertThat(response.getType(),equalTo("test"));
  assertThat(response.getId(),equalTo("2"));
}
