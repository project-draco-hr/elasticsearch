{
  Object key=bucket.getKey();
  if (key instanceof DateTime) {
    return ((DateTime)key).getMillis();
  }
 else   if (key instanceof Number) {
    return ((Number)key).longValue();
  }
 else {
    throw new AggregationExecutionException("Bucket keys must be either a Number or a DateTime for aggregation " + name() + ". Found bucket with key "+ key);
  }
}
