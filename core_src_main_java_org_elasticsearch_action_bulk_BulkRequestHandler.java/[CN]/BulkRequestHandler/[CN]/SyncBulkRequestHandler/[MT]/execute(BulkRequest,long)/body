{
  boolean afterCalled=false;
  try {
    listener.beforeBulk(executionId,bulkRequest);
    BulkResponse bulkResponse=Retry.on(EsRejectedExecutionException.class).policy(backoffPolicy).withSyncBackoff(client,bulkRequest);
    afterCalled=true;
    listener.afterBulk(executionId,bulkRequest,bulkResponse);
  }
 catch (  Exception e) {
    if (!afterCalled) {
      logger.warn("Failed to executed bulk request {}.",e,executionId);
      listener.afterBulk(executionId,bulkRequest,e);
    }
  }
}
