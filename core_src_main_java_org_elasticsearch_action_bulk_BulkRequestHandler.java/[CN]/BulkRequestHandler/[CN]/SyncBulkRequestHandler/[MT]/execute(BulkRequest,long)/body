{
  boolean afterCalled=false;
  try {
    listener.beforeBulk(executionId,bulkRequest);
    BulkResponse bulkResponse=Retry.on(EsRejectedExecutionException.class).policy(backoffPolicy).withSyncBackoff(client,bulkRequest);
    afterCalled=true;
    listener.afterBulk(executionId,bulkRequest,bulkResponse);
  }
 catch (  InterruptedException e) {
    Thread.currentThread().interrupt();
    logger.info(new ParameterizedMessage("Bulk request {} has been cancelled.",executionId),e);
    if (!afterCalled) {
      listener.afterBulk(executionId,bulkRequest,e);
    }
  }
catch (  Exception e) {
    logger.warn(new ParameterizedMessage("Failed to execute bulk request {}.",executionId),e);
    if (!afterCalled) {
      listener.afterBulk(executionId,bulkRequest,e);
    }
  }
}
