{
  boolean afterCalled=false;
  try {
    listener.beforeBulk(executionId,bulkRequest);
    BulkResponse bulkResponse=Retry.on(EsRejectedExecutionException.class).policy(backoffPolicy).withSyncBackoff(client,bulkRequest);
    afterCalled=true;
    listener.afterBulk(executionId,bulkRequest,bulkResponse);
  }
 catch (  InterruptedException e) {
    Thread.currentThread().interrupt();
    logger.info("Bulk request {} has been cancelled.",e,executionId);
    if (!afterCalled) {
      listener.afterBulk(executionId,bulkRequest,e);
    }
  }
catch (  Throwable t) {
    logger.warn("Failed to execute bulk request {}.",t,executionId);
    if (!afterCalled) {
      listener.afterBulk(executionId,bulkRequest,t);
    }
  }
}
