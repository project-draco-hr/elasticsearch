{
  try (NodeEnvironment env=newNodeEnvironment()){
    ShardId id=new ShardId("foo",1);
    long version=between(1,Integer.MAX_VALUE / 2);
    boolean primary=randomBoolean();
    ShardStateMetaData state1=new ShardStateMetaData(version,primary,"foo");
    ShardStateMetaData.write(logger,"foo",id,state1,randomBoolean(),env.shardPaths(id));
    ShardStateMetaData shardStateMetaData=ShardStateMetaData.load(logger,id,env.shardPaths(id));
    assertEquals(shardStateMetaData,state1);
    ShardStateMetaData state2=new ShardStateMetaData(version,primary,"foo");
    ShardStateMetaData.write(logger,"foo",id,state2,randomBoolean(),env.shardPaths(id));
    shardStateMetaData=ShardStateMetaData.load(logger,id,env.shardPaths(id));
    assertEquals(shardStateMetaData,state1);
    ShardStateMetaData state3=new ShardStateMetaData(version + 1,primary,"foo");
    ShardStateMetaData.write(logger,"foo",id,state3,randomBoolean(),env.shardPaths(id));
    shardStateMetaData=ShardStateMetaData.load(logger,id,env.shardPaths(id));
    assertEquals(shardStateMetaData,state3);
    assertEquals("foo",state3.indexUUID);
  }
 }
