{
  GetIndexResponse getIndexResponse=client().admin().indices().prepareGetIndex().addIndices(indexName).get();
  assertEquals(1,getIndexResponse.indices().length);
  assertEquals(indexName,getIndexResponse.indices()[0]);
  Version actualVersionCreated=Version.indexCreated(getIndexResponse.getSettings().get(indexName));
  assertEquals(indexCreated,actualVersionCreated);
  ensureYellow(indexName);
  IndicesSegmentResponse segmentsResponse=client().admin().indices().prepareSegments(indexName).get();
  IndexSegments segments=segmentsResponse.getIndices().get(indexName);
  for (  IndexShardSegments indexShardSegments : segments) {
    for (    ShardSegments shardSegments : indexShardSegments) {
      for (      Segment segment : shardSegments) {
        assertEquals(indexCreated.luceneVersion,segment.version);
      }
    }
  }
  SearchResponse test=client().prepareSearch(indexName).get();
  assertThat(test.getHits().getTotalHits(),greaterThanOrEqualTo(1l));
}
