{
  if (readOnly()) {
    throw new RepositoryException(this.repositoryName,"cannot create snapshot in a readonly repository");
  }
  try {
    if (snapshotFormat.exists(snapshotsBlobContainer,snapshotId.getSnapshot()) || snapshotLegacyFormat.exists(snapshotsBlobContainer,snapshotId.getSnapshot())) {
      throw new InvalidSnapshotNameException(snapshotId,"snapshot with such name already exists");
    }
    globalMetaDataFormat.write(metaData,snapshotsBlobContainer,snapshotId.getSnapshot());
    for (    String index : indices) {
      final IndexMetaData indexMetaData=metaData.index(index);
      final BlobPath indexPath=basePath().add("indices").add(index);
      final BlobContainer indexMetaDataBlobContainer=blobStore().blobContainer(indexPath);
      indexMetaDataFormat.write(indexMetaData,indexMetaDataBlobContainer,snapshotId.getSnapshot());
    }
  }
 catch (  IOException ex) {
    throw new SnapshotCreationException(snapshotId,ex);
  }
}
