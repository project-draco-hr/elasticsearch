{
  final ElasticsearchDirectoryReader esReader=ElasticsearchDirectoryReader.getElasticsearchDirectoryReader(reader);
  if (esReader != null) {
    return esReader.shardId();
  }
  if (!reader.leaves().isEmpty()) {
    return extractShardId(reader.leaves().get(0).reader());
  }
  return null;
}
