{
  Version versionCreated=VersionUtils.randomVersion(random());
  assertAcked(client().admin().indices().prepareCreate("test").setSettings(SETTING_NUMBER_OF_SHARDS,1,SETTING_NUMBER_OF_REPLICAS,0,SETTING_VERSION_CREATED,versionCreated.id));
  client().prepareIndex("test","test").setSource("{}").get();
  ensureGreen("test");
  IndicesService indicesService=getInstanceFromNode(IndicesService.class);
  IndexShard test=indicesService.indexService("test").shard(0);
  assertEquals(versionCreated.luceneVersion,test.minimumCompatibleVersion());
  client().prepareIndex("test","test").setSource("{}").get();
  assertEquals(versionCreated.luceneVersion,test.minimumCompatibleVersion());
  test.engine().flush();
  assertEquals(Version.CURRENT.luceneVersion,test.minimumCompatibleVersion());
}
