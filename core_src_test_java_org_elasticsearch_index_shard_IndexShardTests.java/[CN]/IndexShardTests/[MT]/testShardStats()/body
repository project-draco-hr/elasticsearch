{
  createIndex("test");
  ensureGreen();
  IndicesService indicesService=getInstanceFromNode(IndicesService.class);
  IndexService test=indicesService.indexService(resolveIndex("test"));
  IndexShard shard=test.getShardOrNull(0);
  ShardStats stats=new ShardStats(shard.routingEntry(),shard.shardPath(),new CommonStats(indicesService.getIndicesQueryCache(),test.cache().getPercolatorQueryCache(),shard,new CommonStatsFlags()),shard.commitStats());
  assertEquals(shard.shardPath().getRootDataPath().toString(),stats.getDataPath());
  assertEquals(shard.shardPath().getRootStatePath().toString(),stats.getStatePath());
  assertEquals(shard.shardPath().isCustomDataPath(),stats.isCustomDataPath());
  if (randomBoolean() || true) {
    BytesStreamOutput out=new BytesStreamOutput();
    stats.writeTo(out);
    StreamInput in=StreamInput.wrap(out.bytes());
    stats=ShardStats.readShardStats(in);
  }
  XContentBuilder builder=XContentFactory.jsonBuilder();
  builder.startObject();
  stats.toXContent(builder,EMPTY_PARAMS);
  builder.endObject();
  String xContent=builder.string();
  StringBuilder expectedSubSequence=new StringBuilder("\"shard_path\":{\"state_path\":\"");
  expectedSubSequence.append(shard.shardPath().getRootStatePath().toString());
  expectedSubSequence.append("\",\"data_path\":\"");
  expectedSubSequence.append(shard.shardPath().getRootDataPath().toString());
  expectedSubSequence.append("\",\"is_custom_data_path\":").append(shard.shardPath().isCustomDataPath()).append("}");
  assumeFalse("Some path weirdness on windows",Constants.WINDOWS);
  assertTrue(xContent.contains(expectedSubSequence));
}
