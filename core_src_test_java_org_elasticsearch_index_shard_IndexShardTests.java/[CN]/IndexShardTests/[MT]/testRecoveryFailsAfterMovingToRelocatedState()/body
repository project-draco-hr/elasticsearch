{
  createIndex("test");
  ensureGreen();
  IndicesService indicesService=getInstanceFromNode(IndicesService.class);
  IndexService test=indicesService.indexService(resolveIndex("test"));
  final IndexShard shard=test.getShardOrNull(0);
  ShardRouting origRouting=shard.routingEntry();
  assertThat(shard.state(),equalTo(IndexShardState.STARTED));
  ShardRouting inRecoveryRouting=ShardRoutingHelper.relocate(origRouting,"some_node");
  shard.updateRoutingEntry(inRecoveryRouting);
  shard.relocated("simulate mark as relocated");
  assertThat(shard.state(),equalTo(IndexShardState.RELOCATED));
  try {
    shard.updateRoutingEntry(origRouting);
    fail("Expected IndexShardRelocatedException");
  }
 catch (  IndexShardRelocatedException expected) {
  }
}
