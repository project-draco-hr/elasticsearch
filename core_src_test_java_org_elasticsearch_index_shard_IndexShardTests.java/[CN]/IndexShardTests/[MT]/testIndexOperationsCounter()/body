{
  assertAcked(client().admin().indices().prepareCreate("test").setSettings(Settings.builder().put("index.number_of_shards",1).put("index.number_of_replicas",0)).get());
  ensureGreen("test");
  IndicesService indicesService=getInstanceFromNode(IndicesService.class);
  IndexService indexService=indicesService.indexServiceSafe("test");
  IndexShard indexShard=indexService.getShardOrNull(0);
  assertEquals(0,indexShard.getActiveOperationsCount());
  Releasable operation1=indexShard.acquirePrimaryOperationLock();
  assertEquals(1,indexShard.getActiveOperationsCount());
  Releasable operation2=indexShard.acquirePrimaryOperationLock();
  assertEquals(2,indexShard.getActiveOperationsCount());
  Releasables.close(operation1,operation2);
  assertEquals(0,indexShard.getActiveOperationsCount());
}
