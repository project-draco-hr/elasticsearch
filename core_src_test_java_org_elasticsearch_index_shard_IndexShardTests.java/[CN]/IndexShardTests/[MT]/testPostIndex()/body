{
  createIndex("testpostindex");
  ensureGreen();
  IndicesService indicesService=getInstanceFromNode(IndicesService.class);
  IndexService test=indicesService.indexService("testpostindex");
  IndexShard shard=test.shard(0);
  ShardIndexingService shardIndexingService=shard.indexingService();
  final AtomicBoolean postIndexCalled=new AtomicBoolean(false);
  shardIndexingService.addListener(new IndexingOperationListener(){
    @Override public void postIndex(    Engine.Index index){
      postIndexCalled.set(true);
      super.postIndex(index);
    }
  }
);
  ParsedDocument doc=testParsedDocument("1","1","test",null,-1,-1,new ParseContext.Document(),new BytesArray(new byte[]{1}),null);
  Engine.Index index=new Engine.Index(new Term("_uid","1"),doc);
  shard.index(index);
  assertTrue(postIndexCalled.get());
}
