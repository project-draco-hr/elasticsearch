{
  createIndex("testpostindex");
  ensureGreen();
  IndicesService indicesService=getInstanceFromNode(IndicesService.class);
  IndexService test=indicesService.indexService("testpostindex");
  IndexShard shard=test.shard(0);
  ShardIndexingService shardIndexingService=shard.indexingService();
  final HashMap<String,Boolean> listenerInfo=new HashMap<>();
  listenerInfo.put("postIndexCalled",false);
  shardIndexingService.addListener(new IndexingOperationListener(){
    @Override public void postIndex(    Engine.Index index){
      listenerInfo.put("postIndexCalled",true);
      super.postIndex(index);
    }
  }
);
  ParsedDocument doc=testParsedDocument("1","1","test",null,-1,-1,new ParseContext.Document(),new BytesArray(new byte[]{1}),null);
  Engine.Index index=new Engine.Index(new Term("_uid","1"),doc);
  shard.index(index);
  assertTrue(listenerInfo.get("postIndexCalled"));
}
