{
  createIndex("test");
  ensureGreen("test");
  client().prepareIndex("test","bar","1").setSource("{}").setRefresh(true).get();
  client().admin().indices().prepareFlush("test").get();
  SearchResponse response=client().prepareSearch("test").get();
  assertHitCount(response,1l);
  IndicesService indicesService=getInstanceFromNode(IndicesService.class);
  IndexService test=indicesService.indexService("test");
  IndexShard shard=test.getShardOrNull(0);
  ShardPath shardPath=shard.shardPath();
  Path dataPath=shardPath.getDataPath();
  client().admin().indices().prepareClose("test").get();
  Path tempDir=createTempDir();
  Files.move(dataPath,tempDir.resolve("test"));
  client().admin().indices().prepareDelete("test").get();
  Files.createDirectories(dataPath.getParent());
  Files.move(tempDir.resolve("test"),dataPath);
  createIndex("test");
  ensureGreen("test");
  response=client().prepareSearch("test").get();
  assertHitCount(response,0l);
}
