{
  createIndex("testindexfortranslogsync");
  client().admin().indices().preparePutMapping("testindexfortranslogsync").setType("testtype").setSource(jsonBuilder().startObject().startObject("testtype").startObject("properties").startObject("foo").field("type","text").endObject().endObject().endObject().endObject()).get();
  ensureGreen();
  IndicesService indicesService=getInstanceFromNode(IndicesService.class);
  IndexService test=indicesService.indexService(resolveIndex("testindexfortranslogsync"));
  IndexShard shard=test.getShardOrNull(0);
  ShardRouting routing=getInitializingShardRouting(shard.routingEntry());
  test.removeShard(0,"b/c britta says so");
  IndexShard newShard=test.createShard(routing);
  DiscoveryNode localNode=new DiscoveryNode("foo",LocalTransportAddress.buildUnique(),emptyMap(),emptySet(),Version.CURRENT);
  newShard.markAsRecovering("for testing",new RecoveryState(routing,localNode,null));
  List<Translog.Operation> operations=new ArrayList<>();
  operations.add(new Translog.Index("testtype","1",BytesReference.toBytes(jsonBuilder().startObject().field("foo","bar").endObject().bytes())));
  newShard.prepareForIndexRecovery();
  newShard.recoveryState().getTranslog().totalOperations(operations.size());
  newShard.skipTranslogRecovery(IndexRequest.UNSET_AUTO_GENERATED_TIMESTAMP);
  newShard.performBatchRecovery(operations);
  assertFalse(newShard.getTranslog().syncNeeded());
}
