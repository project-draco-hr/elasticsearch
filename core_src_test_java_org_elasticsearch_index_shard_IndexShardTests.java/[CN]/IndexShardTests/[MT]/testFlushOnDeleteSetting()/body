{
  boolean initValue=randomBoolean();
  createIndex("test",settingsBuilder().put(IndexSettings.INDEX_FLUSH_ON_CLOSE,initValue).build());
  ensureGreen();
  IndicesService indicesService=getInstanceFromNode(IndicesService.class);
  IndexService test=indicesService.indexService("test");
  IndexShard shard=test.getShardOrNull(0);
  assertEquals(initValue,shard.getIndexSettings().isFlushOnClose());
  final boolean newValue=!initValue;
  assertAcked(client().admin().indices().prepareUpdateSettings("test").setSettings(settingsBuilder().put(IndexSettings.INDEX_FLUSH_ON_CLOSE,newValue).build()));
  assertEquals(newValue,shard.getIndexSettings().isFlushOnClose());
  try {
    assertAcked(client().admin().indices().prepareUpdateSettings("test").setSettings(settingsBuilder().put(IndexSettings.INDEX_FLUSH_ON_CLOSE,"FOOBAR").build()));
    fail("exception expected");
  }
 catch (  IllegalArgumentException ex) {
  }
  assertEquals(newValue,shard.getIndexSettings().isFlushOnClose());
}
