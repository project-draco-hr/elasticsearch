{
  assertAcked(client().admin().indices().prepareCreate("test").setSettings(Settings.builder().put("index.number_of_shards",1).put("index.number_of_replicas",0)).get());
  ensureGreen("test");
  IndicesService indicesService=getInstanceFromNode(IndicesService.class);
  IndexService indexService=indicesService.indexServiceSafe(resolveIndex("test"));
  IndexShard indexShard=indexService.getShardOrNull(0);
  client().admin().indices().prepareDelete("test").get();
  assertThat(indexShard.getActiveOperationsCount(),equalTo(0));
  try {
    indexShard.acquirePrimaryOperationLock();
    fail("we should not be able to increment anymore");
  }
 catch (  IndexShardClosedException e) {
  }
  try {
    indexShard.acquireReplicaOperationLock(indexShard.getPrimaryTerm());
    fail("we should not be able to increment anymore");
  }
 catch (  IndexShardClosedException e) {
  }
}
