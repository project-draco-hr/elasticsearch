{
  createIndex("test");
  ensureGreen();
  IndicesService indicesService=getInstanceFromNode(IndicesService.class);
  NodeEnvironment env=getInstanceFromNode(NodeEnvironment.class);
  IndexService test=indicesService.indexService(resolveIndex("test"));
  IndexShard shard=test.getShardOrNull(0);
  ShardStateMetaData shardStateMetaData=load(logger,env.availableShardPaths(shard.shardId));
  assertEquals(getShardStateMetadata(shard),shardStateMetaData);
  ShardRouting routing=shard.shardRouting;
  shard.updateRoutingEntry(routing);
  shardStateMetaData=load(logger,env.availableShardPaths(shard.shardId));
  assertEquals(shardStateMetaData,getShardStateMetadata(shard));
  assertEquals(shardStateMetaData,new ShardStateMetaData(routing.primary(),shard.indexSettings().getUUID(),routing.allocationId()));
  routing=TestShardRouting.relocate(shard.shardRouting,"some node",42L);
  shard.updateRoutingEntry(routing);
  shardStateMetaData=load(logger,env.availableShardPaths(shard.shardId));
  assertEquals(shardStateMetaData,getShardStateMetadata(shard));
  assertEquals(shardStateMetaData,new ShardStateMetaData(routing.primary(),shard.indexSettings().getUUID(),routing.allocationId()));
}
