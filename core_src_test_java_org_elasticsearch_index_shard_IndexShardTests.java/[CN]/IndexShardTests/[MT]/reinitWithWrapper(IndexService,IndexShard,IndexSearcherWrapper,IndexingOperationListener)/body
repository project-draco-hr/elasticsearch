{
  ShardRouting routing=new ShardRouting(shard.routingEntry());
  shard.close("simon says",true);
  IndexShard newShard=new IndexShard(shard.shardId(),indexService.getIndexSettings(),shard.shardPath(),shard.store(),indexService.cache(),indexService.mapperService(),indexService.similarityService(),indexService.fieldData(),shard.getEngineFactory(),indexService.getIndexEventListener(),wrapper,indexService.getThreadPool(),indexService.getBigArrays(),indexService.getSearchSlowLog(),null,listeners);
  ShardRoutingHelper.reinit(routing);
  newShard.updateRoutingEntry(routing,false);
  DiscoveryNode localNode=new DiscoveryNode("foo",DummyTransportAddress.INSTANCE,emptyMap(),emptySet(),Version.CURRENT);
  newShard.markAsRecovering("store",new RecoveryState(newShard.shardId(),routing.primary(),RecoveryState.Type.STORE,localNode,localNode));
  assertTrue(newShard.recoverFromStore(localNode));
  routing=new ShardRouting(routing);
  ShardRoutingHelper.moveToStarted(routing);
  newShard.updateRoutingEntry(routing,true);
  return newShard;
}
