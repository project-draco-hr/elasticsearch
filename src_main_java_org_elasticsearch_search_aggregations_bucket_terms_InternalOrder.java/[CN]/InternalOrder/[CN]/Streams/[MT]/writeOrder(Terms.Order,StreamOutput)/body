{
  out.writeByte(order.id());
  if (order instanceof Aggregation) {
    Aggregation aggregationOrder=(Aggregation)order;
    out.writeBoolean(((MultiBucketsAggregation.Bucket.SubAggregationComparator)aggregationOrder.comparator).asc());
    OrderPath path=((Aggregation)order).path();
    if (out.getVersion().onOrAfter(Version.V_1_1_0)) {
      out.writeString(path.toString());
    }
 else {
      OrderPath.Token token=path.lastToken();
      out.writeString(token.name);
      boolean hasValueName=token.key != null;
      out.writeBoolean(hasValueName);
      if (hasValueName) {
        out.writeString(token.key);
      }
    }
  }
 else   if (order instanceof CompoundOrder) {
    CompoundOrder compoundOrder=(CompoundOrder)order;
    out.writeVInt(compoundOrder.compoundOrder.size());
    for (    Terms.Order innerOrder : compoundOrder.compoundOrder) {
      Streams.writeOrder(innerOrder,out);
    }
  }
}
