{
  indexWriter.addDocument(testDocument());
  indexWriter.commit();
  assertThat(listCommits(dir).size(),equalTo(1));
  indexWriter.addDocument(testDocument());
  indexWriter.commit();
  assertThat(listCommits(dir).size(),equalTo(1));
  SnapshotIndexCommit snapshot=deletionPolicy.snapshot();
  indexWriter.addDocument(testDocument());
  indexWriter.commit();
  assertThat(listCommits(dir).size(),equalTo(2));
  SnapshotIndexCommits snapshots=deletionPolicy.snapshots();
  assertThat(snapshots.size(),equalTo(2));
  assertThat(snapshot.release(),equalTo(true));
  indexWriter.addDocument(testDocument());
  indexWriter.commit();
  assertThat(listCommits(dir).size(),equalTo(3));
  assertThat(snapshots.release(),equalTo(true));
  indexWriter.addDocument(testDocument());
  indexWriter.commit();
  assertThat(listCommits(dir).size(),equalTo(1));
}
