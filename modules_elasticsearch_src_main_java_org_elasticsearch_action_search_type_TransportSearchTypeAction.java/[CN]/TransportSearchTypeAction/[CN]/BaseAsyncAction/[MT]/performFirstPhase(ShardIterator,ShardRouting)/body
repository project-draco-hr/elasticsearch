{
  if (shard == null) {
    onFirstPhaseResult(null,shardIt,null);
  }
 else {
    DiscoveryNode node=nodes.get(shard.currentNodeId());
    if (node == null) {
      onFirstPhaseResult(shard,shardIt,null);
    }
 else {
      String[] filteringAliases=clusterState.metaData().filteringAliases(shard.index(),request.indices());
      sendExecuteFirstPhase(node,internalSearchRequest(shard,shardsIts.size(),request,filteringAliases),new SearchServiceListener<FirstResult>(){
        @Override public void onResult(        FirstResult result){
          onFirstPhaseResult(shard,result,shardIt);
        }
        @Override public void onFailure(        Throwable t){
          onFirstPhaseResult(shard,shardIt,t);
        }
      }
);
    }
  }
}
