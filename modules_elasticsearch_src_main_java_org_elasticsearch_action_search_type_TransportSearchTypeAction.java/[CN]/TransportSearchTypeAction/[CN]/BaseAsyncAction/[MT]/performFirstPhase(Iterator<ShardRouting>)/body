{
  if (!shardIt.hasNext()) {
    return;
  }
  final ShardRouting shard=shardIt.next();
  if (!shard.active()) {
    onFirstPhaseResult(shard,shardIt,null);
  }
 else {
    Node node=nodes.get(shard.currentNodeId());
    sendExecuteFirstPhase(node,internalSearchRequest(shard,request),new SearchServiceListener<FirstResult>(){
      @Override public void onResult(      FirstResult result){
        onFirstPhaseResult(shard,result,shardIt);
      }
      @Override public void onFailure(      Throwable t){
        onFirstPhaseResult(shard,shardIt,t);
      }
    }
);
  }
}
