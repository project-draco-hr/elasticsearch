{
  MockAppender mockAppender=new MockAppender();
  Logger rootLogger=Logger.getRootLogger();
  Level savedLevel=rootLogger.getLevel();
  rootLogger.addAppender(mockAppender);
  rootLogger.setLevel(Level.TRACE);
  try {
    assertAcked(prepareCreate("test").setSettings(ImmutableSettings.builder().put(IndexMetaData.SETTING_NUMBER_OF_SHARDS,"1").put(IndexMetaData.SETTING_NUMBER_OF_REPLICAS,"0").put(TieredMergePolicyProvider.INDEX_MERGE_POLICY_MAX_MERGE_AT_ONCE,"2").put(TieredMergePolicyProvider.INDEX_MERGE_POLICY_SEGMENTS_PER_TIER,"2").put(ConcurrentMergeSchedulerProvider.MAX_THREAD_COUNT,"1").put(ConcurrentMergeSchedulerProvider.MAX_MERGE_COUNT,"2")));
    client().admin().indices().prepareUpdateSettings("test").setSettings(ImmutableSettings.builder().put(ConcurrentMergeSchedulerProvider.AUTO_THROTTLE,"no")).get();
    assertTrue(mockAppender.sawUpdateAutoThrottle);
    GetSettingsResponse getSettingsResponse=client().admin().indices().prepareGetSettings("test").get();
    assertThat(getSettingsResponse.getSetting("test",ConcurrentMergeSchedulerProvider.AUTO_THROTTLE),equalTo("no"));
  }
  finally {
    rootLogger.removeAppender(mockAppender);
    rootLogger.setLevel(savedLevel);
  }
}
