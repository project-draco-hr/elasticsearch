{
  createIndex("test");
  client().prepareIndex("test","type","1").setSource("f",1).get();
  client().prepareDelete("test","type","1").get();
  client().prepareIndex("test","type","1").setSource("f",2).setVersion(2).get();
  client().admin().indices().prepareUpdateSettings("test").setSettings(Settings.settingsBuilder().put("index.gc_deletes",0)).get();
  client().prepareDelete("test","type","1").get();
  Thread.sleep(300);
  assertThrows(client().prepareIndex("test","type","1").setSource("f",3).setVersion(4),VersionConflictEngineException.class);
}
