{
  BytesStreamOutput bytesOut=new BytesStreamOutput();
  HandlesStreamOutput out=new HandlesStreamOutput(bytesOut,5);
  String lowerThresholdValue="test";
  String higherThresholdValue="something that is higher than 5";
  out.writeString(lowerThresholdValue);
  out.writeString(higherThresholdValue);
  out.writeInt(1);
  out.writeString("else");
  out.writeString(higherThresholdValue);
  out.writeString(lowerThresholdValue);
  HandlesStreamInput in=new HandlesStreamInput(new BytesStreamInput(bytesOut.bytes().toBytes(),false));
  assertThat(in.readString(),equalTo(lowerThresholdValue));
  assertThat(in.readString(),equalTo(higherThresholdValue));
  assertThat(in.readInt(),equalTo(1));
  assertThat(in.readString(),equalTo("else"));
  assertThat(in.readString(),equalTo(higherThresholdValue));
  assertThat(in.readString(),equalTo(lowerThresholdValue));
}
