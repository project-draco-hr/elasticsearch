{
  if (maxNumFragments < 0) {
    throw new IllegalArgumentException("maxNumFragments(" + maxNumFragments + ") must be positive number.");
  }
  List<String> fragments=new ArrayList<String>(maxNumFragments);
  List<FieldFragList.WeightedFragInfo> fragInfos=fieldFragList.getFragInfos();
  Field[] values=getFields(reader,docId,fieldName);
  if (values.length == 0) {
    return null;
  }
  if (discreteMultiValueHighlighting && values.length > 1) {
    fragInfos=discreteMultiValueHighlighting(fragInfos,values);
  }
  fragInfos=getWeightedFragInfoList(fragInfos);
  StringBuilder buffer=new StringBuilder();
  int[] nextValueIndex={0};
  for (int n=0; n < maxNumFragments && n < fragInfos.size(); n++) {
    FieldFragList.WeightedFragInfo fragInfo=fragInfos.get(n);
    fragments.add(makeFragment(buffer,nextValueIndex,values,fragInfo,preTags,postTags,encoder));
  }
  return fragments.toArray(new String[fragments.size()]);
}
