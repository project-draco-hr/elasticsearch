{
  QueryBuilder innerQueryBuilder=queryBuilder.query();
  if (innerQueryBuilder instanceof EmptyQueryBuilder) {
    assertNull(query);
  }
 else   if (context.indexVersionCreated().onOrAfter(Version.V_2_0_0_beta1)) {
    assertThat(query,instanceOf(HasChildQueryBuilder.LateParsingQuery.class));
    HasChildQueryBuilder.LateParsingQuery lpq=(HasChildQueryBuilder.LateParsingQuery)query;
    assertEquals(queryBuilder.score() ? ScoreMode.Max : ScoreMode.None,lpq.getScoreMode());
  }
 else {
    if (queryBuilder.score()) {
      assertThat(query,instanceOf(ParentQuery.class));
      ParentQuery pq=(ParentQuery)query;
      assertEquals(queryBuilder.boost(),pq.getBoost(),0f);
    }
 else {
      assertThat(query,instanceOf(ParentConstantScoreQuery.class));
      ParentConstantScoreQuery csq=(ParentConstantScoreQuery)query;
      assertEquals(queryBuilder.boost(),csq.getBoost(),0f);
    }
  }
  if (queryBuilder.innerHit() != null) {
    assertNotNull(SearchContext.current());
    if (query != null) {
      assertNotNull(SearchContext.current().innerHits());
      assertEquals(1,SearchContext.current().innerHits().getInnerHits().size());
      assertTrue(SearchContext.current().innerHits().getInnerHits().containsKey("inner_hits_name"));
      InnerHitsContext.BaseInnerHits innerHits=SearchContext.current().innerHits().getInnerHits().get("inner_hits_name");
      assertEquals(innerHits.size(),100);
      assertEquals(innerHits.sort().getSort().length,1);
      assertEquals(innerHits.sort().getSort()[0].getField(),STRING_FIELD_NAME);
    }
 else {
      assertNull(SearchContext.current().innerHits());
    }
  }
}
