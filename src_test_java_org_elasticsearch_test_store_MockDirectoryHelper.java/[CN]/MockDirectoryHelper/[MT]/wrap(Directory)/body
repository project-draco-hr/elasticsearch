{
  final ElasticsearchMockDirectoryWrapper w=new ElasticsearchMockDirectoryWrapper(random,dir,logger,failOnClose);
  w.setRandomIOExceptionRate(randomIOExceptionRate);
  w.setRandomIOExceptionRateOnOpen(randomIOExceptionRateOnOpen);
  w.setThrottling(throttle);
  w.setCheckIndexOnClose(checkIndexOnClose);
  w.setPreventDoubleWrite(preventDoubleWrite);
  w.setNoDeleteOpenFile(noDeleteOpenFile);
  wrappers.add(w);
  return new FilterDirectory(w){
    @Override public Directory getDelegate(){
      return w.getDelegate();
    }
  }
;
}
