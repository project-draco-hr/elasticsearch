{
  QueryRescoreContext rescore=(QueryRescoreContext)rescoreContext;
  ContextIndexSearcher searcher=context.searcher();
  if (sourceExplanation == null) {
    return new ComplexExplanation(false,0.0f,"nothing matched");
  }
  Explanation rescoreExplain=searcher.explain(rescore.query(),topLevelDocId);
  float primaryWeight=rescore.queryWeight();
  ComplexExplanation prim=new ComplexExplanation(sourceExplanation.isMatch(),sourceExplanation.getValue() * primaryWeight,"product of:");
  prim.addDetail(sourceExplanation);
  prim.addDetail(new Explanation(primaryWeight,"primaryWeight"));
  if (rescoreExplain != null && rescoreExplain.isMatch()) {
    float secondaryWeight=rescore.rescoreQueryWeight();
    ComplexExplanation sec=new ComplexExplanation(rescoreExplain.isMatch(),rescoreExplain.getValue() * secondaryWeight,"product of:");
    sec.addDetail(rescoreExplain);
    sec.addDetail(new Explanation(secondaryWeight,"secondaryWeight"));
    ScoreMode scoreMode=rescore.scoreMode();
    ComplexExplanation calcExpl=new ComplexExplanation();
    calcExpl.setDescription(scoreMode + " of:");
    calcExpl.addDetail(prim);
    calcExpl.setMatch(prim.isMatch());
    calcExpl.addDetail(sec);
    calcExpl.setValue(scoreMode.combine(prim.getValue(),sec.getValue()));
    return calcExpl;
  }
 else {
    return prim;
  }
}
