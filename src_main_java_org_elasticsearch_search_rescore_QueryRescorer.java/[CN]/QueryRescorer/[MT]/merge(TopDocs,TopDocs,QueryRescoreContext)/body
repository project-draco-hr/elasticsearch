{
  DocIdSorter sorter=new DocIdSorter();
  sorter.array=primary.scoreDocs;
  sorter.mergeSort(0,sorter.array.length - 1);
  ScoreDoc[] primaryDocs=sorter.array;
  sorter.array=secondary.scoreDocs;
  sorter.mergeSort(0,sorter.array.length - 1);
  ScoreDoc[] secondaryDocs=sorter.array;
  int j=0;
  float primaryWeight=context.queryWeight();
  float secondaryWeight=context.rescoreQueryWeight();
  for (int i=0; i < primaryDocs.length && j < secondaryDocs.length; i++) {
    if (primaryDocs[i].doc == secondaryDocs[j].doc) {
      primaryDocs[i].score=(primaryDocs[i].score * primaryWeight) + (secondaryDocs[j++].score * secondaryWeight);
    }
 else {
      primaryDocs[i].score*=primaryWeight;
    }
  }
  ScoreSorter scoreSorter=new ScoreSorter();
  scoreSorter.array=primaryDocs;
  scoreSorter.mergeSort(0,primaryDocs.length - 1);
  primary.setMaxScore(primaryDocs[0].score);
  return primary;
}
