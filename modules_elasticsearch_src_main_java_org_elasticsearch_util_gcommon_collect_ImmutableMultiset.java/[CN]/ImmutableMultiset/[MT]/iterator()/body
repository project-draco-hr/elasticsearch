{
  final Iterator<Map.Entry<E,Integer>> mapIterator=map.entrySet().iterator();
  return new UnmodifiableIterator<E>(){
    int remaining;
    E element;
    public boolean hasNext(){
      return (remaining > 0) || mapIterator.hasNext();
    }
    public E next(){
      if (remaining <= 0) {
        Map.Entry<E,Integer> entry=mapIterator.next();
        element=entry.getKey();
        remaining=entry.getValue();
      }
      remaining--;
      return element;
    }
  }
;
}
