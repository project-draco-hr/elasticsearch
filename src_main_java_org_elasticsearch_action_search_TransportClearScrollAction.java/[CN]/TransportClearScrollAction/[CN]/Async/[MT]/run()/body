{
  if (expectedOps.isCountedDown()) {
    listener.onResponse(new ClearScrollResponse(true));
    return;
  }
  if (contexts.isEmpty()) {
    for (    final DiscoveryNode node : nodes) {
      searchServiceTransportAction.sendClearAllScrollContexts(node,request,new ActionListener<Boolean>(){
        @Override public void onResponse(        Boolean success){
          onFreedContext();
        }
        @Override public void onFailure(        Throwable e){
          onFailedFreedContext(e,node);
        }
      }
);
    }
  }
 else {
    for (    Tuple<String,Long>[] context : contexts) {
      for (      Tuple<String,Long> target : context) {
        final DiscoveryNode node=nodes.get(target.v1());
        if (node == null) {
          onFreedContext();
          continue;
        }
        searchServiceTransportAction.sendFreeContext(node,target.v2(),request,new ActionListener<Boolean>(){
          @Override public void onResponse(          Boolean success){
            onFreedContext();
          }
          @Override public void onFailure(          Throwable e){
            onFailedFreedContext(e,node);
          }
        }
);
      }
    }
  }
}
