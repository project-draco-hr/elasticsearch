{
  BytesStreamOutput os=new BytesStreamOutput();
  PrintStream out=new PrintStream(os,false,Charsets.UTF_8.name());
  try (Directory directory=new SimpleFSDirectory(targetPath.resolveIndex());final CheckIndex checkIndex=new CheckIndex(directory)){
    checkIndex.setInfoStream(out);
    CheckIndex.Status status=checkIndex.checkIndex();
    out.flush();
    if (!status.clean) {
      logger.warn("check index [failure]\n{}",new String(os.bytes().toBytes(),Charsets.UTF_8));
      throw new IllegalStateException("index check failure");
    }
  }
 }
