{
  long total_bytes=0;
  long to_upgrade_bytes=0;
  long to_upgrade_bytes_ancient=0;
  for (  IndexShardSegments shard : indexSegments) {
    for (    ShardSegments segs : shard.getShards()) {
      for (      Segment seg : segs.getSegments()) {
        total_bytes+=seg.sizeInBytes;
        if (seg.version.major != Version.CURRENT.luceneVersion.major) {
          to_upgrade_bytes_ancient+=seg.sizeInBytes;
          to_upgrade_bytes+=seg.sizeInBytes;
        }
 else         if (seg.version.minor != Version.CURRENT.luceneVersion.minor) {
          to_upgrade_bytes+=seg.sizeInBytes;
        }
      }
    }
  }
  builder.byteSizeField(SIZE_IN_BYTES,SIZE,total_bytes);
  builder.byteSizeField(SIZE_TO_UPGRADE_IN_BYTES,SIZE_TO_UPGRADE,to_upgrade_bytes);
  builder.byteSizeField(SIZE_TO_UPGRADE_ANCIENT_IN_BYTES,SIZE_TO_UPGRADE_ANCIENT,to_upgrade_bytes_ancient);
}
