{
  IndicesSegmentsRequest segsReq=new IndicesSegmentsRequest(Strings.splitStringByCommaToArray(request.param("index")));
  client.admin().indices().segments(segsReq,new RestBuilderListener<IndicesSegmentResponse>(channel){
    @Override public RestResponse buildResponse(    IndicesSegmentResponse response,    XContentBuilder builder) throws Exception {
      builder.startObject();
      for (      IndexSegments indexSegments : response.getIndices().values()) {
        Tuple<Long,Long> summary=calculateUpgradeStatus(indexSegments);
        builder.startObject(indexSegments.getIndex());
        builder.byteSizeField(SIZE_IN_BYTES,SIZE,summary.v1());
        builder.byteSizeField(SIZE_TO_UPGRADE_IN_BYTES,SIZE_TO_UPGRADE,summary.v2());
        builder.endObject();
      }
      builder.endObject();
      return new BytesRestResponse(OK,builder);
    }
  }
);
}
