{
  final CompletionMappingBuilder mapping=new CompletionMappingBuilder();
  createIndexAndMapping(mapping);
  List<IndexRequestBuilder> indexRequestBuilders=Arrays.asList(client().prepareIndex(INDEX,TYPE,"1").setSource(FIELD,"suggestion","test_field","test"),client().prepareIndex(INDEX,TYPE,"2").setSource(FIELD,"suggestion"));
  indexRandom(true,indexRequestBuilders);
  CompletionSuggestionBuilder prefix=SuggestBuilders.completionSuggestion(FIELD).prefix("sugg").payload(Collections.singletonList("test_field"));
  SearchResponse searchResponse=client().prepareSearch(INDEX).suggest(new SuggestBuilder().addSuggestion("foo",prefix)).execute().actionGet();
  assertNoFailures(searchResponse);
  CompletionSuggestion completionSuggestion=searchResponse.getSuggest().getSuggestion("foo");
  CompletionSuggestion.Entry options=completionSuggestion.getEntries().get(0);
  assertThat(options.getOptions().size(),equalTo(2));
  for (  CompletionSuggestion.Entry.Option option : options.getOptions()) {
    assertThat(option.getPayload().keySet(),contains("test_field"));
  }
}
