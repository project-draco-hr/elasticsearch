{
  final CompletionMappingBuilder mapping=new CompletionMappingBuilder();
  createIndexAndMapping(mapping);
  List<IndexRequestBuilder> indexRequestBuilders=Arrays.asList(client().prepareIndex(INDEX,TYPE,"1").setSource(FIELD,"suggestion","test_field","test"),client().prepareIndex(INDEX,TYPE,"2").setSource(FIELD,"suggestion"));
  indexRandom(true,indexRequestBuilders);
  CompletionSuggestionBuilder prefix=SuggestBuilders.completionSuggestion("foo").field(FIELD).prefix("sugg").payload(Collections.singletonList("test_field"));
  SuggestResponse suggestResponse=client().prepareSuggest(INDEX).addSuggestion(prefix).execute().actionGet();
  assertNoFailures(suggestResponse);
  CompletionSuggestion completionSuggestion=suggestResponse.getSuggest().getSuggestion("foo");
  CompletionSuggestion.Entry options=completionSuggestion.getEntries().get(0);
  assertThat(options.getOptions().size(),equalTo(2));
  for (  CompletionSuggestion.Entry.Option option : options.getOptions()) {
    assertThat(option.getPayload().keySet(),contains("test_field"));
  }
}
