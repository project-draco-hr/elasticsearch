{
  super(settings);
  this.nodeEnv=nodeEnv;
  this.format=XContentType.fromRestContentType(settings.get(FORMAT_SETTING,"smile"));
  if (this.format == XContentType.SMILE) {
    Map<String,String> params=new HashMap<>();
    params.put("binary","true");
    formatParams=new ToXContent.MapParams(params);
    Map<String,String> gatewayModeParams=new HashMap<>();
    gatewayModeParams.put("binary","true");
    gatewayModeParams.put(MetaData.CONTEXT_MODE_PARAM,MetaData.CONTEXT_MODE_GATEWAY);
    gatewayModeFormatParams=new ToXContent.MapParams(gatewayModeParams);
  }
 else {
    formatParams=ToXContent.EMPTY_PARAMS;
    Map<String,String> gatewayModeParams=new HashMap<>();
    gatewayModeParams.put(MetaData.CONTEXT_MODE_PARAM,MetaData.CONTEXT_MODE_GATEWAY);
    gatewayModeFormatParams=new ToXContent.MapParams(gatewayModeParams);
  }
  indexStateFormat=indexStateFormat(format,formatParams);
  globalStateFormat=globalStateFormat(format,gatewayModeFormatParams);
}
