{
  if (!settings.getAsBoolean("cloud.node.auto_attributes",false)) {
    return null;
  }
  Map<String,String> ec2Attributes=Maps.newHashMap();
  URLConnection urlConnection;
  InputStream in=null;
  try {
    URL url=new URL(AwsEc2Service.EC2_METADATA_URL + "placement/availability-zone");
    logger.debug("obtaining ec2 [placement/availability-zone] from ec2 meta-data url {}",url);
    urlConnection=url.openConnection();
    urlConnection.setConnectTimeout(2000);
    in=urlConnection.getInputStream();
    BufferedReader urlReader=new BufferedReader(new InputStreamReader(in));
    String metadataResult=urlReader.readLine();
    if (metadataResult == null || metadataResult.length() == 0) {
      logger.error("no ec2 metadata returned from {}",url);
      return null;
    }
    ec2Attributes.put("aws_availability_zone",metadataResult);
  }
 catch (  IOException e) {
    logger.debug("failed to get metadata for [placement/availability-zone]: " + ExceptionsHelper.detailedMessage(e));
  }
 finally {
    Closeables.closeQuietly(in);
  }
  return ec2Attributes;
}
