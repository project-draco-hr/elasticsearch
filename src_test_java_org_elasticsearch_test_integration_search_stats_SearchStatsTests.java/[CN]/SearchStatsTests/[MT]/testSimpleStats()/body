{
  createIndex("test1");
  for (int i=0; i < 500; i++) {
    client().prepareIndex("test1","type",Integer.toString(i)).setSource("field","value").execute().actionGet();
    if (i == 10) {
      refresh();
    }
  }
  createIndex("test2");
  for (int i=0; i < 500; i++) {
    client().prepareIndex("test2","type",Integer.toString(i)).setSource("field","value").execute().actionGet();
    if (i == 10) {
      refresh();
    }
  }
  cluster().ensureAtMostNumNodes(numAssignedShards("test1","test2"));
  for (int i=0; i < 200; i++) {
    client().prepareSearch().setQuery(QueryBuilders.termQuery("field","value")).setStats("group1","group2").execute().actionGet();
  }
  IndicesStatsResponse indicesStats=client().admin().indices().prepareStats().execute().actionGet();
  assertThat(indicesStats.getTotal().getSearch().getTotal().getQueryCount(),greaterThan(0l));
  assertThat(indicesStats.getTotal().getSearch().getTotal().getQueryTimeInMillis(),greaterThan(0l));
  assertThat(indicesStats.getTotal().getSearch().getTotal().getFetchCount(),greaterThan(0l));
  assertThat(indicesStats.getTotal().getSearch().getTotal().getFetchTimeInMillis(),greaterThan(0l));
  assertThat(indicesStats.getTotal().getSearch().getGroupStats(),nullValue());
  indicesStats=client().admin().indices().prepareStats().setGroups("group1").execute().actionGet();
  assertThat(indicesStats.getTotal().getSearch().getGroupStats(),notNullValue());
  assertThat(indicesStats.getTotal().getSearch().getGroupStats().get("group1").getQueryCount(),greaterThan(0l));
  assertThat(indicesStats.getTotal().getSearch().getGroupStats().get("group1").getQueryTimeInMillis(),greaterThan(0l));
  assertThat(indicesStats.getTotal().getSearch().getGroupStats().get("group1").getFetchCount(),greaterThan(0l));
  assertThat(indicesStats.getTotal().getSearch().getGroupStats().get("group1").getFetchTimeInMillis(),greaterThan(0l));
  NodesStatsResponse nodeStats=client().admin().cluster().prepareNodesStats().execute().actionGet();
  assertThat(nodeStats.getNodes()[0].getIndices().getSearch().getTotal().getQueryCount(),greaterThan(0l));
  assertThat(nodeStats.getNodes()[0].getIndices().getSearch().getTotal().getQueryTimeInMillis(),greaterThan(0l));
}
