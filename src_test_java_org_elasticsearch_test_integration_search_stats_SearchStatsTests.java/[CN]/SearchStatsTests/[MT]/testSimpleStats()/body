{
  client.admin().indices().prepareDelete().execute().actionGet();
  for (int i=0; i < 500; i++) {
    client.prepareIndex("test1","type",Integer.toString(i)).setSource("field","value").execute().actionGet();
    if (i == 10) {
      client.admin().indices().prepareRefresh("test1").execute().actionGet();
    }
  }
  for (int i=0; i < 500; i++) {
    client.prepareIndex("test2","type",Integer.toString(i)).setSource("field","value").execute().actionGet();
    if (i == 10) {
      client.admin().indices().prepareRefresh("test1").execute().actionGet();
    }
  }
  for (int i=0; i < 200; i++) {
    client.prepareSearch().setQuery(QueryBuilders.termQuery("field","value")).setStats("group1","group2").execute().actionGet();
  }
  IndicesStats indicesStats=client.admin().indices().prepareStats().execute().actionGet();
  assertThat(indicesStats.total().search().total().queryCount(),greaterThan(0l));
  assertThat(indicesStats.total().search().total().queryTimeInMillis(),greaterThan(0l));
  assertThat(indicesStats.total().search().total().fetchCount(),greaterThan(0l));
  assertThat(indicesStats.total().search().total().fetchTimeInMillis(),greaterThan(0l));
  assertThat(indicesStats.total().search().groupStats(),nullValue());
  indicesStats=client.admin().indices().prepareStats().setGroups("group1").execute().actionGet();
  assertThat(indicesStats.total().search().groupStats(),notNullValue());
  assertThat(indicesStats.total().search().groupStats().get("group1").queryCount(),greaterThan(0l));
  assertThat(indicesStats.total().search().groupStats().get("group1").queryTimeInMillis(),greaterThan(0l));
  assertThat(indicesStats.total().search().groupStats().get("group1").fetchCount(),greaterThan(0l));
  assertThat(indicesStats.total().search().groupStats().get("group1").fetchTimeInMillis(),greaterThan(0l));
  NodesStatsResponse nodeStats=client.admin().cluster().prepareNodesStats().execute().actionGet();
  assertThat(nodeStats.nodes()[0].indices().getSearch().total().queryCount(),greaterThan(0l));
  assertThat(nodeStats.nodes()[0].indices().getSearch().total().queryTimeInMillis(),greaterThan(0l));
}
