{
  int totalNumberOfShards=0;
  for (  ObjectCursor<IndexMetaData> cursor : metaData.indices().values()) {
    IndexMetaData indexMetaData=cursor.value;
    if (indexMetaData.state() == IndexMetaData.State.OPEN) {
      totalNumberOfShards+=indexMetaData.totalNumberOfShards();
    }
  }
  return totalNumberOfShards / nodesToShards.size();
}
