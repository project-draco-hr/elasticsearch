{
  ShardRoutingState oldState=shard.state();
  shard.assignToNode(nodeId);
  node(nodeId).add(shard);
  if (oldState == ShardRoutingState.UNASSIGNED) {
    inactiveShardCount++;
    if (shard.primary()) {
      unassignedPrimaryCount--;
      inactivePrimaryCount++;
    }
  }
  if (shard.state() == ShardRoutingState.RELOCATING) {
    relocatingReplicaSets.add(shard.shardId());
  }
  addToReplicaSet(shard);
}
