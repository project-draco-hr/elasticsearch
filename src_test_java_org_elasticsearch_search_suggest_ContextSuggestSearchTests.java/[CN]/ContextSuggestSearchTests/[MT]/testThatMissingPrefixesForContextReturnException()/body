{
  XContentBuilder xContentBuilder=jsonBuilder().startObject().startObject("service").startObject("properties").startObject("suggest").field("type","completion").startObject("context").startObject("color").field("type","category").field("path","color").endObject().endObject().endObject().endObject().endObject().endObject();
  assertAcked(prepareCreate(INDEX).addMapping("service",xContentBuilder));
  ensureYellow();
  index(INDEX,"service","1",jsonBuilder().startObject().field("color","red").startObject("suggest").field("input","backback").endObject().endObject());
  try {
    index(INDEX,"service","2",jsonBuilder().startObject().startObject("suggest").field("input","backback").endObject().endObject());
    fail("index operation was not supposed to be successful");
  }
 catch (  ElasticsearchIllegalArgumentException e) {
    assertThat(e.getMessage(),containsString("one or more prefixes needed"));
  }
}
