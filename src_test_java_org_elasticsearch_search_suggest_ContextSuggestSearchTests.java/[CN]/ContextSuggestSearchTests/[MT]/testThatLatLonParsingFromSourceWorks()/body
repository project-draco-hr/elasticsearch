{
  XContentBuilder xContentBuilder=jsonBuilder().startObject().startObject("mappings").startObject("test").startObject("properties").startObject("suggest_geo").field("type","completion").startObject("context").startObject("location").field("type","geo").field("precision","1km").endObject().endObject().endObject().endObject().endObject().endObject().endObject();
  assertAcked(prepareCreate("test").setSource(xContentBuilder.bytes()));
  double latitude=52.22;
  double longitude=4.53;
  String geohash=GeoHashUtils.encode(latitude,longitude);
  XContentBuilder doc1=jsonBuilder().startObject().startObject("suggest_geo").field("input","Hotel Marriot in Amsterdam").startObject("context").startObject("location").field("lat",latitude).field("lon",longitude).endObject().endObject().endObject().endObject();
  index("test","test","1",doc1);
  XContentBuilder doc2=jsonBuilder().startObject().startObject("suggest_geo").field("input","Hotel Marriot in Berlin").startObject("context").startObject("location").field("lat",53.31).field("lon",13.24).endObject().endObject().endObject().endObject();
  index("test","test","2",doc2);
  refresh();
  XContentBuilder source=jsonBuilder().startObject().startObject("suggestion").field("text","h").startObject("completion").field("field","suggest_geo").startObject("context").field("location",geohash).endObject().endObject().endObject().endObject();
  SuggestRequest suggestRequest=new SuggestRequest(INDEX).suggest(source.bytes());
  SuggestResponse suggestResponse=client().suggest(suggestRequest).get();
  assertSuggestion(suggestResponse.getSuggest(),0,"suggestion","Hotel Marriot in Amsterdam");
  source=jsonBuilder().startObject().startObject("suggestion").field("text","h").startObject("completion").field("field","suggest_geo").startObject("context").startObject("location").field("lat",latitude).field("lon",longitude).endObject().endObject().endObject().endObject().endObject();
  suggestRequest=new SuggestRequest(INDEX).suggest(source.bytes());
  suggestResponse=client().suggest(suggestRequest).get();
  assertSuggestion(suggestResponse.getSuggest(),0,"suggestion","Hotel Marriot in Amsterdam");
}
