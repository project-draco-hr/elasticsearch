{
  XContentBuilder xContentBuilder=jsonBuilder().startObject().startObject("item").startObject("properties").startObject("suggest").field("type","completion").startObject("context").startObject("color").field("type","category").field("default","red").endObject().endObject().endObject().endObject().endObject().endObject();
  assertAcked(prepareCreate(INDEX).addMapping("item",xContentBuilder));
  ensureYellow();
  index(INDEX,"item","1",jsonBuilder().startObject().startObject("suggest").field("input","Hoodie red").endObject().endObject());
  index(INDEX,"item","2",jsonBuilder().startObject().startObject("suggest").field("input","Hoodie blue").startObject("context").field("color","blue").endObject().endObject().endObject());
  refresh();
  CompletionSuggestionBuilder suggestionBuilder=new CompletionSuggestionBuilder("suggestion").field("suggest").text("h").size(10).addContextField("color","red");
  SuggestResponse suggestResponse=client().prepareSuggest(INDEX).addSuggestion(suggestionBuilder).get();
  assertSuggestion(suggestResponse.getSuggest(),0,"suggestion","Hoodie red");
}
