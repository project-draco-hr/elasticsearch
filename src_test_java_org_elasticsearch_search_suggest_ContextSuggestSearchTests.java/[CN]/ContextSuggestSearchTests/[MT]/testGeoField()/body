{
  XContentBuilder mapping=jsonBuilder();
  mapping.startObject();
  mapping.startObject(TYPE);
  mapping.startObject("properties");
  mapping.startObject("pin");
  mapping.field("type","geo_point");
  mapping.endObject();
  mapping.startObject(FIELD);
  mapping.field("type","completion");
  mapping.field("index_analyzer","simple");
  mapping.field("search_analyzer","simple");
  mapping.startObject("context");
  mapping.value(ContextBuilder.location("st",5,true).field("pin").build());
  mapping.endObject();
  mapping.endObject();
  mapping.endObject();
  mapping.endObject();
  mapping.endObject();
  assertAcked(prepareCreate(INDEX).addMapping(TYPE,mapping));
  ensureYellow();
  XContentBuilder source1=jsonBuilder().startObject().latlon("pin",52.529172,13.407333).startObject(FIELD).array("input","Hotel Amsterdam","Amsterdam").field("output","Hotel Amsterdam in Berlin").startObject("context").endObject().endObject().endObject();
  client().prepareIndex(INDEX,TYPE,"1").setSource(source1).execute().actionGet();
  XContentBuilder source2=jsonBuilder().startObject().latlon("pin",52.363389,4.888695).startObject(FIELD).array("input","Hotel Berlin","Berlin").field("output","Hotel Berlin in Amsterdam").startObject("context").endObject().endObject().endObject();
  client().prepareIndex(INDEX,TYPE,"2").setSource(source2).execute().actionGet();
  refresh();
  String suggestionName=RandomStrings.randomAsciiOfLength(new Random(),10);
  CompletionSuggestionBuilder context=new CompletionSuggestionBuilder(suggestionName).field(FIELD).text("h").size(10).addGeoLocation("st",52.52,13.4);
  SuggestRequestBuilder suggestionRequest=client().prepareSuggest(INDEX).addSuggestion(context);
  SuggestResponse suggestResponse=suggestionRequest.execute().actionGet();
  assertEquals(suggestResponse.getSuggest().size(),1);
  assertEquals("Hotel Amsterdam in Berlin",suggestResponse.getSuggest().getSuggestion(suggestionName).iterator().next().getOptions().iterator().next().getText().string());
}
