{
  Query percolatorTypeFilter=context.indexService().mapperService().documentMapper(TYPE_NAME).typeFilter();
  final Query filter;
  if (context.aliasFilter() != null) {
    BooleanQuery.Builder booleanFilter=new BooleanQuery.Builder();
    booleanFilter.add(context.aliasFilter(),BooleanClause.Occur.MUST);
    booleanFilter.add(percolatorTypeFilter,BooleanClause.Occur.MUST);
    filter=booleanFilter.build();
  }
 else {
    filter=percolatorTypeFilter;
  }
  Query query=Queries.filtered(context.percolateQuery(),filter);
  percolatorSearcher.searcher().search(query,percolateCollector);
  percolateCollector.aggregatorCollector.postCollection();
  if (context.aggregations() != null) {
    aggregationPhase.execute(context);
  }
}
