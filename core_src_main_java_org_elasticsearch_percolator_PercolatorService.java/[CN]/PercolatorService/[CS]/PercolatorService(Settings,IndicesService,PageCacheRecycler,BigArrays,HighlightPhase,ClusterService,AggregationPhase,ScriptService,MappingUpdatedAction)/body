{
  super(settings);
  this.parseFieldMatcher=new ParseFieldMatcher(settings);
  this.indicesService=indicesService;
  this.pageCacheRecycler=pageCacheRecycler;
  this.bigArrays=bigArrays;
  this.clusterService=clusterService;
  this.highlightPhase=highlightPhase;
  this.aggregationPhase=aggregationPhase;
  this.scriptService=scriptService;
  this.mappingUpdatedAction=mappingUpdatedAction;
  this.sortParseElement=new SortParseElement();
  final long maxReuseBytes=settings.getAsBytesSize("indices.memory.memory_index.size_per_thread",new ByteSizeValue(1,ByteSizeUnit.MB)).bytes();
  cache=new CloseableThreadLocal<MemoryIndex>(){
    @Override protected MemoryIndex initialValue(){
      return new ExtendedMemoryIndex(true,false,maxReuseBytes);
    }
  }
;
  single=new SingleDocumentPercolatorIndex(cache);
  multi=new MultiDocumentPercolatorIndex(cache);
  percolatorTypes=new IntObjectHashMap<>(6);
  percolatorTypes.put(countPercolator.id(),countPercolator);
  percolatorTypes.put(queryCountPercolator.id(),queryCountPercolator);
  percolatorTypes.put(matchPercolator.id(),matchPercolator);
  percolatorTypes.put(queryPercolator.id(),queryPercolator);
  percolatorTypes.put(scoringPercolator.id(),scoringPercolator);
  percolatorTypes.put(topMatchingPercolator.id(),topMatchingPercolator);
}
