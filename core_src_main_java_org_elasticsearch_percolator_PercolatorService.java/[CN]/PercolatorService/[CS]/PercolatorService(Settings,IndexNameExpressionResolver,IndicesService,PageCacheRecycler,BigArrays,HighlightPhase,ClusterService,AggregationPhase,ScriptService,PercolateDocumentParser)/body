{
  super(settings);
  this.indexNameExpressionResolver=indexNameExpressionResolver;
  this.percolateDocumentParser=percolateDocumentParser;
  this.parseFieldMatcher=new ParseFieldMatcher(settings);
  this.indicesService=indicesService;
  this.pageCacheRecycler=pageCacheRecycler;
  this.bigArrays=bigArrays;
  this.clusterService=clusterService;
  this.scriptService=scriptService;
  this.aggregationPhase=aggregationPhase;
  this.highlightPhase=highlightPhase;
  final long maxReuseBytes=settings.getAsBytesSize("indices.memory.memory_index.size_per_thread",new ByteSizeValue(1,ByteSizeUnit.MB)).bytes();
  cache=new CloseableThreadLocal<MemoryIndex>(){
    @Override protected MemoryIndex initialValue(){
      return new ExtendedMemoryIndex(true,false,maxReuseBytes);
    }
  }
;
  single=new SingleDocumentPercolatorIndex(cache);
  multi=new MultiDocumentPercolatorIndex(cache);
}
