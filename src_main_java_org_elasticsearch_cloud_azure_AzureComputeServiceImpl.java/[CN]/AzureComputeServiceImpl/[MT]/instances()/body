{
  if (socketFactory == null) {
    if (logger.isTraceEnabled())     logger.trace("azure plugin is disabled. Returning an empty list of nodes.");
    return new HashSet<Instance>();
  }
 else {
    try {
      String SERVICE_NAME=componentSettings.get(Fields.SERVICE_NAME,settings.get("cloud." + Fields.SERVICE_NAME));
      InputStream stream=getXML("/services/hostedservices/" + SERVICE_NAME + "?embed-detail=true");
      Set<Instance> instances=buildInstancesFromXml(stream,port_name);
      if (logger.isTraceEnabled())       logger.trace("get instances from azure: {}",instances);
      return instances;
    }
 catch (    ParserConfigurationException e) {
      logger.warn("can not parse XML response: {}",e.getMessage());
      return new HashSet<Instance>();
    }
catch (    XPathExpressionException e) {
      logger.warn("can not parse XML response: {}",e.getMessage());
      return new HashSet<Instance>();
    }
catch (    SAXException e) {
      logger.warn("can not parse XML response: {}",e.getMessage());
      return new HashSet<Instance>();
    }
catch (    Exception e) {
      logger.warn("can not get list of azure nodes: {}",e.getMessage());
      return new HashSet<Instance>();
    }
  }
}
