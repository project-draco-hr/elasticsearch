{
  String indexName="index-0.90.6";
  loadIndex(indexName);
  assertMinVersion(indexName,org.apache.lucene.util.Version.parse("4.5.1"));
  UpgradeTest.assertNotUpgraded(client(),indexName);
  assertTrue(UpgradeTest.hasAncientSegments(client(),indexName));
  assertNoFailures(client().admin().indices().prepareUpgrade(indexName).setUpgradeOnlyAncientSegments(true).get());
  assertFalse(UpgradeTest.hasAncientSegments(client(),"index-0.90.6"));
  UpgradeTest.assertUpgraded(client(),indexName);
  assertEquals(Version.CURRENT.luceneVersion.toString(),client().admin().indices().prepareGetSettings(indexName).get().getSetting(indexName,IndexMetaData.SETTING_VERSION_MINIMUM_COMPATIBLE));
  assertMinVersion(indexName,Version.CURRENT.luceneVersion);
}
