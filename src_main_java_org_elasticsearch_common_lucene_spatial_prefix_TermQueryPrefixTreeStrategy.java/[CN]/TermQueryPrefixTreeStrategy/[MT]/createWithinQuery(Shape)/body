{
  Query intersectsQuery=createIntersectsQuery(shape);
  Geometry shapeGeometry=ShapeBuilder.toJTSGeometry(shape);
  Geometry buffer=BufferOp.bufferOp(shapeGeometry,WITHIN_BUFFER_DISTANCE,BUFFER_PARAMETERS);
  Shape bufferedShape=new JtsGeometry(buffer.difference(shapeGeometry),GeoShapeConstants.SPATIAL_CONTEXT,true);
  Query bufferedQuery=createIntersectsQuery(bufferedShape);
  BooleanQuery query=new BooleanQuery();
  query.add(intersectsQuery,BooleanClause.Occur.SHOULD);
  query.add(bufferedQuery,BooleanClause.Occur.MUST_NOT);
  return new ConstantScoreQuery(query);
}
