{
  client1.admin().indices().prepareDelete().execute().actionGet();
  logger.info("--> creating index [test]");
  client1.admin().indices().create(createIndexRequest("test")).actionGet();
  logger.info("--> running cluster_health");
  ClusterHealthResponse clusterHealth=client1.admin().cluster().health(clusterHealthRequest().waitForGreenStatus()).actionGet();
  logger.info("--> done cluster_health, status " + clusterHealth.status());
  assertThat(clusterHealth.timedOut(),equalTo(false));
  assertThat(clusterHealth.status(),equalTo(ClusterHealthStatus.GREEN));
  logger.info("--> aliasing index [test] with [alias1] and filter [user:kimchy]");
  FilterBuilder filter=termFilter("user","kimchy");
  client1.admin().indices().prepareAliases().addAlias("test","alias1",filter).execute().actionGet();
  Thread.sleep(300);
  logger.info("--> making sure that filter was stored with alias [alias1] and filter [user:kimchy]");
  ClusterState clusterState=client1.admin().cluster().prepareState().execute().actionGet().state();
  IndexMetaData indexMd=clusterState.metaData().index("test");
  assertThat(indexMd.aliases().get("alias1").filter().string(),equalTo("{\"term\":{\"user\":\"kimchy\"}}"));
}
