{
  if (nodeInfo == null) {
    throw new IllegalStateException("Node has not started yet");
  }
  if (client == null) {
    TransportAddress addr=nodeInfo.getTransport().getAddress().publishAddress();
    Settings clientSettings=settingsBuilder().put(externalNodeSettings).put("client.transport.nodes_sampler_interval","1s").put("name","transport_client_" + nodeInfo.getNode().name()).put(ClusterName.SETTING,clusterName).put("client.transport.sniff",false).build();
    TransportClient client=TransportClient.builder().settings(clientSettings).build();
    client.addTransportAddress(addr);
    this.client=client;
  }
  return client;
}
