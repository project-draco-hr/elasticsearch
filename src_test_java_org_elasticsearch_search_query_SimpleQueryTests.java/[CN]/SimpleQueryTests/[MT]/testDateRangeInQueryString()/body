{
  assertAcked(client().admin().indices().prepareCreate("test").setSettings(SETTING_NUMBER_OF_SHARDS,1));
  String aMonthAgo=ISODateTimeFormat.yearMonthDay().print(new DateTime(DateTimeZone.UTC).minusMonths(1));
  String aMonthFromNow=ISODateTimeFormat.yearMonthDay().print(new DateTime(DateTimeZone.UTC).plusMonths(1));
  client().prepareIndex("test","type","1").setSource("past",aMonthAgo,"future",aMonthFromNow).get();
  refresh();
  SearchResponse searchResponse=client().prepareSearch().setQuery(queryString("past:[now-2M/d TO now/d]")).get();
  assertHitCount(searchResponse,1l);
  searchResponse=client().prepareSearch().setQuery(queryString("future:[now/d TO now+2M/d]").lowercaseExpandedTerms(false)).get();
  assertHitCount(searchResponse,1l);
  try {
    client().prepareSearch().setQuery(queryString("future:[now/D TO now+2M/d]").lowercaseExpandedTerms(false)).get();
    fail("D is an unsupported unit in date math");
  }
 catch (  Exception e) {
  }
}
