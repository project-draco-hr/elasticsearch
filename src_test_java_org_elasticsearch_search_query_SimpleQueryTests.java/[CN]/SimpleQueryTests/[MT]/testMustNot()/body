{
  client().admin().indices().prepareDelete().execute().actionGet();
  client().admin().indices().prepareCreate("test").setSettings(ImmutableSettings.settingsBuilder().put("index.number_of_shards",2).put("index.number_of_replicas",0)).execute().actionGet();
  ensureGreen();
  client().prepareIndex("test","test","1").setSource(jsonBuilder().startObject().field("description","foo other anything bar").endObject()).execute().actionGet();
  client().prepareIndex("test","test","2").setSource(jsonBuilder().startObject().field("description","foo other anything").endObject()).execute().actionGet();
  client().prepareIndex("test","test","3").setSource(jsonBuilder().startObject().field("description","foo other").endObject()).execute().actionGet();
  client().prepareIndex("test","test","4").setSource(jsonBuilder().startObject().field("description","foo").endObject()).execute().actionGet();
  client().admin().indices().prepareRefresh().execute().actionGet();
  SearchResponse response=client().prepareSearch("test").setQuery(QueryBuilders.matchAllQuery()).setSearchType(SearchType.DFS_QUERY_THEN_FETCH).execute().actionGet();
  assertNoFailures(response);
  assertThat(response.getHits().totalHits(),equalTo(4l));
  response=client().prepareSearch("test").setQuery(QueryBuilders.boolQuery().mustNot(QueryBuilders.matchQuery("description","anything").type(Type.BOOLEAN))).setSearchType(SearchType.DFS_QUERY_THEN_FETCH).execute().actionGet();
  assertThat(response.getShardFailures().length,equalTo(0));
  assertThat(response.getHits().totalHits(),equalTo(2l));
}
