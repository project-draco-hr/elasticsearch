{
  createIndex("index1","index2");
  ensureGreen();
  client().prepareIndex("index1","type1").setId("1").setSource("text","value").get();
  client().prepareIndex("index2","type2").setId("2").setSource("text","value").get();
  refresh();
  SearchResponse response=client().prepareSearch("index1","index2").setQuery(indicesQuery(matchQuery("text","value"),"index1").noMatchQuery(matchQuery("text","value"))).get();
  assertHitCount(response,2l);
  assertThat(response.getHits().getAt(0).getId(),either(equalTo("1")).or(equalTo("2")));
  assertThat(response.getHits().getAt(1).getId(),either(equalTo("1")).or(equalTo("2")));
  response=client().prepareSearch("index1","index2").setQuery(indicesQuery(matchQuery("text","value"),"index1")).get();
  assertHitCount(response,2l);
  assertThat(response.getHits().getAt(0).getId(),either(equalTo("1")).or(equalTo("2")));
  assertThat(response.getHits().getAt(1).getId(),either(equalTo("1")).or(equalTo("2")));
  response=client().prepareSearch("index1","index2").setQuery(indicesQuery(matchQuery("text","value"),"index1").noMatchQuery("all")).get();
  assertHitCount(response,2l);
  assertThat(response.getHits().getAt(0).getId(),either(equalTo("1")).or(equalTo("2")));
  assertThat(response.getHits().getAt(1).getId(),either(equalTo("1")).or(equalTo("2")));
  response=client().prepareSearch("index1","index2").setQuery(indicesQuery(matchQuery("text","value"),"index1").noMatchQuery("none")).get();
  assertHitCount(response,1l);
  assertThat(response.getHits().getAt(0).getId(),equalTo("1"));
}
