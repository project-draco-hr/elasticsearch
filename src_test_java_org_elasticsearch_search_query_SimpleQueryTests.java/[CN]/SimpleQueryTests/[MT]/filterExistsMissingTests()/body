{
  createIndex("test");
  indexRandom(true,client().prepareIndex("test","type1","1").setSource(jsonBuilder().startObject().startObject("obj1").field("obj1_val","1").endObject().field("x1","x_1").field("field1","value1_1").field("field2","value2_1").endObject()),client().prepareIndex("test","type1","2").setSource(jsonBuilder().startObject().startObject("obj1").field("obj1_val","1").endObject().field("x2","x_2").field("field1","value1_2").endObject()),client().prepareIndex("test","type1","3").setSource(jsonBuilder().startObject().startObject("obj2").field("obj2_val","1").endObject().field("y1","y_1").field("field2","value2_3").endObject()),client().prepareIndex("test","type1","4").setSource(jsonBuilder().startObject().startObject("obj2").field("obj2_val","1").endObject().field("y2","y_2").field("field3","value3_4").endObject()));
  SearchResponse searchResponse=client().prepareSearch().setQuery(filteredQuery(matchAllQuery(),existsFilter("field1"))).get();
  assertHitCount(searchResponse,2l);
  assertSearchHits(searchResponse,"1","2");
  searchResponse=client().prepareSearch().setQuery(constantScoreQuery(existsFilter("field1"))).get();
  assertHitCount(searchResponse,2l);
  assertSearchHits(searchResponse,"1","2");
  searchResponse=client().prepareSearch().setQuery(queryStringQuery("_exists_:field1")).get();
  assertHitCount(searchResponse,2l);
  assertSearchHits(searchResponse,"1","2");
  searchResponse=client().prepareSearch().setQuery(filteredQuery(matchAllQuery(),existsFilter("field2"))).get();
  assertHitCount(searchResponse,2l);
  assertSearchHits(searchResponse,"1","3");
  searchResponse=client().prepareSearch().setQuery(filteredQuery(matchAllQuery(),existsFilter("field3"))).get();
  assertHitCount(searchResponse,1l);
  assertFirstHit(searchResponse,hasId("4"));
  searchResponse=client().prepareSearch().setQuery(filteredQuery(matchAllQuery(),existsFilter("x*"))).get();
  assertHitCount(searchResponse,2l);
  assertSearchHits(searchResponse,"1","2");
  searchResponse=client().prepareSearch().setQuery(filteredQuery(matchAllQuery(),existsFilter("obj1"))).get();
  assertHitCount(searchResponse,2l);
  assertSearchHits(searchResponse,"1","2");
  searchResponse=client().prepareSearch().setQuery(filteredQuery(matchAllQuery(),missingFilter("field1"))).get();
  assertHitCount(searchResponse,2l);
  assertSearchHits(searchResponse,"3","4");
  searchResponse=client().prepareSearch().setQuery(filteredQuery(matchAllQuery(),missingFilter("field1"))).get();
  assertHitCount(searchResponse,2l);
  assertSearchHits(searchResponse,"3","4");
  searchResponse=client().prepareSearch().setQuery(constantScoreQuery(missingFilter("field1"))).get();
  assertHitCount(searchResponse,2l);
  assertSearchHits(searchResponse,"3","4");
  searchResponse=client().prepareSearch().setQuery(queryStringQuery("_missing_:field1")).get();
  assertHitCount(searchResponse,2l);
  assertSearchHits(searchResponse,"3","4");
  searchResponse=client().prepareSearch().setQuery(filteredQuery(matchAllQuery(),missingFilter("x*"))).get();
  assertHitCount(searchResponse,2l);
  assertSearchHits(searchResponse,"3","4");
  searchResponse=client().prepareSearch().setQuery(filteredQuery(matchAllQuery(),missingFilter("obj1"))).get();
  assertHitCount(searchResponse,2l);
  assertSearchHits(searchResponse,"3","4");
}
