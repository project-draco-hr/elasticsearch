{
  CloseableHttpResponse response;
  try {
    response=client.execute(connection.getHost(),request);
  }
 catch (  IOException e) {
    RequestLogger.log(logger,"request failed",request.getRequestLine(),connection.getHost(),e);
    throw e;
  }
 finally {
    request.reset();
  }
  StatusLine statusLine=response.getStatusLine();
  if (statusLine.getStatusCode() < 300 || request.getMethod().equals(HttpHead.METHOD_NAME) && statusLine.getStatusCode() == 404) {
    RequestLogger.log(logger,"request succeeded",request.getRequestLine(),connection.getHost(),response.getStatusLine());
    return new ElasticsearchResponse(request.getRequestLine(),connection.getHost(),response);
  }
 else {
    EntityUtils.consume(response.getEntity());
    RequestLogger.log(logger,"request failed",request.getRequestLine(),connection.getHost(),response.getStatusLine());
    throw new ElasticsearchResponseException(request.getRequestLine(),connection.getHost(),statusLine);
  }
}
