{
  for (; ; ) {
    long s=getReconciledState();
    int phase=phaseOf(s);
    int parties=partiesOf(s);
    int unarrived=unarrivedOf(s);
    if (phase < 0 || casState(s,stateFor(-1,parties,unarrived))) {
      releaseWaiters(0);
      releaseWaiters(1);
      if (parent != null)       parent.forceTermination();
      return;
    }
  }
}
