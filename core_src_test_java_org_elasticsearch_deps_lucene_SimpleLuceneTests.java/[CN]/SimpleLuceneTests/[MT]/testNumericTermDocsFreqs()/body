{
  Directory dir=new RAMDirectory();
  IndexWriter indexWriter=new IndexWriter(dir,new IndexWriterConfig(Lucene.STANDARD_ANALYZER));
  Document doc=new Document();
  FieldType type=LegacyIntField.TYPE_NOT_STORED;
  LegacyIntField field=new LegacyIntField("int1",1,type);
  doc.add(field);
  type=new FieldType(LegacyIntField.TYPE_NOT_STORED);
  type.setIndexOptions(IndexOptions.DOCS_AND_FREQS);
  type.freeze();
  field=new LegacyIntField("int1",1,type);
  doc.add(field);
  field=new LegacyIntField("int2",1,type);
  doc.add(field);
  field=new LegacyIntField("int2",1,type);
  doc.add(field);
  indexWriter.addDocument(doc);
  IndexReader reader=DirectoryReader.open(indexWriter);
  LeafReader atomicReader=SlowCompositeReaderWrapper.wrap(reader);
  Terms terms=atomicReader.terms("int1");
  TermsEnum termsEnum=terms.iterator();
  termsEnum.next();
  PostingsEnum termDocs=termsEnum.postings(null);
  assertThat(termDocs.nextDoc(),equalTo(0));
  assertThat(termDocs.docID(),equalTo(0));
  assertThat(termDocs.freq(),equalTo(1));
  terms=atomicReader.terms("int2");
  termsEnum=terms.iterator();
  termsEnum.next();
  termDocs=termsEnum.postings(termDocs);
  assertThat(termDocs.nextDoc(),equalTo(0));
  assertThat(termDocs.docID(),equalTo(0));
  assertThat(termDocs.freq(),equalTo(2));
  reader.close();
  indexWriter.close();
}
