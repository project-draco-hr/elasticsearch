{
  this.delegate=delegate;
synchronized (mutex) {
    MapBuilder<String,StoreFileMetaData> builder=MapBuilder.newMapBuilder();
    for (    String file : delegate.listAll()) {
      if (file.endsWith(".md5")) {
        continue;
      }
      try {
        String md5=preComputedMd5(file);
        if (md5 != null) {
          if (shouldWriteMd5(file)) {
            writeMd5File(delegate,file,md5);
          }
        }
        builder.put(file,new StoreFileMetaData(file,delegate.fileLength(file),delegate.fileModified(file),md5));
      }
 catch (      FileNotFoundException e) {
      }
    }
    filesMetadata=builder.immutableMap();
    files=filesMetadata.keySet().toArray(new String[filesMetadata.size()]);
  }
}
