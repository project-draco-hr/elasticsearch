{
  IndexOutput checkSumOutput=((StoreDirectory)directory()).delegate().createOutput(name + ".cks");
  byte[] checksumBytes=Unicode.fromStringAsBytes(checksum);
  checkSumOutput.writeBytes(checksumBytes,checksumBytes.length);
  checkSumOutput.close();
synchronized (mutex) {
    StoreFileMetaData metaData=filesMetadata.get(name);
    metaData=new StoreFileMetaData(metaData.name(),metaData.length(),metaData.lastModified(),checksum);
    filesMetadata=MapBuilder.newMapBuilder(filesMetadata).put(name,metaData).immutableMap();
  }
}
