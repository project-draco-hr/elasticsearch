{
  if (event.state().blocks().disableStatePersistence()) {
    this.currentMetaData=null;
    return;
  }
  MetaData newMetaData=event.state().metaData();
  if (currentMetaData != null) {
    for (    IndexMetaData current : currentMetaData) {
      if (!newMetaData.hasIndex(current.index())) {
        logger.debug("[{}] deleting index that is no longer part of the metadata (indices: [{}])",current.index(),newMetaData.indices().keys());
        if (nodeEnv.hasNodeFile()) {
          try {
            IOUtils.rm(FileSystemUtils.toPaths(nodeEnv.indexLocations(new Index(current.index()))));
          }
 catch (          Exception ex) {
            logger.debug("failed to delete shard locations",ex);
          }
        }
        try {
          nodeIndexDeletedAction.nodeIndexStoreDeleted(event.state(),current.index(),event.state().nodes().localNodeId());
        }
 catch (        Exception e) {
          logger.debug("[{}] failed to notify master on local index store deletion",e,current.index());
        }
      }
    }
  }
  currentMetaData=newMetaData;
}
