{
  if (event.state().blocks().disableStatePersistence()) {
    this.currentMetaData=null;
    return;
  }
  MetaData newMetaData=event.state().metaData();
  if (nodeEnv.hasNodeFile()) {
    if (currentMetaData != null) {
      for (      IndexMetaData current : currentMetaData) {
        if (!newMetaData.hasIndex(current.index())) {
          logger.debug("[{}] deleting index that is no longer part of the metadata (indices: [{}])",current.index(),newMetaData.indices().keySet());
          FileSystemUtils.deleteRecursively(nodeEnv.indexLocations(new Index(current.index())));
          try {
            nodeIndexDeletedAction.nodeIndexStoreDeleted(current.index(),event.state().nodes().masterNodeId());
          }
 catch (          Exception e) {
            logger.debug("[{}] failed to notify master on local index store deletion",e,current.index());
          }
        }
      }
    }
  }
  currentMetaData=newMetaData;
}
