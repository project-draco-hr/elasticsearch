{
  ScriptParameterParser scriptParameterParser=new ScriptParameterParser();
  XContentType xContentType=XContentFactory.xContentType(source);
  try (XContentParser parser=XContentFactory.xContent(xContentType).createParser(source)){
    XContentParser.Token token=parser.nextToken();
    if (token == null) {
      return this;
    }
    String currentFieldName=null;
    while ((token=parser.nextToken()) != XContentParser.Token.END_OBJECT) {
      if (token == XContentParser.Token.FIELD_NAME) {
        currentFieldName=parser.currentName();
      }
 else       if ("params".equals(currentFieldName)) {
        scriptParams=parser.map();
      }
 else       if ("scripted_upsert".equals(currentFieldName)) {
        scriptedUpsert=parser.booleanValue();
      }
 else       if ("upsert".equals(currentFieldName)) {
        XContentBuilder builder=XContentFactory.contentBuilder(xContentType);
        builder.copyCurrentStructure(parser);
        safeUpsertRequest().source(builder);
      }
 else       if ("doc".equals(currentFieldName)) {
        XContentBuilder docBuilder=XContentFactory.contentBuilder(xContentType);
        docBuilder.copyCurrentStructure(parser);
        safeDoc().source(docBuilder);
      }
 else       if ("doc_as_upsert".equals(currentFieldName)) {
        docAsUpsert(parser.booleanValue());
      }
 else       if ("detect_noop".equals(currentFieldName)) {
        detectNoop(parser.booleanValue());
      }
 else {
        scriptParameterParser.token(currentFieldName,token,parser);
      }
    }
    ScriptParameterValue scriptValue=scriptParameterParser.getDefaultScriptParameterValue();
    if (scriptValue != null) {
      script=scriptValue.script();
      scriptType=scriptValue.scriptType();
    }
    scriptLang=scriptParameterParser.lang();
  }
   return this;
}
