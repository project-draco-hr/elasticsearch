{
  if (len == 0) {
    return 0;
  }
  if (pos >= offset + length) {
    return -1;
  }
  final int numBytesToCopy=Math.min(len,length - pos);
  long byteArrayOffset=offset + pos;
  int copiedBytes=0;
  while (copiedBytes < numBytesToCopy) {
    long pageFragment=PAGE_SIZE - (byteArrayOffset % PAGE_SIZE);
    int bulkSize=(int)Math.min(pageFragment,numBytesToCopy - copiedBytes);
    boolean copied=bytearray.get(byteArrayOffset,bulkSize,ref);
    assert(copied == false);
    System.arraycopy(ref.bytes,ref.offset,b,bOffset + copiedBytes,bulkSize);
    copiedBytes+=bulkSize;
    byteArrayOffset+=bulkSize;
  }
  pos+=copiedBytes;
  return copiedBytes;
}
