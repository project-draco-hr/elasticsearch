{
  try (ReleasableLock lock=writeLock.acquire()){
    operationCounter++;
    long position=lastPosition;
    if (data.length() >= buffer.length) {
      flushBuffer();
      data.writeTo(channelReference.channel());
      lastWrittenPosition+=data.length();
      lastPosition+=data.length();
      return new Translog.Location(id,position,data.length());
    }
    if (data.length() > buffer.length - bufferCount) {
      flushBuffer();
    }
    data.writeTo(bufferOs);
    lastPosition+=data.length();
    return new Translog.Location(id,position,data.length());
  }
 }
