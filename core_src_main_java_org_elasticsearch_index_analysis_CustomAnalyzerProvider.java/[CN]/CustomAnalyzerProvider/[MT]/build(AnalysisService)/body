{
  String tokenizerName=analyzerSettings.get("tokenizer");
  if (tokenizerName == null) {
    throw new IllegalArgumentException("Custom Analyzer [" + name() + "] must be configured with a tokenizer");
  }
  TokenizerFactory tokenizer=analysisService.tokenizer(tokenizerName);
  if (tokenizer == null) {
    throw new IllegalArgumentException("Custom Analyzer [" + name() + "] failed to find tokenizer under name ["+ tokenizerName+ "]");
  }
  List<CharFilterFactory> charFilters=newArrayList();
  String[] charFilterNames=analyzerSettings.getAsArray("char_filter");
  for (  String charFilterName : charFilterNames) {
    CharFilterFactory charFilter=analysisService.charFilter(charFilterName);
    if (charFilter == null) {
      throw new IllegalArgumentException("Custom Analyzer [" + name() + "] failed to find char_filter under name ["+ charFilterName+ "]");
    }
    charFilters.add(charFilter);
  }
  List<TokenFilterFactory> tokenFilters=newArrayList();
  String[] tokenFilterNames=analyzerSettings.getAsArray("filter");
  for (  String tokenFilterName : tokenFilterNames) {
    TokenFilterFactory tokenFilter=analysisService.tokenFilter(tokenFilterName);
    if (tokenFilter == null) {
      throw new IllegalArgumentException("Custom Analyzer [" + name() + "] failed to find filter under name ["+ tokenFilterName+ "]");
    }
    tokenFilters.add(tokenFilter);
  }
  int positionOffsetGap=analyzerSettings.getAsInt("position_offset_gap",0);
  int offsetGap=analyzerSettings.getAsInt("offset_gap",-1);
  this.customAnalyzer=new CustomAnalyzer(tokenizer,charFilters.toArray(new CharFilterFactory[charFilters.size()]),tokenFilters.toArray(new TokenFilterFactory[tokenFilters.size()]),positionOffsetGap,offsetGap);
}
