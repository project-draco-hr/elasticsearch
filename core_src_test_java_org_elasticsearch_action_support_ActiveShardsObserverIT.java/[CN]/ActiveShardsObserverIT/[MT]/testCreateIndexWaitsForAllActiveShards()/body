{
  final int numReplicas=internalCluster().numDataNodes() + randomInt(4);
  Settings settings=Settings.builder().put(indexSettings()).put(INDEX_NUMBER_OF_SHARDS_SETTING.getKey(),randomIntBetween(1,5)).put(INDEX_NUMBER_OF_REPLICAS_SETTING.getKey(),numReplicas).build();
  assertFalse(prepareCreate("test-idx1").setSettings(settings).setWaitForActiveShards(ActiveShardCount.ALL).setTimeout("100ms").get().isShardsAcked());
  settings=Settings.builder().put(indexSettings()).put(INDEX_NUMBER_OF_SHARDS_SETTING.getKey(),randomIntBetween(1,7)).put(INDEX_NUMBER_OF_REPLICAS_SETTING.getKey(),internalCluster().numDataNodes() - 1).build();
  assertAcked(prepareCreate("test-idx2").setSettings(settings).setWaitForActiveShards(ActiveShardCount.ALL).get());
}
