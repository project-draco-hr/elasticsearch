{
  int randomInt=randomInt(PreBuiltAnalyzers.values().length - 1);
  PreBuiltAnalyzers randomPreBuiltAnalyzer=PreBuiltAnalyzers.values()[randomInt];
  String analyzerName=randomPreBuiltAnalyzer.name().toLowerCase(Locale.ROOT);
  Version randomVersion=randomVersion();
  Settings indexSettings=ImmutableSettings.settingsBuilder().put(IndexMetaData.SETTING_VERSION_CREATED,randomVersion).build();
  NamedAnalyzer namedAnalyzer=new PreBuiltAnalyzerProvider(analyzerName,AnalyzerScope.INDEX,randomPreBuiltAnalyzer.getAnalyzer(randomVersion)).get();
  String mapping=XContentFactory.jsonBuilder().startObject().startObject("type").startObject("properties").startObject("field").field("type","string").field("analyzer",analyzerName).endObject().endObject().endObject().endObject().string();
  DocumentMapper docMapper=MapperTestUtils.newParser(indexSettings).parse(mapping);
  FieldMapper fieldMapper=docMapper.mappers().name("field").mapper();
  assertThat(fieldMapper.searchAnalyzer(),instanceOf(NamedAnalyzer.class));
  NamedAnalyzer fieldMapperNamedAnalyzer=(NamedAnalyzer)fieldMapper.searchAnalyzer();
  assertThat(fieldMapperNamedAnalyzer.analyzer(),is(namedAnalyzer.analyzer()));
}
