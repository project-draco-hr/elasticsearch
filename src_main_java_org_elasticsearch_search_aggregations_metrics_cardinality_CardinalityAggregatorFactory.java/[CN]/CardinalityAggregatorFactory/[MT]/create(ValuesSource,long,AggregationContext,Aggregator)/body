{
  if (!(valuesSource instanceof NumericValuesSource) && !rehash) {
    throw new AggregationExecutionException("Turning off rehashing for cardinality aggregation [" + name + "] on non-numeric values in not allowed");
  }
  return new CardinalityAggregator(name,parent == null ? 1 : parent.estimatedBucketCount(),valuesSource,rehash,precision(parent),context,parent);
}
