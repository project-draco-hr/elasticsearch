{
  startServer("server1");
  startServer("server2");
  clusterService=((InternalServer)server("server1")).injector().getInstance(ClusterService.class);
  indicesService=((InternalServer)server("server1")).injector().getInstance(IndicesService.class);
  client("server1").admin().indices().create(Requests.createIndexRequest("test")).actionGet();
  for (int i=0; i < 100; i++) {
    index(client("server1"),Integer.toString(i),"test",i);
  }
  client("server1").admin().indices().refresh(refreshRequest("test")).actionGet();
  SearchService searchService1=((InternalServer)server("server1")).injector().getInstance(SearchService.class);
  SearchService searchService2=((InternalServer)server("server2")).injector().getInstance(SearchService.class);
  nodeToSearchService=ImmutableMap.<String,SearchService>builder().put(((InternalServer)server("server1")).injector().getInstance(ClusterService.class).state().nodes().localNodeId(),searchService1).put(((InternalServer)server("server2")).injector().getInstance(ClusterService.class).state().nodes().localNodeId(),searchService2).build();
  searchPhaseController=((InternalServer)server("server1")).injector().getInstance(SearchPhaseController.class);
}
