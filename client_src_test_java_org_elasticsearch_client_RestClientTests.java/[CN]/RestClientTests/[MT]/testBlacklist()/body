{
  additionalNodes=Arrays.asList("127.0.0.2:9200 c","127.0.0.3:9200 d");
  HttpHost httpHost=new HttpHost("127.0.0.1",server.getAddress().getPort(),"http");
  try (RestClient client=new RestClient(httpHost)){
    client.setNodes(client.fetchNodes(httpHost,true,true,false));
    assertEquals(3,client.getNumHosts());
    assertEquals(0,client.getNumBlacklistedHosts());
    server.stop(0);
    try {
      client.httpGet("/_cat/health",Collections.emptyMap());
      fail();
    }
 catch (    IOException ex) {
      assertTrue(ex.getMessage(),ex.getMessage().endsWith("failed: connect timed out") || ex.getMessage().endsWith("failed: Connection refused"));
    }
    assertEquals(3,client.getNumHosts());
    assertEquals(3,client.getNumBlacklistedHosts());
    int num=0;
    for (    HttpHost host : client.getHostIterator(false)) {
      num++;
    }
    assertEquals(0,num);
    for (    HttpHost host : client.getHostIterator(true)) {
      num++;
    }
    assertEquals(3,num);
  }
 }
