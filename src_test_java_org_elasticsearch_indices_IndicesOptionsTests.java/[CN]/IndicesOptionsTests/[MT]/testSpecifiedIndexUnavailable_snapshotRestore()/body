{
  createIndex("test1");
  ensureYellow();
  PutRepositoryResponse putRepositoryResponse=client().admin().cluster().preparePutRepository("dummy-repo").setType("fs").setSettings(ImmutableSettings.settingsBuilder().put("location",newTempDir())).get();
  assertThat(putRepositoryResponse.isAcknowledged(),equalTo(true));
  client().admin().cluster().prepareCreateSnapshot("dummy-repo","snap1").setWaitForCompletion(true).get();
  verify(snapshot("snap2","test1","test2"),true);
  verify(restore("snap1","test1","test2"),true);
  IndicesOptions options=IndicesOptions.strict();
  verify(snapshot("snap2","test1","test2").setIndicesOptions(options),true);
  verify(restore("snap1","test1","test2").setIndicesOptions(options),true);
  options=IndicesOptions.lenient();
  verify(snapshot("snap2","test1","test2").setIndicesOptions(options),false);
  verify(restore("snap2","test1","test2").setIndicesOptions(options),false);
  options=IndicesOptions.strict();
  assertAcked(prepareCreate("test2"));
  ensureYellow();
  verify(snapshot("snap3","test1","test2").setIndicesOptions(options),false);
  verify(restore("snap3","test1","test2").setIndicesOptions(options),false);
}
