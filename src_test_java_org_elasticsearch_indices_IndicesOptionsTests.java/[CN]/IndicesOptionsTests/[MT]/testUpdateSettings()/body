{
  verify(client().admin().indices().prepareUpdateSettings("foo").setSettings(ImmutableSettings.builder().put("a","b")),true);
  verify(client().admin().indices().prepareUpdateSettings("_all").setSettings(ImmutableSettings.builder().put("a","b")),true);
  assertAcked(prepareCreate("foo"));
  assertAcked(prepareCreate("foobar"));
  assertAcked(prepareCreate("bar"));
  assertAcked(prepareCreate("barbaz"));
  ensureYellow();
  assertAcked(client().admin().indices().prepareClose("_all").get());
  verify(client().admin().indices().prepareUpdateSettings("foo").setSettings(ImmutableSettings.builder().put("a","b")),false);
  verify(client().admin().indices().prepareUpdateSettings("bar*").setSettings(ImmutableSettings.builder().put("a","b")),false);
  verify(client().admin().indices().prepareUpdateSettings("_all").setSettings(ImmutableSettings.builder().put("c","d")),false);
  assertAcked(client().admin().indices().prepareOpen("_all").get());
  try {
    verify(client().admin().indices().prepareUpdateSettings("barbaz").setSettings(ImmutableSettings.builder().put("e","f")),false);
  }
 catch (  ElasticSearchIllegalArgumentException e) {
    assertThat(e.getMessage(),equalTo("Can't update non dynamic settings[[index.e]] for open indices[[barbaz]]"));
  }
  verify(client().admin().indices().prepareUpdateSettings("baz*").setSettings(ImmutableSettings.builder().put("a","b")),true);
}
