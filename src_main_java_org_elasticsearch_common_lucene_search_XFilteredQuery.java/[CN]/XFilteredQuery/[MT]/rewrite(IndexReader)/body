{
  Query query=delegate.getQuery();
  final Query queryRewritten=query.rewrite(reader);
  if (queryRewritten instanceof MatchAllDocsQuery || Queries.isConstantMatchAllQuery(queryRewritten)) {
    final Query rewritten=new XLuceneConstantScoreQuery(delegate.getFilter());
    rewritten.setBoost(delegate.getBoost() * queryRewritten.getBoost());
    return rewritten;
  }
  if (queryRewritten != query) {
    final Query rewritten=new XFilteredQuery(queryRewritten,rawFilter,strategy);
    rewritten.setBoost(delegate.getBoost());
    return rewritten;
  }
 else {
    return this;
  }
}
