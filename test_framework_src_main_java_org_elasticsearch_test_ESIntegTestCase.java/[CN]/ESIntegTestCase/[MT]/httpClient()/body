{
  final NodesInfoResponse nodeInfos=client().admin().cluster().prepareNodesInfo().get();
  final NodeInfo[] nodes=nodeInfos.getNodes();
  assertTrue(nodes.length > 0);
  TransportAddress publishAddress=randomFrom(nodes).getHttp().address().publishAddress();
  assertEquals(1,publishAddress.uniqueAddressTypeId());
  InetSocketAddress address=((InetSocketTransportAddress)publishAddress).address();
  return new HttpRequestBuilder(HttpClients.createDefault()).host(NetworkAddress.formatAddress(address.getAddress())).port(address.getPort());
}
