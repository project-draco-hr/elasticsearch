{
  Map<String,Object> subField=new HashMap<>();
  subField.put("_subfield","value");
  Map<String,Object> fieldSettings=new HashMap<>();
  fieldSettings.put("_field",subField);
  Map<String,Object> addSettings=new HashMap<>();
  addSettings.put("fields",fieldSettings);
  Map<String,Object> removeSettings=new HashMap<>();
  removeSettings.put("fields",Collections.singletonList("_field._subfield"));
  Pipeline pipeline=createPipeline(processorConfig(SetProcessor.TYPE,addSettings),processorConfig(RemoveProcessor.TYPE,removeSettings));
  IngestDocument ingestDocument=new IngestDocument("_index","_type","_id",new HashMap<>());
  pipeline.execute(ingestDocument);
  assertThat(ingestDocument.getSource().get("_field"),Matchers.notNullValue());
  assertThat(((Map)ingestDocument.getSource().get("_field")).get("_subfield"),Matchers.nullValue());
  assertThat(((Map)fieldSettings.get("_field")).get("_subfield"),Matchers.equalTo("value"));
}
