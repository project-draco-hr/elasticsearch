{
  XContentBuilder builder=restContentBuilder(request).startObject().field("error",detailedMessage(t)).field("status",status.getStatus());
  if (t != null && request.paramAsBoolean("error_trace",false)) {
    builder.startObject("error_trace");
    boolean first=true;
    int counter=0;
    while (t != null) {
      if (counter++ > 10) {
        break;
      }
      if (!first) {
        builder.startObject("cause");
      }
      buildThrowable(t,builder);
      if (!first) {
        builder.endObject();
      }
      t=t.getCause();
      first=false;
    }
    builder.endObject();
  }
  builder.endObject();
  return builder;
}
