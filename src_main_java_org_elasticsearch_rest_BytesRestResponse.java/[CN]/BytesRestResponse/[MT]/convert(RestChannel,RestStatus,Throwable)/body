{
  XContentBuilder builder=channel.newBuilder().startObject();
  if (t == null) {
    builder.field("error","unknown");
  }
 else   if (channel.detailedErrorsEnabled()) {
    builder.field("error");
    builder.startObject();
    final ElasticsearchException[] rootCauses=ElasticsearchException.guessRootCauses(t);
    builder.field("root_cause");
    builder.startArray();
    for (    ElasticsearchException rootCause : rootCauses) {
      builder.startObject();
      rootCause.toXContent(builder,new ToXContent.DelegatingMapParams(Collections.singletonMap(ElasticsearchException.REST_EXCEPTION_SKIP_CAUSE,"true"),channel.request()));
      builder.endObject();
    }
    builder.endArray();
    ElasticsearchException.toXContent(builder,channel.request(),t);
    builder.endObject();
    if (channel.request().paramAsBoolean("error_trace",false)) {
      buildErrorTrace(t,builder);
    }
  }
 else {
    builder.field("error",simpleMessage(t));
  }
  builder.field("status",status.getStatus());
  builder.endObject();
  return builder;
}
