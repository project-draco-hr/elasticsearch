{
  XContentParser.Token token;
  while ((token=parser.nextToken()) != XContentParser.Token.END_OBJECT) {
    if (token == XContentParser.Token.FIELD_NAME) {
      String fieldName=parser.currentName();
      boolean reverse=false;
      String innerJsonName=null;
      token=parser.nextToken();
      if (token == XContentParser.Token.VALUE_STRING) {
        String direction=parser.text();
        if (direction.equals("asc")) {
          reverse=SCORE_FIELD_NAME.equals(fieldName);
        }
 else         if (direction.equals("desc")) {
          reverse=!SCORE_FIELD_NAME.equals(fieldName);
        }
        addSortField(context,sortFields,fieldName,reverse);
      }
 else       if (GEO_DISTANCE_FIELD_NAME.equals(fieldName)) {
        addGeoDistanceSortField(parser,context,sortFields);
      }
 else       if (SCRIPT_FIELD_NAME.equals(fieldName)) {
        addScriptSortField(parser,context,sortFields);
      }
 else {
        while ((token=parser.nextToken()) != XContentParser.Token.END_OBJECT) {
          if (token == XContentParser.Token.FIELD_NAME) {
            innerJsonName=parser.currentName();
          }
 else           if (token.isValue()) {
            if ("reverse".equals(innerJsonName)) {
              reverse=parser.booleanValue();
            }
 else             if ("order".equals(innerJsonName)) {
              if ("asc".equals(parser.text())) {
                reverse=SCORE_FIELD_NAME.equals(fieldName);
              }
 else               if ("desc".equals(parser.text())) {
                reverse=!SCORE_FIELD_NAME.equals(fieldName);
              }
            }
          }
        }
        addSortField(context,sortFields,fieldName,reverse);
      }
    }
  }
}
