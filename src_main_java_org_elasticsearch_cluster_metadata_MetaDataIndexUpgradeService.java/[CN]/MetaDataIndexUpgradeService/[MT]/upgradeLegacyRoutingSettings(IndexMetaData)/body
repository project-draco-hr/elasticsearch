{
  if (indexMetaData.settings().get(IndexMetaData.SETTING_LEGACY_ROUTING_HASH_FUNCTION) == null && indexMetaData.getCreationVersion().before(Version.V_2_0_0)) {
    Settings indexSettings=ImmutableSettings.builder().put(indexMetaData.settings()).put(IndexMetaData.SETTING_LEGACY_ROUTING_HASH_FUNCTION,pre20HashFunction).put(IndexMetaData.SETTING_LEGACY_ROUTING_USE_TYPE,pre20UseType == null ? false : pre20UseType).build();
    return IndexMetaData.builder(indexMetaData).version(indexMetaData.version()).settings(indexSettings).build();
  }
 else   if (indexMetaData.getCreationVersion().onOrAfter(Version.V_2_0_0)) {
    if (indexMetaData.getSettings().get(IndexMetaData.SETTING_LEGACY_ROUTING_HASH_FUNCTION) != null || indexMetaData.getSettings().get(IndexMetaData.SETTING_LEGACY_ROUTING_USE_TYPE) != null) {
      throw new IllegalStateException("Indices created on or after 2.0 should NOT contain [" + IndexMetaData.SETTING_LEGACY_ROUTING_HASH_FUNCTION + "] + or ["+ IndexMetaData.SETTING_LEGACY_ROUTING_USE_TYPE+ "] in their index settings");
    }
  }
  return indexMetaData;
}
