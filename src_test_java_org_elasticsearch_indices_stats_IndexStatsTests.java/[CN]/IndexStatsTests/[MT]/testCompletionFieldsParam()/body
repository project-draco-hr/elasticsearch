{
  assertAcked(prepareCreate("test1").addMapping("bar","{ \"properties\": { \"bar\": { \"type\": \"string\", \"fields\": { \"completion\": { \"type\": \"completion\" }}},\"baz\": { \"type\": \"string\", \"fields\": { \"completion\": { \"type\": \"completion\" }}}}}"));
  ensureGreen();
  client().prepareIndex("test1","bar",Integer.toString(1)).setSource("{\"bar\":\"bar\",\"baz\":\"baz\"}").execute().actionGet();
  client().prepareIndex("test1","baz",Integer.toString(1)).setSource("{\"bar\":\"bar\",\"baz\":\"baz\"}").execute().actionGet();
  refresh();
  IndicesStatsRequestBuilder builder=client().admin().indices().prepareStats();
  IndicesStatsResponse stats=builder.execute().actionGet();
  assertThat(stats.getTotal().completion.getSizeInBytes(),greaterThan(0l));
  assertThat(stats.getTotal().completion.getFields(),is(nullValue()));
  stats=builder.setCompletionFields("bar.completion").execute().actionGet();
  assertThat(stats.getTotal().completion.getSizeInBytes(),greaterThan(0l));
  assertThat(stats.getTotal().completion.getFields().containsKey("bar.completion"),is(true));
  assertThat(stats.getTotal().completion.getFields().get("bar.completion"),greaterThan(0l));
  assertThat(stats.getTotal().completion.getFields().containsKey("baz.completion"),is(false));
  stats=builder.setCompletionFields("bar.completion","baz.completion").execute().actionGet();
  assertThat(stats.getTotal().completion.getSizeInBytes(),greaterThan(0l));
  assertThat(stats.getTotal().completion.getFields().containsKey("bar.completion"),is(true));
  assertThat(stats.getTotal().completion.getFields().get("bar.completion"),greaterThan(0l));
  assertThat(stats.getTotal().completion.getFields().containsKey("baz.completion"),is(true));
  assertThat(stats.getTotal().completion.getFields().get("baz.completion"),greaterThan(0l));
  stats=builder.setCompletionFields("*").execute().actionGet();
  assertThat(stats.getTotal().completion.getSizeInBytes(),greaterThan(0l));
  assertThat(stats.getTotal().completion.getFields().containsKey("bar.completion"),is(true));
  assertThat(stats.getTotal().completion.getFields().get("bar.completion"),greaterThan(0l));
  assertThat(stats.getTotal().completion.getFields().containsKey("baz.completion"),is(true));
  assertThat(stats.getTotal().completion.getFields().get("baz.completion"),greaterThan(0l));
  stats=builder.setCompletionFields("*r*").execute().actionGet();
  assertThat(stats.getTotal().completion.getSizeInBytes(),greaterThan(0l));
  assertThat(stats.getTotal().completion.getFields().containsKey("bar.completion"),is(true));
  assertThat(stats.getTotal().completion.getFields().get("bar.completion"),greaterThan(0l));
  assertThat(stats.getTotal().completion.getFields().containsKey("baz.completion"),is(false));
}
