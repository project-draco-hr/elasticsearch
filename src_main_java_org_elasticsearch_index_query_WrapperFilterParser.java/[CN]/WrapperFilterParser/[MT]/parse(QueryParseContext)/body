{
  XContentParser parser=parseContext.parser();
  XContentParser.Token token=parser.nextToken();
  if (token != XContentParser.Token.FIELD_NAME) {
    throw new QueryParsingException(parseContext.index(),"[wrapper] filter malformed");
  }
  String fieldName=parser.currentName();
  if (!fieldName.equals("filter")) {
    throw new QueryParsingException(parseContext.index(),"[wrapper] filter malformed");
  }
  parser.nextToken();
  byte[] querySource=parser.binaryValue();
  XContentParser qSourceParser=XContentFactory.xContent(querySource).createParser(querySource);
  try {
    final QueryParseContext context=new QueryParseContext(parseContext.index(),parseContext.indexQueryParser);
    context.reset(qSourceParser);
    Filter result=context.parseInnerFilter();
    parser.nextToken();
    return result;
  }
  finally {
    qSourceParser.close();
  }
}
