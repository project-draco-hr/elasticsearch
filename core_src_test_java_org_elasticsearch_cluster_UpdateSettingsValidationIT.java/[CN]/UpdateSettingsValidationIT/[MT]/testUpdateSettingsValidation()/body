{
  List<String> nodes=internalCluster().startNodesAsync(settingsBuilder().put(Node.NODE_DATA_SETTING.getKey(),false).build(),settingsBuilder().put(Node.NODE_MASTER_SETTING.getKey(),false).build(),settingsBuilder().put(Node.NODE_MASTER_SETTING.getKey(),false).build()).get();
  String master=nodes.get(0);
  String node_1=nodes.get(1);
  String node_2=nodes.get(2);
  createIndex("test");
  NumShards test=getNumShards("test");
  ClusterHealthResponse healthResponse=client().admin().cluster().prepareHealth("test").setWaitForEvents(Priority.LANGUID).setWaitForNodes("3").setWaitForGreenStatus().execute().actionGet();
  assertThat(healthResponse.isTimedOut(),equalTo(false));
  assertThat(healthResponse.getIndices().get("test").getActiveShards(),equalTo(test.totalNumShards));
  client().admin().indices().prepareUpdateSettings("test").setSettings(settingsBuilder().put("index.number_of_replicas",0)).execute().actionGet();
  healthResponse=client().admin().cluster().prepareHealth("test").setWaitForEvents(Priority.LANGUID).setWaitForGreenStatus().execute().actionGet();
  assertThat(healthResponse.isTimedOut(),equalTo(false));
  assertThat(healthResponse.getIndices().get("test").getActiveShards(),equalTo(test.numPrimaries));
  try {
    client().admin().indices().prepareUpdateSettings("test").setSettings(settingsBuilder().put("index.refresh_interval","")).execute().actionGet();
    fail();
  }
 catch (  IllegalArgumentException ex) {
    logger.info("Error message: [{}]",ex.getMessage());
  }
}
