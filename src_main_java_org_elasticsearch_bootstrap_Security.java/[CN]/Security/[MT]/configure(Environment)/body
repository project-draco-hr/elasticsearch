{
  ESLogger log=Loggers.getLogger(Security.class);
  StringHelper.randomId();
  InputStream config=Security.class.getResourceAsStream(POLICY_RESOURCE);
  if (config == null) {
    throw new NoSuchFileException(POLICY_RESOURCE);
  }
  Path newConfig=processTemplate(config,environment);
  System.setProperty("java.security.policy",newConfig.toString());
  System.setSecurityManager(new SecurityManager());
  try {
    Files.delete(newConfig);
  }
 catch (  SecurityException broken) {
    log.error("unable to properly access temporary files, run with -Djava.security.debug=policy for more information");
    throw broken;
  }
catch (  IOException ignore) {
  }
}
