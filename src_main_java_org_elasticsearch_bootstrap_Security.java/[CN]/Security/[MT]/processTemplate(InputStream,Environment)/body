{
  Path processed=Files.createTempFile(null,null);
  try (OutputStream output=new BufferedOutputStream(Files.newOutputStream(processed))){
    try (InputStream in=new BufferedInputStream(template)){
      ByteStreams.copy(in,output);
    }
     Set<Path> paths=new HashSet<>();
    paths.add(environment.homeFile());
    paths.add(environment.configFile());
    paths.add(environment.logsFile());
    paths.add(environment.pluginsFile());
    for (    Path path : environment.dataFiles()) {
      paths.add(path);
    }
    for (    Path path : environment.dataWithClusterFiles()) {
      paths.add(path);
    }
    output.write(createPermissions(paths));
  }
   return processed;
}
