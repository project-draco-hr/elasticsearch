{
  ParsedSimulateRequest request=new ParsedSimulateRequest(pipeline,Collections.singletonList(data),true);
  SimulateDocumentResult itemResponse=new SimulateVerboseDocumentResult(Arrays.asList(new SimulateProcessorResult("processor[mock]-0",data),new SimulateProcessorResult("processor[mock]-1",data)));
  executionService.execute(request,listener);
  SimulatePipelineResponse response=new SimulatePipelineResponse("_id",Collections.singletonList(itemResponse));
  assertBusy(new Runnable(){
    @Override public void run(){
      verify(processor,times(2)).execute(data);
      verify(listener).onResponse(response);
    }
  }
);
}
