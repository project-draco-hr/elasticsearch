{
  SimulateExecutionService.Listener listener=mock(SimulateExecutionService.Listener.class);
  SimulatedItemResponse itemResponse=new SimulatedItemResponse(data);
  ParsedSimulateRequest request=new ParsedSimulateRequest(pipeline,Collections.singletonList(data),false);
  executionService.execute(request,listener);
  SimulatePipelineResponse response=new SimulatePipelineResponse("_id",Collections.singletonList(itemResponse));
  assertBusy(new Runnable(){
    @Override public void run(){
      verify(processor,times(2)).execute(data);
      verify(listener).onResponse(response);
    }
  }
);
}
