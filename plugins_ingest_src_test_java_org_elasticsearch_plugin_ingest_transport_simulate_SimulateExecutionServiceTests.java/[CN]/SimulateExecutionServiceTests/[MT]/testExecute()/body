{
  SimulateDocumentResult itemResponse=new SimulateDocumentResult(data);
  ParsedSimulateRequest request=new ParsedSimulateRequest(pipeline,Collections.singletonList(data),false);
  executionService.execute(request,listener);
  SimulatePipelineResponse response=new SimulatePipelineResponse("_id",Collections.singletonList(itemResponse));
  assertBusy(new Runnable(){
    @Override public void run(){
      verify(processor,times(2)).execute(data);
      verify(listener).onResponse(response);
    }
  }
);
}
