{
  Exception e=new RuntimeException("processor failed");
  doThrow(e).doNothing().when(processor).execute(ingestDocument);
  SimulateDocumentResult actualItemResponse=executionService.executeDocument(pipeline,ingestDocument,true);
  verify(processor,times(2)).execute(ingestDocument);
  assertThat(actualItemResponse,instanceOf(SimulateDocumentVerboseResult.class));
  SimulateDocumentVerboseResult simulateDocumentVerboseResult=(SimulateDocumentVerboseResult)actualItemResponse;
  assertThat(simulateDocumentVerboseResult.getProcessorResults().size(),equalTo(2));
  assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getProcessorId(),equalTo("processor[mock]-0"));
  assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getIngestDocument(),nullValue());
  assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getFailure(),instanceOf(RuntimeException.class));
  RuntimeException runtimeException=(RuntimeException)simulateDocumentVerboseResult.getProcessorResults().get(0).getFailure();
  assertThat(runtimeException.getMessage(),equalTo("processor failed"));
  assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getProcessorId(),equalTo("processor[mock]-1"));
  assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getIngestDocument(),not(sameInstance(ingestDocument)));
  assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getIngestDocument(),equalTo(ingestDocument));
  assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getFailure(),nullValue());
  runtimeException=(RuntimeException)simulateDocumentVerboseResult.getProcessorResults().get(0).getFailure();
  assertThat(runtimeException.getMessage(),equalTo("processor failed"));
}
