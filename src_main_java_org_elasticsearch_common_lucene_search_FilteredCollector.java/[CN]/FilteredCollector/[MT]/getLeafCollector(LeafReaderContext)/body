{
  final DocIdSet set=filter.getDocIdSet(context,null);
  final LeafCollector in=collector.getLeafCollector(context);
  final Bits bits=set == null ? null : set.bits();
  if (bits != null) {
    return new FilterLeafCollector(in){
      public void collect(      int doc) throws IOException {
        if (bits.get(doc)) {
          in.collect(doc);
        }
      }
    }
;
  }
  final DocIdSetIterator iterator;
  if (DocIdSets.isEmpty(set)) {
    iterator=null;
  }
 else {
    iterator=set.iterator();
  }
  if (iterator == null) {
    return new FilterLeafCollector(in){
      @Override public void collect(      int doc) throws IOException {
      }
    }
;
  }
  return new FilterLeafCollector(in){
    @Override public void collect(    int doc) throws IOException {
      final int itDoc=iterator.docID();
      if (itDoc > doc) {
        return;
      }
 else       if (itDoc < doc) {
        if (iterator.advance(doc) == doc) {
          in.collect(doc);
        }
      }
 else {
        in.collect(doc);
      }
    }
  }
;
}
