{
  resp.setContentType(response.contentType());
  resp.addHeader("Access-Control-Allow-Origin","*");
  if (restRequest.method() == RestRequest.Method.OPTIONS) {
    resp.addHeader("Access-Control-Max-Age","1728000");
    resp.addHeader("Access-Control-Allow-Methods","PUT, DELETE");
    resp.addHeader("Access-Control-Allow-Headers","X-Requested-With");
  }
  try {
    int contentLength=response.contentLength() + response.prefixContentLength() + response.suffixContentLength();
    resp.setContentLength(contentLength);
    ServletOutputStream out=resp.getOutputStream();
    if (response.prefixContent() != null) {
      out.write(response.prefixContent(),0,response.prefixContentLength());
    }
    out.write(response.content(),0,response.contentLength());
    if (response.suffixContent() != null) {
      out.write(response.suffixContent(),0,response.suffixContentLength());
    }
    out.close();
  }
 catch (  IOException e) {
    sendFailure=e;
  }
 finally {
    latch.countDown();
  }
}
