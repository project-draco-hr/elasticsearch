{
  final ShardId shardId=new ShardId(new Index("index"),1);
  DirectoryService directoryService=new LuceneManagedDirectoryService(random());
  final ShardLock shardLock=new DummyShardLock(shardId);
  Store store=new Store(shardId,ImmutableSettings.EMPTY,null,directoryService,randomDistributor(directoryService),shardLock);
  final AtomicBoolean called=new AtomicBoolean(false);
  Store.OnCloseListener listener=new Store.OnCloseListener(){
    @Override public void onClose(    ShardId shardId){
      assertTrue(called.compareAndSet(false,true));
      throw new RuntimeException("foobar");
    }
  }
;
  assertTrue(shardLock.isOpen());
  store.close(listener);
  assertTrue(called.get());
  assertFalse(shardLock.isOpen());
}
