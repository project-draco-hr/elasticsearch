{
  Map<String,StoreFileMetaData> metaDataMap=new HashMap<>();
  metaDataMap.put("segments_1",new StoreFileMetaData("segments_1",50,null,null,new BytesRef(new byte[]{1})));
  metaDataMap.put("_0_1.del",new StoreFileMetaData("_0_1.del",42,"foobarbaz",null,new BytesRef()));
  Store.MetadataSnapshot snapshot=new Store.MetadataSnapshot(metaDataMap,Collections.EMPTY_MAP);
  final ShardId shardId=new ShardId(new Index("index"),1);
  DirectoryService directoryService=new LuceneManagedDirectoryService(random());
  Store store=new Store(shardId,ImmutableSettings.EMPTY,directoryService,new DummyShardLock(shardId));
  for (  String file : metaDataMap.keySet()) {
    try (IndexOutput output=store.directory().createOutput(file,IOContext.DEFAULT)){
      BytesRef bytesRef=new BytesRef(TestUtil.randomRealisticUnicodeString(random(),10,1024));
      output.writeBytes(bytesRef.bytes,bytesRef.offset,bytesRef.length);
      CodecUtil.writeFooter(output);
    }
   }
  store.verifyAfterCleanup(snapshot,snapshot);
  deleteContent(store.directory());
  IOUtils.close(store);
}
