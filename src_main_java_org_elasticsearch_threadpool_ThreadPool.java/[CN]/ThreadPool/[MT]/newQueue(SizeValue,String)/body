{
  if (queueSize == null) {
    return ConcurrentCollections.newBlockingQueue();
  }
 else   if (queueSize.singles() == 0) {
    return new SynchronousQueue<Runnable>();
  }
 else   if (queueSize.singles() > 0) {
    if ("linked".equals(queueType)) {
      return new LinkedBlockingQueue<Runnable>((int)queueSize.singles());
    }
 else     if ("array".equals(queueType)) {
      return new ArrayBlockingQueue<Runnable>((int)queueSize.singles());
    }
 else {
      throw new ElasticSearchIllegalArgumentException("illegal queue_type set to [" + queueType + "], should be either linked or array");
    }
  }
 else {
    return ConcurrentCollections.newBlockingQueue();
  }
}
