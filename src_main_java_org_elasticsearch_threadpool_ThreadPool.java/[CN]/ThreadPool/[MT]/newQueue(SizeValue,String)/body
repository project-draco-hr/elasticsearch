{
  if (capacity == null) {
    return ConcurrentCollections.newBlockingQueue();
  }
 else   if ((int)capacity.singles() > 0) {
    if ("linked".equals(queueType)) {
      return new LinkedBlockingQueue<Runnable>((int)capacity.singles());
    }
 else     if ("array".equals(queueType)) {
      return new ArrayBlockingQueue<Runnable>((int)capacity.singles());
    }
 else {
      throw new ElasticSearchIllegalArgumentException("illegal queue_type set to [" + queueType + "], should be either linked or array");
    }
  }
 else {
    return new SynchronousQueue<Runnable>();
  }
}
