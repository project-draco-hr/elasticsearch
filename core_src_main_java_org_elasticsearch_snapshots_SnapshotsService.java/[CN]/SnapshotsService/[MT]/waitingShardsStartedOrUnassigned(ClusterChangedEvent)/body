{
  SnapshotMetaData curr=event.state().metaData().custom(SnapshotMetaData.TYPE);
  if (curr != null) {
    for (    SnapshotMetaData.Entry entry : curr.entries()) {
      if (entry.state() == State.STARTED && !entry.waitingIndices().isEmpty()) {
        for (        String index : entry.waitingIndices().keySet()) {
          if (event.indexRoutingTableChanged(index)) {
            IndexRoutingTable indexShardRoutingTable=event.state().getRoutingTable().index(index);
            for (            ShardId shardId : entry.waitingIndices().get(index)) {
              ShardRouting shardRouting=indexShardRoutingTable.shard(shardId.id()).primaryShard();
              if (shardRouting != null && (shardRouting.started() || shardRouting.unassigned())) {
                return true;
              }
            }
          }
        }
      }
    }
  }
  return false;
}
