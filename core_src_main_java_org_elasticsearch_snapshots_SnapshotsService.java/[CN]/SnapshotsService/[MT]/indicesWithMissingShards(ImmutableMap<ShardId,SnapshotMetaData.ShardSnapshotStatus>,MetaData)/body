{
  Set<String> missing=newHashSet();
  Set<String> closed=newHashSet();
  for (  ImmutableMap.Entry<ShardId,SnapshotMetaData.ShardSnapshotStatus> entry : shards.entrySet()) {
    if (entry.getValue().state() == State.MISSING) {
      if (metaData.hasIndex(entry.getKey().getIndex()) && metaData.index(entry.getKey().getIndex()).getState() == IndexMetaData.State.CLOSE) {
        closed.add(entry.getKey().getIndex());
      }
 else {
        missing.add(entry.getKey().getIndex());
      }
    }
  }
  return new Tuple<>(missing,closed);
}
