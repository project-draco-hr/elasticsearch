{
  SnapshotsInProgress snapshotsInProgress=clusterService.state().custom(SnapshotsInProgress.TYPE);
  if (snapshotsInProgress == null || snapshotsInProgress.entries().isEmpty()) {
    return ImmutableList.of();
  }
  if ("_all".equals(repository)) {
    return snapshotsInProgress.entries();
  }
  if (snapshotsInProgress.entries().size() == 1) {
    SnapshotsInProgress.Entry entry=snapshotsInProgress.entries().get(0);
    if (!entry.snapshotId().getRepository().equals(repository)) {
      return ImmutableList.of();
    }
    if (snapshots != null && snapshots.length > 0) {
      for (      String snapshot : snapshots) {
        if (entry.snapshotId().getSnapshot().equals(snapshot)) {
          return snapshotsInProgress.entries();
        }
      }
      return ImmutableList.of();
    }
 else {
      return snapshotsInProgress.entries();
    }
  }
  ImmutableList.Builder<SnapshotsInProgress.Entry> builder=ImmutableList.builder();
  for (  SnapshotsInProgress.Entry entry : snapshotsInProgress.entries()) {
    if (!entry.snapshotId().getRepository().equals(repository)) {
      continue;
    }
    if (snapshots != null && snapshots.length > 0) {
      for (      String snapshot : snapshots) {
        if (entry.snapshotId().getSnapshot().equals(snapshot)) {
          builder.add(entry);
          break;
        }
      }
    }
 else {
      builder.add(entry);
    }
  }
  return builder.build();
}
