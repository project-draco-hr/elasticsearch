{
  SnapshotsInProgress snapshotsInProgress=clusterService.state().custom(SnapshotsInProgress.TYPE);
  if (snapshotsInProgress == null || snapshotsInProgress.entries().isEmpty()) {
    return Collections.emptyList();
  }
  if ("_all".equals(repository)) {
    return snapshotsInProgress.entries();
  }
  if (snapshotsInProgress.entries().size() == 1) {
    SnapshotsInProgress.Entry entry=snapshotsInProgress.entries().get(0);
    if (!entry.snapshotId().getRepository().equals(repository)) {
      return Collections.emptyList();
    }
    if (snapshots != null && snapshots.length > 0) {
      for (      String snapshot : snapshots) {
        if (entry.snapshotId().getSnapshot().equals(snapshot)) {
          return snapshotsInProgress.entries();
        }
      }
      return Collections.emptyList();
    }
 else {
      return snapshotsInProgress.entries();
    }
  }
  List<SnapshotsInProgress.Entry> builder=new ArrayList<>();
  for (  SnapshotsInProgress.Entry entry : snapshotsInProgress.entries()) {
    if (!entry.snapshotId().getRepository().equals(repository)) {
      continue;
    }
    if (snapshots != null && snapshots.length > 0) {
      for (      String snapshot : snapshots) {
        if (entry.snapshotId().getSnapshot().equals(snapshot)) {
          builder.add(entry);
          break;
        }
      }
    }
 else {
      builder.add(entry);
    }
  }
  return Collections.unmodifiableList(builder);
}
