{
  MetaData metaData=clusterService.state().metaData();
  SnapshotMetaData snapshotMetaData=metaData.custom(SnapshotMetaData.TYPE);
  if (snapshotMetaData == null || snapshotMetaData.entries().isEmpty()) {
    return ImmutableList.of();
  }
  if ("_all".equals(repository)) {
    return snapshotMetaData.entries();
  }
  if (snapshotMetaData.entries().size() == 1) {
    SnapshotMetaData.Entry entry=snapshotMetaData.entries().get(0);
    if (!entry.snapshotId().getRepository().equals(repository)) {
      return ImmutableList.of();
    }
    if (snapshots != null && snapshots.length > 0) {
      for (      String snapshot : snapshots) {
        if (entry.snapshotId().getSnapshot().equals(snapshot)) {
          return snapshotMetaData.entries();
        }
      }
      return ImmutableList.of();
    }
 else {
      return snapshotMetaData.entries();
    }
  }
  ImmutableList.Builder<SnapshotMetaData.Entry> builder=ImmutableList.builder();
  for (  SnapshotMetaData.Entry entry : snapshotMetaData.entries()) {
    if (!entry.snapshotId().getRepository().equals(repository)) {
      continue;
    }
    if (snapshots != null && snapshots.length > 0) {
      for (      String snapshot : snapshots) {
        if (entry.snapshotId().getSnapshot().equals(snapshot)) {
          builder.add(entry);
          break;
        }
      }
    }
 else {
      builder.add(entry);
    }
  }
  return builder.build();
}
