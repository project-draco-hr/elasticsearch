{
  Set<Snapshot> snapshotSet=new HashSet<>();
  List<SnapshotsInProgress.Entry> entries=currentSnapshots(repositoryName,null);
  for (  SnapshotsInProgress.Entry entry : entries) {
    snapshotSet.add(inProgressSnapshot(entry));
  }
  Repository repository=repositoriesService.repository(repositoryName);
  List<SnapshotId> snapshotIds=repository.snapshots();
  for (  SnapshotId snapshotId : snapshotIds) {
    try {
      snapshotSet.add(repository.readSnapshot(snapshotId));
    }
 catch (    Exception ex) {
      if (ignoreUnavailable) {
        logger.warn("failed to get snapshot [{}]",ex,snapshotId);
      }
 else {
        throw new SnapshotException(snapshotId,"Snapshot could not be read",ex);
      }
    }
  }
  ArrayList<Snapshot> snapshotList=new ArrayList<>(snapshotSet);
  CollectionUtil.timSort(snapshotList);
  return Collections.unmodifiableList(snapshotList);
}
