{
  if (!metaData.hasIndex(index())) {
    validation.addIndexFailure(index(),"Exists in routing does not exists in metadata");
    return;
  }
  IndexMetaData indexMetaData=metaData.index(index());
  if (indexMetaData.numberOfShards() != shards().size()) {
    Set<Integer> expected=Sets.newHashSet();
    for (int i=0; i < indexMetaData.numberOfShards(); i++) {
      expected.add(i);
    }
    for (    IndexShardRoutingTable indexShardRoutingTable : this) {
      expected.remove(indexShardRoutingTable.shardId().id());
    }
    validation.addIndexFailure(index(),"Wrong number of shards in routing table, missing: " + expected);
  }
  for (  IndexShardRoutingTable indexShardRoutingTable : this) {
    int routingNumberOfReplicas=indexShardRoutingTable.size() - 1;
    if (routingNumberOfReplicas != indexMetaData.numberOfReplicas()) {
      validation.addIndexFailure(index(),"Shard [" + indexShardRoutingTable.shardId().id() + "] routing table has wrong number of replicas, expected ["+ indexMetaData.numberOfReplicas()+ "], got ["+ routingNumberOfReplicas+ "]");
    }
  }
}
