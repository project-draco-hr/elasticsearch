{
  XContentBuilder builder=RestXContentBuilder.restContentBuilder(request);
  Set<String> displayHeaders=buildDisplayHeaders(table,request);
  List<Table.Cell> headers=table.getHeaders();
  builder.startArray();
  for (  List<Table.Cell> row : table.getRows()) {
    builder.startObject();
    for (int i=0; i < headers.size(); i++) {
      String headerName=headers.get(i).value.toString();
      if (displayHeaders.contains(headerName)) {
        builder.field(headerName,renderValue(request,row.get(i).value));
      }
    }
    builder.endObject();
  }
  builder.endArray();
  return new XContentRestResponse(request,RestStatus.OK,builder);
}
