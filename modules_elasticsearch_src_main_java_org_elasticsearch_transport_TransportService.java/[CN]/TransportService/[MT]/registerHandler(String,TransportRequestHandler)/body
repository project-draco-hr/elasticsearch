{
synchronized (serverHandlersMutex) {
    TransportRequestHandler handlerReplaced=serverHandlers.get(action);
    serverHandlers=MapBuilder.newMapBuilder(serverHandlers).put(action,handler).immutableMap();
    if (handlerReplaced != null) {
      logger.warn("Registered two transport handlers for action {}, handlers: {}, {}",action,handler,handlerReplaced);
    }
  }
}
