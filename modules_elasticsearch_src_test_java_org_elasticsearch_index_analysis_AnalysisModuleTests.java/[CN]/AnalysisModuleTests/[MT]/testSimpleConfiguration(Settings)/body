{
  Index index=new Index("test");
  Injector injector=Guice.createInjector(new IndexSettingsModule(settings),new IndexNameModule(index),new AnalysisModule(settings));
  AnalysisService analysisService=injector.getInstance(AnalysisService.class);
  Analyzer analyzer=analysisService.analyzer("custom1").analyzer();
  assertThat(analyzer,instanceOf(CustomAnalyzer.class));
  CustomAnalyzer custom1=(CustomAnalyzer)analyzer;
  assertThat(custom1.tokenizerFactory(),instanceOf(StandardTokenizerFactory.class));
  assertThat(custom1.tokenFilters().length,equalTo(2));
  StopTokenFilterFactory stop1=(StopTokenFilterFactory)custom1.tokenFilters()[0];
  assertThat(stop1.stopWords().size(),equalTo(1));
  assertThat(stop1.stopWords(),hasItem("test-stop"));
}
