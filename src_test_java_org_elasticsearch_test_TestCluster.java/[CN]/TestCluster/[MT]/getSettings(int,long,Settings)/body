{
  Builder builder=ImmutableSettings.settingsBuilder().put(defaultSettings).put(getRandomNodeSettings(nodeSeed));
  Settings settings=nodeSettingsSource.settings(nodeOrdinal);
  if (settings != null) {
    if (settings.get(CLUSTER_NAME_KEY) != null) {
      throw new ElasticsearchIllegalStateException("Tests must not set a '" + CLUSTER_NAME_KEY + "' as a node setting set '"+ CLUSTER_NAME_KEY+ "': ["+ settings.get(CLUSTER_NAME_KEY)+ "]");
    }
    builder.put(settings);
  }
  if (others != null) {
    builder.put(others);
  }
  builder.put(CLUSTER_NAME_KEY,clusterName);
  return builder.build();
}
