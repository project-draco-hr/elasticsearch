{
  Random random=new Random(seed);
  Builder builder=ImmutableSettings.settingsBuilder().put("cluster.name",clusterName).put("cluster.routing.schedule",(30 + random.nextInt(50)) + "ms").put("gateway.type","none").put(SETTING_CLUSTER_NODE_SEED,seed);
  if (ENABLE_MOCK_MODULES && usually(random)) {
    builder.put("index.store.type",MockFSIndexStoreModule.class.getName());
    builder.put(IndexEngineModule.EngineSettings.ENGINE_TYPE,MockEngineModule.class.getName());
    builder.put(PageCacheRecyclerModule.CACHE_IMPL,MockPageCacheRecyclerModule.class.getName());
  }
  if (isLocalTransportConfigured()) {
    builder.put(TransportModule.TRANSPORT_TYPE_KEY,AssertingLocalTransportModule.class.getName());
  }
 else {
    builder.put(Transport.TransportSettings.TRANSPORT_TCP_COMPRESS,rarely(random));
  }
  builder.put("type",RandomPicks.randomFrom(random,CacheRecycler.Type.values()));
  if (random.nextBoolean()) {
    builder.put("cache.recycler.page.type",RandomPicks.randomFrom(random,CacheRecycler.Type.values()));
  }
  if (random.nextBoolean()) {
    for (    String name : Arrays.asList(ThreadPool.Names.BULK,ThreadPool.Names.FLUSH,ThreadPool.Names.GENERIC,ThreadPool.Names.GET,ThreadPool.Names.INDEX,ThreadPool.Names.MANAGEMENT,ThreadPool.Names.MERGE,ThreadPool.Names.OPTIMIZE,ThreadPool.Names.PERCOLATE,ThreadPool.Names.REFRESH,ThreadPool.Names.SEARCH,ThreadPool.Names.SNAPSHOT,ThreadPool.Names.SUGGEST,ThreadPool.Names.WARMER)) {
      if (random.nextBoolean()) {
        final String type=RandomPicks.randomFrom(random,Arrays.asList("fixed","cached","scaling"));
        builder.put(ThreadPool.THREADPOOL_GROUP + name + ".type",type);
      }
    }
  }
  return builder.build();
}
