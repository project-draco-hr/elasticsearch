{
  Directory dir=new RAMDirectory();
  IndexWriter indexWriter=new IndexWriter(dir,new IndexWriterConfig(Lucene.VERSION,Lucene.STANDARD_ANALYZER));
  indexWriter.addDocument(doc().add(field("_id","1")).build());
  DirectoryReader reader=IndexReader.open(indexWriter,true);
  assertThat(reader.numDocs(),equalTo(1));
  indexWriter.prepareCommit();
  reader=DirectoryReader.openIfChanged(reader);
  assertThat(reader.numDocs(),equalTo(1));
  indexWriter.addDocument(doc().add(field("_id","2")).build());
  indexWriter.commit();
  reader=DirectoryReader.openIfChanged(reader);
  assertThat(reader.numDocs(),equalTo(2));
}
