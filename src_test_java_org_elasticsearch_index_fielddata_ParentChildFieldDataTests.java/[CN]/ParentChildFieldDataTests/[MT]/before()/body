{
  MapperService mapperService=MapperTestUtils.newMapperService(ifdService.index(),ImmutableSettings.Builder.EMPTY_SETTINGS);
  mapperService.merge(childType,new CompressedString(PutMappingRequest.buildFromSimplifiedDef(childType,"_parent","type=" + parentType).string()),true);
  mapperService.merge(grandChildType,new CompressedString(PutMappingRequest.buildFromSimplifiedDef(grandChildType,"_parent","type=" + childType).string()),true);
  IndexService indexService=new StubIndexService(mapperService);
  ifdService.setIndexService(indexService);
  Document d=new Document();
  d.add(new StringField(UidFieldMapper.NAME,Uid.createUid(parentType,"1"),Field.Store.NO));
  writer.addDocument(d);
  d=new Document();
  d.add(new StringField(UidFieldMapper.NAME,Uid.createUid(childType,"2"),Field.Store.NO));
  d.add(new StringField(ParentFieldMapper.NAME,Uid.createUid(parentType,"1"),Field.Store.NO));
  writer.addDocument(d);
  writer.commit();
  d=new Document();
  d.add(new StringField(UidFieldMapper.NAME,Uid.createUid(childType,"3"),Field.Store.NO));
  d.add(new StringField(ParentFieldMapper.NAME,Uid.createUid(parentType,"1"),Field.Store.NO));
  writer.addDocument(d);
  d=new Document();
  d.add(new StringField(UidFieldMapper.NAME,Uid.createUid(parentType,"2"),Field.Store.NO));
  writer.addDocument(d);
  d=new Document();
  d.add(new StringField(UidFieldMapper.NAME,Uid.createUid(childType,"4"),Field.Store.NO));
  d.add(new StringField(ParentFieldMapper.NAME,Uid.createUid(parentType,"2"),Field.Store.NO));
  writer.addDocument(d);
  d=new Document();
  d.add(new StringField(UidFieldMapper.NAME,Uid.createUid(childType,"5"),Field.Store.NO));
  d.add(new StringField(ParentFieldMapper.NAME,Uid.createUid(parentType,"1"),Field.Store.NO));
  writer.addDocument(d);
  writer.commit();
  d=new Document();
  d.add(new StringField(UidFieldMapper.NAME,Uid.createUid(grandChildType,"6"),Field.Store.NO));
  d.add(new StringField(ParentFieldMapper.NAME,Uid.createUid(childType,"2"),Field.Store.NO));
  writer.addDocument(d);
  d=new Document();
  d.add(new StringField(UidFieldMapper.NAME,Uid.createUid("other-type","1"),Field.Store.NO));
  writer.addDocument(d);
}
