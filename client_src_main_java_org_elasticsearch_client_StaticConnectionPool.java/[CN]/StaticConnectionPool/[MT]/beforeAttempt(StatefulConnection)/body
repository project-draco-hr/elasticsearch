{
  if (pingEnabled && connection.shouldBeRetried()) {
    HttpHead httpHead=new HttpHead("/");
    httpHead.setConfig(pingRequestConfig);
    StatusLine statusLine;
    try (CloseableHttpResponse httpResponse=client.execute(connection.getNode().getHttpHost(),httpHead)){
      statusLine=httpResponse.getStatusLine();
      EntityUtils.consume(httpResponse.getEntity());
    }
 catch (    IOException e) {
      RequestLogger.log(logger,"ping failed",httpHead.getRequestLine(),connection.getNode(),e);
      onFailure(connection);
      throw e;
    }
    if (statusLine.getStatusCode() >= 300) {
      RequestLogger.log(logger,"ping failed",httpHead.getRequestLine(),connection.getNode(),statusLine);
      onFailure(connection);
      throw new ElasticsearchResponseException(httpHead.getRequestLine(),connection.getNode(),statusLine);
    }
 else {
      RequestLogger.log(logger,"ping succeeded",httpHead.getRequestLine(),connection.getNode(),statusLine);
      onSuccess(connection);
    }
  }
}
