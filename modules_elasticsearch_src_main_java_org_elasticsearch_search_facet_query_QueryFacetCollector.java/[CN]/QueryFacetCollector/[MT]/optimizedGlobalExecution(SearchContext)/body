{
  Query query=this.query;
  if (super.filter != null) {
    query=new FilteredQuery(query,super.filter);
  }
  if (searchContext.types().length > 0) {
    query=new FilteredQuery(query,searchContext.filterCache().cache(searchContext.mapperService().typesFilter(searchContext.types())));
  }
  TotalHitCountCollector collector=new TotalHitCountCollector();
  searchContext.searcher().search(query,collector);
  count=collector.getTotalHits();
}
