{
  String routingSpec=mainRequest.getDestination().routing();
  if (routingSpec == null) {
    super.copyRouting(index,doc);
    return;
  }
  if (routingSpec.startsWith("=")) {
    index.routing(mainRequest.getDestination().routing().substring(1));
    return;
  }
switch (routingSpec) {
case "keep":
    super.copyRouting(index,doc);
  break;
case "discard":
index.routing(null);
break;
default :
throw new IllegalArgumentException("Unsupported routing command");
}
}
