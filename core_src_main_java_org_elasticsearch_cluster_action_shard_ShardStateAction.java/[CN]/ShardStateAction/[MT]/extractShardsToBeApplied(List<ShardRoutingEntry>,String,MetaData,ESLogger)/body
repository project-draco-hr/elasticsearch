{
  List<ShardRoutingEntry> shardRoutingsToBeApplied=new ArrayList<>(shardRoutingEntries.size());
  for (int i=0; i < shardRoutingEntries.size(); i++) {
    ShardRoutingEntry shardRoutingEntry=shardRoutingEntries.get(i);
    ShardRouting shardRouting=shardRoutingEntry.shardRouting;
    IndexMetaData indexMetaData=metaData.index(shardRouting.index());
    if (indexMetaData == null) {
      logger.debug("{} ignoring shard {}, unknown index in {}",shardRouting.shardId(),type,shardRoutingEntry);
      continue;
    }
    if (!indexMetaData.isSameUUID(shardRoutingEntry.indexUUID)) {
      logger.debug("{} ignoring shard {}, different index uuid, current {}, got {}",shardRouting.shardId(),type,indexMetaData.getIndexUUID(),shardRoutingEntry);
      continue;
    }
    logger.trace("{} will apply shard {} {}",shardRouting.shardId(),type,shardRoutingEntry);
    shardRoutingsToBeApplied.add(shardRoutingEntry);
  }
  return shardRoutingsToBeApplied;
}
