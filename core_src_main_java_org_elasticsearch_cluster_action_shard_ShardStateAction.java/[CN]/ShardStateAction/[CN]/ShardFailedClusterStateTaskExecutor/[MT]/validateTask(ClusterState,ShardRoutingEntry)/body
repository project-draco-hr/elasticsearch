{
  if (!task.shardRouting.isSameAllocation(task.sourceShardRouting)) {
    IndexShardRoutingTable indexShard=currentState.getRoutingTable().shardRoutingTableOrNull(task.shardRouting.shardId());
    if (indexShard == null) {
      return ValidationResult.SOURCE_INVALID;
    }
    ShardRouting primaryShard=indexShard.primaryShard();
    if (primaryShard == null || !primaryShard.isSameAllocation(task.sourceShardRouting)) {
      return ValidationResult.SOURCE_INVALID;
    }
  }
  RoutingNodes.RoutingNodeIterator routingNodeIterator=currentState.getRoutingNodes().routingNodeIter(task.getShardRouting().currentNodeId());
  if (routingNodeIterator != null) {
    for (    ShardRouting maybe : routingNodeIterator) {
      if (task.getShardRouting().isSameAllocation(maybe)) {
        return ValidationResult.VALID;
      }
    }
  }
  return ValidationResult.SHARD_MISSING;
}
