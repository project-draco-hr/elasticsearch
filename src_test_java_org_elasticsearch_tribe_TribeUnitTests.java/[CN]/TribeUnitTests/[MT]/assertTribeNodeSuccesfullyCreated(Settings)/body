{
  Settings settings=ImmutableSettings.builder().put("http.enabled",false).put("node.name","tribe_node").put("tribe.t1.node.mode",NODE_MODE).put("tribe.t2.node.mode",NODE_MODE).put("path.home",createTempDir()).put(extraSettings).build();
  try (Node node=NodeBuilder.nodeBuilder().settings(settings).node()){
    try (Client client=node.client()){
      assertBusy(new Runnable(){
        @Override public void run(){
          ClusterState state=client.admin().cluster().prepareState().clear().setNodes(true).get().getState();
          assertThat(state.getClusterName().value(),equalTo("tribe_node_cluster"));
          assertThat(state.getNodes().getSize(),equalTo(5));
          for (          DiscoveryNode discoveryNode : state.getNodes()) {
            assertThat(discoveryNode.getName(),either(equalTo("tribe1_node")).or(equalTo("tribe2_node")).or(equalTo("tribe_node")).or(equalTo("tribe_node/t1")).or(equalTo("tribe_node/t2")));
          }
        }
      }
);
    }
   }
 }
