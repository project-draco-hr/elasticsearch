{
  Pipeline pipeline;
  if (pipelineId != null) {
    pipeline=pipelineStore.get(pipelineId);
  }
 else {
    Map<String,Object> pipelineConfig=ConfigurationUtils.readOptionalMap(config,"pipeline");
    pipeline=PIPELINE_FACTORY.create(SIMULATED_PIPELINE_ID,pipelineConfig,pipelineStore.getProcessorFactoryRegistry());
  }
  List<Map<String,Object>> docs=ConfigurationUtils.readList(config,"docs");
  List<Data> dataList=new ArrayList<>();
  for (int i=0; i < docs.size(); i++) {
    Map<String,Object> dataMap=docs.get(i);
    Map<String,Object> document=ConfigurationUtils.readOptionalMap(dataMap,"_source");
    if (document == null) {
      document=Collections.emptyMap();
    }
    Data data=new Data(ConfigurationUtils.readOptionalStringProperty(dataMap,"_index"),ConfigurationUtils.readOptionalStringProperty(dataMap,"_type"),ConfigurationUtils.readOptionalStringProperty(dataMap,"_id"),document);
    dataList.add(data);
  }
  return new ParsedSimulateRequest(pipeline,dataList,verbose);
}
