{
  logger.info("--> script: " + script);
  SearchResponse resp=client().prepareSearch("test").setSource(new SearchSourceBuilder().query(QueryBuilders.matchAllQuery()).sort(SortBuilders.scriptSort(new Script(script + "; doc['foo'].value + 2",ScriptType.INLINE,"groovy",null),"number"))).get();
  assertEquals(0,resp.getHits().getTotalHits());
  ShardSearchFailure fails[]=resp.getShardFailures();
  for (  ShardSearchFailure fail : fails) {
    assertThat(fail.getCause(),instanceOf(ScriptException.class));
    assertTrue("unexpected exception" + fail.getCause(),fail.getCause().toString().toLowerCase(Locale.ROOT).contains("[access denied"));
  }
}
