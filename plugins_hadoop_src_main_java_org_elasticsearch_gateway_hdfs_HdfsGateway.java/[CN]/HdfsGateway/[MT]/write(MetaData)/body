{
  try {
    final Path file=new Path(metaDataPath,"metadata-" + (currentIndex + 1));
    BinaryXContentBuilder builder=XContentFactory.contentBinaryBuilder(XContentType.JSON);
    builder.prettyPrint();
    builder.startObject();
    MetaData.Builder.toXContent(metaData,builder,ToXContent.EMPTY_PARAMS);
    builder.endObject();
    FSDataOutputStream fileStream=fileSystem.create(file,true);
    fileStream.write(builder.unsafeBytes(),0,builder.unsafeBytesLength());
    fileStream.flush();
    fileStream.sync();
    fileStream.close();
    currentIndex++;
    FileStatus[] oldFiles=fileSystem.listStatus(metaDataPath,new PathFilter(){
      @Override public boolean accept(      Path path){
        return path.getName().startsWith("metadata-") && !path.getName().equals(file.getName());
      }
    }
);
    if (oldFiles != null) {
      for (      FileStatus oldFile : oldFiles) {
        fileSystem.delete(oldFile.getPath(),false);
      }
    }
  }
 catch (  IOException e) {
    throw new GatewayException("can't write new metadata file into the gateway",e);
  }
}
