{
  ShardId shardId=new ShardId("myindex",0);
  Settings regularSettings=Settings.builder().put(IndexMetaData.SETTING_NUMBER_OF_SHARDS,2).put(IndexMetaData.SETTING_NUMBER_OF_REPLICAS,1).build();
  Settings shadowSettings=Settings.builder().put(IndexMetaData.SETTING_NUMBER_OF_SHARDS,2).put(IndexMetaData.SETTING_NUMBER_OF_REPLICAS,1).put(IndexMetaData.SETTING_SHADOW_REPLICAS,true).build();
  IndexShardModule ism1=new IndexShardModule(shardId,true,regularSettings,null);
  IndexShardModule ism2=new IndexShardModule(shardId,false,regularSettings,null);
  IndexShardModule ism3=new IndexShardModule(shardId,true,shadowSettings,null);
  IndexShardModule ism4=new IndexShardModule(shardId,false,shadowSettings,null);
  assertFalse("no shadow replicas for normal settings",ism1.useShadowEngine());
  assertFalse("no shadow replicas for normal settings",ism2.useShadowEngine());
  assertFalse("no shadow replicas for primary shard with shadow settings",ism3.useShadowEngine());
  assertTrue("shadow replicas for replica shards with shadow settings",ism4.useShadowEngine());
}
