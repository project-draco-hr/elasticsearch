{
  try {
    Object propertyValue=bucket.getProperty(agg.getName(),aggPathAsList);
    if (propertyValue == null) {
      throw new AggregationExecutionException(DerivativeParser.BUCKETS_PATH.getPreferredName() + " must reference either a number value or a single value numeric metric aggregation");
    }
 else {
      double value;
      if (propertyValue instanceof Number) {
        value=((Number)propertyValue).doubleValue();
      }
 else       if (propertyValue instanceof InternalNumericMetricsAggregation.SingleValue) {
        value=((InternalNumericMetricsAggregation.SingleValue)propertyValue).value();
      }
 else {
        throw new AggregationExecutionException(DerivativeParser.BUCKETS_PATH.getPreferredName() + " must reference either a number value or a single value numeric metric aggregation");
      }
      if (Double.isInfinite(value) || Double.isNaN(value)) {
switch (gapPolicy) {
case INSERT_ZEROS:
          return 0.0;
case IGNORE:
default :
        return Double.NaN;
    }
  }
 else {
    return value;
  }
}
}
 catch (InvalidAggregationPathException e) {
return null;
}
}
