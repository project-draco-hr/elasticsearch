{
  return new MetaDataStateFormat<ShardStateInfo>(XContentType.JSON,deleteOldFiles){
    @Override protected XContentBuilder newXContentBuilder(    XContentType type,    OutputStream stream) throws IOException {
      XContentBuilder xContentBuilder=super.newXContentBuilder(type,stream);
      xContentBuilder.prettyPrint();
      return xContentBuilder;
    }
    @Override public void toXContent(    XContentBuilder builder,    ShardStateInfo shardStateInfo) throws IOException {
      builder.field(VERSION_KEY,shardStateInfo.version);
      if (shardStateInfo.primary != null) {
        builder.field(PRIMARY_KEY,shardStateInfo.primary);
      }
    }
    @Override public ShardStateInfo fromXContent(    XContentParser parser) throws IOException {
      XContentParser.Token token=parser.nextToken();
      if (token == null) {
        return null;
      }
      long version=-1;
      Boolean primary=null;
      String currentFieldName=null;
      while ((token=parser.nextToken()) != XContentParser.Token.END_OBJECT) {
        if (token == XContentParser.Token.FIELD_NAME) {
          currentFieldName=parser.currentName();
        }
 else         if (token.isValue()) {
          if (VERSION_KEY.equals(currentFieldName)) {
            version=parser.longValue();
          }
 else           if (PRIMARY_KEY.equals(currentFieldName)) {
            primary=parser.booleanValue();
          }
 else {
            throw new CorruptStateException("unexpected field in shard state [" + currentFieldName + "]");
          }
        }
 else {
          throw new CorruptStateException("unexpected token in shard state [" + token.name() + "]");
        }
      }
      if (primary == null) {
        throw new CorruptStateException("missing value for [primary] in shard state");
      }
      if (version == -1) {
        throw new CorruptStateException("missing value for [version] in shard state");
      }
      return new ShardStateInfo(version,primary);
    }
  }
;
}
