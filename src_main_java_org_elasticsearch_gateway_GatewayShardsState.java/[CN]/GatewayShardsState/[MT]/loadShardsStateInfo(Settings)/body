{
  Set<ShardId> shardIds=nodeEnv.findAllShardIds();
  long highestVersion=-1;
  Map<ShardId,ShardStateInfo> shardsState=Maps.newHashMap();
  for (  ShardId shardId : shardIds) {
    ShardStateInfo shardStateInfo=loadShardStateInfo(shardId,indexSettings);
    if (shardStateInfo == null) {
      continue;
    }
    shardsState.put(shardId,shardStateInfo);
    if (shardStateInfo.version > highestVersion) {
      highestVersion=shardStateInfo.version;
    }
  }
  return shardsState;
}
