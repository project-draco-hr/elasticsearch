{
  logger.trace("{} writing shard state, reason [{}]",shardId,reason);
  final boolean deleteOldFiles=previousStateInfo != null && previousStateInfo.version != shardStateInfo.version;
  MetaDataStateFormat<ShardStateInfo> stateFormat=newShardStateInfoFormat(deleteOldFiles);
  stateFormat.write(shardStateInfo,SHARD_STATE_FILE_PREFIX,shardStateInfo.version,nodeEnv.shardPaths(shardId));
}
