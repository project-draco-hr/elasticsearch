{
  final IndexService service=createIndex("foo");
  assertThat(engine(service).currentIndexWriterConfig().getUseCompoundFile(),is(true));
  client().admin().indices().prepareUpdateSettings("foo").setSettings(ImmutableSettings.builder().put(InternalEngine.INDEX_COMPOUND_ON_FLUSH,false).build()).get();
  assertThat(engine(service).currentIndexWriterConfig().getUseCompoundFile(),is(false));
  client().admin().indices().prepareUpdateSettings("foo").setSettings(ImmutableSettings.builder().put(InternalEngine.INDEX_COMPOUND_ON_FLUSH,true).build()).get();
  assertThat(engine(service).currentIndexWriterConfig().getUseCompoundFile(),is(true));
  assertThat(engine(service).currentIndexWriterConfig().getCheckIntegrityAtMerge(),is(true));
  client().admin().indices().prepareUpdateSettings("foo").setSettings(ImmutableSettings.builder().put(InternalEngine.INDEX_CHECKSUM_ON_MERGE,false).build()).get();
  assertThat(engine(service).currentIndexWriterConfig().getCheckIntegrityAtMerge(),is(false));
  client().admin().indices().prepareUpdateSettings("foo").setSettings(ImmutableSettings.builder().put(InternalEngine.INDEX_CHECKSUM_ON_MERGE,true).build()).get();
  assertThat(engine(service).currentIndexWriterConfig().getCheckIntegrityAtMerge(),is(true));
}
