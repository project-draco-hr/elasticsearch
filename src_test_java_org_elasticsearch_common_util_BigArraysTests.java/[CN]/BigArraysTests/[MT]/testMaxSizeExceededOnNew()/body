{
  final int size=scaledRandomIntBetween(5,1 << 22);
  for (  String type : Arrays.asList("Byte","Int","Long","Float","Double","Object")) {
    BigArrays bigArrays=new BigArrays(ImmutableSettings.builder().put(BigArrays.MAX_SIZE_IN_BYTES_SETTING,randomIntBetween(1,size)).build(),null);
    Method create=BigArrays.class.getMethod("new" + type + "Array",long.class);
    try {
      create.invoke(bigArrays,size);
      fail("expected an exception on " + create);
    }
 catch (    InvocationTargetException e) {
      assertTrue(e.getCause() instanceof ElasticsearchIllegalStateException);
    }
    assertEquals(0,bigArrays.sizeInBytes());
  }
}
