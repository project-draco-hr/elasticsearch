{
  internalCluster().ensureAtMostNumDataNodes(0);
  internalCluster().startNode(Settings.builder().put("gateway.recover_after_nodes",2).build());
  ClusterStatsResponse response=client().admin().cluster().prepareClusterStats().get();
  assertThat(response.getStatus(),equalTo(ClusterHealthStatus.RED));
  internalCluster().ensureAtLeastNumDataNodes(3);
  ensureGreen();
  response=client().admin().cluster().prepareClusterStats().get();
  assertThat(response.getStatus(),equalTo(ClusterHealthStatus.GREEN));
}
