{
  final Metadata.ExpressionMetadata unaryemd=metadata.getExpressionMetadata(ctx);
  final ExpressionContext exprctx=metadata.updateExpressionTree(ctx.expression());
  final Metadata.ExpressionMetadata expremd=metadata.createExpressionMetadata(exprctx);
  if (ctx.BOOLNOT() != null) {
    expremd.to=definition.booleanType;
    visit(exprctx);
    markCast(expremd);
    if (expremd.postConst != null) {
      unaryemd.preConst=!(boolean)expremd.postConst;
    }
    unaryemd.from=definition.booleanType;
  }
 else   if (ctx.BWNOT() != null || ctx.ADD() != null || ctx.SUB() != null) {
    visit(exprctx);
    final Type promote=promoteNumeric(expremd.from,ctx.BWNOT() == null,true);
    if (promote == null) {
      throw new ClassCastException("Cannot apply [" + ctx.getChild(0).getText() + "] "+ "operation to type ["+ expremd.from.name+ "].");
    }
    expremd.to=promote;
    markCast(expremd);
    if (expremd.postConst != null) {
      final Sort sort=promote.sort;
      if (ctx.BWNOT() != null) {
        if (sort == Sort.INT) {
          unaryemd.preConst=~(int)expremd.postConst;
        }
 else         if (sort == Sort.LONG) {
          unaryemd.preConst=~(long)expremd.postConst;
        }
 else {
          throw new IllegalStateException(Metadata.error(ctx) + "Unexpected parser state.");
        }
      }
 else       if (ctx.SUB() != null) {
        if (exprctx instanceof NumericContext) {
          unaryemd.preConst=expremd.postConst;
        }
 else {
          if (sort == Sort.INT) {
            if (settings.getNumericOverflow()) {
              unaryemd.preConst=-(int)expremd.postConst;
            }
 else {
              unaryemd.preConst=Math.negateExact((int)expremd.postConst);
            }
          }
 else           if (sort == Sort.LONG) {
            if (settings.getNumericOverflow()) {
              unaryemd.preConst=-(long)expremd.postConst;
            }
 else {
              unaryemd.preConst=Math.negateExact((long)expremd.postConst);
            }
          }
 else           if (sort == Sort.FLOAT) {
            unaryemd.preConst=-(float)expremd.postConst;
          }
 else           if (sort == Sort.DOUBLE) {
            unaryemd.preConst=-(double)expremd.postConst;
          }
 else {
            throw new IllegalStateException(Metadata.error(ctx) + "Unexpected parser state.");
          }
        }
      }
 else       if (ctx.ADD() != null) {
        if (sort == Sort.INT) {
          unaryemd.preConst=+(int)expremd.postConst;
        }
 else         if (sort == Sort.LONG) {
          unaryemd.preConst=+(long)expremd.postConst;
        }
 else         if (sort == Sort.FLOAT) {
          unaryemd.preConst=+(float)expremd.postConst;
        }
 else         if (sort == Sort.DOUBLE) {
          unaryemd.preConst=+(double)expremd.postConst;
        }
 else {
          throw new IllegalStateException(Metadata.error(ctx) + "Unexpected parser state.");
        }
      }
 else {
        throw new IllegalStateException(Metadata.error(ctx) + "Unexpected parser state.");
      }
    }
    unaryemd.from=promote;
    unaryemd.typesafe=expremd.typesafe;
  }
 else {
    throw new IllegalStateException(Metadata.error(ctx) + "Unexpected parser state.");
  }
  return null;
}
