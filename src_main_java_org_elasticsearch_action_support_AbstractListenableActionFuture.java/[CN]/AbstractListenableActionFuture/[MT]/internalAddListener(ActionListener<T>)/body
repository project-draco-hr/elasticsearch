{
  boolean executeImmediate=false;
synchronized (this) {
    if (executedListeners) {
      executeImmediate=true;
    }
 else {
      Object listeners=this.listeners;
      if (listeners == null) {
        listeners=listener;
      }
 else       if (listeners instanceof List) {
        ((List)this.listeners).add(listener);
      }
 else {
        Object orig=listeners;
        listeners=Lists.newArrayListWithCapacity(2);
        ((List)listeners).add(orig);
        ((List)listeners).add(listener);
      }
      this.listeners=listeners;
    }
  }
  if (executeImmediate) {
    executeListener(listener);
  }
}
