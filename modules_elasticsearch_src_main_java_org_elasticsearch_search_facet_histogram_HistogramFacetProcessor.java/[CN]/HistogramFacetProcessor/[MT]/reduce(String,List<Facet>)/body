{
  if (facets.size() == 1) {
    return facets.get(0);
  }
  TLongLongHashMap counts=null;
  TLongDoubleHashMap totals=null;
  InternalHistogramFacet firstHistoFacet=(InternalHistogramFacet)facets.get(0);
  for (  Facet facet : facets) {
    InternalHistogramFacet histoFacet=(InternalHistogramFacet)facet;
    if (!histoFacet.counts.isEmpty()) {
      if (counts == null) {
        counts=histoFacet.counts;
      }
 else {
        for (TLongLongIterator it=histoFacet.counts.iterator(); it.hasNext(); ) {
          it.advance();
          counts.adjustOrPutValue(it.key(),it.value(),it.value());
        }
      }
    }
    if (!histoFacet.totals.isEmpty()) {
      if (totals == null) {
        totals=histoFacet.totals;
      }
 else {
        for (TLongDoubleIterator it=histoFacet.totals.iterator(); it.hasNext(); ) {
          it.advance();
          totals.adjustOrPutValue(it.key(),it.value(),it.value());
        }
      }
    }
  }
  if (counts == null) {
    counts=InternalHistogramFacet.EMPTY_LONG_LONG_MAP;
  }
  if (totals == null) {
    totals=InternalHistogramFacet.EMPTY_LONG_DOUBLE_MAP;
  }
  firstHistoFacet.counts=counts;
  firstHistoFacet.totals=totals;
  return firstHistoFacet;
}
