{
  SocketAddress addr=new InetSocketAddress(InetAddress.getByName(config.group),config.port);
  MulticastSocket multicastSocket=new MulticastSocket(config.port);
  try {
    multicastSocket.setTimeToLive(config.ttl);
    if (config.deferToInterface) {
      multicastSocket.joinGroup(addr,null);
      multicastSocket.setInterface(config.multicastInterface);
    }
 else {
      multicastSocket.setInterface(config.multicastInterface);
      multicastSocket.joinGroup(InetAddress.getByName(config.group));
    }
    multicastSocket.setReceiveBufferSize(config.bufferSize);
    multicastSocket.setSendBufferSize(config.bufferSize);
    multicastSocket.setSoTimeout(60000);
  }
 catch (  Throwable e) {
    IOUtils.closeWhileHandlingException(multicastSocket);
    throw e;
  }
  return multicastSocket;
}
