{
  if (fuzziness != null) {
    if (mapper != null) {
      Query query=mapper.fuzzyQuery(term.text(),fuzziness,fuzzyPrefixLength,maxExpansions);
      if (query instanceof FuzzyQuery) {
        QueryParsers.setRewriteMethod((FuzzyQuery)query,fuzzyRewriteMethod);
      }
    }
    String text=term.text();
    int edits=FuzzyQuery.floatToEdits(Float.parseFloat(fuzziness),text.codePointCount(0,text.length()));
    FuzzyQuery query=new FuzzyQuery(term,edits,fuzzyPrefixLength,maxExpansions,transpositions);
    QueryParsers.setRewriteMethod(query,rewriteMethod);
    return query;
  }
  if (mapper != null) {
    Query termQuery=mapper.queryStringTermQuery(term);
    if (termQuery != null) {
      return termQuery;
    }
  }
  return new TermQuery(term);
}
