{
  if (version.onOrAfter(Version.LUCENE_4_3) && esVersion.onOrAfter(org.elasticsearch.Version.V_0_90_2)) {
    if (side == Lucene43EdgeNGramTokenizer.Side.BACK) {
      throw new ElasticsearchIllegalArgumentException("side=back is not supported anymore. Please fix your analysis chain or use" + " an older compatibility version (<=4.2) but beware that it might cause highlighting bugs." + " To obtain the same behavior as the previous version please use \"edgeNGram\" filter which still supports side=back"+ " in combination with a \"keyword\" tokenizer");
    }
    final Version version=this.version == Version.LUCENE_4_3 ? Version.LUCENE_4_4 : this.version;
    if (matcher == null) {
      return new EdgeNGramTokenizer(minGram,maxGram);
    }
 else {
      return new EdgeNGramTokenizer(minGram,maxGram){
        @Override protected boolean isTokenChar(        int chr){
          return matcher.isTokenChar(chr);
        }
      }
;
    }
  }
 else {
    return new Lucene43EdgeNGramTokenizer(side,minGram,maxGram);
  }
}
