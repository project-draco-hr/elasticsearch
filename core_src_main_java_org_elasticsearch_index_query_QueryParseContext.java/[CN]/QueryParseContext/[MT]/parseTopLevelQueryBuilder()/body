{
  try {
    QueryBuilder<?> queryBuilder=null;
    for (XContentParser.Token token=parser.nextToken(); token != XContentParser.Token.END_OBJECT; token=parser.nextToken()) {
      if (token == XContentParser.Token.FIELD_NAME) {
        String fieldName=parser.currentName();
        if ("query".equals(fieldName)) {
          queryBuilder=parseInnerQueryBuilder();
        }
 else {
          throw new ParsingException(parser.getTokenLocation(),"request does not support [" + parser.currentName() + "]");
        }
      }
    }
    if (queryBuilder == null) {
      throw new ParsingException(parser.getTokenLocation(),"Required query is missing");
    }
    return queryBuilder;
  }
 catch (  ParsingException e) {
    throw e;
  }
catch (  Throwable e) {
    throw new ParsingException(parser == null ? null : parser.getTokenLocation(),"Failed to parse",e);
  }
}
