{
  final IndexReader r2;
  if (useNonNrtReaders) {
    if (random().nextBoolean()) {
      r2=DirectoryReader.open(writer,true);
    }
 else {
      writer.commit();
      r2=DirectoryReader.open(dir);
    }
  }
 else {
    r2=DirectoryReader.open(writer,true);
  }
  return newSearcher(r2);
}
