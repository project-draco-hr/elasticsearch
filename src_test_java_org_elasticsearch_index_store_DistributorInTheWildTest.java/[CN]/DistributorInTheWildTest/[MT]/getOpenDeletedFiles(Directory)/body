{
  if (random().nextBoolean() && dir instanceof MockDirectoryWrapper) {
    return ((MockDirectoryWrapper)dir).getOpenDeletedFiles();
  }
  DistributorDirectory d=dir instanceof MockDirectoryWrapper ? (DistributorDirectory)((MockDirectoryWrapper)dir).getDelegate() : (DistributorDirectory)dir;
  assertTrue(DistributorDirectory.assertConsistency(logger,d));
  Distributor distributor=d.getDistributor();
  Set<String> set=new HashSet<>();
  for (  Directory subDir : distributor.all()) {
    Set<String> openDeletedFiles=((MockDirectoryWrapper)subDir).getOpenDeletedFiles();
    set.addAll(openDeletedFiles);
  }
  return set;
}
