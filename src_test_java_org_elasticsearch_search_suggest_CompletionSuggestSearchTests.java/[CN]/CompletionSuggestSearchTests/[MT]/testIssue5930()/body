{
  client().admin().indices().prepareCreate(INDEX).get();
  ElasticsearchAssertions.assertAcked(client().admin().indices().preparePutMapping(INDEX).setType(TYPE).setSource(jsonBuilder().startObject().startObject(TYPE).startObject("properties").startObject(FIELD).field("type","completion").endObject().endObject().endObject().endObject()));
  ensureYellow();
  String string="foo bar";
  client().prepareIndex(INDEX,TYPE,"1").setSource(jsonBuilder().startObject().field(FIELD,string).endObject()).setRefresh(true).get();
  try {
    client().prepareSearch(INDEX).addAggregation(AggregationBuilders.terms("suggest_agg").field(FIELD).collectMode(randomFrom(SubAggCollectionMode.values()))).execute().actionGet();
    assertFalse(true);
  }
 catch (  SearchPhaseExecutionException e) {
    assertTrue(e.getDetailedMessage().contains("found no fielddata type for field [" + FIELD + "]"));
  }
}
