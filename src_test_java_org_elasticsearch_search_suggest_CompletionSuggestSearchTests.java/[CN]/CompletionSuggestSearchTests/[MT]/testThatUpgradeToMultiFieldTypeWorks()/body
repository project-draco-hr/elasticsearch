{
  final XContentBuilder mapping=jsonBuilder().startObject().startObject(TYPE).startObject("properties").startObject(FIELD).field("type","string").field("path","just_name").endObject().endObject().endObject().endObject();
  assertAcked(prepareCreate(INDEX).addMapping(TYPE,mapping));
  client().prepareIndex(INDEX,TYPE,"1").setRefresh(true).setSource(jsonBuilder().startObject().field(FIELD,"Foo Fighters").endObject()).get();
  ensureGreen(INDEX);
  PutMappingResponse putMappingResponse=client().admin().indices().preparePutMapping(INDEX).setType(TYPE).setSource(jsonBuilder().startObject().startObject(TYPE).startObject("properties").startObject(FIELD).field("type","multi_field").field("path","just_name").startObject("fields").startObject(FIELD).field("type","string").endObject().startObject("suggest").field("type","completion").field("index_analyzer","simple").field("search_analyzer","simple").endObject().endObject().endObject().endObject().endObject().endObject()).get();
  assertThat(putMappingResponse.isAcknowledged(),is(true));
  SuggestResponse suggestResponse=client().prepareSuggest(INDEX).addSuggestion(new CompletionSuggestionBuilder("suggs").field("suggest").text("f").size(10)).execute().actionGet();
  assertSuggestions(suggestResponse,"suggs");
  client().prepareIndex(INDEX,TYPE,"1").setRefresh(true).setSource(jsonBuilder().startObject().field(FIELD,"Foo Fighters").endObject()).get();
  ensureGreen(INDEX);
  SuggestResponse afterReindexingResponse=client().prepareSuggest(INDEX).addSuggestion(SuggestBuilders.completionSuggestion("suggs").field("suggest").text("f").size(10)).execute().actionGet();
  assertSuggestions(afterReindexingResponse,"suggs","Foo Fighters");
}
