{
  IndexRequest index=new IndexRequest("index","type","1").source(singletonMap("foo","bar"));
  Map<String,SearchHitField> fields=new HashMap<>();
  InternalSearchHit doc=new InternalSearchHit(0,"id",new Text("type"),fields);
  doc.shardTarget(new SearchShardTarget("nodeid",new Index("index","uuid"),1));
  ExecutableScript executableScript=new SimpleExecutableScript(scriptBody);
  when(scriptService.executable(any(CompiledScript.class),Matchers.<Map<String,Object>>any())).thenReturn(executableScript);
  AbstractAsyncBulkIndexByScrollAction<Request> action=action(scriptService,request().setScript(EMPTY_SCRIPT));
  action.buildScriptApplier().apply(AbstractAsyncBulkIndexByScrollAction.wrap(index),doc);
  return index;
}
