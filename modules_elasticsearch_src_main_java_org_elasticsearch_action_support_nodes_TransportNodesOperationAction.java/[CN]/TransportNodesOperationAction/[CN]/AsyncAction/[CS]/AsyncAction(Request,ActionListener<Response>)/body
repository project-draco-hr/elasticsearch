{
  this.request=request;
  this.listener=listener;
  clusterState=clusterService.state();
  String[] nodesIds=request.nodesIds();
  if (nodesIds == null || nodesIds.length == 0 || (nodesIds.length == 1 && nodesIds[0].equals("_all"))) {
    int index=0;
    nodesIds=new String[clusterState.nodes().size()];
    for (    DiscoveryNode node : clusterState.nodes()) {
      nodesIds[index++]=node.id();
    }
  }
  for (int i=0; i < nodesIds.length; i++) {
    if (nodesIds[i].equals("_local")) {
      nodesIds[i]=clusterState.nodes().localNodeId();
    }
 else     if (nodesIds[i].equals("_master")) {
      nodesIds[i]=clusterState.nodes().masterNodeId();
    }
  }
  this.nodesIds=filterNodeIds(clusterState.nodes(),nodesIds);
  this.responses=new AtomicReferenceArray<Object>(this.nodesIds.length);
}
