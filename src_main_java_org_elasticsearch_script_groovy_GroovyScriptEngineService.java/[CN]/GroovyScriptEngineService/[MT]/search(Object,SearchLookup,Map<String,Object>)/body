{
  try {
    Map<String,Object> allVars=new HashMap<>();
    allVars.putAll(lookup.asMap());
    if (vars != null) {
      allVars.putAll(vars);
    }
    Script scriptObject=createScript(compiledScript,allVars);
    return new GroovyScript(scriptObject,lookup,this.logger);
  }
 catch (  Exception e) {
    throw new ScriptException("failed to build search script",e);
  }
}
