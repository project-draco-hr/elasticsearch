{
  CommonStats stats=new CommonStats(flags);
  if (includePrevious) {
    Flag[] setFlags=flags.getFlags();
    for (    Flag flag : setFlags) {
switch (flag) {
case Get:
        stats.get.add(oldShardsStats.getStats);
      break;
case Indexing:
    stats.indexing.add(oldShardsStats.indexingStats);
  break;
case Search:
stats.search.add(oldShardsStats.searchStats);
break;
case Merge:
stats.merge.add(oldShardsStats.mergeStats);
break;
case Refresh:
stats.refresh.add(oldShardsStats.refreshStats);
break;
case Flush:
stats.flush.add(oldShardsStats.flushStats);
break;
}
}
}
for (IndexService indexService : indices.values()) {
for (IndexShard indexShard : indexService) {
try {
stats.add(new CommonStats(indexShard,flags));
}
 catch (IllegalIndexShardStateException e) {
}
}
}
return new NodeIndicesStats(stats);
}
