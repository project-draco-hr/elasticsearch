{
  List<IndexRequestBuilder> docs=new ArrayList<>();
  docs.addAll(indexDoc("1","1",5));
  docs.addAll(indexDoc("1","2",4));
  docs.addAll(indexDoc("1","3",3));
  docs.addAll(indexDoc("1","4",2));
  docs.addAll(indexDoc("1","5",1));
  docs.addAll(indexDoc("2","1",3));
  docs.addAll(indexDoc("2","2",1));
  docs.addAll(indexDoc("2","3",5));
  docs.addAll(indexDoc("2","4",2));
  docs.addAll(indexDoc("2","5",1));
  indexRandom(true,docs);
  SearchResponse resp=client().prepareSearch("idx").setTypes("type").setRouting("1").setQuery(matchAllQuery()).execute().actionGet();
  assertSearchResponse(resp);
  long totalOnOne=resp.getHits().getTotalHits();
  assertThat(totalOnOne,is(15l));
  resp=client().prepareSearch("idx").setTypes("type").setRouting("2").setQuery(matchAllQuery()).execute().actionGet();
  assertSearchResponse(resp);
  long totalOnTwo=resp.getHits().getTotalHits();
  assertThat(totalOnTwo,is(12l));
}
