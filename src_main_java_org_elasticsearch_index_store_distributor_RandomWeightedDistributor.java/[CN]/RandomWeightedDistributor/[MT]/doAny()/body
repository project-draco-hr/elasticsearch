{
  long[] usableSpace=new long[delegates.length];
  long size=0;
  for (int i=0; i < delegates.length; i++) {
    Directory delegate=delegates[i];
    if (delegate instanceof FSDirectory) {
      size+=((FSDirectory)delegate).getDirectory().getUsableSpace();
    }
 else {
    }
    usableSpace[i]=size;
  }
  if (size != 0) {
    long random=ThreadLocalRandom.current().nextLong(size);
    for (int i=0; i < delegates.length; i++) {
      if (usableSpace[i] > random) {
        return delegates[i];
      }
    }
  }
  return delegates[ThreadLocalRandom.current().nextInt(delegates.length)];
}
