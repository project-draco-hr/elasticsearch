{
  ChannelPipeline pipeline=Channels.pipeline();
  pipeline.addLast("openChannels",transport.serverOpenChannels);
  HttpRequestDecoder requestDecoder=new HttpRequestDecoder((int)transport.maxInitialLineLength.bytes(),(int)transport.maxHeaderSize.bytes(),(int)transport.maxChunkSize.bytes());
  if (transport.maxCumulationBufferCapacity.bytes() >= 0) {
    if (transport.maxCumulationBufferCapacity.bytes() > Integer.MAX_VALUE) {
      requestDecoder.setMaxCumulationBufferCapacity(Integer.MAX_VALUE);
    }
 else {
      requestDecoder.setMaxCumulationBufferCapacity((int)transport.maxCumulationBufferCapacity.bytes());
    }
  }
  if (transport.maxCompositeBufferComponents != -1) {
    requestDecoder.setMaxCumulationBufferComponents(transport.maxCompositeBufferComponents);
  }
  pipeline.addLast("decoder",requestDecoder);
  pipeline.addLast("decoder_compress",new ESHttpContentDecompressor(transport.compression));
  HttpChunkAggregator httpChunkAggregator=new HttpChunkAggregator((int)transport.maxContentLength.bytes());
  if (transport.maxCompositeBufferComponents != -1) {
    httpChunkAggregator.setMaxCumulationBufferComponents(transport.maxCompositeBufferComponents);
  }
  pipeline.addLast("aggregator",httpChunkAggregator);
  if (SETTING_CORS_ENABLED.get(transport.settings())) {
    pipeline.addLast("cors",new CorsHandler(transport.getCorsConfig()));
  }
  pipeline.addLast("encoder",new ESHttpResponseEncoder());
  if (transport.compression) {
    pipeline.addLast("encoder_compress",new HttpContentCompressor(transport.compressionLevel));
  }
  if (transport.pipelining) {
    pipeline.addLast("pipelining",new HttpPipeliningHandler(transport.pipeliningMaxEvents));
  }
  pipeline.addLast("handler",requestHandler);
  return pipeline;
}
