{
  MultiGetRequest request=new MultiGetRequest();
  request.add(null,null,null,null,new BytesArray(json),true);
  List<MultiGetRequest.Item> items=request.getItems();
  assertEquals(items.size(),3);
  for (  MultiGetRequest.Item item : items) {
    assertThat(item.index(),is("test"));
    assertThat(item.type(),is("type"));
    FetchSourceContext fetchSource=item.fetchSourceContext();
switch (item.id()) {
case "1":
      assertThat(fetchSource.fetchSource(),is(false));
    break;
case "2":
  assertThat(fetchSource.fetchSource(),is(true));
assertThat(fetchSource.includes(),is(new String[]{"field3","field4"}));
break;
case "3":
assertThat(fetchSource.fetchSource(),is(true));
assertThat(fetchSource.includes(),is(new String[]{"user"}));
assertThat(fetchSource.excludes(),is(new String[]{"user.location"}));
break;
default :
fail("item with id: " + item.id() + " is not 1, 2 or 3");
break;
}
}
return items;
}
