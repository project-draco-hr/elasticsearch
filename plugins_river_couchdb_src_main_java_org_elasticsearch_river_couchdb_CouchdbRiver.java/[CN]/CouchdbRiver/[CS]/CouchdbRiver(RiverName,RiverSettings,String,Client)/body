{
  super(riverName,settings);
  this.riverIndexName=riverIndexName;
  this.client=client;
  if (settings.settings().containsKey("couchdb")) {
    Map<String,Object> couchSettings=(Map<String,Object>)settings.settings().get("couchdb");
    couchHost=XContentMapValues.nodeStringValue(couchSettings.get("host"),"localhost");
    couchPort=XContentMapValues.nodeIntegerValue(couchSettings.get("port"),5984);
    couchDb=XContentMapValues.nodeStringValue(couchSettings.get("db"),riverName.name());
    couchFilter=XContentMapValues.nodeStringValue(couchSettings.get("filter"),null);
    if (couchSettings.containsKey("filter_params")) {
      Map<String,Object> filterParams=(Map<String,Object>)couchSettings.get("filter_params");
      StringBuilder sb=new StringBuilder();
      for (      Map.Entry<String,Object> entry : filterParams.entrySet()) {
        try {
          sb.append("&").append(URLEncoder.encode(entry.getKey(),"UTF-8")).append("=").append(URLEncoder.encode(entry.getValue().toString(),"UTF-8"));
        }
 catch (        UnsupportedEncodingException e) {
        }
      }
      couchFilterParamsUrl=sb.toString();
    }
 else {
      couchFilterParamsUrl=null;
    }
    if (couchSettings.containsKey("user") && couchSettings.containsKey("password")) {
      String user=couchSettings.get("user").toString();
      String password=couchSettings.get("password").toString();
      basicAuth="Basic " + Base64.encodeBytes((user + ":" + password).getBytes());
    }
 else {
      basicAuth=null;
    }
  }
 else {
    couchHost="localhost";
    couchPort=5984;
    couchDb="db";
    couchFilter=null;
    couchFilterParamsUrl=null;
    basicAuth=null;
  }
  if (settings.settings().containsKey("index")) {
    Map<String,Object> indexSettings=(Map<String,Object>)settings.settings().get("index");
    indexName=XContentMapValues.nodeStringValue(indexSettings.get("index"),couchDb);
    typeName=XContentMapValues.nodeStringValue(indexSettings.get("type"),couchDb);
    bulkSize=XContentMapValues.nodeIntegerValue(indexSettings.get("bulk_size"),100);
    if (indexSettings.containsKey("bulk_timeout")) {
      bulkTimeout=TimeValue.parseTimeValue(XContentMapValues.nodeStringValue(indexSettings.get("bulk_timeout"),"10ms"),TimeValue.timeValueMillis(10));
    }
 else {
      bulkTimeout=TimeValue.timeValueMillis(10);
    }
  }
 else {
    indexName=couchDb;
    typeName=couchDb;
    bulkSize=100;
    bulkTimeout=TimeValue.timeValueMillis(10);
  }
}
