{
  Map<String,Object> map=null;
  try {
    map=XContentFactory.xContent(XContentType.JSON).createParser(s).mapAndClose();
  }
 catch (  IOException e) {
    logger.warn("failed to parse {}",e,s);
    return null;
  }
  if (map.containsKey("error")) {
    logger.warn("received error {}",s);
    return null;
  }
  String seq=map.get("seq").toString();
  String id=map.get("id").toString();
  if (id.startsWith("_design/")) {
    logger.trace("ignoring design document {}",id);
    return seq;
  }
  if (map.containsKey("deleted") && map.get("deleted").equals(Boolean.TRUE)) {
    bulk.add(deleteRequest(indexName).type(typeName).id(id));
  }
 else   if (map.containsKey("doc")) {
    Map<String,Object> doc=(Map<String,Object>)map.get("doc");
    bulk.add(indexRequest(indexName).type(typeName).id(id).source(doc));
  }
 else {
    logger.warn("ignoring unknown change {}",s);
  }
  return seq;
}
