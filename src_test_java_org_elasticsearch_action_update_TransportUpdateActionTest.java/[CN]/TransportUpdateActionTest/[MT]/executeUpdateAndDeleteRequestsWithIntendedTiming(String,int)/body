{
  ListenableActionFuture<UpdateResponse> updateFuture=updateDocument(documentId,false,retryOnConflict);
  internalEngine.waitUntilIndexOperationReceived();
  sendDeleteRequestAndWaitUntilCompletelyDone(documentId);
  internalEngine.letIndexOperationBegin();
  internalEngine.waitUntilIndexOperationFinished();
  internalEngine.letIndexOperationReturn();
  return updateFuture;
}
