{
  ListenableActionFuture<UpdateResponse> upsertFuture=updateDocument(documentId,true,1);
  internalEngine.waitUntilCreateOperationReceived();
  sendAddRequestAndWaitUntilCompletelyDone(documentId);
  internalEngine.letCreateOperationBegin();
  internalEngine.waitUntilCreateOperationFinished();
  internalEngine.letNextGetThrowException();
  internalEngine.letCreateOperationReturn();
  verifyUpdateResponseCompletesExceptionally(upsertFuture,VersionConflictEngineException.class);
}
