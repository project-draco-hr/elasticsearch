{
  this.index=index;
  this.shuffler=new RotationShardShuffler(ThreadLocalRandom.current().nextInt());
  this.shards=shards;
  ImmutableList.Builder<ShardRouting> allShards=ImmutableList.builder();
  ImmutableList.Builder<ShardRouting> allActiveShards=ImmutableList.builder();
  for (  IntObjectCursor<IndexShardRoutingTable> cursor : shards) {
    for (    ShardRouting shardRouting : cursor.value) {
      allShards.add(shardRouting);
      if (shardRouting.active()) {
        allActiveShards.add(shardRouting);
      }
    }
  }
  this.allShards=allShards.build();
  this.allActiveShards=allActiveShards.build();
}
