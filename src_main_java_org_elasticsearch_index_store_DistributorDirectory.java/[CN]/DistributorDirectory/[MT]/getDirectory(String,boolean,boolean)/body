{
  if (usePrimary(name)) {
    return distributor.primary();
  }
  if (!nameDirMapping.containsKey(name)) {
    if (iterate) {
      for (      Directory dir : distributor.all()) {
        if (dir.fileExists(name)) {
          final Directory directory=nameDirMapping.putIfAbsent(name,dir);
          return directory == null ? dir : directory;
        }
      }
    }
    if (failIfNotAssociated) {
      throw new FileNotFoundException("No such file [" + name + "]");
    }
  }
  final Directory dir=distributor.any();
  final Directory directory=nameDirMapping.putIfAbsent(name,dir);
  return directory == null ? dir : directory;
}
