{
  if (usePrimary(name)) {
    return distributor.primary();
  }
  Directory directory=nameDirMapping.get(name);
  if (directory == null) {
    if (failIfNotAssociated) {
      throw new FileNotFoundException("No such file [" + name + "]");
    }
    final Directory dir=distributor.any();
    directory=nameDirMapping.putIfAbsent(name,dir);
    if (directory == null) {
      directory=dir;
    }
  }
  return directory;
}
