{
  try {
    if (!context.queryRewritten()) {
      context.updateRewriteQuery(context.searcher().rewrite(context.query()));
    }
    THashSet<Term> termsSet=cachedTermsSet.get().get();
    termsSet.clear();
    context.query().extractTerms(termsSet);
    Term[] terms=termsSet.toArray(new Term[termsSet.size()]);
    TermStatistics[] termStatistics=new TermStatistics[terms.length];
    IndexReaderContext indexReaderContext=context.searcher().getTopReaderContext();
    for (int i=0; i < terms.length; i++) {
      TermContext termContext=TermContext.build(indexReaderContext,terms[i],false);
      termStatistics[i]=context.searcher().termStatistics(terms[i],termContext);
    }
    context.dfsResult().termsAndFreqs(terms,termStatistics);
    context.dfsResult().maxDoc(context.searcher().getIndexReader().maxDoc());
  }
 catch (  Exception e) {
    throw new DfsPhaseExecutionException(context,"Exception during dfs phase",e);
  }
}
