{
  super(settings);
  this.threadPool=threadPool;
  this.transportService=transportService;
  this.recoverySettings=recoverySettings;
  this.clusterService=clusterService;
  this.onGoingRecoveries=new RecoveriesCollection(logger,threadPool);
  transportService.registerRequestHandler(Actions.FILES_INFO,RecoveryFilesInfoRequest.class,ThreadPool.Names.GENERIC,new FilesInfoRequestHandler());
  transportService.registerRequestHandler(Actions.FILE_CHUNK,RecoveryFileChunkRequest.class,ThreadPool.Names.GENERIC,new FileChunkTransportRequestHandler());
  transportService.registerRequestHandler(Actions.CLEAN_FILES,RecoveryCleanFilesRequest.class,ThreadPool.Names.GENERIC,new CleanFilesRequestHandler());
  transportService.registerRequestHandler(Actions.PREPARE_TRANSLOG,RecoveryPrepareForTranslogOperationsRequest.class,ThreadPool.Names.GENERIC,new PrepareForTranslogOperationsRequestHandler());
  transportService.registerRequestHandler(Actions.TRANSLOG_OPS,RecoveryTranslogOperationsRequest.class,ThreadPool.Names.GENERIC,new TranslogOperationsRequestHandler());
  transportService.registerRequestHandler(Actions.FINALIZE,RecoveryFinalizeRecoveryRequest.class,ThreadPool.Names.GENERIC,new FinalizeRecoveryRequestHandler());
  indicesLifecycle.addListener(new IndicesLifecycle.Listener(){
    @Override public void beforeIndexShardClosed(    ShardId shardId,    @Nullable IndexShard indexShard,    @IndexSettings Settings indexSettings){
      if (indexShard != null) {
        onGoingRecoveries.cancelRecoveriesForShard(shardId,"shard closed");
      }
    }
  }
);
}
