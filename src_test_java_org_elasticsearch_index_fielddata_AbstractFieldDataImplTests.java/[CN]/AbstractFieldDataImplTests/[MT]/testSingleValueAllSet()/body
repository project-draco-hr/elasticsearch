{
  fillSingleValueAllSet();
  IndexFieldData indexFieldData=getForField("value");
  AtomicReaderContext readerContext=refreshReader();
  AtomicFieldData fieldData=indexFieldData.load(readerContext);
  assertThat(fieldData.getMemorySizeInBytes(),greaterThan(0l));
  assertThat(fieldData.getNumDocs(),equalTo(3));
  BytesValues bytesValues=fieldData.getBytesValues();
  assertThat(bytesValues.isMultiValued(),equalTo(false));
  assertThat(bytesValues.hasValue(0),equalTo(true));
  assertThat(bytesValues.hasValue(1),equalTo(true));
  assertThat(bytesValues.hasValue(2),equalTo(true));
  assertThat(bytesValues.getValue(0),equalTo(new BytesRef(two())));
  assertThat(bytesValues.getValue(1),equalTo(new BytesRef(one())));
  assertThat(bytesValues.getValue(2),equalTo(new BytesRef(three())));
  assertValues(bytesValues,0,two());
  assertValues(bytesValues,1,one());
  assertValues(bytesValues,2,three());
  BytesValues hashedBytesValues=fieldData.getBytesValues();
  assertThat(hashedBytesValues.hasValue(0),equalTo(true));
  assertThat(hashedBytesValues.hasValue(1),equalTo(true));
  assertThat(hashedBytesValues.hasValue(2),equalTo(true));
  assertThat(convert(hashedBytesValues,0),equalTo(new HashedBytesRef(two())));
  assertThat(convert(hashedBytesValues,1),equalTo(new HashedBytesRef(one())));
  assertThat(convert(hashedBytesValues,2),equalTo(new HashedBytesRef(three())));
  assertHashedValues(hashedBytesValues,0,two());
  assertHashedValues(hashedBytesValues,1,one());
  assertHashedValues(hashedBytesValues,2,three());
  IndexSearcher searcher=new IndexSearcher(readerContext.reader());
  TopFieldDocs topDocs;
  topDocs=searcher.search(new MatchAllDocsQuery(),10,new Sort(new SortField("value",indexFieldData.comparatorSource(null,SortMode.MIN))));
  assertThat(topDocs.totalHits,equalTo(3));
  assertThat(topDocs.scoreDocs[0].doc,equalTo(1));
  assertThat(toString(((FieldDoc)topDocs.scoreDocs[0]).fields[0]),equalTo(one()));
  assertThat(topDocs.scoreDocs[1].doc,equalTo(0));
  assertThat(toString(((FieldDoc)topDocs.scoreDocs[1]).fields[0]),equalTo(two()));
  assertThat(topDocs.scoreDocs[2].doc,equalTo(2));
  assertThat(toString(((FieldDoc)topDocs.scoreDocs[2]).fields[0]),equalTo(three()));
  topDocs=searcher.search(new MatchAllDocsQuery(),10,new Sort(new SortField("value",indexFieldData.comparatorSource(null,SortMode.MAX),true)));
  assertThat(topDocs.totalHits,equalTo(3));
  assertThat(topDocs.scoreDocs[0].doc,equalTo(2));
  assertThat(topDocs.scoreDocs[1].doc,equalTo(0));
  assertThat(topDocs.scoreDocs[2].doc,equalTo(1));
}
