{
  assertThat(this.testRoutingTable.allActiveShardCopiesGrouped(new ShardId(TEST_INDEX_1,randomInt(numberOfShards - 1))).size(),is(0));
  try {
    this.testRoutingTable.allActiveShardCopiesGrouped(new ShardId(TEST_INDEX_1,numberOfShards)).size();
    fail();
  }
 catch (  ElasticsearchIllegalStateException e) {
  }
  initPrimaries();
  assertThat(this.testRoutingTable.allActiveShardCopiesGrouped(new ShardId(TEST_INDEX_1,randomInt(numberOfShards - 1))).size(),is(0));
  startInitializingShards(TEST_INDEX_1);
  assertThat(this.testRoutingTable.allActiveShardCopiesGrouped(new ShardId(TEST_INDEX_1,randomInt(numberOfShards - 1))).size(),is(1));
  startInitializingShards(TEST_INDEX_1);
  assertThat(this.testRoutingTable.allActiveShardCopiesGrouped(new ShardId(TEST_INDEX_1,randomInt(numberOfShards - 1))).size(),is(numberOfReplicas + 1));
}
