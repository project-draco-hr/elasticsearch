{
  List<String> prefixesToRemove=new ArrayList<>();
  for (  final Map.Entry<String,String> entry : settings.entrySet()) {
    final Matcher matcher=ARRAY_PATTERN.matcher(entry.getKey());
    if (matcher.matches()) {
      prefixesToRemove.add(matcher.group(1));
    }
 else     if (Iterables.any(map.keySet(),startsWith(entry.getKey() + "."))) {
      prefixesToRemove.add(entry.getKey());
    }
  }
  for (  String prefix : prefixesToRemove) {
    Iterator<Map.Entry<String,String>> iterator=map.entrySet().iterator();
    while (iterator.hasNext()) {
      Map.Entry<String,String> entry=iterator.next();
      if (entry.getKey().startsWith(prefix + ".") || entry.getKey().equals(prefix)) {
        iterator.remove();
      }
    }
  }
}
