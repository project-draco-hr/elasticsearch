{
  if (response.status().getStatus() >= 500) {
    channel.write(ERROR.duplicate());
  }
 else {
    if (request.method() == RestRequest.Method.POST) {
      channel.write(STORED.duplicate());
    }
 else     if (request.method() == RestRequest.Method.DELETE) {
      channel.write(DELETED.duplicate());
    }
 else {
      try {
        ChannelBuffer writeBuffer=ChannelBuffers.dynamicBuffer(response.contentLength() + 512);
        writeBuffer.writeBytes(VALUE.duplicate());
        writeBuffer.writeBytes(Unicode.fromStringAsBytes(request.uri()));
        writeBuffer.writeByte((byte)' ');
        writeBuffer.writeByte((byte)'0');
        writeBuffer.writeByte((byte)' ');
        writeBuffer.writeBytes(Bytes.itoa(response.contentLength()));
        writeBuffer.writeByte((byte)'\r');
        writeBuffer.writeByte((byte)'\n');
        writeBuffer.writeBytes(response.content(),0,response.contentLength());
        writeBuffer.writeByte((byte)'\r');
        writeBuffer.writeByte((byte)'\n');
        writeBuffer.writeBytes(END.duplicate());
        channel.write(writeBuffer);
      }
 catch (      Exception e) {
        throw new MemcachedTransportException("Failed to write 'get' response",e);
      }
    }
  }
}
