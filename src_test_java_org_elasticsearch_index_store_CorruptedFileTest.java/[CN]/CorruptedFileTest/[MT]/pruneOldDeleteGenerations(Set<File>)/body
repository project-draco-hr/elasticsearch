{
  final TreeSet<File> delFiles=new TreeSet<>();
  for (  File file : files) {
    if (file.getName().endsWith(".del")) {
      delFiles.add(file);
    }
  }
  File last=null;
  for (  File current : delFiles) {
    if (last != null) {
      final String newSegmentName=IndexFileNames.parseSegmentName(current.getName());
      final String oldSegmentName=IndexFileNames.parseSegmentName(last.getName());
      if (newSegmentName.equals(oldSegmentName)) {
        int oldGen=Integer.parseInt(IndexFileNames.stripExtension(IndexFileNames.stripSegmentName(last.getName())).replace("_",""),Character.MAX_RADIX);
        int newGen=Integer.parseInt(IndexFileNames.stripExtension(IndexFileNames.stripSegmentName(current.getName())).replace("_",""),Character.MAX_RADIX);
        if (newGen > oldGen) {
          files.remove(last);
        }
 else {
          files.remove(current);
          continue;
        }
      }
    }
    last=current;
  }
}
