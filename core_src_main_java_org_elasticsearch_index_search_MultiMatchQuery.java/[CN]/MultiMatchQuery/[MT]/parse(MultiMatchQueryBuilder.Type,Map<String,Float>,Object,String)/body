{
  if (fieldNames.size() == 1) {
    Map.Entry<String,Float> fieldBoost=fieldNames.entrySet().iterator().next();
    Float boostValue=fieldBoost.getValue();
    return parseAndApply(type.matchQueryType(),fieldBoost.getKey(),value,minimumShouldMatch,boostValue);
  }
  final float tieBreaker=groupTieBreaker == null ? type.tieBreaker() : groupTieBreaker;
switch (type) {
case PHRASE:
case PHRASE_PREFIX:
case BEST_FIELDS:
case MOST_FIELDS:
    queryBuilder=new QueryBuilder(tieBreaker);
  break;
case CROSS_FIELDS:
queryBuilder=new CrossFieldsQueryBuilder(tieBreaker);
break;
default :
throw new IllegalStateException("No such type: " + type);
}
final List<? extends Query> queries=queryBuilder.buildGroupedQueries(type,fieldNames,value,minimumShouldMatch);
return queryBuilder.combineGrouped(queries);
}
