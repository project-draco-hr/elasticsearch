{
  IndexQueryParserService queryParserService=indicesService.indexServiceSafe(request.index()).queryParserService();
  boolean valid;
  String explanation=null;
  String error=null;
  if (request.querySource().length() == 0) {
    valid=true;
  }
 else {
    try {
      ParsedQuery parsedQuery=queryParserService.parse(request.querySource().bytes(),request.querySource().offset(),request.querySource().length());
      valid=true;
      if (request.explain()) {
        explanation=parsedQuery.query().toString();
      }
    }
 catch (    QueryParsingException e) {
      valid=false;
      error=e.getDetailedMessage();
    }
catch (    AssertionError e) {
      valid=false;
      error=e.getMessage();
    }
  }
  return new ShardValidateQueryResponse(request.index(),request.shardId(),valid,explanation,error);
}
