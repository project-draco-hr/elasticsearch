{
  test.indexRandom(true,client().prepareIndex("source","test","1").setSource("foo","a"),client().prepareIndex("source","test","2").setSource("foo","a"));
  request.source("source").script(new Script("sticky",ScriptType.INLINE,"native",emptyMap()));
  request.source().setSize(1);
  ListenableActionFuture<Response> response=request.execute();
  barrier.await(30,TimeUnit.SECONDS);
  barrier.await(30,TimeUnit.SECONDS);
  barrier.await(30,TimeUnit.SECONDS);
  List<TaskInfo> cancelledTasks=client().admin().cluster().prepareCancelTasks().setActions(actionToCancel).get().getTasks();
  assertThat(cancelledTasks,hasSize(1));
  barrier.await();
  return response.get();
}
