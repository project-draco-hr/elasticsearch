{
  ensureGreen();
  try {
    getRestClient().performRequest("GET","/_protected",Collections.emptyMap(),null);
    fail("request should have failed");
  }
 catch (  ElasticsearchResponseException e) {
    ElasticsearchResponse response=e.getElasticsearchResponse();
    assertThat(response.getStatusLine().getStatusCode(),equalTo(401));
    assertThat(response.getHeader("Secret"),equalTo("required"));
  }
  try (ElasticsearchResponse authResponse=getRestClient().performRequest("GET","/_protected",Collections.emptyMap(),null,new BasicHeader("Secret","password"))){
    assertThat(authResponse.getStatusLine().getStatusCode(),equalTo(200));
    assertThat(authResponse.getHeader("Secret"),equalTo("granted"));
  }
 }
