{
  ensureGreen();
  try {
    getRestClient().performRequest("GET","/_protected",Collections.emptyMap(),null);
    fail("request should have failed");
  }
 catch (  ElasticsearchResponseException e) {
    ElasticsearchResponse response=e.getElasticsearchResponse();
    assertThat(response,hasStatus(UNAUTHORIZED));
    assertThat(response.getFirstHeader("Secret"),equalTo("required"));
  }
  try (ElasticsearchResponse authResponse=getRestClient().performRequest("GET","/_protected",Collections.emptyMap(),null,new BasicHeader("Secret","password"))){
    assertThat(authResponse,hasStatus(OK));
    assertThat(authResponse.getFirstHeader("Secret"),equalTo("granted"));
  }
 }
