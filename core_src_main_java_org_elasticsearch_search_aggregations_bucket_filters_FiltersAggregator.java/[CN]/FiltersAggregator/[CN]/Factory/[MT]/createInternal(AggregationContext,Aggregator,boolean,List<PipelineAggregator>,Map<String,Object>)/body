{
  IndexSearcher contextSearcher=context.searchContext().searcher();
  if (searcher != contextSearcher) {
    searcher=contextSearcher;
    weights=new Weight[filters.size()];
    keys=new String[filters.size()];
    for (int i=0; i < filters.size(); ++i) {
      KeyedFilter keyedFilter=filters.get(i);
      this.keys[i]=keyedFilter.key;
      Query filter=keyedFilter.filter.toFilter(context.searchContext().indexShard().getQueryShardContext());
      this.weights[i]=contextSearcher.createNormalizedWeight(filter,false);
    }
  }
  return new FiltersAggregator(name,factories,keys,weights,keyed,otherBucket ? otherBucketKey : null,context,parent,pipelineAggregators,metaData);
}
