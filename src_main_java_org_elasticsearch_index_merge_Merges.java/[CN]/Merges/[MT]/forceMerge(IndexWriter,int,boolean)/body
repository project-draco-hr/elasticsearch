{
  MergeScheduler mergeScheduler=writer.getConfig().getMergeScheduler();
  if (mergeScheduler instanceof EnableMergeScheduler) {
    ((EnableMergeScheduler)mergeScheduler).enableMerge();
    try {
      writer.forceMerge(maxNumSegments,doWait);
    }
  finally {
      ((EnableMergeScheduler)mergeScheduler).disableMerge();
    }
  }
 else {
    writer.forceMerge(maxNumSegments,doWait);
  }
}
