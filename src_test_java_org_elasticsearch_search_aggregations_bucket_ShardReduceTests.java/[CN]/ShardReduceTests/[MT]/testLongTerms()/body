{
  SearchResponse response=client().prepareSearch("idx").setQuery(QueryBuilders.matchAllQuery()).addAggregation(terms("terms").field("term-l").collectMode(randomFrom(SubAggCollectionMode.values())).subAggregation(dateHistogram("histo").field("date").interval(DateHistogram.Interval.DAY).minDocCount(0))).execute().actionGet();
  assertSearchResponse(response);
  Terms terms=response.getAggregations().get("terms");
  DateHistogram histo=terms.getBucketByKey("1").getAggregations().get("histo");
  assertThat(histo.getBuckets().size(),equalTo(4));
}
