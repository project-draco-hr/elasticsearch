{
  DiscoveryNodes nodes=nodesProvider.nodes();
  if (!request.masterNodeId.equals(nodes.localNodeId())) {
    throw new ElasticSearchIllegalStateException("Got ping as master with id [" + request.masterNodeId + "], but not master and no id");
  }
  if (!nodes.localNodeMaster()) {
    throw new NoLongerMasterException();
  }
  channel.sendResponse(new MasterPingResponseResponse(nodes.nodeExists(request.nodeId)));
}
