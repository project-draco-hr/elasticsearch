{
  DiscoveryNodes nodes=nodesProvider.nodes();
  if (!request.masterNodeId.equals(nodes.localNodeId())) {
    throw new NotMasterException();
  }
  if (request.clusterName != null && !request.clusterName.equals(clusterName)) {
    logger.trace("master fault detection ping request is targeted for a different [{}] cluster then us [{}]",request.clusterName,clusterName);
    throw new NotMasterException("master fault detection ping request is targeted for a different [" + request.clusterName + "] cluster then us ["+ clusterName+ "]");
  }
  if (!nodes.localNodeMaster()) {
    throw new NoLongerMasterException();
  }
  if (!nodes.nodeExists(request.nodeId)) {
    throw new NodeDoesNotExistOnMasterException();
  }
  channel.sendResponse(new MasterPingResponseResponse(nodes.nodeExists(request.nodeId)));
}
