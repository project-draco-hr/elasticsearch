{
  long remainingDelay=42;
  Index i=new Index("test","uuid");
  ShardId shardId=new ShardId(i,0);
  ShardRouting shard=ShardRouting.newUnassigned(i,0,null,false,new UnassignedInfo(UnassignedInfo.Reason.INDEX_CREATED,"foo"));
  IndexMetaData indexMetaData=IndexMetaData.builder("test").settings(Settings.builder().put(IndexMetaData.SETTING_VERSION_CREATED,Version.CURRENT).put(IndexMetaData.SETTING_INDEX_UUID,"uuid")).numberOfShards(1).numberOfReplicas(0).build();
  DiscoveryNode node=new DiscoveryNode("node-0",DummyTransportAddress.INSTANCE,emptyMap(),emptySet(),Version.CURRENT);
  Decision.Multi d=new Decision.Multi();
  d.add(Decision.single(Decision.Type.NO,"no label","because I said no"));
  d.add(Decision.single(Decision.Type.YES,"yes label","yes please"));
  d.add(Decision.single(Decision.Type.THROTTLE,"throttle label","wait a sec"));
  Float nodeWeight=1.5f;
  Set<String> allocationIds=new HashSet<>();
  allocationIds.add("bar");
  IndicesShardStoresResponse.StoreStatus storeStatus=new IndicesShardStoresResponse.StoreStatus(node,42,"eggplant",IndicesShardStoresResponse.StoreStatus.AllocationStatus.PRIMARY,new ElasticsearchException("stuff's broke, yo"));
  NodeExplanation ne=TransportClusterAllocationExplainAction.calculateNodeExplanation(shard,indexMetaData,node,d,nodeWeight,storeStatus,"node-0",allocationIds);
  Map<DiscoveryNode,NodeExplanation> nodeExplanations=new HashMap<>(1);
  nodeExplanations.put(ne.getNode(),ne);
  ClusterAllocationExplanation cae=new ClusterAllocationExplanation(shardId,true,"assignedNode",remainingDelay,null,nodeExplanations);
  XContentBuilder builder=XContentFactory.jsonBuilder();
  cae.toXContent(builder,ToXContent.EMPTY_PARAMS);
  assertEquals("{\"shard\":{\"index\":\"test\",\"index_uuid\":\"uuid\",\"id\":0,\"primary\":true},\"assigned\":true," + "\"assigned_node_id\":\"assignedNode\",\"nodes\":{\"node-0\":{\"node_name\":\"\",\"node_attributes" + "\":{},\"store\":{\"shard_copy\":\"STALE\",\"store_exception\":\"ElasticsearchException[stuff's br"+ "oke, yo]\"},\"final_decision\":\"NO\",\"final_explanation\":\"the copy of the shard is stale, all"+ "ocation ids do not match\",\"weight\":1.5,\"decisions\":[{\"decider\":\"no label\",\"decision\":"+ "\"NO\",\"explanation\":\"because I said no\"},{\"decider\":\"yes label\",\"decision\":\"YES\",\"e"+ "xplanation\":\"yes please\"},{\"decider\":\"throttle label\",\"decision\":\"THROTTLE\",\"explanat"+ "ion\":\"wait a sec\"}]}}}",builder.string());
}
