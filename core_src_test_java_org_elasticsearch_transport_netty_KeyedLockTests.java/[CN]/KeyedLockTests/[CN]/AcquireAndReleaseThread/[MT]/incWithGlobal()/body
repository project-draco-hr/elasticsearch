{
  if (connectionLock instanceof KeyedLock.GlobalLockable) {
    final int iters=randomIntBetween(10,200);
    for (int i=0; i < iters; i++) {
      ((KeyedLock.GlobalLockable)connectionLock).globalLock().lock();
      try {
        String curName=names[randomInt(names.length - 1)];
        Integer integer=counter.get(curName);
        if (integer == null) {
          counter.put(curName,1);
        }
 else {
          counter.put(curName,integer.intValue() + 1);
        }
        AtomicInteger atomicInteger=new AtomicInteger(0);
        AtomicInteger value=safeCounter.putIfAbsent(curName,atomicInteger);
        if (value == null) {
          atomicInteger.incrementAndGet();
        }
 else {
          value.incrementAndGet();
        }
      }
  finally {
        ((KeyedLock.GlobalLockable)connectionLock).globalLock().unlock();
      }
    }
  }
}
