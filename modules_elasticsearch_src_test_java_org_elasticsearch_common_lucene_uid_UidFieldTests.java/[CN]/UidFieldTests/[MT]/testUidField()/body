{
  IndexWriter writer=new IndexWriter(new RAMDirectory(),new IndexWriterConfig(Lucene.VERSION,Lucene.STANDARD_ANALYZER));
  IndexReader reader=IndexReader.open(writer,true);
  assertThat(UidField.loadVersion(reader,new Term("_uid","1")),equalTo(-1l));
  Document doc=new Document();
  doc.add(new Field("_uid","1",Field.Store.YES,Field.Index.NOT_ANALYZED));
  writer.addDocument(doc);
  reader=reader.reopen();
  assertThat(UidField.loadVersion(reader,new Term("_uid","1")),equalTo(-2l));
  assertThat(UidField.loadDocIdAndVersion(reader,new Term("_uid","1")).version,equalTo(-2l));
  doc=new Document();
  doc.add(new UidField("_uid","1",1));
  writer.updateDocument(new Term("_uid","1"),doc);
  reader=reader.reopen();
  assertThat(UidField.loadVersion(reader,new Term("_uid","1")),equalTo(1l));
  assertThat(UidField.loadDocIdAndVersion(reader,new Term("_uid","1")).version,equalTo(1l));
  doc=new Document();
  doc.add(new UidField("_uid","1",2));
  writer.updateDocument(new Term("_uid","1"),doc);
  reader=reader.reopen();
  assertThat(UidField.loadVersion(reader,new Term("_uid","1")),equalTo(2l));
  assertThat(UidField.loadDocIdAndVersion(reader,new Term("_uid","1")).version,equalTo(2l));
  writer.deleteDocuments(new Term("_uid","1"));
  reader=reader.reopen();
  assertThat(UidField.loadVersion(reader,new Term("_uid","1")),equalTo(-1l));
  assertThat(UidField.loadDocIdAndVersion(reader,new Term("_uid","1")).version,equalTo(-1l));
}
