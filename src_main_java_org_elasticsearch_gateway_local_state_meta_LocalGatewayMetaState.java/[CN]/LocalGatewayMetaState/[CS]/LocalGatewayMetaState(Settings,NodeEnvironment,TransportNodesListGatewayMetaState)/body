{
  super(settings);
  this.nodeEnv=nodeEnv;
  this.format=XContentType.fromRestContentType(settings.get("format","smile"));
  nodesListGatewayMetaState.init(this);
  if (this.format == XContentType.SMILE) {
    Map<String,String> params=Maps.newHashMap();
    params.put("binary","true");
    formatParams=new ToXContent.MapParams(params);
  }
 else {
    formatParams=ToXContent.EMPTY_PARAMS;
  }
  try {
    pre019Upgrade();
    long start=System.currentTimeMillis();
    loadState();
    logger.debug("took {} to load state",TimeValue.timeValueMillis(System.currentTimeMillis() - start));
  }
 catch (  Exception e) {
    logger.error("failed to read local state, exiting...",e);
    throw e;
  }
}
