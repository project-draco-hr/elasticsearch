{
  long highestVersion=-1;
  IndexMetaData indexMetaData=null;
  for (  File indexLocation : nodeEnv.indexLocations(new Index(index))) {
    File stateDir=new File(indexLocation,"_state");
    if (!stateDir.exists() || !stateDir.isDirectory()) {
      continue;
    }
    File[] stateFiles=stateDir.listFiles();
    if (stateFiles == null) {
      continue;
    }
    for (    File stateFile : stateFiles) {
      if (!stateFile.getName().startsWith("state-")) {
        continue;
      }
      try {
        long version=Long.parseLong(stateFile.getName().substring("state-".length()));
        if (version > highestVersion) {
          byte[] data=Streams.copyToByteArray(new FileInputStream(stateFile));
          if (data.length == 0) {
            logger.debug("[{}]: no data for [" + stateFile.getAbsolutePath() + "], ignoring...",index);
            continue;
          }
          XContentParser parser=null;
          try {
            parser=XContentHelper.createParser(data,0,data.length);
            parser.nextToken();
            indexMetaData=IndexMetaData.Builder.fromXContent(parser);
            highestVersion=version;
          }
  finally {
            if (parser != null) {
              parser.close();
            }
          }
        }
      }
 catch (      Throwable e) {
        logger.debug("[{}]: failed to read [" + stateFile.getAbsolutePath() + "], ignoring...",e,index);
      }
    }
  }
  return indexMetaData;
}
