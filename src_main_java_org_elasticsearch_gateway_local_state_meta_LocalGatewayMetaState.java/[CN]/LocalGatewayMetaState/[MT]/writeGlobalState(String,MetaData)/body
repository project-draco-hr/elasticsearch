{
  logger.trace("{} writing state, reason [{}]",GLOBAL_STATE_LOG_TYPE,reason);
  final MetaDataStateFormat<MetaData> writer=globalStateFormat(format,gatewayModeFormatParams,true);
  try {
    writer.write(metaData,GLOBAL_STATE_FILE_PREFIX,metaData.version(),nodeEnv.nodeDataLocations());
  }
 catch (  Throwable ex) {
    logger.warn("{}: failed to write global state",ex,GLOBAL_STATE_LOG_TYPE);
    throw new IOException("failed to write global state",ex);
  }
}
