{
  long highestVersion=-1;
  MetaData metaData=null;
  for (  File dataLocation : nodeEnv.nodeDataLocations()) {
    File stateLocation=new File(dataLocation,"_state");
    if (!stateLocation.exists()) {
      continue;
    }
    File[] stateFiles=stateLocation.listFiles();
    if (stateFiles == null) {
      continue;
    }
    for (    File stateFile : stateFiles) {
      String name=stateFile.getName();
      if (!name.startsWith("global-")) {
        continue;
      }
      try {
        long version=Long.parseLong(stateFile.getName().substring("global-".length()));
        if (version > highestVersion) {
          byte[] data=Streams.copyToByteArray(new FileInputStream(stateFile));
          if (data.length == 0) {
            logger.debug("[_global] no data for [" + stateFile.getAbsolutePath() + "], ignoring...");
            continue;
          }
          XContentParser parser=null;
          try {
            parser=XContentHelper.createParser(data,0,data.length);
            metaData=MetaData.Builder.fromXContent(parser);
            highestVersion=version;
          }
  finally {
            if (parser != null) {
              parser.close();
            }
          }
        }
      }
 catch (      Exception e) {
        logger.debug("failed to load global state from [{}]",e,stateFile.getAbsolutePath());
      }
    }
  }
  return metaData;
}
