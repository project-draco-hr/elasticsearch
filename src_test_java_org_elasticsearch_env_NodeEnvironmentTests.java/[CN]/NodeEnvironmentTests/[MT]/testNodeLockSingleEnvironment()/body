{
  NodeEnvironment env=newNodeEnvironment(ImmutableSettings.builder().put("node.max_local_storage_nodes",1).build());
  Settings settings=env.getSettings();
  String[] dataPaths=env.getSettings().getAsArray("path.data");
  try {
    new NodeEnvironment(settings,new Environment(settings));
    fail("env is already locked");
  }
 catch (  IllegalStateException ex) {
  }
  env.close();
  env=new NodeEnvironment(settings,new Environment(settings));
  assertEquals(env.nodeDataPaths().length,dataPaths.length);
  for (int i=0; i < dataPaths.length; i++) {
    assertTrue(env.nodeDataPaths()[i].startsWith(PathUtils.get(dataPaths[i])));
  }
  env.close();
  assertTrue("LockedShards: " + env.lockedShards(),env.lockedShards().isEmpty());
}
