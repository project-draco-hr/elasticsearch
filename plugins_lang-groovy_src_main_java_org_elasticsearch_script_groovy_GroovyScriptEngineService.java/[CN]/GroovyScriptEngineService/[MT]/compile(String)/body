{
  try {
    SecurityManager sm=System.getSecurityManager();
    if (sm != null) {
      sm.checkPermission(new SpecialPermission());
    }
    String fake=MessageDigests.toHexString(MessageDigests.sha1().digest(script.getBytes(StandardCharsets.UTF_8)));
    GroovyCodeSource gcs=AccessController.doPrivileged(new PrivilegedAction<GroovyCodeSource>(){
      public GroovyCodeSource run(){
        return new GroovyCodeSource(script,fake,BootstrapInfo.UNTRUSTED_CODEBASE);
      }
    }
);
    gcs.setCachable(false);
    return loader.parseClass(gcs);
  }
 catch (  Throwable e) {
    if (logger.isTraceEnabled()) {
      logger.trace("exception compiling Groovy script:",e);
    }
    throw new ScriptException("failed to compile groovy script",e);
  }
}
