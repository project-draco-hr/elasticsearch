{
  RoutingNode newRoutingNode=state.getRoutingNodes().node(state.nodes().localNodeId());
  if (newRoutingNode == null) {
    throw new IllegalStateException("cluster state does not contain this node - cannot write index meta state");
  }
  Set<String> indices=new HashSet<>();
  for (  MutableShardRouting routing : newRoutingNode) {
    indices.add(routing.index());
  }
  for (  IndexMetaData indexMetaData : state.metaData()) {
    if (previouslyWrittenIndices.contains(indexMetaData.getIndex()) && state.metaData().getIndices().get(indexMetaData.getIndex()).state().equals(IndexMetaData.State.CLOSE)) {
      indices.add(indexMetaData.getIndex());
    }
  }
  return indices;
}
