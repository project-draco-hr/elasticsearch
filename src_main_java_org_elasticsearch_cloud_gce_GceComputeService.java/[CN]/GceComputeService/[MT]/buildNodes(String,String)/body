{
  List<DiscoveryNode> discoNodes=Lists.newArrayList();
  String ipAddress=null;
  try {
    InetAddress inetAddress=networkService.resolvePublishHostAddress(null);
    if (inetAddress != null) {
      ipAddress=inetAddress.getHostAddress();
    }
  }
 catch (  IOException e) {
  }
  Compute.Instances.List list=compute.instances().list(project,zone);
  InstanceList instanceList=list.execute();
  for (  Instance instance : instanceList.getItems()) {
    String name=instance.getName();
    String type=instance.getMachineType();
    String image=instance.getImage();
    String ip_public=null;
    String ip_private=null;
    List<NetworkInterface> interfaces=instance.getNetworkInterfaces();
    for (    NetworkInterface networkInterface : interfaces) {
      if (ip_public == null) {
        for (        AccessConfig accessConfig : networkInterface.getAccessConfigs()) {
          if (Strings.hasText(accessConfig.getNatIP())) {
            ip_public=accessConfig.getNatIP();
            break;
          }
        }
      }
      if (ip_private == null) {
        ip_private=networkInterface.getNetworkIP();
      }
      if (ip_private != null && ip_public != null)       break;
    }
    try {
      if (ip_private.equals(ipAddress)) {
        logger.debug("current node found. Ignoring {}",ip_private);
      }
 else {
        TransportAddress[] addresses=transportService.addressesFromString(ip_private);
        for (int i=0; (i < addresses.length && i < UnicastZenPing.LIMIT_PORTS_COUNT); i++) {
          logger.trace("adding {}, address {}, transport_address {}",name,ip_private,addresses[i]);
          discoNodes.add(new DiscoveryNode("#cloud-" + name + "-"+ i,addresses[i]));
        }
      }
    }
 catch (    Exception e) {
      logger.warn("failed to add {}, address {}",e,name,ip_private);
    }
  }
  return discoNodes;
}
