{
  IngestDocument ingestDocument=RandomDocumentPicks.randomIngestDocument(random(),new HashMap<>());
  IngestDocument testIngestDocument=RandomDocumentPicks.randomIngestDocument(random(),new HashMap<>());
  int numFields=randomIntBetween(1,5);
  Map<String,Object> fields=new HashMap<>();
  for (int i=0; i < numFields; i++) {
    Object fieldValue=RandomDocumentPicks.randomFieldValue(random());
    String fieldName=RandomDocumentPicks.addRandomField(random(),testIngestDocument,fieldValue);
    fields.put(fieldName,fieldValue);
  }
  Processor processor=new AddProcessor(fields);
  processor.execute(ingestDocument);
  for (  Map.Entry<String,Object> field : fields.entrySet()) {
    assertThat(ingestDocument.hasFieldValue(field.getKey()),equalTo(true));
    assertThat(ingestDocument.getFieldValue(field.getKey(),Object.class),equalTo(field.getValue()));
  }
}
