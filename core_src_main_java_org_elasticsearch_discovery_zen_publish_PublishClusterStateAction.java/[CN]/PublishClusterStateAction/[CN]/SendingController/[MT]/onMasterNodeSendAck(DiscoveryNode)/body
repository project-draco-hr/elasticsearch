{
  neededMastersToCommit--;
  if (neededMastersToCommit == 0) {
    logger.trace("committing version [{}]",clusterState.version());
    for (    DiscoveryNode nodeToCommit : sendAckedBeforeCommit) {
      sendCommitToNode(nodeToCommit,clusterState,publishResponseHandler);
    }
    sendAckedBeforeCommit.clear();
    boolean success=committed.compareAndSet(false,true);
    assert success;
    comittedOrFailed.countDown();
  }
  onMasterNodeDone(node);
}
