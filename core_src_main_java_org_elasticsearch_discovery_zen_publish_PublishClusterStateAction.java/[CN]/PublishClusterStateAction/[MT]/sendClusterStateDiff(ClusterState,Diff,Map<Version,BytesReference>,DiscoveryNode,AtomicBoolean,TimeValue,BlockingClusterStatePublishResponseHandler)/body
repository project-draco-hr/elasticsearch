{
  BytesReference bytes=serializedDiffs.get(node.version());
  if (bytes == null) {
    try {
      bytes=serializeDiffClusterState(diff,node.version());
      serializedDiffs.put(node.version(),bytes);
    }
 catch (    Throwable e) {
      logger.warn("failed to serialize diff of cluster_state before publishing it to node {}",e,node);
      publishResponseHandler.onFailure(node,e);
      return;
    }
  }
  publishClusterStateToNode(clusterState,bytes,node,timedOutWaitingForNodes,publishTimeout,publishResponseHandler,true);
}
