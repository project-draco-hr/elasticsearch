{
  Set<DiscoveryNode> nodesToPublishTo=new HashSet<>(clusterChangedEvent.state().nodes().size());
  DiscoveryNode localNode=nodesProvider.nodes().localNode();
  int totalMasterNodes=0;
  for (  final DiscoveryNode node : clusterChangedEvent.state().nodes()) {
    if (node.isMasterNode()) {
      totalMasterNodes++;
    }
    if (node.equals(localNode) == false) {
      nodesToPublishTo.add(node);
    }
  }
  publish(clusterChangedEvent,minMasterNodes,totalMasterNodes,nodesToPublishTo,new AckClusterStatePublishResponseHandler(nodesToPublishTo,ackListener));
}
