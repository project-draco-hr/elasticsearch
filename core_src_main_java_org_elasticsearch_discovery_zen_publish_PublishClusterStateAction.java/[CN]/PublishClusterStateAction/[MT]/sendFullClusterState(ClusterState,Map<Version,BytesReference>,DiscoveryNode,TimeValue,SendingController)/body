{
  BytesReference bytes=serializedStates.get(node.version());
  if (bytes == null) {
    try {
      bytes=serializeFullClusterState(clusterState,node.version());
      if (serializedStates != null) {
        serializedStates.put(node.version(),bytes);
      }
    }
 catch (    Throwable e) {
      logger.warn("failed to serialize cluster_state before publishing it to node {}",e,node);
      sendingController.onNodeSendFailed(node,e);
      return;
    }
  }
  sendClusterStateToNode(clusterState,bytes,node,publishTimeout,sendingController,false,serializedStates);
}
