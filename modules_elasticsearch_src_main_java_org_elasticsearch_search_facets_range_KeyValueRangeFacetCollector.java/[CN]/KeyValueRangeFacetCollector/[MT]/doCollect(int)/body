{
  if (keyFieldData.multiValued()) {
    if (valueFieldData.multiValued()) {
      double[] keys=keyFieldData.doubleValues(doc);
      double[] values=valueFieldData.doubleValues(doc);
      int size=Math.min(keys.length,values.length);
      for (int i=0; i < size; i++) {
        double key=keys[i];
        for (        RangeFacet.Entry entry : entries) {
          if (key >= entry.getFrom() && key < entry.getTo()) {
            entry.count++;
            entry.total+=values[i];
          }
        }
      }
    }
 else {
      double value=valueFieldData.doubleValue(doc);
      for (      double key : keyFieldData.doubleValues(doc)) {
        for (        RangeFacet.Entry entry : entries) {
          if (key >= entry.getFrom() && key < entry.getTo()) {
            entry.count++;
            entry.total+=value;
          }
        }
      }
    }
  }
 else {
    double key=keyFieldData.doubleValue(doc);
    if (valueFieldData.multiValued()) {
      for (      RangeFacet.Entry entry : entries) {
        if (key >= entry.getFrom() && key < entry.getTo()) {
          entry.count++;
          for (          double value : valueFieldData.doubleValues(doc)) {
            entry.total+=value;
          }
        }
      }
    }
 else {
      double value=valueFieldData.doubleValue(doc);
      for (      RangeFacet.Entry entry : entries) {
        if (key >= entry.getFrom() && key < entry.getTo()) {
          entry.count++;
          entry.total+=value;
        }
      }
    }
  }
}
