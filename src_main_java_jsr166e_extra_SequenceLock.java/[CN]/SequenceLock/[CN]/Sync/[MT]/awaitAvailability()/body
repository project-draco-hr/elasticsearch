{
  long s;
  while (((s=getState()) & 1L) != 0L && getExclusiveOwnerThread() != Thread.currentThread()) {
    acquireShared(1L);
    releaseShared(1L);
  }
  return s;
}
