{
  if (query() == null) {
    parsedQuery(ParsedQuery.MATCH_ALL_PARSED_QUERY);
  }
  if (queryBoost() != 1.0f) {
    parsedQuery(new ParsedQuery(new FunctionScoreQuery(query(),new BoostScoreFunction(queryBoost)),parsedQuery()));
  }
  Filter searchFilter=mapperService().searchFilter(types());
  if (searchFilter != null) {
    if (Queries.isConstantMatchAllQuery(query())) {
      Query q=new XConstantScoreQuery(filterCache().cache(searchFilter));
      q.setBoost(query().getBoost());
      parsedQuery(new ParsedQuery(q,parsedQuery()));
    }
 else {
      parsedQuery(new ParsedQuery(new XFilteredQuery(query(),filterCache().cache(searchFilter)),parsedQuery()));
    }
  }
}
