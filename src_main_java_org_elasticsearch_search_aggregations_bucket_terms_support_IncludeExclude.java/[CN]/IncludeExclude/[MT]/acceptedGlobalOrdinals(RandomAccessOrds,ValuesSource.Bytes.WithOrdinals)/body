{
  LongBitSet acceptedGlobalOrdinals=new LongBitSet(globalOrdinals.getValueCount());
  if (includeValues != null) {
    for (    BytesRef includeValue : includeValues) {
      scratch.copyUTF8Bytes(includeValue);
      if (!isExcluded(includeValue,scratch.get())) {
        long ord=globalOrdinals.lookupTerm(includeValue);
        if (ord >= 0) {
          acceptedGlobalOrdinals.set(ord);
        }
      }
    }
  }
 else {
    if (hasRegexTest) {
      TermsEnum globalTermsEnum=globalOrdinals.termsEnum();
      try {
        for (BytesRef term=globalTermsEnum.next(); term != null; term=globalTermsEnum.next()) {
          if (accept(term)) {
            acceptedGlobalOrdinals.set(globalTermsEnum.ord());
          }
        }
      }
 catch (      IOException e) {
        throw ExceptionsHelper.convertToElastic(e);
      }
    }
 else {
      acceptedGlobalOrdinals.set(0,acceptedGlobalOrdinals.length());
      for (      BytesRef excludeValue : excludeValues) {
        long ord=globalOrdinals.lookupTerm(excludeValue);
        if (ord >= 0) {
          acceptedGlobalOrdinals.clear(ord);
        }
      }
    }
  }
  return acceptedGlobalOrdinals;
}
