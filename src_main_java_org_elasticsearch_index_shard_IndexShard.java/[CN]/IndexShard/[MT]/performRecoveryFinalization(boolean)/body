{
  if (withFlush) {
    engineSafe().flush(Engine.FlushType.COMMIT_TRANSLOG,false,false);
  }
  translog.clearUnreferenced();
  engineSafe().refresh("recovery_finalization",true);
synchronized (mutex) {
    changeState(IndexShardState.POST_RECOVERY,"post recovery");
  }
  indicesLifecycle.afterIndexShardPostRecovery(this);
  startScheduledTasksIfNeeded();
  config.setEnableGcDeletes(true);
}
