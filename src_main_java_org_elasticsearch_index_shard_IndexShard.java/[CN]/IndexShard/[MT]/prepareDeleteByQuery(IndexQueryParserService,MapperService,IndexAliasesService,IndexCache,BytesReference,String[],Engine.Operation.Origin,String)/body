{
  long startTime=System.nanoTime();
  if (types == null) {
    types=Strings.EMPTY_ARRAY;
  }
  Query query=queryParserService.parseQuery(source).query();
  Filter searchFilter=mapperService.searchFilter(types);
  if (searchFilter != null) {
    query=new FilteredQuery(query,indexCache.filter().cache(searchFilter,null,queryParserService.autoFilterCachePolicy()));
  }
  Filter aliasFilter=indexAliasesService.aliasFilter(filteringAliases);
  BitDocIdSetFilter parentFilter=mapperService.hasNested() ? indexCache.bitsetFilterCache().getBitDocIdSetFilter(Queries.newNonNestedFilter()) : null;
  return new Engine.DeleteByQuery(query,source,filteringAliases,aliasFilter,parentFilter,origin,startTime,types);
}
