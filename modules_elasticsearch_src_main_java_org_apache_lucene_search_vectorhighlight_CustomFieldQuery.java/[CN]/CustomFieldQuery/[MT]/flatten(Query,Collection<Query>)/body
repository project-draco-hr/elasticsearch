{
  if (sourceQuery instanceof DisjunctionMaxQuery) {
    DisjunctionMaxQuery dmq=(DisjunctionMaxQuery)sourceQuery;
    for (    Query query : dmq) {
      flatten(query,flatQueries);
    }
  }
 else   if (sourceQuery instanceof SpanTermQuery) {
    TermQuery termQuery=new TermQuery(((SpanTermQuery)sourceQuery).getTerm());
    if (!flatQueries.contains(termQuery)) {
      flatQueries.add(termQuery);
    }
  }
 else   if (sourceQuery instanceof ConstantScoreQuery) {
    ConstantScoreQuery constantScoreQuery=(ConstantScoreQuery)sourceQuery;
    if (constantScoreQuery.getFilter() != null) {
      flatten(constantScoreQuery.getFilter(),flatQueries);
    }
 else {
      flatten(constantScoreQuery.getQuery(),flatQueries);
    }
  }
 else   if (sourceQuery instanceof DeletionAwareConstantScoreQuery) {
    flatten(((DeletionAwareConstantScoreQuery)sourceQuery).getFilter(),flatQueries);
  }
 else   if (sourceQuery instanceof FunctionScoreQuery) {
    flatten(((FunctionScoreQuery)sourceQuery).getSubQuery(),flatQueries);
  }
 else   if (sourceQuery instanceof MultiTermQuery) {
    MultiTermQuery multiTermQuery=(MultiTermQuery)sourceQuery;
    MultiTermQuery.RewriteMethod rewriteMethod=multiTermQuery.getRewriteMethod();
    multiTermQuery.setRewriteMethod(MultiTermQuery.SCORING_BOOLEAN_QUERY_REWRITE);
    try {
      flatten(multiTermQuery.rewrite(reader.get()),flatQueries);
    }
 catch (    IOException e) {
    }
catch (    BooleanQuery.TooManyClauses e) {
    }
 finally {
      multiTermQuery.setRewriteMethod(rewriteMethod);
    }
  }
 else   if (sourceQuery instanceof FilteredQuery) {
    flatten(((FilteredQuery)sourceQuery).getQuery(),flatQueries);
    flatten(((FilteredQuery)sourceQuery).getFilter(),flatQueries);
  }
 else {
    super.flatten(sourceQuery,flatQueries);
  }
}
