{
  if (sourceQuery instanceof DisjunctionMaxQuery) {
    DisjunctionMaxQuery dmq=(DisjunctionMaxQuery)sourceQuery;
    for (    Query query : dmq) {
      flatten(query,flatQueries);
    }
  }
 else   if (sourceQuery instanceof SpanTermQuery) {
    TermQuery termQuery=new TermQuery(((SpanTermQuery)sourceQuery).getTerm());
    if (!flatQueries.contains(termQuery)) {
      flatQueries.add(termQuery);
    }
  }
 else   if (sourceQuery instanceof ConstantScoreQuery) {
    Boolean highlight=highlightFilters.get();
    if (highlight != null && highlight.equals(Boolean.TRUE)) {
      flatten(((ConstantScoreQuery)sourceQuery).getFilter(),flatQueries);
    }
  }
 else   if (sourceQuery instanceof MultiTermQuery) {
    MultiTermQuery multiTermQuery=(MultiTermQuery)sourceQuery;
    MultiTermQuery.RewriteMethod rewriteMethod=multiTermQuery.getRewriteMethod();
    if (rewriteMethod != MultiTermQuery.CONSTANT_SCORE_BOOLEAN_QUERY_REWRITE && rewriteMethod != MultiTermQuery.SCORING_BOOLEAN_QUERY_REWRITE) {
      multiTermQuery.setRewriteMethod(MultiTermQuery.SCORING_BOOLEAN_QUERY_REWRITE);
      try {
        flatten(multiTermQuery.rewrite(reader.get()),flatQueries);
      }
 catch (      IOException e) {
      }
 finally {
        multiTermQuery.setRewriteMethod(rewriteMethod);
      }
    }
  }
 else {
    super.flatten(sourceQuery,flatQueries);
  }
}
