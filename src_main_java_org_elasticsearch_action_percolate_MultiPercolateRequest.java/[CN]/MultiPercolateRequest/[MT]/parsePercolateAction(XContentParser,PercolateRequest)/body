{
  String currentFieldName=null;
  XContentParser.Token token;
  while ((token=parser.nextToken()) != XContentParser.Token.END_OBJECT) {
    if (token == XContentParser.Token.FIELD_NAME) {
      currentFieldName=parser.currentName();
    }
 else     if (token.isValue()) {
      if ("index".equals(currentFieldName) || "indices".equals(currentFieldName)) {
        percolateRequest.indices(Strings.splitStringByCommaToArray(parser.text()));
      }
 else       if ("type".equals(currentFieldName)) {
        percolateRequest.documentType(parser.text());
      }
 else       if ("preference".equals(currentFieldName)) {
        percolateRequest.preference(parser.text());
      }
 else       if ("routing".equals(currentFieldName)) {
        percolateRequest.routing(parser.text());
      }
 else       if ("ignore_indices".equals(currentFieldName) || "ignoreIndices".equals(currentFieldName)) {
        percolateRequest.ignoreIndices(IgnoreIndices.fromString(parser.text()));
      }
    }
 else     if (token == XContentParser.Token.START_ARRAY) {
      if ("index".equals(currentFieldName) || "indices".equals(currentFieldName)) {
        percolateRequest.indices(parseArray(parser));
      }
 else {
        throw new ElasticSearchParseException(currentFieldName + " doesn't support arrays");
      }
    }
  }
}
