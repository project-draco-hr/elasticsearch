{
  builder.startObject();
  if (from != -1) {
    builder.field("from",from);
  }
  if (size != -1) {
    builder.field("size",size);
  }
  if (queryBuilder != null) {
    builder.field("query");
    queryBuilder.toXContent(builder,params);
  }
  if (queryBinary != null) {
    if (XContentFactory.xContentType(queryBinary,queryBinaryOffset,queryBinaryLength) == builder.contentType()) {
      builder.rawField("query",queryBinary,queryBinaryOffset,queryBinaryLength);
    }
 else {
      builder.field("query_binary",queryBinary,queryBinaryOffset,queryBinaryLength);
    }
  }
  if (filterBuilder != null) {
    builder.field("filter");
    filterBuilder.toXContent(builder,params);
  }
  if (filterBinary != null) {
    if (XContentFactory.xContentType(filterBinary,filterBinaryOffset,filterBinaryLength) == builder.contentType()) {
      builder.rawField("filter",filterBinary,filterBinaryOffset,filterBinaryLength);
    }
 else {
      builder.field("filter_binary",filterBinary,filterBinaryOffset,filterBinaryLength);
    }
  }
  if (minScore != null) {
    builder.field("min_score",minScore);
  }
  if (version != null) {
    builder.field("version",version);
  }
  if (explain != null) {
    builder.field("explain",explain);
  }
  if (fieldNames != null) {
    if (fieldNames.size() == 1) {
      builder.field("fields",fieldNames.get(0));
    }
 else {
      builder.startArray("fields");
      for (      String fieldName : fieldNames) {
        builder.value(fieldName);
      }
      builder.endArray();
    }
  }
  if (partialFields != null) {
    builder.startObject("partial_fields");
    for (    PartialField partialField : partialFields) {
      builder.startObject(partialField.name());
      if (partialField.includes() != null) {
        if (partialField.includes().length == 1) {
          builder.field("include",partialField.includes()[0]);
        }
 else {
          builder.field("include",partialField.includes());
        }
      }
      if (partialField.excludes() != null) {
        if (partialField.excludes().length == 1) {
          builder.field("exclude",partialField.excludes()[0]);
        }
 else {
          builder.field("exclude",partialField.excludes());
        }
      }
      builder.endObject();
    }
    builder.endObject();
  }
  if (scriptFields != null) {
    builder.startObject("script_fields");
    for (    ScriptField scriptField : scriptFields) {
      builder.startObject(scriptField.fieldName());
      builder.field("script",scriptField.script());
      if (scriptField.lang() != null) {
        builder.field("lang",scriptField.lang());
      }
      if (scriptField.params() != null) {
        builder.field("params");
        builder.map(scriptField.params());
      }
      builder.endObject();
    }
    builder.endObject();
  }
  if (sorts != null) {
    builder.startArray("sort");
    for (    SortBuilder sort : sorts) {
      builder.startObject();
      sort.toXContent(builder,params);
      builder.endObject();
    }
    builder.endArray();
    if (trackScores) {
      builder.field("track_scores",trackScores);
    }
  }
  if (indexBoost != null) {
    builder.startObject("indices_boost");
    for (TObjectFloatIterator<String> it=indexBoost.iterator(); it.hasNext(); ) {
      it.advance();
      builder.field(it.key(),it.value());
    }
    builder.endObject();
  }
  if (facets != null) {
    builder.field("facets");
    builder.startObject();
    for (    AbstractFacetBuilder facet : facets) {
      facet.toXContent(builder,params);
    }
    builder.endObject();
  }
  if (facetsBinary != null) {
    if (XContentFactory.xContentType(facetsBinary,facetBinaryOffset,facetBinaryLength) == builder.contentType()) {
      builder.rawField("facets",facetsBinary,facetBinaryOffset,facetBinaryLength);
    }
 else {
      builder.field("facets_binary",facetsBinary,facetBinaryOffset,facetBinaryLength);
    }
  }
  if (highlightBuilder != null) {
    highlightBuilder.toXContent(builder,params);
  }
  if (stats != null) {
    builder.startArray("stats");
    for (    String stat : stats) {
      builder.value(stat);
    }
    builder.endArray();
  }
  builder.endObject();
  return builder;
}
