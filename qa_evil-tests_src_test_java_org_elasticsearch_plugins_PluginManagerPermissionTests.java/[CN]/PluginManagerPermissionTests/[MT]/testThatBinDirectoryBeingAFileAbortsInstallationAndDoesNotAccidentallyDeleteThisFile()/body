{
  assumeTrue("File system does not support permissions, skipping",supportsPermissions);
  Files.createDirectories(environment.binFile());
  Files.createFile(environment.binFile().resolve(pluginName));
  URL pluginUrl=createPlugin(true,randomBoolean());
  PluginManager pluginManager=new PluginManager(environment,pluginUrl,PluginManager.OutputMode.VERBOSE,TimeValue.timeValueSeconds(10));
  try {
    pluginManager.downloadAndExtract(pluginName,terminal,true);
    fail("Expected plugin installation to fail, but didnt");
  }
 catch (  IOException e) {
    assertFileExists(environment.binFile().resolve(pluginName));
    assertFileNotExists(environment.configFile().resolve(pluginName));
    assertFileNotExists(environment.pluginsFile().resolve(pluginName));
  }
}
