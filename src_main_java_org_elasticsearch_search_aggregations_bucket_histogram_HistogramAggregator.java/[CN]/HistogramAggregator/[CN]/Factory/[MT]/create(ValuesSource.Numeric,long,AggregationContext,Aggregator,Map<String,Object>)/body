{
  long estimatedBucketCount=50;
  if (hasParentBucketAggregator(parent)) {
    estimatedBucketCount=8;
  }
  ExtendedBounds roundedBounds=null;
  if (extendedBounds != null) {
    extendedBounds.processAndValidate(name,aggregationContext.searchContext(),config.parser());
    roundedBounds=extendedBounds.round(rounding);
  }
  return new HistogramAggregator(name,factories,rounding,order,keyed,minDocCount,roundedBounds,valuesSource,config.formatter(),estimatedBucketCount,histogramFactory,aggregationContext,parent,metaData);
}
