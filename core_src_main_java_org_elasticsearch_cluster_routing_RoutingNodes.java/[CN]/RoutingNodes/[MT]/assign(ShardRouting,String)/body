{
  ShardRoutingState oldState=shard.state();
  shard.assignToNode(nodeId);
  node(nodeId).add(shard);
  if (oldState == ShardRoutingState.UNASSIGNED) {
    inactiveShardCount++;
    if (shard.primary()) {
      inactivePrimaryCount++;
    }
  }
  if (shard.state() == ShardRoutingState.RELOCATING) {
    relocatingShards++;
  }
  assignedShardsAdd(shard);
}
