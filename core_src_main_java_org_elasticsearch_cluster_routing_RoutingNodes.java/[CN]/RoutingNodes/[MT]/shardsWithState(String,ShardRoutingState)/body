{
  List<MutableShardRouting> shards=newArrayList();
  for (  RoutingNode routingNode : this) {
    shards.addAll(routingNode.shardsWithState(index,state));
  }
  for (  ShardRoutingState s : state) {
    if (s == ShardRoutingState.UNASSIGNED) {
      for (      MutableShardRouting unassignedShard : unassignedShards) {
        if (unassignedShard.index().equals(index)) {
          shards.add(unassignedShard);
        }
      }
      break;
    }
  }
  return shards;
}
