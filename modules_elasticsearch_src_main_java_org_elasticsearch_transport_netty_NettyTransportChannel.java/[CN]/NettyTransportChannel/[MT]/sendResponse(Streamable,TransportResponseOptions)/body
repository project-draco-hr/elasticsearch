{
  if (transport.compress) {
    options.withCompress(true);
  }
  CachedStreamOutput.Entry cachedEntry=CachedStreamOutput.popEntry();
  TransportStreams.buildResponse(cachedEntry,requestId,message,options);
  ChannelBuffer buffer=ChannelBuffers.wrappedBuffer(cachedEntry.bytes().underlyingBytes(),0,cachedEntry.bytes().size());
  ChannelFuture future=channel.write(buffer);
  future.addListener(new NettyTransport.CacheFutureListener(cachedEntry));
}
