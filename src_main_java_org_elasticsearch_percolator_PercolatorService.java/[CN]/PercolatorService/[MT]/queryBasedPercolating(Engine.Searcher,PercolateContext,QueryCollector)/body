{
  Filter percolatorTypeFilter=context.indexService().mapperService().documentMapper(TYPE_NAME).typeFilter();
  percolatorTypeFilter=context.indexService().cache().filter().cache(percolatorTypeFilter);
  XFilteredQuery query=new XFilteredQuery(context.percolateQuery(),percolatorTypeFilter);
  percolatorSearcher.searcher().search(query,percolateCollector);
  for (  Collector queryCollector : percolateCollector.facetAndAggregatorCollector) {
    if (queryCollector instanceof XCollector) {
      ((XCollector)queryCollector).postCollection();
    }
  }
  if (context.facets() != null) {
    facetPhase.execute(context);
  }
  if (context.aggregations() != null) {
    aggregationPhase.execute(context);
  }
}
