{
  Filter percolatorTypeFilter=context.indexService().mapperService().documentMapper(TYPE_NAME).typeFilter();
  percolatorTypeFilter=context.indexService().cache().filter().cache(percolatorTypeFilter,null,context.queryParserService().autoFilterCachePolicy());
  final Filter filter;
  if (context.aliasFilter() != null) {
    XBooleanFilter booleanFilter=new XBooleanFilter();
    booleanFilter.add(context.aliasFilter(),BooleanClause.Occur.MUST);
    booleanFilter.add(percolatorTypeFilter,BooleanClause.Occur.MUST);
    filter=booleanFilter;
  }
 else {
    filter=percolatorTypeFilter;
  }
  FilteredQuery query=new FilteredQuery(context.percolateQuery(),filter);
  percolatorSearcher.searcher().search(query,percolateCollector);
  percolateCollector.aggregatorCollector.postCollection();
  if (context.aggregations() != null) {
    aggregationPhase.execute(context);
  }
}
