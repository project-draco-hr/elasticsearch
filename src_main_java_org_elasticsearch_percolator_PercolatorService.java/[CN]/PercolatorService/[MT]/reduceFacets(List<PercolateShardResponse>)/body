{
  if (shardResults.size() == 1) {
    return shardResults.get(0).facets();
  }
  PercolateShardResponse firstShardResponse=shardResults.get(0);
  List<Facet> aggregatedFacets=Lists.newArrayList();
  List<Facet> namedFacets=Lists.newArrayList();
  for (  Facet facet : firstShardResponse.facets()) {
    namedFacets.clear();
    for (    PercolateShardResponse entry : shardResults) {
      for (      Facet facet1 : entry.facets()) {
        if (facet.getName().equals(facet1.getName())) {
          namedFacets.add(facet1);
        }
      }
    }
    if (!namedFacets.isEmpty()) {
      Facet aggregatedFacet=((InternalFacet)namedFacets.get(0)).reduce(new InternalFacet.ReduceContext(cacheRecycler,namedFacets));
      aggregatedFacets.add(aggregatedFacet);
    }
  }
  return new InternalFacets(aggregatedFacets);
}
