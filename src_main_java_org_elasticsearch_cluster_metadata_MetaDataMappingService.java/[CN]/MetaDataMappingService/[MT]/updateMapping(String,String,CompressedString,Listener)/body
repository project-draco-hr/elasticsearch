{
  refreshOrUpdateQueue.add(new UpdateTask(index,type,mappingSource,listener));
  clusterService.submitStateUpdateTask("update-mapping [" + index + "]["+ type+ "]",Priority.HIGH,new ProcessedClusterStateUpdateTask(){
    @Override public void onFailure(    String source,    Throwable t){
      listener.onFailure(t);
    }
    @Override public ClusterState execute(    final ClusterState currentState) throws Exception {
      return executeRefreshOrUpdate(currentState);
    }
    @Override public void clusterStateProcessed(    String source,    ClusterState oldState,    ClusterState newState){
      listener.onResponse(new Response(true));
    }
  }
);
}
