{
  Queue<FixedBitSet> docIdSets=cache.get(context.reader().getCoreCacheKey());
  if (docIdSets == null) {
    if (context.reader() instanceof SegmentReader) {
      ((SegmentReader)context.reader()).addCoreClosedListener(this);
    }
    cache.put(context.reader().getCoreCacheKey(),ConcurrentCollections.<FixedBitSet>newQueue());
    return new ContextDocIdSet(context,new FixedBitSet(context.reader().maxDoc()));
  }
  FixedBitSet docIdSet=docIdSets.poll();
  if (docIdSet == null) {
    docIdSet=new FixedBitSet(context.reader().maxDoc());
  }
 else {
    docIdSet.clear(0,docIdSet.length());
  }
  return new ContextDocIdSet(context,docIdSet);
}
