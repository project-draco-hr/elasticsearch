{
  String[] indices=Strings.splitStringByCommaToArray(request.param("index"));
  CountRequest countRequest=new CountRequest(indices);
  String source=request.param("source");
  if (source != null) {
    QueryParseContext context=new QueryParseContext(indicesQueriesRegistry);
    countRequest.query(RestActions.getQueryContent(new BytesArray(source),context));
  }
 else {
    QueryBuilder<?> queryBuilder=RestActions.urlParamsToQueryBuilder(request);
    if (queryBuilder != null) {
      QuerySourceBuilder querySourceBuilder=new QuerySourceBuilder();
      querySourceBuilder.setQuery(queryBuilder);
      countRequest.query(queryBuilder);
    }
  }
  client.count(countRequest,new RestResponseListener<CountResponse>(channel){
    @Override public RestResponse buildResponse(    CountResponse countResponse) throws Exception {
      return RestTable.buildResponse(buildTable(request,countResponse),channel);
    }
  }
);
}
