{
  if (collectsFromSingleBucket == false) {
    return asMultiBucketAggregator(this,context,parent);
  }
  Rounding rounding=createRounding();
  ExtendedBounds roundedBounds=null;
  if (extendedBounds != null) {
    extendedBounds.processAndValidate(name,context.searchContext(),config.format());
    roundedBounds=extendedBounds.round(rounding);
  }
  return new HistogramAggregator(name,factories,rounding,order,keyed,minDocCount,roundedBounds,valuesSource,config.format(),histogramFactory,context,parent,pipelineAggregators,metaData);
}
