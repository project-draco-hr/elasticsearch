{
  gateway.start();
  this.executor=newSingleThreadExecutor(daemonThreadFactory(settings,"gateway"));
  if (discoveryService.initialStateReceived()) {
    if (discoveryService.firstMaster()) {
      if (firstMasterRead.compareAndSet(false,true)) {
        Boolean waited=readFromGateway(initialStateTimeout);
        if (waited != null && !waited) {
          logger.warn("Waited for {} for indices to be created from the gateway, and not all have been created",initialStateTimeout);
        }
      }
    }
  }
 else {
    logger.debug("Can't wait on start for (possibly) reading state from gateway, will do it asynchronously");
  }
  clusterService.add(this);
}
