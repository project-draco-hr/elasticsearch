{
  super(shardId,indexSettings);
  this.threadPool=threadPool;
  this.indexSettingsService=indexSettingsService;
  this.indexShard=indexShard;
  this.translog=translog;
  this.flushThresholdOperations=indexSettings.getAsInt(INDEX_TRANSLOG_FLUSH_THRESHOLD_OPS,indexSettings.getAsInt("index.translog.flush_threshold",Integer.MAX_VALUE));
  this.flushThresholdSize=indexSettings.getAsBytesSize(INDEX_TRANSLOG_FLUSH_THRESHOLD_SIZE,new ByteSizeValue(512,ByteSizeUnit.MB));
  this.flushThresholdPeriod=indexSettings.getAsTime(INDEX_TRANSLOG_FLUSH_THRESHOLD_PERIOD,TimeValue.timeValueMinutes(30));
  this.interval=indexSettings.getAsTime(INDEX_TRANSLOG_FLUSH_INTERVAL,timeValueMillis(5000));
  this.disableFlush=indexSettings.getAsBoolean(INDEX_TRANSLOG_DISABLE_FLUSH,false);
  logger.debug("interval [{}], flush_threshold_ops [{}], flush_threshold_size [{}], flush_threshold_period [{}]",interval,flushThresholdOperations,flushThresholdSize,flushThresholdPeriod);
  this.future=threadPool.schedule(interval,ThreadPool.Names.SAME,new TranslogBasedFlush());
  indexSettingsService.addListener(applySettings);
}
