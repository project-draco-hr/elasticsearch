{
  SimpleIdCache idCache=createSimpleIdCache(Tuple.tuple("child","parent"));
  IndexWriter writer=createIndexWriter();
  final Document parent=doc("parent","1");
  writer.addDocument(parent);
  writer.addDocument(childDoc("child","1","parent","1"));
  writer.addDocument(childDoc("child","2","parent","1"));
  writer.addDocument(childDoc("child","3","parent","1"));
  writer.commit();
  final String parentUid=parent.get("_uid");
  assertNotNull(parentUid);
  writer.deleteDocuments(new Term("_uid",parentUid));
  writer.close();
  DirectoryReader topLevelReader=DirectoryReader.open(writer.getDirectory());
  List<AtomicReaderContext> leaves=topLevelReader.getContext().leaves();
  idCache.refresh(leaves);
  assertThat(leaves.size(),equalTo(1));
  IdReaderCache readerCache=idCache.reader(leaves.get(0).reader());
  IdReaderTypeCache typeCache=readerCache.type("parent");
  assertThat(typeCache.idByDoc(0).toUtf8(),equalTo("1"));
}
