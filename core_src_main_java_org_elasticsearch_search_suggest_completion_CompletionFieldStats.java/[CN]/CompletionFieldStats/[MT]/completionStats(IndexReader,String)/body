{
  long sizeInBytes=0;
  ObjectLongHashMap<String> completionFields=null;
  if (fields != null && fields.length > 0) {
    completionFields=new ObjectLongHashMap<>(fields.length);
  }
  for (  LeafReaderContext atomicReaderContext : indexReader.leaves()) {
    LeafReader atomicReader=atomicReaderContext.reader();
    try {
      for (      String fieldName : atomicReader.fields()) {
        Terms terms=atomicReader.fields().terms(fieldName);
        if (terms instanceof CompletionTerms) {
          long fstSize=((CompletionTerms)terms).suggester().ramBytesUsed();
          if (fields != null && fields.length > 0 && Regex.simpleMatch(fields,fieldName)) {
            completionFields.addTo(fieldName,fstSize);
          }
          sizeInBytes+=fstSize;
        }
      }
    }
 catch (    IOException ignored) {
      throw new ElasticsearchException(ignored);
    }
  }
  return new CompletionStats(sizeInBytes,completionFields);
}
