{
  String fieldName=queryBuilder.fieldName();
  Analyzer analyzer=context.mapperService().searchAnalyzer();
  MappedFieldType fieldType=context.fieldMapper(fieldName);
  if (fieldType != null) {
    fieldName=fieldType.names().indexName();
    analyzer=context.getSearchAnalyzer(fieldType);
  }
  if (queryBuilder.analyzer() != null) {
    analyzer=context.analysisService().analyzer(queryBuilder.analyzer());
  }
  Occur highFreqOccur=queryBuilder.highFreqOperator().toBooleanClauseOccur();
  Occur lowFreqOccur=queryBuilder.lowFreqOperator().toBooleanClauseOccur();
  ExtendedCommonTermsQuery expectedQuery=new ExtendedCommonTermsQuery(highFreqOccur,lowFreqOccur,queryBuilder.cutoffFrequency(),queryBuilder.disableCoord(),fieldType);
  CommonTermsQueryBuilder.parseQueryString(expectedQuery,queryBuilder.text(),fieldName,analyzer,queryBuilder.lowFreqMinimumShouldMatch(),queryBuilder.highFreqMinimumShouldMatch());
  expectedQuery.setBoost(queryBuilder.boost());
  return expectedQuery;
}
