{
  CodeSource codeSource=domain.getCodeSource();
  if (codeSource == null) {
    return false;
  }
  URL location=codeSource.getLocation();
  if (location != null) {
    if (BootstrapInfo.UNTRUSTED_CODEBASE.equals(location.getFile())) {
      return untrusted.implies(domain,permission);
    }
  }
  if (permission instanceof RuntimePermission && "accessClassInPackage.sun.security.ssl".equals(permission.getName())) {
    for (    StackTraceElement element : Thread.currentThread().getStackTrace()) {
      if ("com.amazonaws.http.conn.ssl.SdkTLSSocketFactory".equals(element.getClassName()) && "verifyMasterSecret".equals(element.getMethodName())) {
        rethrow(new IllegalAccessException("no amazon, you cannot do this."));
      }
    }
  }
  return template.implies(domain,permission) || dynamic.implies(permission);
}
