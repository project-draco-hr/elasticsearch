{
  String mapping=copyToStringFromClasspath("/org/elasticsearch/index/mapper/json/all/mapping.json");
  JsonDocumentMapper docMapper=(JsonDocumentMapper)new JsonDocumentMapperParser(new AnalysisService(new Index("test"))).parse(mapping);
  byte[] json=copyToBytesFromClasspath("/org/elasticsearch/index/mapper/json/all/test1.json");
  Document doc=docMapper.parse(json).doc();
  Field field=doc.getField("_all");
  AllEntries allEntries=((AllTokenFilter)field.tokenStreamValue()).allEntries();
  MatcherAssert.assertThat(allEntries.fields().size(),equalTo(2));
  MatcherAssert.assertThat(allEntries.fields().contains("name.last"),equalTo(true));
  MatcherAssert.assertThat(allEntries.fields().contains("simple1"),equalTo(true));
}
