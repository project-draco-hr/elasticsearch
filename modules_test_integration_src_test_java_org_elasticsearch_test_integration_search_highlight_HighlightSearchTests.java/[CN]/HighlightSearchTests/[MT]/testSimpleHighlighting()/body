{
  SearchResponse searchResponse=client.prepareSearch().setIndices("test").setSearchType(DFS_QUERY_THEN_FETCH).setQuery(termQuery("_all","test")).setFrom(0).setSize(60).addHighlightedField("_all").setHighlighterOrder("score").setHighlighterPreTags("<xxx>").setHighlighterPostTags("</xxx>").setScroll(timeValueMinutes(10)).execute().actionGet();
  assertThat("Failures " + Arrays.toString(searchResponse.shardFailures()),searchResponse.shardFailures().length,equalTo(0));
  assertThat(searchResponse.hits().totalHits(),equalTo(100l));
  assertThat(searchResponse.hits().hits().length,equalTo(60));
  for (int i=0; i < 60; i++) {
    SearchHit hit=searchResponse.hits().hits()[i];
    assertThat("id[" + hit.id() + "]",hit.id(),equalTo(Integer.toString(100 - i - 1)));
    assertThat(hit.highlightFields().size(),equalTo(1));
    assertThat(hit.highlightFields().get("_all").fragments().length,greaterThan(0));
  }
  searchResponse=client.prepareSearchScroll(searchResponse.scrollId()).execute().actionGet();
  assertThat(searchResponse.hits().totalHits(),equalTo(100l));
  assertThat(searchResponse.hits().hits().length,equalTo(40));
  for (int i=0; i < 40; i++) {
    SearchHit hit=searchResponse.hits().hits()[i];
    assertThat("id[" + hit.id() + "]",hit.id(),equalTo(Integer.toString(100 - 60 - 1- i)));
  }
}
