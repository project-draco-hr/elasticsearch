{
  String randomPluginName=randomFrom(PluginManager.OFFICIAL_PLUGINS.asList());
  PluginManager.PluginHandle handle=PluginManager.PluginHandle.parse(randomPluginName);
  assertThat(handle.name,is(randomPluginName.replaceAll("^elasticsearch-","")));
  assertThat(handle.urls(),hasSize(Version.CURRENT.snapshot() ? 2 : 1));
  Iterator<URL> iterator=handle.urls().iterator();
  if (Version.CURRENT.snapshot()) {
    String expectedSnapshotUrl=String.format(Locale.ROOT,"http://download.elastic.co/elasticsearch/snapshot/org/elasticsearch/plugin/%s/%s-SNAPSHOT/%s-%s-SNAPSHOT.zip",randomPluginName,Version.CURRENT.number(),randomPluginName,Version.CURRENT.number());
    assertThat(iterator.next(),is(new URL(expectedSnapshotUrl)));
  }
  String releaseUrl=String.format(Locale.ROOT,"http://download.elastic.co/elasticsearch/release/org/elasticsearch/plugin/%s/%s/%s-%s.zip",randomPluginName,Version.CURRENT.number(),randomPluginName,Version.CURRENT.number());
  assertThat(iterator.next(),is(new URL(releaseUrl)));
}
