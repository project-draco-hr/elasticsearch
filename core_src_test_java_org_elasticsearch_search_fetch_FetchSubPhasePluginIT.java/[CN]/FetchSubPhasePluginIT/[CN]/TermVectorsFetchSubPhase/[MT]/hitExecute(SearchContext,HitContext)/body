{
  if (context.getFetchSubPhaseContext(CONTEXT_FACTORY).hitExecutionNeeded() == false) {
    return;
  }
  String field=context.getFetchSubPhaseContext(CONTEXT_FACTORY).getField();
  if (hitContext.hit().fieldsOrNull() == null) {
    hitContext.hit().fields(new HashMap<>());
  }
  SearchHitField hitField=hitContext.hit().fields().get(NAMES[0]);
  if (hitField == null) {
    hitField=new InternalSearchHitField(NAMES[0],new ArrayList<>(1));
    hitContext.hit().fields().put(NAMES[0],hitField);
  }
  TermVectorsResponse termVector=TermVectorsService.getTermVectors(context.indexShard(),new TermVectorsRequest(context.indexShard().shardId().getIndex().getName(),hitContext.hit().type(),hitContext.hit().id()));
  try {
    Map<String,Integer> tv=new HashMap<>();
    TermsEnum terms=termVector.getFields().terms(field).iterator();
    BytesRef term;
    while ((term=terms.next()) != null) {
      tv.put(term.utf8ToString(),terms.postings(null,PostingsEnum.ALL).freq());
    }
    hitField.values().add(tv);
  }
 catch (  IOException e) {
    ESLoggerFactory.getLogger(FetchSubPhasePluginIT.class.getName()).info("Swallowed exception",e);
  }
}
