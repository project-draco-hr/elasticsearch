{
  Query innerQuery=queryBuilder.query().toQuery(context);
  if (innerQuery == null) {
    assertThat(query,nullValue());
  }
 else {
    Query innerFilter=queryBuilder.filter().toQuery(context);
    if (innerFilter == null || Queries.isConstantMatchAllQuery(innerFilter)) {
      innerQuery.setBoost(queryBuilder.boost());
      assertThat(query,equalTo(innerQuery));
    }
 else     if (Queries.isConstantMatchAllQuery(innerQuery)) {
      assertThat(query,instanceOf(ConstantScoreQuery.class));
      assertThat(((ConstantScoreQuery)query).getQuery(),equalTo(innerFilter));
    }
 else {
      assertThat(query,instanceOf(BooleanQuery.class));
      BooleanQuery booleanQuery=(BooleanQuery)query;
      assertThat(booleanQuery.clauses().size(),equalTo(2));
      assertThat(booleanQuery.clauses().get(0).getOccur(),equalTo(BooleanClause.Occur.MUST));
      assertThat(booleanQuery.clauses().get(0).getQuery(),equalTo(innerQuery));
      assertThat(booleanQuery.clauses().get(1).getOccur(),equalTo(BooleanClause.Occur.FILTER));
      assertThat(booleanQuery.clauses().get(1).getQuery(),equalTo(innerFilter));
    }
  }
}
