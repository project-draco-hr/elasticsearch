{
  MetaData.Builder mdBuilder=MetaData.builder().put(indexBuilder("foo")).put(indexBuilder("foobar")).put(indexBuilder("foofoo-closed").state(IndexMetaData.State.CLOSE)).put(indexBuilder("foofoo").putAlias(AliasMetaData.builder("barbaz")));
  MetaData md=mdBuilder.build();
  IndicesOptions lenientExpand=IndicesOptions.fromOptions(true,true,true,true);
  IndicesOptions[] indicesOptions=new IndicesOptions[]{IndicesOptions.lenientExpandOpen(),lenientExpand};
  for (  IndicesOptions options : indicesOptions) {
    String[] results=md.concreteIndices(new String[]{"foo"},options);
    assertEquals(1,results.length);
    assertEquals("foo",results[0]);
    results=md.concreteIndices(new String[]{"bar"},options);
    assertThat(results,emptyArray());
    results=md.concreteIndices(new String[]{"foofoo","foobar"},options);
    assertEquals(2,results.length);
    assertThat(results,arrayContainingInAnyOrder("foofoo","foobar"));
    results=md.concreteIndices(new String[]{"foo","bar"},options);
    assertEquals(1,results.length);
    assertThat(results,arrayContainingInAnyOrder("foo"));
    results=md.concreteIndices(new String[]{"barbaz","foobar"},options);
    assertEquals(2,results.length);
    assertThat(results,arrayContainingInAnyOrder("foofoo","foobar"));
    results=md.concreteIndices(new String[]{"barbaz","bar"},options);
    assertEquals(1,results.length);
    assertThat(results,arrayContainingInAnyOrder("foofoo"));
    results=md.concreteIndices(new String[]{"baz*"},options);
    assertThat(results,emptyArray());
    results=md.concreteIndices(new String[]{"foo","baz*"},options);
    assertEquals(1,results.length);
    assertEquals("foo",results[0]);
  }
  String[] results=md.concreteIndices(Strings.EMPTY_ARRAY,IndicesOptions.lenientExpandOpen());
  assertEquals(3,results.length);
  results=md.concreteIndices(Strings.EMPTY_ARRAY,lenientExpand);
  assertEquals(4,results.length);
  results=md.concreteIndices(new String[]{"foofoo*"},IndicesOptions.lenientExpandOpen());
  assertEquals(1,results.length);
  assertEquals("foofoo",results[0]);
  results=md.concreteIndices(new String[]{"foofoo*"},lenientExpand);
  assertEquals(2,results.length);
  assertThat(results,arrayContainingInAnyOrder("foofoo","foofoo-closed"));
}
