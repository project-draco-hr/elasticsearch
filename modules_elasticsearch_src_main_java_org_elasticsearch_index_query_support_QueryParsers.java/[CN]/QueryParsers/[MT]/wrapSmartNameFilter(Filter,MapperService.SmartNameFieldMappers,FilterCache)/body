{
  if (smartFieldMappers == null) {
    return filter;
  }
  if (!smartFieldMappers.hasDocMapper()) {
    return filter;
  }
  DocumentMapper docMapper=smartFieldMappers.docMapper();
  BooleanFilter booleanFilter=new BooleanFilter();
  Filter typeFilter=new TermFilter(docMapper.typeMapper().term(docMapper.type()));
  if (filterCache != null) {
    typeFilter=filterCache.cache(typeFilter);
  }
  booleanFilter.add(new FilterClause(typeFilter,BooleanClause.Occur.MUST));
  booleanFilter.add(new FilterClause(filter,BooleanClause.Occur.MUST));
  Filter result=booleanFilter;
  if (filterCache != null) {
    result=filterCache.cache(result);
  }
  return result;
}
