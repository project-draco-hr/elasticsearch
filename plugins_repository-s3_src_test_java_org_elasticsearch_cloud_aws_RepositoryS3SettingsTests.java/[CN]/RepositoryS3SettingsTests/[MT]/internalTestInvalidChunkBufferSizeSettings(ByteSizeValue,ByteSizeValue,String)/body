{
  Settings nodeSettings=buildSettings(AWS,S3,REPOSITORIES);
  RepositorySettings s3RepositorySettings=new RepositorySettings(nodeSettings,Settings.builder().put(Repository.BUFFER_SIZE_SETTING.getKey(),buffer).put(Repository.CHUNK_SIZE_SETTING.getKey(),chunk).build());
  try {
    new S3Repository(new RepositoryName("s3","s3repo"),s3RepositorySettings,null);
    fail("We should either raise a NPE or a RepositoryException or a IllegalArgumentException");
  }
 catch (  RepositoryException e) {
    assertThat(e.getDetailedMessage(),containsString(expectedMessage));
  }
catch (  IllegalArgumentException e) {
    assertThat(e.getMessage(),containsString(expectedMessage));
  }
catch (  NullPointerException e) {
    if (expectedMessage != null) {
      fail("We should have raised a RepositoryException");
    }
  }
}
