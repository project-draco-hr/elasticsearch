{
  if (type == null) {
    if (parser != null) {
      return queryParserService.parse(parser).query();
    }
 else {
      return queryParserService.parse(querySource).query();
    }
  }
  String[] previousTypes=QueryParseContext.setTypesWithPrevious(new String[]{type});
  try {
    if (parser != null) {
      return queryParserService.parse(parser).query();
    }
 else {
      return queryParserService.parse(querySource).query();
    }
  }
  finally {
    QueryParseContext.setTypes(previousTypes);
  }
}
