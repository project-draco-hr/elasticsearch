{
  String[] previousTypes=null;
  if (type != null) {
    QueryParseContext.setTypesWithPrevious(new String[]{type});
  }
  try {
    if (parser != null) {
      return queryParserService.parse(cache.get(),parser).query();
    }
 else {
      return queryParserService.parse(cache.get(),querySource).query();
    }
  }
  finally {
    if (type != null) {
      QueryParseContext.setTypes(previousTypes);
    }
  }
}
