{
  try {
    shard.refresh(new Engine.Refresh("percolator_load_queries").force(true));
    Engine.Searcher searcher=shard.acquireSearcher("percolator_load_queries");
    try {
      Query query=new XConstantScoreQuery(indexCache.filter().cache(new TermFilter(new Term(TypeFieldMapper.NAME,PercolatorService.TYPE_NAME))));
      QueriesLoaderCollector queryCollector=new QueriesLoaderCollector(PercolatorQueriesRegistry.this,logger,indexFieldDataService);
      searcher.searcher().search(query,queryCollector);
      Map<HashedBytesRef,Query> queries=queryCollector.queries();
      for (      Map.Entry<HashedBytesRef,Query> entry : queries.entrySet()) {
        Query previousQuery=percolateQueries.put(entry.getKey(),entry.getValue());
        shardPercolateService.addedQuery(entry.getKey(),previousQuery,entry.getValue());
      }
    }
  finally {
      searcher.release();
    }
  }
 catch (  Exception e) {
    throw new PercolatorException(shardId.index(),"failed to load queries from percolator index",e);
  }
}
