{
  client().admin().indices().prepareCreate("test").addMapping("parent",jsonBuilder().startObject().startObject("parent").endObject().endObject()).addMapping("child",jsonBuilder().startObject().startObject("child").startObject("_parent").field("type","parent").endObject().endObject().endObject()).setSettings(ImmutableSettings.settingsBuilder().put("index.number_of_shards",1).put("index.number_of_replicas",0)).execute().actionGet();
  client().admin().cluster().prepareHealth().setWaitForEvents(Priority.LANGUID).setWaitForGreenStatus().execute().actionGet();
  SearchResponse response=client().prepareSearch("test").setQuery(QueryBuilders.hasChildQuery("child",matchQuery("text","value"))).execute().actionGet();
  assertThat(response.getFailedShards(),equalTo(0));
  assertThat(response.getHits().totalHits(),equalTo(0l));
  client().prepareIndex("test","child1").setSource(jsonBuilder().startObject().field("text","value").endObject()).setRefresh(true).execute().actionGet();
  client().prepareSearch("test").setQuery(QueryBuilders.hasChildQuery("child",matchQuery("text","value"))).execute().actionGet();
  assertThat(response.getFailedShards(),equalTo(0));
  assertThat(response.getHits().totalHits(),equalTo(0l));
  client().prepareSearch("test").setQuery(QueryBuilders.hasChildQuery("child",matchQuery("text","value")).scoreType("max")).execute().actionGet();
  assertThat(response.getFailedShards(),equalTo(0));
  assertThat(response.getHits().totalHits(),equalTo(0l));
  client().prepareSearch("test").setQuery(QueryBuilders.hasParentQuery("child",matchQuery("text","value"))).execute().actionGet();
  assertThat(response.getFailedShards(),equalTo(0));
  assertThat(response.getHits().totalHits(),equalTo(0l));
  client().prepareSearch("test").setQuery(QueryBuilders.hasParentQuery("child",matchQuery("text","value")).scoreType("score")).execute().actionGet();
  assertThat(response.getFailedShards(),equalTo(0));
  assertThat(response.getHits().totalHits(),equalTo(0l));
}
