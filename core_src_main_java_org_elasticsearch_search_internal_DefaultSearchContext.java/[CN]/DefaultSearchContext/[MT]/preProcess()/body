{
  if (!(from() == -1 && size() == -1)) {
    int numHits=from() + size();
    if (numHits < 0) {
      String msg="Result window is too large, from + size must be less than or equal to: [" + Integer.MAX_VALUE + "] but was ["+ (((long)from()) + ((long)size()))+ "]";
      throw new QueryPhaseExecutionException(this,msg);
    }
  }
  aliasFilter=indexService.aliasesService().aliasFilter(request.filteringAliases());
  if (query() == null) {
    parsedQuery(ParsedQuery.parsedMatchAllQuery());
  }
  if (queryBoost() != 1.0f) {
    parsedQuery(new ParsedQuery(new FunctionScoreQuery(query(),new BoostScoreFunction(queryBoost)),parsedQuery()));
  }
  Query searchFilter=searchFilter(types());
  if (searchFilter != null) {
    if (Queries.isConstantMatchAllQuery(query())) {
      Query q=new ConstantScoreQuery(searchFilter);
      q.setBoost(query().getBoost());
      parsedQuery(new ParsedQuery(q,parsedQuery()));
    }
 else {
      BooleanQuery filtered=new BooleanQuery();
      filtered.add(query(),Occur.MUST);
      filtered.add(searchFilter,Occur.FILTER);
      parsedQuery(new ParsedQuery(filtered,parsedQuery()));
    }
  }
  try {
    this.query=searcher().rewrite(this.query);
  }
 catch (  IOException e) {
    throw new QueryPhaseExecutionException(this,"Failed to rewrite main query",e);
  }
}
