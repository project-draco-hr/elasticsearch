{
  try {
    final SearchRequest scanRequest=new SearchRequest().indices(request.indices()).types(request.types()).indicesOptions(request.indicesOptions()).scroll(request.scroll());
    if (request.routing() != null) {
      scanRequest.routing(request.routing());
    }
    List<String> fields=new ArrayList<>();
    fields.add("_routing");
    fields.add("_parent");
    SearchSourceBuilder source=new SearchSourceBuilder().query(request.query()).fields(fields).sort("_doc").fetchSource(false).version(true);
    if (request.size() > 0) {
      source.size(request.size());
    }
    if (request.timeout() != null) {
      source.timeout(request.timeout());
    }
    scanRequest.source(source);
    logger.trace("executing scan request");
    searchAction.execute(scanRequest,new ActionListener<SearchResponse>(){
      @Override public void onResponse(      SearchResponse searchResponse){
        long hits=searchResponse.getHits().getTotalHits();
        logger.trace("first request executed: found [{}] document(s) to delete",hits);
        total.set(hits);
        deleteHits(null,searchResponse);
      }
      @Override public void onFailure(      Throwable e){
        listener.onFailure(e);
      }
    }
);
  }
 catch (  Throwable t) {
    logger.error("unable to execute the initial scan request of delete by query",t);
    listener.onFailure(t);
  }
}
