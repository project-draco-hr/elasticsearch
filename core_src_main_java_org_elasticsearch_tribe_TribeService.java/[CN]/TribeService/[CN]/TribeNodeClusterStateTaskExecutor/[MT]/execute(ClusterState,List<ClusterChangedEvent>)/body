{
  ClusterState accumulator=ClusterState.builder(currentState).build();
  BatchResult.Builder<ClusterChangedEvent> builder=BatchResult.builder();
  try {
    accumulator=applyUpdate(accumulator,tasks.get(tasks.size() - 1));
    builder.successes(tasks);
  }
 catch (  Throwable t) {
    builder.failures(tasks,t);
  }
  return builder.build(accumulator);
}
