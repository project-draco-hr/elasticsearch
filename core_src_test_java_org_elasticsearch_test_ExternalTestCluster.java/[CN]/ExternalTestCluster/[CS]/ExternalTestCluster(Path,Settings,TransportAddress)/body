{
  super(0);
  Settings clientSettings=Settings.settingsBuilder().put(additionalSettings).put("name",InternalTestCluster.TRANSPORT_CLIENT_PREFIX + EXTERNAL_CLUSTER_PREFIX + counter.getAndIncrement()).put(InternalSettingsPreparer.IGNORE_SYSTEM_PROPERTIES_SETTING,true).put("client.transport.ignore_cluster_name",true).put("path.home",tempDir).put("node.mode","network").build();
  this.client=TransportClient.builder().settings(clientSettings).build().addTransportAddresses(transportAddresses);
  NodesInfoResponse nodeInfos=this.client.admin().cluster().prepareNodesInfo().clear().setSettings(true).setHttp(true).get();
  httpAddresses=new InetSocketAddress[nodeInfos.getNodes().length];
  this.clusterName=nodeInfos.getClusterName().value();
  int dataNodes=0;
  int masterAndDataNodes=0;
  for (int i=0; i < nodeInfos.getNodes().length; i++) {
    NodeInfo nodeInfo=nodeInfos.getNodes()[i];
    httpAddresses[i]=((InetSocketTransportAddress)nodeInfo.getHttp().address().publishAddress()).address();
    if (DiscoveryNode.dataNode(nodeInfo.getSettings())) {
      dataNodes++;
      masterAndDataNodes++;
    }
 else     if (DiscoveryNode.masterNode(nodeInfo.getSettings())) {
      masterAndDataNodes++;
    }
  }
  this.numDataNodes=dataNodes;
  this.numMasterAndDataNodes=masterAndDataNodes;
  logger.info("Setup ExternalTestCluster [{}] made of [{}] nodes",nodeInfos.getClusterName().value(),size());
}
