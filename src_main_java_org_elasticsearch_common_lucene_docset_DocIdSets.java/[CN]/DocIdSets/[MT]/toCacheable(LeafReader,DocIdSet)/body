{
  if (set == null || set == DocIdSet.EMPTY) {
    return DocIdSet.EMPTY;
  }
  final DocIdSetIterator it=set.iterator();
  if (it == null) {
    return DocIdSet.EMPTY;
  }
  final int firstDoc=it.nextDoc();
  if (firstDoc == DocIdSetIterator.NO_MORE_DOCS) {
    return DocIdSet.EMPTY;
  }
  if (set instanceof BitDocIdSet) {
    return set;
  }
  final RoaringDocIdSet.Builder builder=new RoaringDocIdSet.Builder(reader.maxDoc());
  builder.add(firstDoc);
  for (int doc=it.nextDoc(); doc != DocIdSetIterator.NO_MORE_DOCS; doc=it.nextDoc()) {
    builder.add(doc);
  }
  return builder.build();
}
