{
  System.setProperty("es.logger.prefix","");
  BootstrapCLIParser bootstrapCLIParser=new BootstrapCLIParser();
  CliTool.ExitStatus status=bootstrapCLIParser.execute(args);
  if (CliTool.ExitStatus.OK != status) {
    System.exit(status.status());
  }
  INSTANCE=new Bootstrap();
  boolean foreground=!"false".equals(System.getProperty("es.foreground",System.getProperty("es-foreground")));
  if (System.getProperty("wrapper.service","XXX").equalsIgnoreCase("true")) {
    foreground=false;
  }
  Environment environment=initialSettings(foreground);
  Settings settings=environment.settings();
  if (environment.pidFile() != null) {
    PidFile.create(environment.pidFile(),true);
  }
  setupLogging(settings,environment);
  if (System.getProperty("es.max-open-files","false").equals("true")) {
    ESLogger logger=Loggers.getLogger(Bootstrap.class);
    logger.info("max_open_files [{}]",ProcessProbe.getInstance().getMaxFileDescriptorCount());
  }
  if (JvmInfo.jvmInfo().getVmName().toLowerCase(Locale.ROOT).contains("client")) {
    ESLogger logger=Loggers.getLogger(Bootstrap.class);
    logger.warn("jvm uses the client vm, make sure to run `java` with the server vm for best performance by adding `-server` to the command line");
  }
  try {
    if (!foreground) {
      Loggers.disableConsoleLogging();
      closeSystOut();
    }
    JVMCheck.check();
    INSTANCE.setup(true,settings,environment);
    INSTANCE.start();
    if (!foreground) {
      closeSysError();
    }
  }
 catch (  Throwable e) {
    if (foreground) {
      Loggers.disableConsoleLogging();
    }
    ESLogger logger=Loggers.getLogger(Bootstrap.class);
    if (INSTANCE.node != null) {
      logger=Loggers.getLogger(Bootstrap.class,INSTANCE.node.settings().get("name"));
    }
    logger.error("Exception",e);
    if (foreground) {
      Loggers.enableConsoleLogging();
    }
    throw e;
  }
}
