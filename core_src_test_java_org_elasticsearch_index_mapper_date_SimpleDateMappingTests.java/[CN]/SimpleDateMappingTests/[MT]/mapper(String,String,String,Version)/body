{
  IndexService index;
  if (version.equals(Version.CURRENT)) {
    index=createIndex(indexName);
  }
 else {
    index=createIndex(indexName,settingsBuilder().put(IndexMetaData.SETTING_VERSION_CREATED,version).build());
  }
  client().admin().indices().preparePutMapping(indexName).setType(type).setSource(mapping).get();
  return index.mapperService().documentMapper(type);
}
