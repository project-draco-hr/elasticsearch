{
  String mapping=XContentFactory.jsonBuilder().startObject().startObject("type").startObject("properties").startObject("date_field").field("type","date").endObject().endObject().endObject().endObject().string();
  Version randomVersion=VersionUtils.randomVersionBetween(getRandom(),Version.V_0_90_0,Version.V_1_6_1);
  IndexService index=createIndex("test",settingsBuilder().put(IndexMetaData.SETTING_VERSION_CREATED,randomVersion).build());
  client().admin().indices().preparePutMapping("test").setType("type").setSource(mapping).get();
  assertDateFormat("epoch_millis||dateOptionalTime");
  DocumentMapper defaultMapper=index.mapperService().documentMapper("type");
  defaultMapper.parse("type","1",XContentFactory.jsonBuilder().startObject().field("date_field","1-1-1T00:00:44.000Z").endObject().bytes());
  defaultMapper.parse("type","1",XContentFactory.jsonBuilder().startObject().field("date_field","2015-06-06T00:00:44.000Z").endObject().bytes());
}
