{
  EnumSet<ShardStatusChangeType> changes=purgeDeletedAndClosedShards();
  final List<ShardId> activeToInactiveIndexingShards=new ArrayList<>();
  final int activeShards=updateShardStatuses(changes,activeToInactiveIndexingShards);
  for (  ShardId indexShard : activeToInactiveIndexingShards) {
    markShardAsInactive(indexShard);
  }
  if (changes.isEmpty() == false) {
    calcAndSetShardBuffers(activeShards,"[" + changes + "]");
  }
}
