{
  super(settings);
  this.threadPool=threadPool;
  this.indicesService=indicesService;
  ByteSizeValue indexingBuffer;
  String indexingBufferSetting=this.settings.get(INDEX_BUFFER_SIZE_SETTING,"10%");
  if (indexingBufferSetting.endsWith("%")) {
    double percent=Double.parseDouble(indexingBufferSetting.substring(0,indexingBufferSetting.length() - 1));
    indexingBuffer=new ByteSizeValue((long)(((double)JvmInfo.jvmInfo().getMem().getHeapMax().bytes()) * (percent / 100)));
    ByteSizeValue minIndexingBuffer=this.settings.getAsBytesSize(MIN_INDEX_BUFFER_SIZE_SETTING,new ByteSizeValue(48,ByteSizeUnit.MB));
    ByteSizeValue maxIndexingBuffer=this.settings.getAsBytesSize(MAX_INDEX_BUFFER_SIZE_SETTING,null);
    if (indexingBuffer.bytes() < minIndexingBuffer.bytes()) {
      indexingBuffer=minIndexingBuffer;
    }
    if (maxIndexingBuffer != null && indexingBuffer.bytes() > maxIndexingBuffer.bytes()) {
      indexingBuffer=maxIndexingBuffer;
    }
  }
 else {
    indexingBuffer=ByteSizeValue.parseBytesSizeValue(indexingBufferSetting,INDEX_BUFFER_SIZE_SETTING);
  }
  this.indexingBuffer=indexingBuffer;
  this.minShardIndexBufferSize=this.settings.getAsBytesSize(MIN_SHARD_INDEX_BUFFER_SIZE_SETTING,new ByteSizeValue(4,ByteSizeUnit.MB));
  this.maxShardIndexBufferSize=this.settings.getAsBytesSize(MAX_SHARD_INDEX_BUFFER_SIZE_SETTING,new ByteSizeValue(512,ByteSizeUnit.MB));
  ByteSizeValue translogBuffer;
  String translogBufferSetting=this.settings.get(TRANSLOG_BUFFER_SIZE_SETTING,"1%");
  if (translogBufferSetting.endsWith("%")) {
    double percent=Double.parseDouble(translogBufferSetting.substring(0,translogBufferSetting.length() - 1));
    translogBuffer=new ByteSizeValue((long)(((double)JvmInfo.jvmInfo().getMem().getHeapMax().bytes()) * (percent / 100)));
    ByteSizeValue minTranslogBuffer=this.settings.getAsBytesSize(MIN_TRANSLOG_BUFFER_SIZE_SETTING,new ByteSizeValue(256,ByteSizeUnit.KB));
    ByteSizeValue maxTranslogBuffer=this.settings.getAsBytesSize(MAX_TRANSLOG_BUFFER_SIZE_SETTING,null);
    if (translogBuffer.bytes() < minTranslogBuffer.bytes()) {
      translogBuffer=minTranslogBuffer;
    }
    if (maxTranslogBuffer != null && translogBuffer.bytes() > maxTranslogBuffer.bytes()) {
      translogBuffer=maxTranslogBuffer;
    }
  }
 else {
    translogBuffer=ByteSizeValue.parseBytesSizeValue(translogBufferSetting,null);
  }
  this.translogBuffer=translogBuffer;
  this.minShardTranslogBufferSize=this.settings.getAsBytesSize(MIN_SHARD_TRANSLOG_BUFFER_SIZE_SETTING,new ByteSizeValue(2,ByteSizeUnit.KB));
  this.maxShardTranslogBufferSize=this.settings.getAsBytesSize(MAX_SHARD_TRANSLOG_BUFFER_SIZE_SETTING,new ByteSizeValue(64,ByteSizeUnit.KB));
  this.inactiveTime=this.settings.getAsTime(SHARD_INACTIVE_TIME_SETTING,TimeValue.timeValueMinutes(5));
  this.interval=this.settings.getAsTime(SHARD_INACTIVE_INTERVAL_TIME_SETTING,TimeValue.timeValueSeconds(30));
  logger.debug("using indexing buffer size [{}], with {} [{}], {} [{}], {} [{}], {} [{}]",this.indexingBuffer,MIN_SHARD_INDEX_BUFFER_SIZE_SETTING,this.minShardIndexBufferSize,MAX_SHARD_INDEX_BUFFER_SIZE_SETTING,this.maxShardIndexBufferSize,SHARD_INACTIVE_TIME_SETTING,this.inactiveTime,SHARD_INACTIVE_INTERVAL_TIME_SETTING,this.interval);
}
