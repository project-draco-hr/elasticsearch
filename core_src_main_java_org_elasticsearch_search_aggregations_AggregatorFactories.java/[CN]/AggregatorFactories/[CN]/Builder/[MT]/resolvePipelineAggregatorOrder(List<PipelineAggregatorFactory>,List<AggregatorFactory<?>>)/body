{
  Map<String,PipelineAggregatorFactory> pipelineAggregatorFactoriesMap=new HashMap<>();
  for (  PipelineAggregatorFactory factory : pipelineAggregatorFactories) {
    pipelineAggregatorFactoriesMap.put(factory.getName(),factory);
  }
  Map<String,AggregatorFactory<?>> aggFactoriesMap=new HashMap<>();
  for (  AggregatorFactory<?> aggFactory : aggFactories) {
    aggFactoriesMap.put(aggFactory.name,aggFactory);
  }
  List<PipelineAggregatorFactory> orderedPipelineAggregatorrs=new LinkedList<>();
  List<PipelineAggregatorFactory> unmarkedFactories=new ArrayList<PipelineAggregatorFactory>(pipelineAggregatorFactories);
  Set<PipelineAggregatorFactory> temporarilyMarked=new HashSet<PipelineAggregatorFactory>();
  while (!unmarkedFactories.isEmpty()) {
    PipelineAggregatorFactory factory=unmarkedFactories.get(0);
    resolvePipelineAggregatorOrder(aggFactoriesMap,pipelineAggregatorFactoriesMap,orderedPipelineAggregatorrs,unmarkedFactories,temporarilyMarked,factory);
  }
  return orderedPipelineAggregatorrs;
}
