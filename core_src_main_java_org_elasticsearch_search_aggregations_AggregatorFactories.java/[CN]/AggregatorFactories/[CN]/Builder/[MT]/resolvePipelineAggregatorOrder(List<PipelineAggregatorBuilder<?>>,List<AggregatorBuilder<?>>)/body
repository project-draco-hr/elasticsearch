{
  Map<String,PipelineAggregatorBuilder<?>> pipelineAggregatorFactoriesMap=new HashMap<>();
  for (  PipelineAggregatorBuilder<?> factory : pipelineAggregatorFactories) {
    pipelineAggregatorFactoriesMap.put(factory.getName(),factory);
  }
  Map<String,AggregatorBuilder<?>> aggFactoriesMap=new HashMap<>();
  for (  AggregatorBuilder<?> aggFactory : aggFactories) {
    aggFactoriesMap.put(aggFactory.name,aggFactory);
  }
  List<PipelineAggregatorBuilder<?>> orderedPipelineAggregatorrs=new LinkedList<>();
  List<PipelineAggregatorBuilder<?>> unmarkedFactories=new ArrayList<PipelineAggregatorBuilder<?>>(pipelineAggregatorFactories);
  Set<PipelineAggregatorBuilder<?>> temporarilyMarked=new HashSet<PipelineAggregatorBuilder<?>>();
  while (!unmarkedFactories.isEmpty()) {
    PipelineAggregatorBuilder<?> factory=unmarkedFactories.get(0);
    resolvePipelineAggregatorOrder(aggFactoriesMap,pipelineAggregatorFactoriesMap,orderedPipelineAggregatorrs,unmarkedFactories,temporarilyMarked,factory);
  }
  return orderedPipelineAggregatorrs;
}
