{
  Map<String,PipelineAggregatorBuilder<?>> pipelineAggregatorBuildersMap=new HashMap<>();
  for (  PipelineAggregatorBuilder<?> builder : pipelineAggregatorBuilders) {
    pipelineAggregatorBuildersMap.put(builder.getName(),builder);
  }
  Map<String,AggregationBuilder<?>> aggBuildersMap=new HashMap<>();
  for (  AggregationBuilder<?> aggBuilder : aggBuilders) {
    aggBuildersMap.put(aggBuilder.name,aggBuilder);
  }
  List<PipelineAggregatorBuilder<?>> orderedPipelineAggregatorrs=new LinkedList<>();
  List<PipelineAggregatorBuilder<?>> unmarkedBuilders=new ArrayList<PipelineAggregatorBuilder<?>>(pipelineAggregatorBuilders);
  Set<PipelineAggregatorBuilder<?>> temporarilyMarked=new HashSet<PipelineAggregatorBuilder<?>>();
  while (!unmarkedBuilders.isEmpty()) {
    PipelineAggregatorBuilder<?> builder=unmarkedBuilders.get(0);
    resolvePipelineAggregatorOrder(aggBuildersMap,pipelineAggregatorBuildersMap,orderedPipelineAggregatorrs,unmarkedBuilders,temporarilyMarked,builder);
  }
  return orderedPipelineAggregatorrs;
}
