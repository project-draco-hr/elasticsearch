{
  Settings settings=Settings.builder().put(IndexMetaData.SETTING_VERSION_CREATED,Version.V_1_6_0).build();
  IndexService indexService=createIndex(indexName,settings);
  MapperService mapperService=indexService.mapperService();
  mapperService.merge(parentType,new CompressedXContent(PutMappingRequest.buildFromSimplifiedDef(parentType,"nested_field",random().nextBoolean() ? "type=nested" : "type=object").string()),true);
  mapperService.merge(childType,new CompressedXContent(PutMappingRequest.buildFromSimplifiedDef(childType,"_parent","type=" + parentType,CHILD_SCORE_NAME,"type=double,doc_values=false").string()),true);
  return createSearchContext(indexService);
}
