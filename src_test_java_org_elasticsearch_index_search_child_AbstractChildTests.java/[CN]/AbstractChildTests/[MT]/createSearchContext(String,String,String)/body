{
  IndexService indexService=createIndex(indexName);
  MapperService mapperService=indexService.mapperService();
  mapperService.merge(parentType,new CompressedXContent(PutMappingRequest.buildFromSimplifiedDef(parentType,"nested_field",random().nextBoolean() ? "type=nested" : "type=object").string()),true);
  mapperService.merge(childType,new CompressedXContent(PutMappingRequest.buildFromSimplifiedDef(childType,"_parent","type=" + parentType,CHILD_SCORE_NAME,"type=double,doc_values=false").string()),true);
  return createSearchContext(indexService);
}
