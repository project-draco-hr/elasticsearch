{
  for (  ScriptFieldsContext.ScriptField scriptField : context.scriptFields().fields()) {
    scriptField.script().setNextReader(hitContext.reader());
    scriptField.script().setNextDocId(hitContext.docId());
    Object value;
    try {
      value=scriptField.script().run();
      value=scriptField.script().unwrap(value);
    }
 catch (    RuntimeException e) {
      if (scriptField.ignoreException()) {
        continue;
      }
      throw e;
    }
    if (hitContext.hit().fieldsOrNull() == null) {
      hitContext.hit().fields(new HashMap<String,SearchHitField>(2));
    }
    SearchHitField hitField=hitContext.hit().fields().get(scriptField.name());
    if (hitField == null) {
      hitField=new InternalSearchHitField(scriptField.name(),new ArrayList<Object>(2));
      hitContext.hit().fields().put(scriptField.name(),hitField);
    }
    hitField.values().add(value);
  }
}
