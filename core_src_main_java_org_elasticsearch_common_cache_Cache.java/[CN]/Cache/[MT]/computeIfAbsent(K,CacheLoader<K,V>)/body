{
  long now=now();
  V value=get(key,now);
  if (value == null) {
    CacheSegment<K,V> segment=getCacheSegment(key);
    try (ReleasableLock ignored=segment.writeLock.acquire()){
      value=get(key,now);
      if (value == null) {
        try {
          value=loader.load(key);
        }
 catch (        Exception e) {
          throw new ExecutionException(e);
        }
        if (value == null) {
          throw new ExecutionException(new NullPointerException("loader returned a null value"));
        }
        put(key,value,now);
      }
    }
   }
  return value;
}
