{
  BytesReference inputBytes=new BytesArray(" {\"fields\" : [\"a\",  \"b\",\"c\"], \"offsets\":false, \"positions\":false, \"payloads\":true}");
  TermVectorsRequest tvr=new TermVectorsRequest(null,null,null);
  XContentParser parser=XContentFactory.xContent(XContentType.JSON).createParser(inputBytes);
  TermVectorsRequest.parseRequest(tvr,parser);
  Set<String> fields=tvr.selectedFields();
  assertThat(fields.contains("a"),equalTo(true));
  assertThat(fields.contains("b"),equalTo(true));
  assertThat(fields.contains("c"),equalTo(true));
  assertThat(tvr.offsets(),equalTo(false));
  assertThat(tvr.positions(),equalTo(false));
  assertThat(tvr.payloads(),equalTo(true));
  String additionalFields="b,c  ,d, e  ";
  RestTermVectorsAction.addFieldStringsFromParameter(tvr,additionalFields);
  assertThat(tvr.selectedFields().size(),equalTo(5));
  assertThat(fields.contains("d"),equalTo(true));
  assertThat(fields.contains("e"),equalTo(true));
  additionalFields="";
  RestTermVectorsAction.addFieldStringsFromParameter(tvr,additionalFields);
  inputBytes=new BytesArray(" {\"offsets\":false, \"positions\":false, \"payloads\":true}");
  tvr=new TermVectorsRequest(null,null,null);
  parser=XContentFactory.xContent(XContentType.JSON).createParser(inputBytes);
  TermVectorsRequest.parseRequest(tvr,parser);
  additionalFields="";
  RestTermVectorsAction.addFieldStringsFromParameter(tvr,additionalFields);
  assertThat(tvr.selectedFields(),equalTo(null));
  additionalFields="b,c  ,d, e  ";
  RestTermVectorsAction.addFieldStringsFromParameter(tvr,additionalFields);
  assertThat(tvr.selectedFields().size(),equalTo(4));
}
