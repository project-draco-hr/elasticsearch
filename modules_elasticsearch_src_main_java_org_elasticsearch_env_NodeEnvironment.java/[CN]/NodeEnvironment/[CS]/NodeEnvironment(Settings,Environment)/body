{
  super(settings);
  if (!settings.getAsBoolean("node.data",true) || settings.getAsBoolean("node.client",false) || !settings.getAsBoolean("node.master",true)) {
    nodeFile=null;
    lock=null;
    localNodeId=-1;
    return;
  }
  Lock lock=null;
  File dir=null;
  int localNodeId=-1;
  for (int i=0; i < 100; i++) {
    dir=new File(new File(environment.workWithClusterFile(),"nodes"),Integer.toString(i));
    if (!dir.exists()) {
      dir.mkdirs();
    }
    try {
      NativeFSLockFactory lockFactory=new NativeFSLockFactory(dir);
      Lock tmpLock=lockFactory.makeLock("node.lock");
      boolean obtained=tmpLock.obtain();
      if (obtained) {
        lock=tmpLock;
        localNodeId=i;
        break;
      }
    }
 catch (    IOException e) {
    }
  }
  if (lock == null) {
    throw new IOException("Failed to obtain node lock");
  }
  this.localNodeId=localNodeId;
  this.lock=lock;
  this.nodeFile=dir;
  if (logger.isDebugEnabled()) {
    logger.debug("using node location [{}], local_node_id [{}]",dir,localNodeId);
  }
}
