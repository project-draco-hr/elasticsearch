{
  if (isClosed.get() == false) {
    logger.trace("flushAndClose now acquire writeLock");
    try (ReleasableLock _=writeLock.acquire()){
      logger.trace("flushAndClose now acquired writeLock");
      try {
        logger.debug("flushing shard on close - this might take some time to sync files to disk");
        try {
          flush();
        }
 catch (        FlushNotAllowedEngineException ex) {
          logger.debug("flush not allowed during flushAndClose - skipping");
        }
catch (        EngineClosedException ex) {
          logger.debug("engine already closed - skipping flushAndClose");
        }
      }
  finally {
        close();
      }
    }
   }
}
