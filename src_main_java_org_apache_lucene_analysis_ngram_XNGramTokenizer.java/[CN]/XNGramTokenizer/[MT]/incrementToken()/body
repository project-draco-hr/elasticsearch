{
  clearAttributes();
  if (bufferStart >= buffer.length - maxGram) {
    System.arraycopy(buffer,bufferStart,buffer,0,bufferEnd - bufferStart);
    bufferEnd-=bufferStart;
    bufferStart=0;
    if (!exhausted) {
      while (bufferEnd < buffer.length) {
        final int read=input.read(buffer,bufferEnd,buffer.length - bufferEnd);
        if (read == -1) {
          exhausted=true;
          break;
        }
        bufferEnd+=read;
      }
    }
  }
  if (gramSize > maxGram || bufferStart + gramSize > bufferEnd) {
    bufferStart++;
    offset++;
    gramSize=minGram;
  }
  if (bufferStart + gramSize > bufferEnd) {
    return false;
  }
  termAtt.copyBuffer(buffer,bufferStart,gramSize);
  posIncAtt.setPositionIncrement(1);
  posLenAtt.setPositionLength(1);
  offsetAtt.setOffset(correctOffset(offset),correctOffset(offset + gramSize));
  ++gramSize;
  return true;
}
