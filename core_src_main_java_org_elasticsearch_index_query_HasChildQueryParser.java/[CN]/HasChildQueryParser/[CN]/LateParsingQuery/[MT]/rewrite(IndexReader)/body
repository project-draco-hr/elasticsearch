{
  SearchContext searchContext=SearchContext.current();
  if (searchContext == null) {
    throw new IllegalArgumentException("Search context is required to be set");
  }
  String joinField=ParentFieldMapper.joinField(parentType);
  IndexReader indexReader=searchContext.searcher().getIndexReader();
  IndexSearcher indexSearcher=new IndexSearcher(indexReader);
  IndexParentChildFieldData indexParentChildFieldData=parentChildIndexFieldData.loadGlobal(indexReader);
  MultiDocValues.OrdinalMap ordinalMap=ParentChildIndexFieldData.getOrdinalMap(indexParentChildFieldData,parentType);
  return JoinUtil.createJoinQuery(joinField,innerQuery,toQuery,indexSearcher,scoreMode,ordinalMap,minChildren,maxChildren);
}
