{
  SearchContext searchContext=SearchContext.current();
  if (searchContext == null) {
    throw new IllegalArgumentException("Search context is required to be set");
  }
  IndexSearcher indexSearcher=searchContext.searcher();
  String joinField=ParentFieldMapper.joinField(parentType);
  IndexParentChildFieldData indexParentChildFieldData=parentChildIndexFieldData.loadGlobal(indexSearcher.getIndexReader());
  MultiDocValues.OrdinalMap ordinalMap=ParentChildIndexFieldData.getOrdinalMap(indexParentChildFieldData,parentType);
  return JoinUtil.createJoinQuery(joinField,innerQuery,toQuery,indexSearcher,scoreMode,ordinalMap,minChildren,maxChildren);
}
