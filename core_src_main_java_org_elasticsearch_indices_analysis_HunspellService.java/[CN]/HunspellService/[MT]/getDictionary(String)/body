{
  Dictionary dictionary=dictionaries.get(locale);
  if (dictionary == null) {
    dictionary=knownDictionaries.get(locale);
    if (dictionary == null) {
      keyedLock.acquire(locale);
      dictionary=dictionaries.get(locale);
      if (dictionary == null) {
        try {
          dictionary=loadDictionary(locale,settings,env);
        }
 catch (        Exception e) {
          throw new IllegalStateException("failed to load hunspell dictionary for local: " + locale,e);
        }
        dictionaries=dictionaries.copyAndPut(locale,dictionary);
      }
      keyedLock.release(locale);
    }
  }
  return dictionary;
}
