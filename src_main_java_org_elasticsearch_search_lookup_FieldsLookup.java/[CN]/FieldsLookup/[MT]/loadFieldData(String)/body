{
  FieldLookup data=cachedFieldData.get(name);
  if (data == null) {
    FieldMapper mapper=mapperService.smartNameFieldMapper(name,types);
    if (mapper == null) {
      throw new ElasticSearchIllegalArgumentException("No field found for [" + name + "] in mapping with types "+ Arrays.toString(types)+ "");
    }
    data=new FieldLookup(mapper);
    cachedFieldData.put(name,data);
  }
  if (data.doc() == null) {
    fieldVisitor.name(data.mapper().names().indexName());
    try {
      reader.document(docId,fieldVisitor);
      data.doc(fieldVisitor.createDocument());
    }
 catch (    IOException e) {
      throw new ElasticSearchParseException("failed to load field [" + name + "]",e);
    }
 finally {
      fieldVisitor.reset();
    }
  }
  return data;
}
