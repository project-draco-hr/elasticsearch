{
  for (  AtomicReaderContext readerContext : context.searcher().getTopReaderContext().leaves()) {
    int maxDoc=readerContext.reader().maxDoc();
    if (indexFieldData instanceof IndexFieldData.WithOrdinals) {
      BytesValues.WithOrdinals values=((IndexFieldData.WithOrdinals)indexFieldData).load(readerContext).getBytesValues(false);
      Ordinals.Docs ordinals=values.ordinals();
      for (long ord=Ordinals.MIN_ORDINAL; ord < ordinals.getMaxOrd(); ord++) {
        BytesRef value=values.getValueByOrd(ord);
        aggregator.addValue(value,value.hashCode(),values);
      }
    }
 else {
      BytesValues values=indexFieldData.load(readerContext).getBytesValues(true);
      for (int docId=0; docId < maxDoc; docId++) {
        final int size=values.setDocument(docId);
        for (int i=0; i < size; i++) {
          final BytesRef value=values.nextValue();
          aggregator.addValue(value,values.currentValueHash(),values);
        }
      }
    }
  }
}
