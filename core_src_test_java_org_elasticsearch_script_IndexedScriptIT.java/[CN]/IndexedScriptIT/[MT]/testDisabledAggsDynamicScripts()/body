{
  if (randomBoolean()) {
    client().preparePutIndexedScript(GroovyScriptEngineService.NAME,"script1","{\"script\":\"2\"}").get();
  }
 else {
    client().prepareIndex(ScriptService.SCRIPT_INDEX,GroovyScriptEngineService.NAME,"script1").setSource("{\"script\":\"2\"}").get();
  }
  client().prepareIndex("test","scriptTest","1").setSource("{\"theField\":\"foo\"}").get();
  refresh();
  SearchResponse searchResponse=client().prepareSearch("test").setSource(new SearchSourceBuilder().aggregation(AggregationBuilders.terms("test").script(new Script("script1",ScriptType.INDEXED,null,null)))).get();
  assertHitCount(searchResponse,1);
  assertThat(searchResponse.getAggregations().get("test"),notNullValue());
}
