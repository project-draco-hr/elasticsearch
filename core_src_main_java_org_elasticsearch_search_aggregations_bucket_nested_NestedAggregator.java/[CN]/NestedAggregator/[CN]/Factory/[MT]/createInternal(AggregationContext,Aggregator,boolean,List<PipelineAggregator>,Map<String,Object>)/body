{
  if (collectsFromSingleBucket == false) {
    return asMultiBucketAggregator(this,context,parent);
  }
  MapperService.SmartNameObjectMapper mapper=context.searchContext().smartNameObjectMapper(path);
  if (mapper == null) {
    return new Unmapped(name,context,parent,pipelineAggregators,metaData);
  }
  ObjectMapper objectMapper=mapper.mapper();
  if (objectMapper == null) {
    return new Unmapped(name,context,parent,pipelineAggregators,metaData);
  }
  if (!objectMapper.nested().isNested()) {
    throw new AggregationExecutionException("[nested] nested path [" + path + "] is not nested");
  }
  return new NestedAggregator(name,factories,objectMapper,context,parent,pipelineAggregators,metaData);
}
