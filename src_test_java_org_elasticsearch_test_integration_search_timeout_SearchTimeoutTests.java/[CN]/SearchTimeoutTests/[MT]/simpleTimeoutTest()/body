{
  client.admin().indices().prepareDelete().execute().actionGet();
  for (int i=0; i < 10; i++) {
    client.prepareIndex("test","type",Integer.toString(i)).setSource("field","value").execute().actionGet();
  }
  client.admin().indices().prepareRefresh().execute().actionGet();
  SearchResponse searchResponse=client.prepareSearch("test").setTimeout("10ms").setQuery(filteredQuery(matchAllQuery(),scriptFilter("Thread.sleep(100); return true;"))).execute().actionGet();
  assertThat(searchResponse.timedOut(),equalTo(true));
}
