{
  connectionFactory=new ConnectionFactory();
  connectionFactory.setHost(XContentMapValues.nodeStringValue(settings.settings().get("host"),ConnectionFactory.DEFAULT_HOST));
  connectionFactory.setPort(XContentMapValues.nodeIntegerValue(settings.settings().get("port"),ConnectionFactory.DEFAULT_AMQP_PORT));
  connectionFactory.setUsername(XContentMapValues.nodeStringValue(settings.settings().get("user"),ConnectionFactory.DEFAULT_USER));
  connectionFactory.setPassword(XContentMapValues.nodeStringValue(settings.settings().get("password"),ConnectionFactory.DEFAULT_PASS));
  connectionFactory.setVirtualHost(XContentMapValues.nodeStringValue(settings.settings().get("vhost"),ConnectionFactory.DEFAULT_VHOST));
  logger.info("creating rabbitmq river, host [{}], port [{}], user [{}], vhost [{}]",connectionFactory.getHost(),connectionFactory.getPort(),connectionFactory.getUsername(),connectionFactory.getVirtualHost());
  thread=EsExecutors.daemonThreadFactory(settings.globalSettings(),"rabbitmq_river").newThread(new Consumer());
  thread.start();
}
