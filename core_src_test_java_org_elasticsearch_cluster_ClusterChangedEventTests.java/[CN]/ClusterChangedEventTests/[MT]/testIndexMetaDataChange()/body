{
  final int numNodesInCluster=3;
  final ClusterState originalState=createState(numNodesInCluster,randomBoolean(),initialIndices);
  final ClusterState newState=originalState;
  final ClusterChangedEvent event=new ClusterChangedEvent("_na_",originalState,newState);
  final String indexId=initialIndices.get(0);
  final IndexMetaData originalIndexMeta=originalState.metaData().index(indexId);
  assertNotNull("IndexMetaData for " + indexId + " should exist on the cluster state",originalIndexMeta);
  IndexMetaData newIndexMeta=createIndexMetadata(indexId,originalIndexMeta.getVersion() + 1);
  assertTrue("IndexMetaData with different version numbers must be considered changed",event.indexMetaDataChanged(newIndexMeta));
  newIndexMeta=createIndexMetadata("doesntexist");
  assertTrue("IndexMetaData that didn't previously exist should be considered changed",event.indexMetaDataChanged(newIndexMeta));
  assertFalse("IndexMetaData should be the same",event.indexMetaDataChanged(originalIndexMeta));
}
