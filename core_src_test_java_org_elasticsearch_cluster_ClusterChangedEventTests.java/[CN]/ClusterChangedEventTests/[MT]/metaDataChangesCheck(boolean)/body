{
  final int numNodesInCluster=3;
  for (int i=0; i < INDICES_CHANGE_NUM_TESTS; i++) {
    final ClusterState previousState=createState(numNodesInCluster,randomBoolean(),initialIndices);
    final int numAdd=randomIntBetween(0,5);
    final int numDel=randomIntBetween(0,initialIndices.size());
    final List<String> addedIndices=addIndices(numAdd);
    final List<String> delIndices=delIndices(numDel,initialIndices);
    final ClusterState newState=nextState(previousState,changeClusterUUID,addedIndices,delIndices,0);
    final ClusterChangedEvent event=new ClusterChangedEvent("_na_",newState,previousState);
    final List<String> addsFromEvent=event.indicesCreated();
    final List<String> delsFromEvent=event.indicesDeleted();
    Collections.sort(addsFromEvent);
    Collections.sort(delsFromEvent);
    assertThat(addsFromEvent,equalTo(addedIndices));
    assertThat(delsFromEvent,changeClusterUUID ? equalTo(Collections.emptyList()) : equalTo(delIndices));
    assertThat(event.metaDataChanged(),equalTo(changeClusterUUID || addedIndices.size() > 0 || delIndices.size() > 0));
  }
}
