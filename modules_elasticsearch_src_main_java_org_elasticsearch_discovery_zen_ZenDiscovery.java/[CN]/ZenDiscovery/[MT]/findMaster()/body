{
  ZenPing.PingResponse[] pingResponses=pingService.pingAndWait(pingTimeout);
  if (pingResponses == null) {
    return null;
  }
  if (logger.isDebugEnabled()) {
    StringBuilder sb=new StringBuilder("ping responses:");
    if (pingResponses.length == 0) {
      sb.append(" {none}");
    }
 else {
      for (      ZenPing.PingResponse pingResponse : pingResponses) {
        sb.append("\n\t--> ").append("target [").append(pingResponse.target()).append("], master [").append(pingResponse.master()).append("]");
      }
    }
    logger.debug(sb.toString());
  }
  List<DiscoveryNode> pingMasters=newArrayList();
  for (  ZenPing.PingResponse pingResponse : pingResponses) {
    if (pingResponse.master() != null) {
      pingMasters.add(pingResponse.master());
    }
  }
  if (pingMasters.isEmpty()) {
    List<DiscoveryNode> possibleMasterNodes=newArrayList();
    possibleMasterNodes.add(localNode);
    for (    ZenPing.PingResponse pingResponse : pingResponses) {
      possibleMasterNodes.add(pingResponse.target());
    }
    DiscoveryNode electedMaster=electMaster.electMaster(possibleMasterNodes);
    if (localNode.equals(electedMaster)) {
      return localNode;
    }
  }
 else {
    DiscoveryNode electedMaster=electMaster.electMaster(pingMasters);
    if (electedMaster != null) {
      return electedMaster;
    }
  }
  return null;
}
