{
  while (true) {
    ZenPing.PingResponse[] pingResponses=pingService.pingAndWait(initialPingTimeout);
    List<DiscoveryNode> pingMasters=newArrayList();
    for (    ZenPing.PingResponse pingResponse : pingResponses) {
      if (pingResponse.master() != null) {
        pingMasters.add(pingResponse.master());
      }
    }
    if (pingMasters.isEmpty()) {
      List<DiscoveryNode> possibleMasterNodes=newArrayList();
      possibleMasterNodes.add(localNode);
      for (      ZenPing.PingResponse pingResponse : pingResponses) {
        possibleMasterNodes.add(pingResponse.target());
      }
      DiscoveryNode electedMaster=electMaster.electMaster(possibleMasterNodes);
      if (localNode.equals(electedMaster)) {
        return localNode;
      }
    }
 else {
      DiscoveryNode electedMaster=electMaster.electMaster(pingMasters);
      if (electedMaster != null) {
        return electedMaster;
      }
    }
  }
}
