{
  if (master) {
    logger.warn("master should not receive new cluster state from [{}]",clusterState.nodes().masterNode());
  }
 else {
    if (clusterState.nodes().localNode() == null) {
      logger.warn("received a cluster state from [{}] and not part of the cluster, should not happen",clusterState.nodes().masterNode());
    }
 else {
      clusterService.submitStateUpdateTask("zen-disco-receive(from master [" + clusterState.nodes().masterNode() + "])",new ProcessedClusterStateUpdateTask(){
        @Override public ClusterState execute(        ClusterState currentState){
          latestDiscoNodes=clusterState.nodes();
          if (masterFD.masterNode() == null || !masterFD.masterNode().equals(latestDiscoNodes.masterNode())) {
            masterFD.restart(latestDiscoNodes.masterNode(),"new cluster stare received and we monitor the wrong master [" + masterFD.masterNode() + "]");
          }
          return clusterState;
        }
        @Override public void clusterStateProcessed(        ClusterState clusterState){
          sendInitialStateEventIfNeeded();
        }
      }
);
    }
  }
}
