{
  if (master) {
    logger.warn("Master should not receive new cluster state from [{}]",clusterState.nodes().masterNode());
  }
 else {
    latestDiscoNodes=clusterState.nodes();
    if (masterFD.masterNode() != null && masterFD.masterNode().equals(latestDiscoNodes.masterNode())) {
      masterFD.restart(latestDiscoNodes.masterNode());
    }
    if (clusterState.nodes().localNode() == null) {
      logger.warn("Received a cluster state from [{}] and not part of the cluster, should not happen",clusterState.nodes().masterNode());
    }
 else {
      clusterService.submitStateUpdateTask("zen-disco-receive(from [" + clusterState.nodes().masterNode() + "])",new ProcessedClusterStateUpdateTask(){
        @Override public ClusterState execute(        ClusterState currentState){
          return clusterState;
        }
        @Override public void clusterStateProcessed(        ClusterState clusterState){
          sendInitialStateEventIfNeeded();
        }
      }
);
    }
  }
}
