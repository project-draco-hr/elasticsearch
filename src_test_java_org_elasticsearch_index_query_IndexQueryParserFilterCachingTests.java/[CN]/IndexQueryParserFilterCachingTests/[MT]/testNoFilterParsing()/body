{
  IndexQueryParserService queryParser=queryParser();
  String query=copyToStringFromClasspath("/org/elasticsearch/index/query/date_range_in_boolean.json");
  Query parsedQuery=queryParser.parse(query).query();
  assertThat(parsedQuery,instanceOf(ConstantScoreQuery.class));
  assertThat(((ConstantScoreQuery)parsedQuery).getFilter(),instanceOf(XBooleanFilter.class));
  assertThat(((XBooleanFilter)((ConstantScoreQuery)parsedQuery).getFilter()).clauses().get(1).getFilter(),instanceOf(NoCacheFilter.class));
  assertThat(((XBooleanFilter)((ConstantScoreQuery)parsedQuery).getFilter()).clauses().size(),is(2));
  query=copyToStringFromClasspath("/org/elasticsearch/index/query/date_range_in_boolean_cached_now.json");
  parsedQuery=queryParser.parse(query).query();
  assertThat(parsedQuery,instanceOf(ConstantScoreQuery.class));
  assertThat(((ConstantScoreQuery)parsedQuery).getFilter(),instanceOf(XBooleanFilter.class));
  assertThat(((XBooleanFilter)((ConstantScoreQuery)parsedQuery).getFilter()).clauses().get(1).getFilter(),instanceOf(NoCacheFilter.class));
  assertThat(((XBooleanFilter)((ConstantScoreQuery)parsedQuery).getFilter()).clauses().size(),is(2));
  query=copyToStringFromClasspath("/org/elasticsearch/index/query/date_range_in_boolean_cached.json");
  parsedQuery=queryParser.parse(query).query();
  assertThat(parsedQuery,instanceOf(ConstantScoreQuery.class));
  assertThat(((ConstantScoreQuery)parsedQuery).getFilter(),instanceOf(CachedFilter.class));
  try {
    SearchContext.setCurrent(new TestSearchContext());
    query=copyToStringFromClasspath("/org/elasticsearch/index/query/has-child.json");
    parsedQuery=queryParser.parse(query).query();
    assertThat(parsedQuery,instanceOf(ConstantScoreQuery.class));
    assertThat(((ConstantScoreQuery)parsedQuery).getFilter(),instanceOf(NoCacheFilter.class));
    query=copyToStringFromClasspath("/org/elasticsearch/index/query/and-filter-cache.json");
    parsedQuery=queryParser.parse(query).query();
    assertThat(parsedQuery,instanceOf(ConstantScoreQuery.class));
    assertThat(((ConstantScoreQuery)parsedQuery).getFilter(),instanceOf(CachedFilter.class));
    query=copyToStringFromClasspath("/org/elasticsearch/index/query/has-child-in-and-filter-cached.json");
    parsedQuery=queryParser.parse(query).query();
    assertThat(parsedQuery,instanceOf(ConstantScoreQuery.class));
    assertThat(((ConstantScoreQuery)parsedQuery).getFilter(),instanceOf(AndFilter.class));
  }
  finally {
    SearchContext.removeCurrent();
  }
}
