{
  createIndex("test");
  ensureGreen();
  CloseIndexResponse closeIndexResponse=client().admin().indices().prepareClose("test").execute().actionGet();
  assertThat(closeIndexResponse.isAcknowledged(),equalTo(true));
  OpenIndexResponse openIndexResponse=client().admin().indices().prepareOpen("test").execute().actionGet();
  assertThat(openIndexResponse.isAcknowledged(),equalTo(true));
  for (  Client client : clients()) {
    ClusterStateResponse clusterStateResponse=client.admin().cluster().prepareState().setLocal(true).execute().actionGet();
    IndexMetaData indexMetaData=clusterStateResponse.getState().metaData().indices().get("test");
    assertThat(indexMetaData.getState(),equalTo(IndexMetaData.State.OPEN));
  }
}
