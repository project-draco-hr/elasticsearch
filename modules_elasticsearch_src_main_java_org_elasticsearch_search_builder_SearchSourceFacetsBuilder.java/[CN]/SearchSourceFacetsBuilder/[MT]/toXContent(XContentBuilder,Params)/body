{
  if (queryFacets == null && termsFacets == null && statisticalFacets == null && histogramFacets == null && scriptStatisticalFacets == null) {
    return;
  }
  builder.field("facets");
  builder.startObject();
  if (queryFacets != null) {
    for (    BuilderQueryFacet queryFacet : queryFacets) {
      builder.startObject(queryFacet.name());
      builder.field(QueryFacetCollectorParser.NAME);
      queryFacet.queryBuilder().toXContent(builder,params);
      if (queryFacet.filter() != null) {
        builder.field("filter");
        queryFacet.filter().toXContent(builder,params);
      }
      if (queryFacet.global() != null) {
        builder.field("global",queryFacet.global());
      }
      builder.endObject();
    }
  }
  if (termsFacets != null) {
    for (    BuilderTermsFacet termsFacet : termsFacets) {
      builder.startObject(termsFacet.name());
      builder.startObject(TermsFacetCollectorParser.NAME);
      builder.field("field",termsFacet.fieldName());
      builder.field("size",termsFacet.size());
      builder.endObject();
      if (termsFacet.filter() != null) {
        builder.field("filter");
        termsFacet.filter().toXContent(builder,params);
      }
      if (termsFacet.global() != null) {
        builder.field("global",termsFacet.global());
      }
      builder.endObject();
    }
  }
  if (statisticalFacets != null) {
    for (    BuilderStatisticalFacet statisticalFacet : statisticalFacets) {
      builder.startObject(statisticalFacet.name());
      builder.startObject(StatisticalFacetCollectorParser.NAME);
      builder.field("field",statisticalFacet.fieldName());
      builder.endObject();
      if (statisticalFacet.filter() != null) {
        builder.field("filter");
        statisticalFacet.filter().toXContent(builder,params);
      }
      if (statisticalFacet.global() != null) {
        builder.field("global",statisticalFacet.global());
      }
      builder.endObject();
    }
  }
  if (scriptStatisticalFacets != null) {
    for (    BuilderScriptStatisticalFacet statisticalFacet : scriptStatisticalFacets) {
      builder.startObject(statisticalFacet.name());
      builder.startObject(StatisticalFacetCollectorParser.NAME);
      builder.field("script",statisticalFacet.script());
      if (statisticalFacet.params() != null) {
        builder.field("params");
        builder.map(statisticalFacet.params());
      }
      builder.endObject();
      if (statisticalFacet.filter() != null) {
        builder.field("filter");
        statisticalFacet.filter().toXContent(builder,params);
      }
      if (statisticalFacet.global() != null) {
        builder.field("global",statisticalFacet.global());
      }
      builder.endObject();
    }
  }
  if (histogramFacets != null) {
    for (    BuilderHistogramFacet histogramFacet : histogramFacets) {
      builder.startObject(histogramFacet.name());
      builder.startObject(HistogramFacetCollectorParser.NAME);
      if (histogramFacet.valueFieldName() != null && !histogramFacet.keyFieldName().equals(histogramFacet.valueFieldName())) {
        builder.field("key_field",histogramFacet.keyFieldName());
        builder.field("value_field",histogramFacet.valueFieldName());
      }
 else {
        builder.field("field",histogramFacet.keyFieldName());
      }
      builder.field("interval",histogramFacet.interval());
      builder.field("comparator",histogramFacet.comparatorType().description());
      builder.endObject();
      if (histogramFacet.filter() != null) {
        builder.field("filter");
        histogramFacet.filter().toXContent(builder,params);
      }
      if (histogramFacet.global() != null) {
        builder.field("global",histogramFacet.global());
      }
      builder.endObject();
    }
  }
  builder.endObject();
}
