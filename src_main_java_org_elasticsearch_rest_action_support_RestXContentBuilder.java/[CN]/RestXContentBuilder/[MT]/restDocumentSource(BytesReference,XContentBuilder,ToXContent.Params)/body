{
  Compressor compressor=CompressorFactory.compressor(source);
  if (compressor != null) {
    CompressedStreamInput compressedStreamInput=compressor.streamInput(source.streamInput());
    XContentType contentType=XContentFactory.xContentType(compressedStreamInput);
    compressedStreamInput.resetToBufferStart();
    if (contentType == builder.contentType()) {
      builder.rawField("_source",compressedStreamInput);
    }
 else {
      XContentParser parser=XContentFactory.xContent(contentType).createParser(compressedStreamInput);
      try {
        parser.nextToken();
        builder.field("_source");
        builder.copyCurrentStructure(parser);
      }
  finally {
        parser.close();
      }
    }
  }
 else {
    XContentType contentType=XContentFactory.xContentType(source);
    if (contentType == builder.contentType()) {
      builder.rawField("_source",source);
    }
 else {
      XContentParser parser=XContentFactory.xContent(contentType).createParser(source);
      try {
        parser.nextToken();
        builder.field("_source");
        builder.copyCurrentStructure(parser);
      }
  finally {
        parser.close();
      }
    }
  }
}
