{
  super(index,indexSettings);
  Map<String,SimilarityProvider> similarityProviders=newHashMap();
  if (providerFactories != null) {
    Map<String,Settings> providersSettings=indexSettings.getGroups("index.similarity");
    for (    Map.Entry<String,SimilarityProviderFactory> entry : providerFactories.entrySet()) {
      String similarityName=entry.getKey();
      SimilarityProviderFactory similarityProviderFactory=entry.getValue();
      Settings similaritySettings=providersSettings.get(similarityName);
      if (similaritySettings == null) {
        similaritySettings=ImmutableSettings.Builder.EMPTY_SETTINGS;
      }
      SimilarityProvider similarityProvider=similarityProviderFactory.create(similarityName,similaritySettings);
      similarityProviders.put(similarityName,similarityProvider);
    }
  }
  if (!similarityProviders.containsKey("index")) {
    similarityProviders.put("index",new DefaultSimilarityProvider(index,indexSettings,"index",ImmutableSettings.Builder.EMPTY_SETTINGS));
  }
  if (!similarityProviders.containsKey("search")) {
    similarityProviders.put("search",new DefaultSimilarityProvider(index,indexSettings,"search",ImmutableSettings.Builder.EMPTY_SETTINGS));
  }
  this.similarityProviders=ImmutableMap.copyOf(similarityProviders);
  Map<String,Similarity> similarities=newHashMap();
  for (  SimilarityProvider provider : similarityProviders.values()) {
    similarities.put(provider.name(),provider.get());
  }
  this.similarities=ImmutableMap.copyOf(similarities);
}
