{
  SearchContext sc=SearchContext.current();
  if (sc == null) {
    throw new QueryShardException(this,"inner_hits unsupported");
  }
  InnerHitsContext innerHitsContext;
  if (sc.innerHits() == null) {
    innerHitsContext=new InnerHitsContext(new HashMap<String,InnerHitsContext.BaseInnerHits>());
    sc.innerHits(innerHitsContext);
  }
 else {
    innerHitsContext=sc.innerHits();
  }
  innerHitsContext.addInnerHitDefinition(name,context);
}
