{
  if (allowUnmappedFields) {
    return fieldMapping;
  }
 else   if (mapUnmappedFieldAsString) {
    StringFieldMapper.Builder builder=MapperBuilders.stringField(name);
    return builder.build(new Mapper.BuilderContext(indexSettings.getSettings(),new ContentPath(1))).fieldType();
  }
 else {
    Version indexCreatedVersion=indexSettings.getIndexVersionCreated();
    if (fieldMapping == null && indexCreatedVersion.onOrAfter(Version.V_1_4_0_Beta1)) {
      throw new QueryShardException(this,"Strict field resolution and no field mapping can be found for the field with name [" + name + "]");
    }
 else {
      return fieldMapping;
    }
  }
}
