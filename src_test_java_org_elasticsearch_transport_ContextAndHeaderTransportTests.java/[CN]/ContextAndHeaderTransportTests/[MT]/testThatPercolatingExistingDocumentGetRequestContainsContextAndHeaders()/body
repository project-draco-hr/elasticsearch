{
  indexRandom(false,transportClient().prepareIndex(lookupIndex,".percolator","1").setSource(jsonBuilder().startObject().startObject("query").startObject("match").field("name","star wars").endObject().endObject().endObject()),transportClient().prepareIndex(lookupIndex,"type","1").setSource(jsonBuilder().startObject().field("name","Star Wars - The new republic").endObject()));
  transportClient().admin().indices().prepareRefresh(lookupIndex).get();
  GetRequest getRequest=transportClient().prepareGet(lookupIndex,"type","1").request();
  PercolateResponse response=transportClient().preparePercolate().setDocumentType("type").setGetRequest(getRequest).get();
  assertThat(response.getCount(),is(1l));
  assertGetRequestsContainHeaders();
}
