{
  PutIndexedScriptResponse scriptResponse=transportClient().preparePutIndexedScript(GroovyScriptEngineService.NAME,"my_script",jsonBuilder().startObject().field("script","_score * 10").endObject().string()).get();
  assertThat(scriptResponse.isCreated(),is(true));
  indexRandom(false,false,transportClient().prepareIndex(queryIndex,"type","1").setSource(jsonBuilder().startObject().field("name","Star Wars - The new republic").endObject()));
  transportClient().admin().indices().prepareRefresh(queryIndex).get();
  XContentBuilder builder=jsonBuilder().startObject().startObject("function_score").field("boost_mode","replace").startArray("functions").startObject().startObject("script_score").field("script_id","my_script").field("lang","groovy").endObject().endObject().endArray().endObject().endObject();
  SearchResponse searchResponse=transportClient().prepareSearch(queryIndex).setQuery(builder).get();
  assertNoFailures(searchResponse);
  assertHitCount(searchResponse,1);
  assertThat(searchResponse.getHits().getMaxScore(),is(10.0f));
  assertGetRequestsContainHeaders(".scripts");
  assertRequestsContainHeader(PutIndexedScriptRequest.class);
}
