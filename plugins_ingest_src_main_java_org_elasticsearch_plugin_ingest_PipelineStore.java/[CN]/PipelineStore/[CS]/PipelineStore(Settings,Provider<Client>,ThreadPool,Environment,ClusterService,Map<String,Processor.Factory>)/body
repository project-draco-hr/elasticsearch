{
  super(settings);
  this.threadPool=threadPool;
  this.clusterService=clusterService;
  this.clientProvider=clientProvider;
  this.scrollTimeout=settings.getAsTime("ingest.pipeline.store.scroll.timeout",TimeValue.timeValueSeconds(30));
  this.pipelineUpdateInterval=settings.getAsTime("ingest.pipeline.store.update.interval",TimeValue.timeValueSeconds(1));
  for (  Processor.Factory factory : processors.values()) {
    factory.setConfigDirectory(environment.configFile());
  }
  this.processorFactoryRegistry=Collections.unmodifiableMap(processors);
  clusterService.add(new PipelineStoreListener());
  clusterService.addLifecycleListener(new LifecycleListener(){
    @Override public void beforeClose(){
      try {
        IOUtils.close(processorFactoryRegistry.values());
      }
 catch (      IOException e) {
        throw new RuntimeException(e);
      }
    }
  }
);
}
