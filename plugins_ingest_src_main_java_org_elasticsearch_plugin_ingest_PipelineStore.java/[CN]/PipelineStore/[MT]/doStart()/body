{
  Map<String,Processor.Factory> processorFactories=new HashMap<>();
  TemplateService templateService=new InternalTemplateService(scriptServiceProvider.get());
  for (  Map.Entry<String,ProcessorFactoryProvider> entry : processorFactoryProviders.entrySet()) {
    Processor.Factory processorFactory=entry.getValue().get(environment,templateService);
    processorFactories.put(entry.getKey(),processorFactory);
  }
  this.processorFactoryRegistry=Collections.unmodifiableMap(processorFactories);
}
