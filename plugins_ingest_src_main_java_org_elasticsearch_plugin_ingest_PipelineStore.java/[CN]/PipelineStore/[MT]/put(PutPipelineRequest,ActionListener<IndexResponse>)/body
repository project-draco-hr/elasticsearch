{
  ensureReady();
  try {
    Map<String,Object> pipelineConfig=XContentHelper.convertToMap(request.source(),false).v2();
    constructPipeline(request.id(),pipelineConfig);
  }
 catch (  Exception e) {
    throw new IllegalArgumentException("Invalid pipeline configuration",e);
  }
  IndexRequest indexRequest=new IndexRequest(request);
  indexRequest.index(PipelineStore.INDEX);
  indexRequest.type(PipelineStore.TYPE);
  indexRequest.id(request.id());
  indexRequest.source(request.source());
  indexRequest.refresh(true);
  client.index(indexRequest,handleWriteResponseAndReloadPipelines(listener));
}
