{
  int changed=0;
  Map<String,PipelineReference> newPipelines=new HashMap<>(pipelines);
  for (  SearchHit hit : configDocReader.readAll()) {
    String pipelineId=hit.getId();
    BytesReference pipelineSource=hit.getSourceRef();
    PipelineReference previous=newPipelines.get(pipelineId);
    if (previous != null) {
      if (previous.getSource().equals(pipelineSource)) {
        continue;
      }
    }
    changed++;
    Pipeline.Builder builder=new Pipeline.Builder(hit.sourceAsMap(),processorFactoryRegistry);
    newPipelines.put(pipelineId,new PipelineReference(builder.build(),hit.getVersion(),pipelineSource));
  }
  if (changed != 0) {
    logger.debug("adding or updating [{}] pipelines",changed);
    pipelines=newPipelines;
  }
 else {
    logger.debug("adding no new pipelines");
  }
}
