{
  Settings settings=Settings.EMPTY;
  ClusterName test=new ClusterName("test");
  NetworkHandle handleA=startServices("TS_A",settings,Version.CURRENT,test);
  NetworkHandle handleB=startServices("TS_B",settings,VersionUtils.getPreviousVersion(Version.CURRENT.minimumCompatibilityVersion()),test);
  try {
    handleA.transportService.connectToNodeLightAndHandshake(new DiscoveryNode("",handleB.discoveryNode.getAddress(),emptyMap(),emptySet(),Version.CURRENT.minimumCompatibilityVersion()),timeout);
    fail("expected handshake to fail from incompatible versions");
  }
 catch (  ConnectTransportException e) {
    assertThat(e.getMessage(),containsString("handshake failed, incompatible version"));
  }
}
