{
  NettyTransport transport=new NettyTransport(settings,threadPool,new NetworkService(settings),BigArrays.NON_RECYCLING_INSTANCE,new NamedWriteableRegistry(),new NoneCircuitBreakerService());
  TransportService transportService=new MockTransportService(settings,transport,threadPool);
  transportService.start();
  transportService.acceptIncomingRequests();
  DiscoveryNode node=new DiscoveryNode(nodeNameAndId,nodeNameAndId,transportService.boundAddress().publishAddress(),emptyMap(),emptySet(),version);
  transportService.setLocalNode(node);
  transportServices.add(transportService);
  return new NetworkHandle(transportService,node);
}
