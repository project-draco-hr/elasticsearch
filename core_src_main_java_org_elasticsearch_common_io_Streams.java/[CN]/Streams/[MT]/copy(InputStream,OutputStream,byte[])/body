{
  Preconditions.checkNotNull(in,"No InputStream specified");
  Preconditions.checkNotNull(out,"No OutputStream specified");
  try {
    long byteCount=0;
    int bytesRead;
    while ((bytesRead=in.read(buffer)) != -1) {
      out.write(buffer,0,bytesRead);
      byteCount+=bytesRead;
    }
    out.flush();
    return byteCount;
  }
  finally {
    try {
      in.close();
    }
 catch (    IOException ex) {
    }
    try {
      out.close();
    }
 catch (    IOException ex) {
    }
  }
}
