{
  IndexWriterConfig iwc=newIndexWriterConfig();
  TranslogConfig translogConfig=new TranslogConfig(shardId,translogPath,new IndexSettings(shardId.index(),indexSettings,Collections.EMPTY_LIST),Translog.Durabilty.REQUEST,BigArrays.NON_RECYCLING_INSTANCE,threadPool);
  EngineConfig config=new EngineConfig(shardId,threadPool,new ShardIndexingService(shardId,new IndexSettings(shardId.index(),indexSettings,Collections.EMPTY_LIST)),indexSettings,null,store,createSnapshotDeletionPolicy(),mergePolicy,mergeSchedulerConfig,iwc.getAnalyzer(),iwc.getSimilarity(),new CodecService(INDEX_SETTINGS,null),new Engine.EventListener(){
    @Override public void onFailedEngine(    String reason,    @Nullable Throwable t){
    }
  }
,null,IndexSearcher.getDefaultQueryCache(),IndexSearcher.getDefaultQueryCachingPolicy(),translogConfig);
  try {
    config.setCreate(Lucene.indexExists(store.directory()) == false);
  }
 catch (  IOException e) {
    throw new ElasticsearchException("can't find index?",e);
  }
  return config;
}
