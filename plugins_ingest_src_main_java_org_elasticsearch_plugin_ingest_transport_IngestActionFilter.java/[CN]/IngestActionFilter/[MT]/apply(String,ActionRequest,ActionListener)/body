{
  String pipelineId=request.getFromContext(IngestPlugin.INGEST_CONTEXT_KEY);
  if (pipelineId == null) {
    pipelineId=request.getHeader(IngestPlugin.INGEST_PARAM);
    if (pipelineId == null) {
      return true;
    }
  }
  Pipeline pipeline=pipelineStore.get(pipelineId);
  if (pipeline == null) {
    return true;
  }
  if (request instanceof IndexRequest) {
    processIndexRequest((IndexRequest)request,pipeline);
  }
 else   if (request instanceof BulkRequest) {
    BulkRequest bulkRequest=(BulkRequest)request;
    List<ActionRequest> actionRequests=bulkRequest.requests();
    for (    ActionRequest actionRequest : actionRequests) {
      if (actionRequest instanceof IndexRequest) {
        processIndexRequest((IndexRequest)actionRequest,pipeline);
      }
    }
  }
  return true;
}
