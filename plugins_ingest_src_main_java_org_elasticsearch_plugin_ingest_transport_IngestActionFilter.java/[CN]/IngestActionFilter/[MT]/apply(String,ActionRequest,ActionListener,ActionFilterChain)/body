{
  String pipelineId=request.getFromContext(IngestPlugin.PIPELINE_ID_PARAM_CONTEXT_KEY);
  if (pipelineId == null) {
    pipelineId=request.getHeader(IngestPlugin.PIPELINE_ID_PARAM);
    if (pipelineId == null) {
      chain.proceed(action,request,listener);
      return;
    }
  }
  if (request instanceof IndexRequest) {
    processIndexRequest(action,listener,chain,(IndexRequest)request,pipelineId);
  }
 else   if (request instanceof BulkRequest) {
    BulkRequest bulkRequest=(BulkRequest)request;
    @SuppressWarnings("unchecked") ActionListener<BulkResponse> actionListener=(ActionListener<BulkResponse>)listener;
    processBulkIndexRequest(bulkRequest,pipelineId,action,chain,actionListener);
  }
 else {
    chain.proceed(action,request,listener);
  }
}
