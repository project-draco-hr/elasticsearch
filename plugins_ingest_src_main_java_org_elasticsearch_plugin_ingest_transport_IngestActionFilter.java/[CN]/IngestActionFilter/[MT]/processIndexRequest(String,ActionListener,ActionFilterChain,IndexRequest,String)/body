{
  if (indexRequest.hasHeader(IngestPlugin.PIPELINE_ALREADY_PROCESSED)) {
    chain.proceed(action,indexRequest,listener);
    return;
  }
  executionService.execute(indexRequest,pipelineId,new PipelineExecutionService.Listener(){
    @Override public void executed(    IngestDocument ingestDocument){
      indexRequest.putHeader(IngestPlugin.PIPELINE_ALREADY_PROCESSED,true);
      chain.proceed(action,indexRequest,listener);
    }
    @Override public void failed(    Throwable e){
      logger.error("failed to execute pipeline [{}]",e,pipelineId);
      listener.onFailure(e);
    }
  }
);
}
