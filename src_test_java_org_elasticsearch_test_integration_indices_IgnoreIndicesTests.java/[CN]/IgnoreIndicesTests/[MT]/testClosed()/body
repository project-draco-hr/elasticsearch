{
  client.admin().indices().prepareDelete().execute().actionGet();
  client.admin().indices().prepareCreate("test1").execute().actionGet();
  client.admin().indices().prepareCreate("test2").execute().actionGet();
  ClusterHealthResponse clusterHealthResponse=client.admin().cluster().prepareHealth().setWaitForYellowStatus().execute().actionGet();
  assertThat(clusterHealthResponse.isTimedOut(),equalTo(false));
  client.prepareSearch("test1","test2").setQuery(QueryBuilders.matchAllQuery()).execute().actionGet();
  client.admin().indices().prepareClose("test2").execute().actionGet();
  clusterHealthResponse=client.admin().cluster().prepareHealth().setWaitForYellowStatus().execute().actionGet();
  assertThat(clusterHealthResponse.isTimedOut(),equalTo(false));
  try {
    client.prepareSearch("test1","test2").setQuery(QueryBuilders.matchAllQuery()).execute().actionGet();
    fail("Exception should have been thrown");
  }
 catch (  ClusterBlockException e) {
  }
  try {
    client.prepareCount("test1","test2").setQuery(QueryBuilders.matchAllQuery()).execute().actionGet();
    fail("Exception should have been thrown");
  }
 catch (  ClusterBlockException e) {
  }
}
