{
  cluster().ensureAtLeastNumNodes(2);
  createIndex("test1","test2");
  ensureGreen();
  client().prepareSearch("test1","test2").setQuery(QueryBuilders.matchAllQuery()).execute().actionGet();
  CloseIndexResponse closeIndexResponse=client().admin().indices().prepareClose("test2").execute().actionGet();
  assertThat(closeIndexResponse.isAcknowledged(),equalTo(true));
  try {
    client().prepareSearch("test1","test2").setQuery(QueryBuilders.matchAllQuery()).execute().actionGet();
    fail("Exception should have been thrown");
  }
 catch (  ClusterBlockException e) {
  }
  try {
    client().prepareCount("test1","test2").setQuery(QueryBuilders.matchAllQuery()).execute().actionGet();
    fail("Exception should have been thrown");
  }
 catch (  ClusterBlockException e) {
  }
}
