{
  createIndex("test");
  index("test","type","1","f",1);
  PutWarmerResponse putWarmerResponse=client().admin().indices().preparePutWarmer("custom_warmer").setTimeout("0s").setSearchRequest(client().prepareSearch("test").setTypes("test").setQuery(QueryBuilders.matchAllQuery())).get();
  assertThat(putWarmerResponse.isAcknowledged(),equalTo(false));
  assertTrue(awaitBusy(new Predicate<Object>(){
    @Override public boolean apply(    Object input){
      for (      Client client : clients()) {
        GetWarmersResponse getWarmersResponse=client.admin().indices().prepareGetWarmers().setLocal(true).get();
        if (getWarmersResponse.warmers().size() != 1) {
          return false;
        }
      }
      return true;
    }
  }
));
  assertAcked(client().admin().indices().prepareDeleteWarmer().setIndices("test").setNames("custom_warmer"));
}
