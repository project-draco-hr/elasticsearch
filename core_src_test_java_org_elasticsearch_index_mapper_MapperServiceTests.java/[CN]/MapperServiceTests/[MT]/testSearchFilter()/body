{
  IndexService indexService=createIndex("index1",client().admin().indices().prepareCreate("index1").addMapping("type1","field1","type=nested").addMapping("type2",new Object[0]));
  Query searchFilter=indexService.mapperService().searchFilter("type1","type3");
  Query expectedQuery=new BooleanQuery.Builder().add(new BooleanQuery.Builder().add(new ConstantScoreQuery(new TermQuery(new Term(TypeFieldMapper.NAME,"type1"))),BooleanClause.Occur.SHOULD).add(new TermQuery(new Term(TypeFieldMapper.NAME,"type3")),BooleanClause.Occur.SHOULD).build(),BooleanClause.Occur.MUST).add(Queries.newNonNestedFilter(),BooleanClause.Occur.MUST).build();
  assertThat(searchFilter,equalTo(new ConstantScoreQuery(expectedQuery)));
}
