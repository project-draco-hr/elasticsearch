{
  Response response=new Response();
  response.items=new ArrayList<Response.Item>(request.items.size());
  for (  Request.Item item : request.items) {
    Response.Item responseItem;
    int slot=item.slot;
    try {
      responseItem=new Response.Item(slot,percolatorService.percolate(item.request));
    }
 catch (    Throwable e) {
      logger.debug("[{}][{}] failed to multi percolate",e,request.index(),request.shardId());
      if (TransportActions.isShardNotAvailableException(e)) {
        throw new ElasticSearchException("",e);
      }
 else {
        responseItem=new Response.Item(slot,new StringText(ExceptionsHelper.detailedMessage(e)));
      }
    }
    response.items.add(responseItem);
  }
  return response;
}
