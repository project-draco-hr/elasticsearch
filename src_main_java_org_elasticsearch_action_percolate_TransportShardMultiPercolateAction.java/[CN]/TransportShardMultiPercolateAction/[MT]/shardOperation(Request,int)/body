{
  Response response=new Response();
  response.items=new ArrayList<Response.Item>(request.items.size());
  for (  Request.Item item : request.items) {
    Response.Item responseItem=new Response.Item();
    responseItem.slot=item.slot;
    try {
      responseItem.response=percolatorService.percolate(item.request);
    }
 catch (    Throwable e) {
      logger.debug("[{}][{}] failed to multi percolate",e,request.index(),request.shardId());
      if (TransportActions.isShardNotAvailableException(e)) {
        throw new ElasticSearchException("",e);
      }
 else {
        responseItem.error=new StringText(ExceptionsHelper.detailedMessage(e));
      }
    }
    response.items.add(responseItem);
  }
  return response;
}
