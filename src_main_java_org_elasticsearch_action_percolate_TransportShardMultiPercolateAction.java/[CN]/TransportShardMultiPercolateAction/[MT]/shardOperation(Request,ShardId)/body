{
  Response response=new Response();
  response.items=new ArrayList<>(request.items.size());
  for (  Request.Item item : request.items) {
    Response.Item responseItem;
    int slot=item.slot;
    try {
      responseItem=new Response.Item(slot,percolatorService.percolate(item.request));
    }
 catch (    Throwable t) {
      if (TransportActions.isShardNotAvailableException(t)) {
        throw (ElasticsearchException)t;
      }
 else {
        logger.debug("{} failed to multi percolate",t,request.shardId());
        responseItem=new Response.Item(slot,new StringText(ExceptionsHelper.detailedMessage(t)));
      }
    }
    response.items.add(responseItem);
  }
  return response;
}
