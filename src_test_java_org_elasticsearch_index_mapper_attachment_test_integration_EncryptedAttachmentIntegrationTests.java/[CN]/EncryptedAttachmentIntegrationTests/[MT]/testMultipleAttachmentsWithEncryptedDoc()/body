{
  ignore_errors=true;
  logger.info("creating index [test]");
  createIndex("test");
  String mapping=copyToStringFromClasspath("/org/elasticsearch/index/mapper/attachment/test/integration/encrypted/test-mapping.json");
  byte[] html=copyToBytesFromClasspath("/org/elasticsearch/index/mapper/attachment/test/sample-files/htmlWithValidDateMeta.html");
  byte[] pdf=copyToBytesFromClasspath("/org/elasticsearch/index/mapper/attachment/test/sample-files/encrypted.pdf");
  client().admin().indices().putMapping(putMappingRequest("test").type("person").source(mapping)).actionGet();
  index("test","person",jsonBuilder().startObject().field("file1",html).field("file2",pdf).field("hello","world").endObject());
  refresh();
  CountResponse countResponse=client().prepareCount("test").setQuery(queryStringQuery("World").defaultField("file1")).execute().get();
  assertThat(countResponse.getCount(),equalTo(1l));
  countResponse=client().prepareCount("test").setQuery(queryStringQuery("World").defaultField("hello")).execute().get();
  assertThat(countResponse.getCount(),equalTo(1l));
}
