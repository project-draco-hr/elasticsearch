{
  final String file=fileInfo.physicalName();
  final byte[] buffer=new byte[BUFFER_SIZE];
  try (IndexInput indexInput=store.openVerifyingInput(file,IOContext.READONCE,fileInfo.metadata())){
    for (int i=0; i < fileInfo.numberOfParts(); i++) {
      final InputStreamIndexInput inputStreamIndexInput=new InputStreamIndexInput(indexInput,fileInfo.partBytes());
      InputStream inputStream=snapshotRateLimiter == null ? inputStreamIndexInput : new RateLimitingInputStream(inputStreamIndexInput,snapshotRateLimiter,snapshotThrottleListener);
      inputStream=new AbortableInputStream(inputStream,fileInfo.physicalName());
      blobContainer.writeBlob(fileInfo.partName(i),inputStream,fileInfo.partBytes());
    }
    Store.verify(indexInput);
    snapshotStatus.addProcessedFile(fileInfo.length());
  }
 catch (  Throwable t) {
    failStoreIfCorrupted(t);
    snapshotStatus.addProcessedFile(0);
    throw t;
  }
}
