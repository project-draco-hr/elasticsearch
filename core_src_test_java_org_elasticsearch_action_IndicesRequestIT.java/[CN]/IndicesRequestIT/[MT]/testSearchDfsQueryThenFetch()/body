{
  interceptTransportActions(SearchServiceTransportAction.DFS_ACTION_NAME,SearchServiceTransportAction.QUERY_ID_ACTION_NAME,SearchServiceTransportAction.FETCH_ID_ACTION_NAME,SearchServiceTransportAction.FREE_CONTEXT_ACTION_NAME);
  String[] randomIndicesOrAliases=randomIndicesOrAliases();
  for (int i=0; i < randomIndicesOrAliases.length; i++) {
    client().prepareIndex(randomIndicesOrAliases[i],"type","id-" + i).setSource("field","value").get();
  }
  refresh();
  SearchRequest searchRequest=new SearchRequest(randomIndicesOrAliases).searchType(SearchType.DFS_QUERY_THEN_FETCH);
  SearchResponse searchResponse=internalCluster().clientNodeClient().search(searchRequest).actionGet();
  assertNoFailures(searchResponse);
  assertThat(searchResponse.getHits().totalHits(),greaterThan(0l));
  clearInterceptedActions();
  assertSameIndices(searchRequest,SearchServiceTransportAction.DFS_ACTION_NAME,SearchServiceTransportAction.QUERY_ID_ACTION_NAME,SearchServiceTransportAction.FETCH_ID_ACTION_NAME);
  assertSameIndicesOptionalRequests(searchRequest,SearchServiceTransportAction.FREE_CONTEXT_ACTION_NAME);
}
