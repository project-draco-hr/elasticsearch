{
  client().admin().indices().prepareCreate("test").setSettings(ImmutableSettings.builder().put("number_of_replicas",0));
  client().prepareIndex("test","foo").setSource("field","foo").get();
  refresh();
  assertTotalCompoundSegments(2,2,"test");
  client().admin().indices().prepareUpdateSettings("test").setSettings(ImmutableSettings.builder().put(RobinEngine.INDEX_COMPOUND_ON_FLUSH,false)).get();
  client().prepareIndex("test","foo").setSource("field","foo").get();
  refresh();
  assertTotalCompoundSegments(2,4,"test");
  client().admin().indices().prepareUpdateSettings("test").setSettings(ImmutableSettings.builder().put(RobinEngine.INDEX_COMPOUND_ON_FLUSH,true)).get();
  client().prepareIndex("test","foo").setSource("field","foo").get();
  refresh();
  assertTotalCompoundSegments(4,6,"test");
}
