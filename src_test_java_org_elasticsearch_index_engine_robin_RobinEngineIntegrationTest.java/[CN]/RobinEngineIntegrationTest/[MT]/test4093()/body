{
  assertAcked(prepareCreate("test").setSettings(ImmutableSettings.settingsBuilder().put("index.store.type","memory").put("cache.memory.large_cache_size",new ByteSizeValue(1,ByteSizeUnit.MB)).put("index.number_of_shards","1").put("index.number_of_replicas","0").put("gateway.type","none").put(RobinEngine.INDEX_COMPOUND_ON_FLUSH,randomBoolean()).put("index.warmer.enabled",false).build()).get());
  NodesInfoResponse nodeInfos=client().admin().cluster().prepareNodesInfo().setJvm(true).get();
  NodeInfo[] nodes=nodeInfos.getNodes();
  for (  NodeInfo info : nodes) {
    ByteSizeValue directMemoryMax=info.getJvm().getMem().getDirectMemoryMax();
    logger.debug("  --> JVM max direct memory for node [{}] is set to [{}]",info.getNode().getName(),directMemoryMax);
  }
  final int numDocs=between(100,500);
  logger.debug("  --> Indexing [{}] documents",numDocs);
  for (int i=0; i < numDocs; i++) {
    if ((i + 1) % 10 == 0) {
      logger.debug("  --> Indexed [{}] documents",i + 1);
    }
    client().prepareIndex("test","type1").setSource("a","" + i).setRefresh(true).execute().actionGet();
  }
  logger.debug("  --> Done indexing [{}] documents",numDocs);
  assertHitCount(client().prepareCount("test").setQuery(QueryBuilders.matchAllQuery()).get(),numDocs);
}
