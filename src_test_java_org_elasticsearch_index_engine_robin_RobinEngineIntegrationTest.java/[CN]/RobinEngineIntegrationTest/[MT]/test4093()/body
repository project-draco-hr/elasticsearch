{
  cluster().ensureAtMostNumNodes(1);
  assertAcked(prepareCreate("test").setSettings(ImmutableSettings.settingsBuilder().put("index.store.type","memory").put("cache.memory.large_cache_size",new ByteSizeValue(10,ByteSizeUnit.MB)).put("index.number_of_shards","1").put("index.number_of_replicas","0").put("gateway.type","none").put(RobinEngine.INDEX_COMPOUND_ON_FLUSH,randomBoolean()).put("index.warmer.enabled",false).build()).get());
  NodesInfoResponse nodeInfos=client().admin().cluster().prepareNodesInfo().setJvm(true).get();
  NodeInfo[] nodes=nodeInfos.getNodes();
  for (  NodeInfo info : nodes) {
    ByteSizeValue directMemoryMax=info.getJvm().getMem().getDirectMemoryMax();
    logger.info(" JVM max direct memory for node [{}] is set to [{}]",info.getNode().getName(),directMemoryMax);
  }
  final int iters=between(500,1000);
  for (int i=0; i < iters; i++) {
    client().prepareIndex("test","type1").setSource("a","" + i).setRefresh(true).execute().actionGet();
  }
  assertHitCount(client().prepareCount("test").setQuery(QueryBuilders.matchAllQuery()).get(),iters);
}
