{
  flush(new Flush().type(Flush.Type.COMMIT).waitIfOngoing(true));
  try (InternalLock _=readLock.acquire()){
    ensureOpen();
    return deletionPolicy.snapshot();
  }
 catch (  IOException e) {
    throw new SnapshotFailedEngineException(shardId,e);
  }
}
