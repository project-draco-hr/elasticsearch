{
  try {
    Method method=IndexWriter.class.getDeclaredMethod("waitForMerges");
    method.setAccessible(true);
    method.invoke(currentIndexWriter());
  }
 catch (  ReflectiveOperationException e) {
    throw new OptimizeFailedEngineException(shardId,e);
  }
  if (flushAfter) {
    flush(new Flush().force(true).waitIfOngoing(true));
  }
}
