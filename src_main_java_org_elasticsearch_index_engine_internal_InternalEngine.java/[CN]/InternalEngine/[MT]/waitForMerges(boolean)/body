{
  try {
    currentIndexWriter().waitForMerges();
  }
 catch (  IOException e) {
    throw new OptimizeFailedEngineException(shardId,e);
  }
  if (flushAfter) {
    flush(new Flush().force(true).waitIfOngoing(true));
  }
}
