{
  if (optimizeAutoGenerateId && create.autoGeneratedId() && !create.canHaveDuplicates()) {
    innerCreateNoLock(create,writer,Versions.NOT_FOUND,null);
  }
 else {
synchronized (dirtyLock(create.uid())) {
      final long currentVersion;
      final VersionValue versionValue;
      versionValue=versionMap.getUnderLock(create.uid().bytes());
      if (versionValue == null) {
        currentVersion=loadCurrentVersionFromIndex(create.uid());
      }
 else {
        if (enableGcDeletes && versionValue.delete() && (threadPool.estimatedTimeInMillis() - versionValue.time()) > gcDeletesInMillis) {
          currentVersion=Versions.NOT_FOUND;
        }
 else {
          currentVersion=versionValue.version();
        }
      }
      innerCreateNoLock(create,writer,currentVersion,versionValue);
    }
  }
}
