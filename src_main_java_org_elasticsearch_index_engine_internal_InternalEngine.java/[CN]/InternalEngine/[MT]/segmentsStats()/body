{
  try (InternalLock _=readLock.acquire()){
    ensureOpen();
    Searcher searcher=acquireSearcher("segments_stats");
    try {
      SegmentsStats stats=new SegmentsStats();
      for (      AtomicReaderContext reader : searcher.reader().leaves()) {
        stats.add(1,getReaderRamBytesUsed(reader));
      }
      stats.addVersionMapMemoryInBytes(versionMap.ramBytesUsed());
      stats.addIndexWriterMemoryInBytes(indexWriter.ramBytesUsed());
      return stats;
    }
  finally {
      searcher.close();
    }
  }
 }
