{
  createIndex("test1");
  ensureGreen();
  client().prepareIndex("test1","bar",Integer.toString(1)).setSource("{\"bar\":\"bar\",\"baz\":\"baz\"}").execute().actionGet();
  client().prepareIndex("test1","baz",Integer.toString(1)).setSource("{\"bar\":\"bar\",\"baz\":\"baz\"}").execute().actionGet();
  refresh();
  client().prepareSearch("_all").addSort("bar",SortOrder.ASC).addSort("baz",SortOrder.ASC).execute().actionGet();
  IndicesStatsRequestBuilder builder=client().admin().indices().prepareStats();
  IndicesStatsResponse stats=builder.execute().actionGet();
  assertThat(stats.getTotal().fieldData.getMemorySizeInBytes(),greaterThan(0l));
  assertThat(stats.getTotal().fieldData.getFields(),is(nullValue()));
  stats=builder.setFieldDataFields("bar").execute().actionGet();
  assertThat(stats.getTotal().fieldData.getMemorySizeInBytes(),greaterThan(0l));
  assertThat(stats.getTotal().fieldData.getFields().containsKey("bar"),is(true));
  assertThat(stats.getTotal().fieldData.getFields().get("bar"),greaterThan(0l));
  assertThat(stats.getTotal().fieldData.getFields().containsKey("baz"),is(false));
  stats=builder.setFieldDataFields("bar","baz").execute().actionGet();
  assertThat(stats.getTotal().fieldData.getMemorySizeInBytes(),greaterThan(0l));
  assertThat(stats.getTotal().fieldData.getFields().containsKey("bar"),is(true));
  assertThat(stats.getTotal().fieldData.getFields().get("bar"),greaterThan(0l));
  assertThat(stats.getTotal().fieldData.getFields().containsKey("baz"),is(true));
  assertThat(stats.getTotal().fieldData.getFields().get("baz"),greaterThan(0l));
  stats=builder.setFieldDataFields("*").execute().actionGet();
  assertThat(stats.getTotal().fieldData.getMemorySizeInBytes(),greaterThan(0l));
  assertThat(stats.getTotal().fieldData.getFields().containsKey("bar"),is(true));
  assertThat(stats.getTotal().fieldData.getFields().get("bar"),greaterThan(0l));
  assertThat(stats.getTotal().fieldData.getFields().containsKey("baz"),is(true));
  assertThat(stats.getTotal().fieldData.getFields().get("baz"),greaterThan(0l));
  stats=builder.setFieldDataFields("*r").execute().actionGet();
  assertThat(stats.getTotal().fieldData.getMemorySizeInBytes(),greaterThan(0l));
  assertThat(stats.getTotal().fieldData.getFields().containsKey("bar"),is(true));
  assertThat(stats.getTotal().fieldData.getFields().get("bar"),greaterThan(0l));
  assertThat(stats.getTotal().fieldData.getFields().containsKey("baz"),is(false));
}
