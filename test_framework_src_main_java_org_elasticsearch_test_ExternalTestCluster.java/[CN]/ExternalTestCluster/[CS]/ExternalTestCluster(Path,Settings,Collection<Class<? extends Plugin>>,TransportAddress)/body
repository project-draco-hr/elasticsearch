{
  super(0);
  Settings clientSettings=Settings.builder().put(additionalSettings).put("node.name",InternalTestCluster.TRANSPORT_CLIENT_PREFIX + EXTERNAL_CLUSTER_PREFIX + counter.getAndIncrement()).put(InternalSettingsPreparer.IGNORE_SYSTEM_PROPERTIES_SETTING.getKey(),true).put("client.transport.ignore_cluster_name",true).put(Environment.PATH_HOME_SETTING.getKey(),tempDir).put(Node.NODE_MODE_SETTING.getKey(),"network").build();
  TransportClient.Builder transportClientBuilder=TransportClient.builder().settings(clientSettings);
  for (  Class<? extends Plugin> pluginClass : pluginClasses) {
    transportClientBuilder.addPlugin(pluginClass);
  }
  TransportClient client=transportClientBuilder.build();
  try {
    client.addTransportAddresses(transportAddresses);
    NodesInfoResponse nodeInfos=client.admin().cluster().prepareNodesInfo().clear().setSettings(true).setHttp(true).get();
    httpAddresses=new InetSocketAddress[nodeInfos.getNodes().length];
    this.clusterName=nodeInfos.getClusterName().value();
    int dataNodes=0;
    int masterAndDataNodes=0;
    for (int i=0; i < nodeInfos.getNodes().length; i++) {
      NodeInfo nodeInfo=nodeInfos.getNodes()[i];
      httpAddresses[i]=((InetSocketTransportAddress)nodeInfo.getHttp().address().publishAddress()).address();
      if (DiscoveryNode.isDataNode(nodeInfo.getSettings())) {
        dataNodes++;
        masterAndDataNodes++;
      }
 else       if (DiscoveryNode.isMasterNode(nodeInfo.getSettings())) {
        masterAndDataNodes++;
      }
    }
    this.numDataNodes=dataNodes;
    this.numMasterAndDataNodes=masterAndDataNodes;
    this.client=client;
    logger.info("Setup ExternalTestCluster [{}] made of [{}] nodes",nodeInfos.getClusterName().value(),size());
  }
 catch (  Exception e) {
    client.close();
    throw e;
  }
}
