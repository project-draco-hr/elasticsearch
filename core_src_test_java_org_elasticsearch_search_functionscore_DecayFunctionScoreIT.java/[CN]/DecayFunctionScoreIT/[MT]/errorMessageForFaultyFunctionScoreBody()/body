{
  assertAcked(prepareCreate("test").addMapping("type",jsonBuilder().startObject().startObject("type").startObject("properties").startObject("test").field("type","string").endObject().startObject("num").field("type","double").endObject().endObject().endObject().endObject()));
  ensureYellow();
  client().index(indexRequest("test").type("type").source(jsonBuilder().startObject().field("test","value").field("num",1.0).endObject())).actionGet();
  refresh();
  XContentBuilder query=XContentFactory.jsonBuilder();
  query.startObject().startObject("function_score").field("weight","1").startArray("functions").startObject().startObject("script_score").field("script","3").endObject().endObject().endArray().endObject().endObject();
  try {
    client().search(searchRequest().source(searchSource().query(query))).actionGet();
    fail("Search should result in SearchPhaseExecutionException");
  }
 catch (  SearchPhaseExecutionException e) {
    logger.info(e.shardFailures()[0].reason());
    assertThat(e.shardFailures()[0].reason(),containsString("already found [weight], now encountering [functions]."));
  }
  query=XContentFactory.jsonBuilder();
  query.startObject().startObject("function_score").startObject("random_score").field("seed",3).endObject().startArray("functions").startObject().startObject("random_score").field("seed",3).endObject().endObject().endArray().endObject().endObject();
  try {
    client().search(searchRequest().source(searchSource().query(query))).actionGet();
    fail("Search should result in SearchPhaseExecutionException");
  }
 catch (  SearchPhaseExecutionException e) {
    logger.info(e.shardFailures()[0].reason());
    assertThat(e.shardFailures()[0].reason(),containsString("already found [random_score], now encountering [functions]"));
    assertThat(e.shardFailures()[0].reason(),not(containsString("did you mean [boost] instead?")));
  }
}
