{
  assertAcked(prepareCreate("test").addMapping("type",jsonBuilder().startObject().startObject("type").startObject("properties").startObject("test").field("type","string").endObject().startObject("num").field("type","double").endObject().endObject().endObject().endObject()));
  ensureYellow();
  client().index(indexRequest("test").type("type").source(jsonBuilder().startObject().field("test","value").field("num",1.0).endObject())).actionGet();
  refresh();
  try {
    client().search(searchRequest().source(new SearchSourceBuilder().query(QueryBuilders.functionScoreQuery(ScoreFunctionBuilders.scriptFunction(new Script("3")).setWeight(1.0f))))).actionGet();
    fail("Search should result in SearchPhaseExecutionException");
  }
 catch (  SearchPhaseExecutionException e) {
    logger.info(e.shardFailures()[0].reason());
    assertThat(e.shardFailures()[0].reason(),containsString("already found [weight], now encountering [functions]."));
  }
  try {
    client().search(searchRequest().source(new SearchSourceBuilder().query(QueryBuilders.functionScoreQuery(ScoreFunctionBuilders.randomFunction(3))))).actionGet();
    fail("Search should result in SearchPhaseExecutionException");
  }
 catch (  SearchPhaseExecutionException e) {
    logger.info(e.shardFailures()[0].reason());
    assertThat(e.shardFailures()[0].reason(),containsString("already found [random_score], now encountering [functions]"));
    assertThat(e.shardFailures()[0].reason(),not(containsString("did you mean [boost] instead?")));
  }
}
