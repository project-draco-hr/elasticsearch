{
  IndexService indexService=indicesService.indexServiceSafe(request.index());
  IndexShard indexShard=indexService.shardSafe(request.shardId());
  Engine.Searcher engineSearcher=indexShard.searcher();
  SearchShardTarget shardTarget=new SearchShardTarget(clusterService.state().nodes().localNodeId(),request.index(),request.shardId());
  SearchContext context=new SearchContext(idGenerator.incrementAndGet(),shardTarget,request.timeout(),request.queryBoost(),request.source(),request.types(),engineSearcher,indexService);
  context.from(request.from());
  context.size(request.size());
  context.scroll(request.scroll());
  parseSource(context);
  if (context.from() == -1) {
    context.from(0);
  }
  if (context.size() == -1) {
    context.size(10);
  }
  return context;
}
