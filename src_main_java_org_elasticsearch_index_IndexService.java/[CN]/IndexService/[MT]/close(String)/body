{
  if (closed.compareAndSet(false,true)) {
    final Set<Integer> shardIds=shardIds();
    for (    final int shardId : shardIds) {
      try {
        removeShard(shardId,reason);
      }
 catch (      Throwable t) {
        logger.warn("failed to close shard",t);
      }
    }
  }
}
