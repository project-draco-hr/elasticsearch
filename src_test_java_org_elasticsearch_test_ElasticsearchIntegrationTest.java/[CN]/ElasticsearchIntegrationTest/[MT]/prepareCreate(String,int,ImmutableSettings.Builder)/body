{
  internalCluster().ensureAtLeastNumDataNodes(numNodes);
  ImmutableSettings.Builder builder=ImmutableSettings.builder().put(indexSettings()).put(settingsBuilder.build());
  if (numNodes > 0) {
    getExcludeSettings(index,numNodes,builder);
  }
  return client().admin().indices().prepareCreate(index).setSettings(builder.build());
}
