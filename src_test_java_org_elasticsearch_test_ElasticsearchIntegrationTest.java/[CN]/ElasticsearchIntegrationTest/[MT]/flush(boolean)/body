{
  waitForRelocation();
  FlushResponse actionGet=client().admin().indices().prepareFlush().execute().actionGet();
  if (ignoreNotAllowed) {
    for (    ShardOperationFailedException failure : actionGet.getShardFailures()) {
      assertThat("unexpected flush failure " + failure.reason(),failure.status(),equalTo(RestStatus.SERVICE_UNAVAILABLE));
    }
  }
 else {
    assertNoFailures(actionGet);
  }
  return actionGet;
}
