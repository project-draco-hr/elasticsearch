{
  File indexDir=newTempDir();
  File dataDir=new File(indexDir,"data");
  try (FileInputStream stream=new FileInputStream(backwardsIndex)){
    TestUtil.unzip(stream,indexDir.toPath());
  }
   assertTrue(dataDir.exists());
  String[] list=dataDir.list();
  if (list == null || list.length > 1) {
    throw new IllegalStateException("Backwards index must contain exactly one cluster");
  }
  File src=new File(dataDir,list[0]);
  File dest=new File(dataDir,internalCluster().getClusterName());
  assertTrue(src.exists());
  src.renameTo(dest);
  assertFalse(src.exists());
  assertTrue(dest.exists());
  ImmutableSettings.Builder builder=ImmutableSettings.builder().put(settings).put("gateway.type","local").put("path.data",dataDir.getPath());
  File configDir=new File(indexDir,"config");
  if (configDir.exists()) {
    builder.put("path.conf",configDir.getPath());
  }
  return builder.build();
}
