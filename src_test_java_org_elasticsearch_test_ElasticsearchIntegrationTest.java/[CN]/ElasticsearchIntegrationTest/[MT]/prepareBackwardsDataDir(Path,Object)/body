{
  Path indexDir=createTempDir();
  Path dataDir=indexDir.resolve("data");
  try (InputStream stream=Files.newInputStream(backwardsIndex)){
    TestUtil.unzip(stream,indexDir);
  }
   assertTrue(Files.exists(dataDir));
  final Path[] list;
  try (DirectoryStream<Path> stream=Files.newDirectoryStream(dataDir)){
    List<Path> dirs=new ArrayList<>();
    for (    Path p : stream) {
      if (!p.getFileName().toString().startsWith("extra")) {
        dirs.add(p);
      }
    }
    list=dirs.toArray(new Path[0]);
  }
   if (list.length != 1) {
    throw new IllegalStateException("Backwards index must contain exactly one cluster\n" + StringUtils.join(list,"\n"));
  }
  Path src=list[0];
  Path dest=dataDir.resolve(internalCluster().getClusterName());
  assertTrue(Files.exists(src));
  Files.move(src,dest);
  assertFalse(Files.exists(src));
  assertTrue(Files.exists(dest));
  ImmutableSettings.Builder builder=ImmutableSettings.builder().put(settings).put("path.data",dataDir.toAbsolutePath());
  Path configDir=indexDir.resolve("config");
  if (Files.exists(configDir)) {
    builder.put("path.conf",configDir.toAbsolutePath());
  }
  return builder.build();
}
