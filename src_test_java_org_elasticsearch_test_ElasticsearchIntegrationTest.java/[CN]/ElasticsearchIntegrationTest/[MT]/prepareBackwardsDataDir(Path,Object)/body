{
  Path indexDir=newTempDirPath();
  Path dataDir=indexDir.resolve("data");
  try (InputStream stream=Files.newInputStream(backwardsIndex)){
    TestUtil.unzip(stream,indexDir);
  }
   assertTrue(Files.exists(dataDir));
  Path[] list=FileSystemUtils.files(dataDir);
  if (list.length != 1) {
    throw new IllegalStateException("Backwards index must contain exactly one cluster");
  }
  Path src=list[0];
  Path dest=dataDir.resolve(internalCluster().getClusterName());
  assertTrue(Files.exists(src));
  Files.move(src,dest);
  assertFalse(Files.exists(src));
  assertTrue(Files.exists(dest));
  ImmutableSettings.Builder builder=ImmutableSettings.builder().put(settings).put("gateway.type","local").put("path.data",dataDir.toAbsolutePath());
  Path configDir=indexDir.resolve("config");
  if (Files.exists(configDir)) {
    builder.put("path.conf",configDir.toAbsolutePath());
  }
  return builder.build();
}
