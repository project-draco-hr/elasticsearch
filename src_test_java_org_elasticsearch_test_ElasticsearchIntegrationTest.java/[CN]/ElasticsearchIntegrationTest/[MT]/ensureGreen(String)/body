{
  ClusterHealthResponse actionGet=client().admin().cluster().health(Requests.clusterHealthRequest(indices).waitForGreenStatus().waitForEvents(Priority.LANGUID).waitForRelocatingShards(0)).actionGet();
  if (actionGet.isTimedOut()) {
    logger.info("ensureGreen timed out, cluster state:\n{}\n{}",client().admin().cluster().prepareState().get().getState().prettyPrint(),client().admin().cluster().preparePendingClusterTasks().get().prettyPrint());
    assertThat("timed out waiting for green state",actionGet.isTimedOut(),equalTo(false));
  }
  assertThat(actionGet.getStatus(),equalTo(ClusterHealthStatus.GREEN));
  return actionGet.getStatus();
}
