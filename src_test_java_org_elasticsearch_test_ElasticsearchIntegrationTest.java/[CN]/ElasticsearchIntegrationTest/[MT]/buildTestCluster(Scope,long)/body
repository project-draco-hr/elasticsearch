{
  int numClientNodes=InternalTestCluster.DEFAULT_NUM_CLIENT_NODES;
  boolean enableRandomBenchNodes=InternalTestCluster.DEFAULT_ENABLE_RANDOM_BENCH_NODES;
  boolean enableHttpPipelining=InternalTestCluster.DEFAULT_ENABLE_HTTP_PIPELINING;
  int minNumDataNodes=InternalTestCluster.DEFAULT_MIN_NUM_DATA_NODES;
  int maxNumDataNodes=InternalTestCluster.DEFAULT_MAX_NUM_DATA_NODES;
  SettingsSource settingsSource=InternalTestCluster.DEFAULT_SETTINGS_SOURCE;
  final String nodePrefix;
switch (scope) {
case TEST:
    nodePrefix=TEST_CLUSTER_NODE_PREFIX;
  break;
case SUITE:
nodePrefix=SUITE_CLUSTER_NODE_PREFIX;
break;
default :
throw new ElasticsearchException("Scope not supported: " + scope);
}
settingsSource=new SettingsSource(){
@Override public Settings node(int nodeOrdinal){
return ImmutableSettings.builder().put(InternalNode.HTTP_ENABLED,false).put(nodeSettings(nodeOrdinal)).build();
}
@Override public Settings transportClient(){
return transportClientSettings();
}
}
;
int numDataNodes=getNumDataNodes();
if (numDataNodes >= 0) {
minNumDataNodes=maxNumDataNodes=numDataNodes;
}
 else {
minNumDataNodes=getMinNumDataNodes();
maxNumDataNodes=getMaxNumDataNodes();
}
numClientNodes=getNumClientNodes();
enableRandomBenchNodes=enableRandomBenchNodes();
return new InternalTestCluster(seed,minNumDataNodes,maxNumDataNodes,clusterName(scope.name(),Integer.toString(CHILD_JVM_ID),seed),settingsSource,numClientNodes,enableRandomBenchNodes,enableHttpPipelining,CHILD_JVM_ID,nodePrefix);
}
