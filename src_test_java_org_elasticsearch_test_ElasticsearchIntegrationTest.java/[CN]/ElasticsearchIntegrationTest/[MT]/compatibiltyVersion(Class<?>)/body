{
  if (clazz == Object.class || clazz == ElasticsearchIntegrationTest.class) {
    return COMPATIBILITY_VERSION;
  }
  CompatibilityVersion annotation=clazz.getAnnotation(CompatibilityVersion.class);
  if (annotation != null) {
    return Version.smallest(Version.fromId(annotation.version()),COMPATIBILITY_VERSION);
  }
  return compatibiltyVersion(clazz.getSuperclass());
}
