{
  String field=((TermVectorsFetchContext)context.getFetchSubPhaseContext(CONTEXT_FACTORY)).getField();
  if (hitContext.hit().fieldsOrNull() == null) {
    hitContext.hit().fields(new HashMap<String,SearchHitField>());
  }
  SearchHitField hitField=hitContext.hit().fields().get(NAMES[0]);
  if (hitField == null) {
    hitField=new InternalSearchHitField(NAMES[0],new ArrayList<>(1));
    hitContext.hit().fields().put(NAMES[0],hitField);
  }
  TermVectorsResponse termVector=context.indexShard().termVectorsService().getTermVectors(new TermVectorsRequest(context.indexShard().indexService().index().getName(),hitContext.hit().type(),hitContext.hit().id()),context.indexShard().indexService().index().getName());
  try {
    Map<String,Integer> tv=new HashMap<>();
    TermsEnum terms=termVector.getFields().terms(field).iterator();
    BytesRef term;
    while ((term=terms.next()) != null) {
      tv.put(term.utf8ToString(),terms.postings(null,null,PostingsEnum.ALL).freq());
    }
    hitField.values().add(tv);
  }
 catch (  IOException e) {
    e.printStackTrace();
  }
}
