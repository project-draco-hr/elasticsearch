{
  if (state.getType() == RecoveryState.Type.SNAPSHOT) {
    try {
      if (Lucene.isCorruptionException(e.getCause())) {
        restoreService.failRestore(state.getRestoreSource().snapshotId(),shardRouting.shardId());
      }
    }
 catch (    Throwable inner) {
      e.addSuppressed(inner);
    }
 finally {
      handleRecoveryFailure(indexService,shardRouting,sendShardFailure,e);
    }
  }
 else {
    handleRecoveryFailure(indexService,shardRouting,sendShardFailure,e);
  }
}
