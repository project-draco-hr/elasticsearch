{
  ShardRouting shardRouting=null;
  final IndexService indexService=indicesService.indexService(shardId.index().name());
  if (indexService != null) {
    IndexShard indexShard=indexService.shard(shardId.id());
    if (indexShard != null) {
      shardRouting=indexShard.routingEntry();
    }
  }
  if (shardRouting == null) {
    logger.warn("[{}][{}] engine failed, but can't find index shard. failure reason: [{}]",failure,shardId.index().name(),shardId.id(),reason);
    return;
  }
  final ShardRouting fShardRouting=shardRouting;
  threadPool.generic().execute(new Runnable(){
    @Override public void run(){
synchronized (mutex) {
        failAndRemoveShard(fShardRouting,indexService,true,"engine failure, reason [" + reason + "]",failure);
      }
    }
  }
);
}
