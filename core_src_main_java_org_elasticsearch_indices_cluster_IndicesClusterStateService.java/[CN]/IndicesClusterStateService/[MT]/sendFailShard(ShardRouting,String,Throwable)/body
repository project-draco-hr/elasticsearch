{
  try {
    logger.warn("[{}] marking and sending shard failed due to [{}]",failure,shardRouting.shardId(),message);
    failedShardsCache.put(shardRouting.shardId(),shardRouting);
    shardStateAction.shardFailed(shardRouting,shardRouting,message,failure,SHARD_STATE_ACTION_LISTENER);
  }
 catch (  Throwable e1) {
    logger.warn("[{}][{}] failed to mark shard as failed (because of [{}])",e1,shardRouting.getIndexName(),shardRouting.getId(),message);
  }
}
