{
  RoutingNodes.RoutingNodeIterator routingNode=event.state().getRoutingNodes().routingNodeIter(event.state().nodes().localNodeId());
  if (routingNode == null) {
    return;
  }
  for (  ShardRouting shard : routingNode) {
    if (!indicesService.hasIndex(shard.index())) {
      final IndexMetaData indexMetaData=event.state().metaData().index(shard.index());
      if (logger.isDebugEnabled()) {
        logger.debug("[{}] creating index",indexMetaData.getIndex());
      }
      try {
        indicesService.createIndex(indexMetaData);
      }
 catch (      Throwable e) {
        sendFailShard(shard,indexMetaData.getIndexUUID(),"failed to create index",e);
      }
    }
  }
}
