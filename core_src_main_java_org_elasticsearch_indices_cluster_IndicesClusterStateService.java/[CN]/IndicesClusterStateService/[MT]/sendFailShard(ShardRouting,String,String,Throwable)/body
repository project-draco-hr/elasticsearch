{
  try {
    logger.warn("[{}] marking and sending shard failed due to [{}]",failure,shardRouting.shardId(),message);
    failedShards.put(shardRouting.shardId(),new FailedShard(shardRouting.version()));
    shardStateAction.shardFailed(shardRouting,indexUUID,"shard failure [" + message + "]"+ (failure == null ? "" : "[" + detailedMessage(failure) + "]"));
  }
 catch (  Throwable e1) {
    logger.warn("[{}][{}] failed to mark shard as failed (because of [{}])",e1,shardRouting.getIndex(),shardRouting.getId(),message);
  }
}
