{
  indexWriter.addDocument(testDocument());
  indexWriter.commit();
  assertThat(listCommits(dir).size(),equalTo(1));
  indexWriter.addDocument(testDocument());
  indexWriter.commit();
  assertThat(listCommits(dir).size(),equalTo(1));
  SnapshotIndexCommit snapshot=deletionPolicy.snapshot();
  indexWriter.addDocument(testDocument());
  indexWriter.commit();
  assertThat(listCommits(dir).size(),equalTo(2));
  snapshot.close();
  indexWriter.addDocument(testDocument());
  indexWriter.commit();
  assertThat(listCommits(dir).size(),equalTo(1));
}
