{
  indexWriter.addDocument(testDocument());
  indexWriter.commit();
  assertThat(listCommits(dir).size(),equalTo(1));
  SnapshotIndexCommit snapshot1=deletionPolicy.snapshot();
  SnapshotIndexCommit snapshot2=deletionPolicy.snapshot();
  indexWriter.addDocument(testDocument());
  indexWriter.commit();
  assertThat(listCommits(dir).size(),equalTo(2));
  snapshot1.close();
  indexWriter.addDocument(testDocument());
  indexWriter.commit();
  assertThat(listCommits(dir).size(),equalTo(2));
  snapshot2.close();
  indexWriter.addDocument(testDocument());
  indexWriter.commit();
  assertThat(listCommits(dir).size(),equalTo(1));
}
