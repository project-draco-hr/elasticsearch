{
  if (isAllIndices(aliasesOrIndices)) {
    return resolveSearchRoutingAllIndices(routing);
  }
  aliasesOrIndices=convertFromWildcards(aliasesOrIndices,true,IgnoreIndices.MISSING);
  if (aliasesOrIndices.length == 1) {
    return resolveSearchRoutingSingleValue(routing,aliasesOrIndices[0]);
  }
  Map<String,Set<String>> routings=null;
  Set<String> paramRouting=null;
  Set<String> norouting=new HashSet<String>();
  if (routing != null) {
    paramRouting=Strings.splitStringByCommaToSet(routing);
  }
  for (  String aliasOrIndex : aliasesOrIndices) {
    Map<String,AliasMetaData> indexToRoutingMap=aliases.get(aliasOrIndex);
    if (indexToRoutingMap != null && !indexToRoutingMap.isEmpty()) {
      for (      Map.Entry<String,AliasMetaData> indexRouting : indexToRoutingMap.entrySet()) {
        if (!norouting.contains(indexRouting.getKey())) {
          if (!indexRouting.getValue().searchRoutingValues().isEmpty()) {
            if (routings == null) {
              routings=newHashMap();
            }
            Set<String> r=routings.get(indexRouting.getKey());
            if (r == null) {
              r=new HashSet<String>();
              routings.put(indexRouting.getKey(),r);
            }
            r.addAll(indexRouting.getValue().searchRoutingValues());
            if (paramRouting != null) {
              r.retainAll(paramRouting);
            }
            if (r.isEmpty()) {
              routings.remove(indexRouting.getKey());
            }
          }
 else {
            if (!norouting.contains(indexRouting.getKey())) {
              norouting.add(indexRouting.getKey());
              if (paramRouting != null) {
                Set<String> r=new HashSet<String>(paramRouting);
                if (routings == null) {
                  routings=newHashMap();
                }
                routings.put(indexRouting.getKey(),r);
              }
 else {
                if (routings != null) {
                  routings.remove(indexRouting.getKey());
                }
              }
            }
          }
        }
      }
    }
 else {
      if (!norouting.contains(aliasOrIndex)) {
        norouting.add(aliasOrIndex);
        if (paramRouting != null) {
          Set<String> r=new HashSet<String>(paramRouting);
          if (routings == null) {
            routings=newHashMap();
          }
          routings.put(aliasOrIndex,r);
        }
 else {
          if (routings != null) {
            routings.remove(aliasOrIndex);
          }
        }
      }
    }
  }
  if (routings == null || routings.isEmpty()) {
    return null;
  }
  return routings;
}
