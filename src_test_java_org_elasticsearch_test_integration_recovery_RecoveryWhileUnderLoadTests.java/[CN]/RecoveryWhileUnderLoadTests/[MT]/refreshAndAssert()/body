{
  assertThat(awaitBusy(new Predicate<Object>(){
    public boolean apply(    Object o){
      try {
        RefreshResponse actionGet=client().admin().indices().prepareRefresh().execute().actionGet();
        assertNoFailures(actionGet);
        return actionGet.getTotalShards() == actionGet.getSuccessfulShards();
      }
 catch (      Throwable e) {
        throw new RuntimeException(e);
      }
    }
  }
,5,TimeUnit.MINUTES),equalTo(true));
}
