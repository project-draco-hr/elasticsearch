{
  int pFlags=0;
  if (flags == null) {
    for (    String s : Strings.delimitedListToStringArray(flags,"|")) {
      if ("CASE_INSENSITIVE".equalsIgnoreCase(s)) {
        pFlags|=Pattern.CASE_INSENSITIVE;
      }
 else       if ("MULTILINE".equalsIgnoreCase(s)) {
        pFlags|=Pattern.MULTILINE;
      }
 else       if ("DOTALL".equalsIgnoreCase(s)) {
        pFlags|=Pattern.DOTALL;
      }
 else       if ("UNICODE_CASE".equalsIgnoreCase(s)) {
        pFlags|=Pattern.UNICODE_CASE;
      }
 else       if ("CANON_EQ".equalsIgnoreCase(s)) {
        pFlags|=Pattern.CANON_EQ;
      }
 else       if ("UNIX_LINES".equalsIgnoreCase(s)) {
        pFlags|=Pattern.UNIX_LINES;
      }
 else       if ("LITERAL".equalsIgnoreCase(s)) {
        pFlags|=Pattern.LITERAL;
      }
 else       if ("COMMENTS".equalsIgnoreCase(s)) {
        pFlags|=Pattern.COMMENTS;
      }
 else {
        throw new ElasticSearchIllegalArgumentException("Unknown regex flag [" + s + "] to compile ["+ regex+ "]");
      }
    }
  }
  return Pattern.compile(regex,pFlags);
}
