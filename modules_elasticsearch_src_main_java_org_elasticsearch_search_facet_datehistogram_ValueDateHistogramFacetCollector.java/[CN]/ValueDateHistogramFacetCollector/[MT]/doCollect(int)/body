{
  keyFieldData.date(doc,dateTime);
  long time=dateTime.getMillis();
  if (interval != 1) {
    time=CountDateHistogramFacetCollector.bucket(time,interval);
  }
  if (valueFieldData.multiValued()) {
    for (    double value : valueFieldData.doubleValues(doc)) {
      counts.adjustOrPutValue(time,1,1);
      totals.adjustOrPutValue(time,value,value);
    }
  }
 else {
    double value=valueFieldData.doubleValue(doc);
    counts.adjustOrPutValue(time,1,1);
    totals.adjustOrPutValue(time,value,value);
  }
}
