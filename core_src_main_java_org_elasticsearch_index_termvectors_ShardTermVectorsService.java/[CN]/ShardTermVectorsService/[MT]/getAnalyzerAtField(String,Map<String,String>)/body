{
  MapperService mapperService=indexShard.mapperService();
  Analyzer analyzer;
  if (perFieldAnalyzer != null && perFieldAnalyzer.containsKey(field)) {
    analyzer=mapperService.analysisService().analyzer(perFieldAnalyzer.get(field).toString());
  }
 else {
    analyzer=mapperService.smartNameFieldType(field).indexAnalyzer();
  }
  if (analyzer == null) {
    analyzer=mapperService.analysisService().defaultIndexAnalyzer();
  }
  return analyzer;
}
