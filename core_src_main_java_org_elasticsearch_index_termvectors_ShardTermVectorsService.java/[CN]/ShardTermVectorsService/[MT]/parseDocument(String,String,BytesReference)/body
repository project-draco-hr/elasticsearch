{
  MapperService mapperService=indexShard.mapperService();
  DocumentMapperForType docMapper=mapperService.documentMapperWithAutoCreate(type);
  ParsedDocument parsedDocument=docMapper.getDocumentMapper().parse(source(doc).index(index).type(type).flyweight(true));
  if (docMapper.getMapping() != null) {
    parsedDocument.addDynamicMappingsUpdate(docMapper.getMapping());
  }
  if (parsedDocument.dynamicMappingsUpdate() != null) {
    mappingUpdatedAction.updateMappingOnMasterSynchronously(index,type,parsedDocument.dynamicMappingsUpdate());
  }
  return parsedDocument;
}
