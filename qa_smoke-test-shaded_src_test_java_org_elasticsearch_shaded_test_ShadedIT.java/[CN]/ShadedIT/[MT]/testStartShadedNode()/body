{
  ESLoggerFactory.getRootLogger().setLevel("ERROR");
  Path data=createTempDir();
  Settings settings=Settings.builder().put("path.home",data.toAbsolutePath().toString()).put("node.mode","local").put("http.enabled","false").build();
  NodeBuilder builder=NodeBuilder.nodeBuilder().data(true).settings(settings).loadConfigSettings(false).local(true);
  try (Node node=builder.node()){
    Client client=node.client();
    client.admin().indices().prepareCreate("test").get();
    client.prepareIndex("test","foo").setSource("{ \"field\" : \"value\" }").get();
    client.admin().indices().prepareRefresh().get();
    SearchResponse response=client.prepareSearch("test").get();
    assertEquals(response.getHits().getTotalHits(),1l);
  }
 }
