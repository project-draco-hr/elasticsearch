{
  final ArrayList<InternalAggregation> childAggs=new ArrayList<>();
  final long bucketDocCount=bucketDocCount(bucketOrd);
  if (bucketDocCount == 0L) {
    for (int i=0; i < subAggregators.length; i++) {
      childAggs.add(subAggregators[i].buildEmptyAggregation());
    }
  }
 else {
    BucketAnalysisCollector analysisCollector=new BucketAnalysisCollector(){
      @Override public void add(      Aggregation analysis){
        childAggs.add((InternalAggregation)analysis);
      }
    }
;
    collectableSubAggregators.gatherAnalysis(analysisCollector,bucketOrd);
    for (int i=0; i < subAggregators.length; i++) {
      if (!subAggregators[i].shouldCollect()) {
        childAggs.add(subAggregators[i].buildAggregation(bucketOrd));
      }
    }
  }
  return new InternalAggregations(childAggs);
}
