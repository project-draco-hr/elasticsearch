{
  if (DEFAULT_MAPPING.equals(type)) {
    DocumentMapper mapper=documentParser.parse(type,mappingSource);
    try (ReleasableLock lock=mappingWriteLock.acquire()){
      mappers=newMapBuilder(mappers).put(type,mapper).map();
    }
     try {
      defaultMappingSource=mappingSource.string();
    }
 catch (    IOException e) {
      throw new ElasticsearchGenerationException("failed to un-compress",e);
    }
    return mapper;
  }
 else {
    try (ReleasableLock lock=mappingWriteLock.acquire()){
      applyDefault&=mappers.containsKey(type) == false;
      return merge(parse(type,mappingSource,applyDefault),updateAllTypes);
    }
   }
}
