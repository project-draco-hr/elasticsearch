{
  poolMaxSize=settings.getAsInt(PERCOLATE_POOL_SIZE,10);
  if (poolMaxSize <= 0) {
    throw new ElasticSearchIllegalArgumentException(PERCOLATE_POOL_SIZE + " size must be > 0 but was [" + poolMaxSize+ "]");
  }
  memoryIndexQueue=new ArrayBlockingQueue<ReusableMemoryIndex>(poolMaxSize);
  maxMemorySize=settings.getAsBytesSize(PERCOLATE_POOL_MAX_MEMORY,new ByteSizeValue(1,ByteSizeUnit.MB));
  if (maxMemorySize.bytes() < 0) {
    throw new ElasticSearchIllegalArgumentException(PERCOLATE_POOL_MAX_MEMORY + " must be positive but was [" + maxMemorySize.bytes()+ "]");
  }
  timeout=settings.getAsTime(PERCOLATE_TIMEOUT,new TimeValue(100));
  if (timeout.millis() < 0) {
    throw new ElasticSearchIllegalArgumentException(PERCOLATE_TIMEOUT + " must be positive but was [" + timeout+ "]");
  }
  bytesPerMemoryIndex=maxMemorySize.bytes() / poolMaxSize;
}
