{
  if (expectedOperations.get() == 0) {
    finish();
    return;
  }
  for (  Map.Entry<ShardId,TransportShardMultiPercolateAction.Request> entry : requestsByShard.entrySet()) {
    final int shardId=entry.getKey().id();
    final String index=entry.getKey().index().name();
    TransportShardMultiPercolateAction.Request shardRequest=entry.getValue();
    shardMultiPercolateAction.execute(shardRequest,new ActionListener<TransportShardMultiPercolateAction.Response>(){
      @Override public void onResponse(      TransportShardMultiPercolateAction.Response response){
        onShardResponse(new ShardId(index,shardId),response);
      }
      @Override public void onFailure(      Throwable e){
        onShardFailure(new ShardId(index,shardId),e);
      }
    }
);
  }
}
