{
  if (expectedOperations.get() == 0) {
    finish();
    return;
  }
  logger.trace("mpercolate executing for shards {}",requestsByShard.keySet());
  for (  Map.Entry<ShardId,TransportShardMultiPercolateAction.Request> entry : requestsByShard.entrySet()) {
    final ShardId shardId=entry.getKey();
    TransportShardMultiPercolateAction.Request shardRequest=entry.getValue();
    shardMultiPercolateAction.execute(shardRequest,new ActionListener<TransportShardMultiPercolateAction.Response>(){
      @Override public void onResponse(      TransportShardMultiPercolateAction.Response response){
        onShardResponse(shardId,response);
      }
      @Override public void onFailure(      Throwable e){
        onShardFailure(shardId,e);
      }
    }
);
  }
}
