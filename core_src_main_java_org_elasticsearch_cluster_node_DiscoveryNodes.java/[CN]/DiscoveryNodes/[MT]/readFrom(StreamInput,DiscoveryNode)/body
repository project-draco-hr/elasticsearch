{
  Builder builder=new Builder();
  if (in.readBoolean()) {
    builder.masterNodeId(in.readString());
  }
  if (localNode != null) {
    builder.localNodeId(localNode.id());
  }
  int size=in.readVInt();
  for (int i=0; i < size; i++) {
    DiscoveryNode node=new DiscoveryNode(in);
    if (localNode != null && node.id().equals(localNode.id())) {
      node=localNode;
    }
    builder.put(node);
  }
  return builder.build();
}
