{
  if (isAllNodes(nodesIds)) {
    int index=0;
    nodesIds=new String[nodes.size()];
    for (    DiscoveryNode node : this) {
      nodesIds[index++]=node.id();
    }
    return nodesIds;
  }
 else {
    ObjectHashSet<String> resolvedNodesIds=new ObjectHashSet<>(nodesIds.length);
    for (    String nodeId : nodesIds) {
      if (nodeId.equals("_local")) {
        String localNodeId=localNodeId();
        if (localNodeId != null) {
          resolvedNodesIds.add(localNodeId);
        }
      }
 else       if (nodeId.equals("_master")) {
        String masterNodeId=masterNodeId();
        if (masterNodeId != null) {
          resolvedNodesIds.add(masterNodeId);
        }
      }
 else       if (nodeExists(nodeId)) {
        resolvedNodesIds.add(nodeId);
      }
 else {
        for (        DiscoveryNode node : this) {
          if (Regex.simpleMatch(nodeId,node.name())) {
            resolvedNodesIds.add(node.id());
          }
        }
        for (        DiscoveryNode node : this) {
          if (Regex.simpleMatch(nodeId,node.getHostAddress())) {
            resolvedNodesIds.add(node.id());
          }
 else           if (Regex.simpleMatch(nodeId,node.getHostName())) {
            resolvedNodesIds.add(node.id());
          }
        }
        int index=nodeId.indexOf(':');
        if (index != -1) {
          String matchAttrName=nodeId.substring(0,index);
          String matchAttrValue=nodeId.substring(index + 1);
          if ("data".equals(matchAttrName)) {
            if (Booleans.parseBoolean(matchAttrValue,true)) {
              resolvedNodesIds.addAll(dataNodes.keys());
            }
 else {
              resolvedNodesIds.removeAll(dataNodes.keys());
            }
          }
 else           if ("master".equals(matchAttrName)) {
            if (Booleans.parseBoolean(matchAttrValue,true)) {
              resolvedNodesIds.addAll(masterNodes.keys());
            }
 else {
              resolvedNodesIds.removeAll(masterNodes.keys());
            }
          }
 else {
            for (            DiscoveryNode node : this) {
              for (              ObjectObjectCursor<String,String> entry : node.attributes()) {
                String attrName=entry.key;
                String attrValue=entry.value;
                if (Regex.simpleMatch(matchAttrName,attrName) && Regex.simpleMatch(matchAttrValue,attrValue)) {
                  resolvedNodesIds.add(node.id());
                }
              }
            }
          }
        }
      }
    }
    return resolvedNodesIds.toArray(String.class);
  }
}
