{
  try {
    XContentParser parser=XContentFactory.xContent(scriptBytes).createParser(scriptBytes);
    TemplateQueryParser.TemplateContext context=TemplateQueryParser.parse(parser,"params","script","template");
    if (Strings.hasLength(context.template())) {
      try {
        CompiledScript compiledScript=compile(scriptLang,context.template(),ScriptType.INLINE);
        if (compiledScript == null) {
          throw new ElasticsearchIllegalArgumentException("Unable to parse [" + context.template() + "] lang ["+ scriptLang+ "] (ScriptService.compile returned null)");
        }
      }
 catch (      Exception e) {
        throw new ElasticsearchIllegalArgumentException("Unable to parse [" + context.template() + "] lang ["+ scriptLang+ "]",e);
      }
    }
 else {
      throw new ElasticsearchIllegalArgumentException("Unable to find script in : " + scriptBytes.toUtf8());
    }
  }
 catch (  IOException e) {
    throw new ElasticsearchIllegalArgumentException("failed to parse template script",e);
  }
}
