{
  HashedBytesArray parentUid=typeCache.parentIdByDoc(doc);
  float previousScore=uidToScore.get(parentUid);
  float currentScore=scorer.score();
  if (Float.compare(previousScore,0) == 0) {
    uidToScore.put(parentUid,currentScore);
  }
 else {
switch (scoreType) {
case SUM:
      uidToScore.adjustValue(parentUid,currentScore);
    break;
case MAX:
  if (Float.compare(previousScore,currentScore) < 0) {
    uidToScore.put(parentUid,currentScore);
  }
break;
}
}
}
