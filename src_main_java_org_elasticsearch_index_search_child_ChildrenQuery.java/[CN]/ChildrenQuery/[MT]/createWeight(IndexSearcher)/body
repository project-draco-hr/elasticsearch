{
  if (uidToScore == null) {
    throw new ElasticSearchIllegalStateException("has_child query hasn't executed properly");
  }
  int size=uidToScore.v().size();
  if (size == 0) {
    return Queries.NO_MATCH_QUERY.createWeight(searcher);
  }
  Filter parentFilter;
  if (size == 1) {
    BytesRef id=uidToScore.v().keys().iterator().next().value.toBytesRef();
    parentFilter=new TermFilter(new Term(UidFieldMapper.NAME,Uid.createUidAsBytes(parentType,id)));
  }
 else   if (size <= shortCircuitParentDocSet) {
    parentFilter=new ParentIdsFilter(parentType,uidToScore.v().keys,uidToScore.v().allocated);
  }
 else {
    parentFilter=this.parentFilter;
  }
  return new ParentWeight(rewrittenChildQuery.createWeight(searcher),parentFilter,size);
}
