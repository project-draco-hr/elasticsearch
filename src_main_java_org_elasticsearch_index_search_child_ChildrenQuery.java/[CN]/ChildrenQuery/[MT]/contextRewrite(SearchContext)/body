{
  searchContext.idCache().refresh(searchContext.searcher().getTopReaderContext().leaves());
  uidToScore=searchContext.cacheRecycler().objectFloatMap(-1);
  Collector collector;
switch (scoreType) {
case AVG:
    uidToCount=searchContext.cacheRecycler().objectIntMap(-1);
  collector=new AvgChildUidCollector(scoreType,searchContext,parentType,uidToScore.v(),uidToCount.v());
break;
default :
collector=new ChildUidCollector(scoreType,searchContext,parentType,uidToScore.v());
}
Query childQuery;
if (rewrittenChildQuery == null) {
childQuery=rewrittenChildQuery=searchContext.searcher().rewrite(originalChildQuery);
}
 else {
childQuery=rewrittenChildQuery;
}
searchContext.searcher().search(childQuery,collector);
}
