{
  searchContext.idCache().refresh(searchContext.searcher().getTopReaderContext().leaves());
  uidToScore=CacheRecycler.popObjectFloatMap();
  Collector collector;
switch (scoreType) {
case AVG:
    uidToCount=CacheRecycler.popObjectIntMap();
  collector=new AvgChildUidCollector(scoreType,searchContext,parentType,uidToScore,uidToCount);
break;
default :
collector=new ChildUidCollector(scoreType,searchContext,parentType,uidToScore);
}
Query childQuery;
if (rewrittenChildQuery == null) {
childQuery=rewrittenChildQuery=searchContext.searcher().rewrite(originalChildQuery);
}
 else {
childQuery=rewrittenChildQuery;
}
searchContext.searcher().search(childQuery,collector);
}
