{
  if (version.onOrAfter(Version.LUCENE_43) && esVersion.onOrAfter(org.elasticsearch.Version.V_0_90_2)) {
    final Version version=this.version == Version.LUCENE_43 ? Version.LUCENE_44 : this.version;
    if (matcher == null) {
      return new NGramTokenizer(version,reader,minGram,maxGram);
    }
 else {
      return new NGramTokenizer(version,reader,minGram,maxGram){
        @Override protected boolean isTokenChar(        int chr){
          return matcher.isTokenChar(chr);
        }
      }
;
    }
  }
 else {
    return new Lucene43NGramTokenizer(reader,minGram,maxGram);
  }
}
