{
  final DiscoveryNode pNode;
synchronized (this) {
    pNode=getDiscoveryNode(primary.routingEntry().currentNodeId());
  }
  final DiscoveryNode rNode=getDiscoveryNode(replica.routingEntry().currentNodeId());
  replica.markAsRecovering("remote",new RecoveryState(replica.shardId(),false,RecoveryState.Type.REPLICA,pNode,rNode));
  replica.prepareForIndexRecovery();
  RecoveryTarget recoveryTarget=targetSupplier.apply(replica,pNode);
  StartRecoveryRequest request=new StartRecoveryRequest(replica.shardId(),pNode,rNode,replica.store().getMetadataOrEmpty(),RecoveryState.Type.REPLICA,0);
  RecoverySourceHandler recovery=new RecoverySourceHandler(primary,recoveryTarget,request,(int)ByteSizeUnit.MB.toKB(1),logger);
  recovery.recoverToTarget();
  recoveryTarget.markAsDone();
  replica.updateRoutingEntry(ShardRoutingHelper.moveToStarted(replica.routingEntry()));
}
