{
  if (refreshMutex.compareAndSet(false,true)) {
    try {
      if (dirty) {
        dirty=false;
        AcquirableResource<ReaderSearcherHolder> current=nrtResource;
        IndexReader newReader=current.resource().reader().reopen(true);
        if (newReader != current.resource().reader()) {
          nrtResource=newAcquirableResource(new ReaderSearcherHolder(newReader));
          current.markForClose();
        }
      }
    }
 catch (    IOException e) {
      throw new RefreshFailedEngineException(shardId,e);
    }
 finally {
      refreshMutex.set(false);
    }
  }
}
