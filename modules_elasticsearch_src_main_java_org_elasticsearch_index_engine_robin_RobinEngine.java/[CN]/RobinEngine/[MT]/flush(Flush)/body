{
  if (disableFlushCounter > 0) {
    throw new FlushNotAllowedEngineException(shardId,"Recovery is in progress, flush is not allowed");
  }
  rwl.writeLock().lock();
  try {
    if (disableFlushCounter > 0) {
      throw new FlushNotAllowedEngineException(shardId,"Recovery is in progress, flush is not allowed");
    }
    try {
      indexWriter.commit();
      translog.newTranslog();
    }
 catch (    IOException e) {
      throw new FlushFailedEngineException(shardId,e);
    }
  }
  finally {
    rwl.writeLock().unlock();
  }
  if (flush.refresh()) {
    refresh(new Refresh(false));
  }
}
