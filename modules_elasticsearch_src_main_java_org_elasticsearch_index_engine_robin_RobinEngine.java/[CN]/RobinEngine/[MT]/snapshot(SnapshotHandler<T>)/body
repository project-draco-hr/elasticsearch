{
  SnapshotIndexCommit snapshotIndexCommit=null;
  Translog.Snapshot traslogSnapshot=null;
  rwl.readLock().lock();
  try {
    snapshotIndexCommit=deletionPolicy.snapshot();
    traslogSnapshot=translog.snapshot();
  }
 catch (  Exception e) {
    if (snapshotIndexCommit != null)     snapshotIndexCommit.release();
    throw new SnapshotFailedEngineException(shardId,e);
  }
 finally {
    rwl.readLock().unlock();
  }
  try {
    return snapshotHandler.snapshot(snapshotIndexCommit,traslogSnapshot);
  }
  finally {
    snapshotIndexCommit.release();
    traslogSnapshot.release();
  }
}
