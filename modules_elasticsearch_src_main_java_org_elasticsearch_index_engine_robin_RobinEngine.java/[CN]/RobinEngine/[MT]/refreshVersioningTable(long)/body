{
  refresh(new Refresh(true).force(true));
  Searcher searcher=indexingSearcher.get();
  if (searcher != null) {
    indexingSearcher.set(null);
  }
  for (  Map.Entry<String,VersionValue> entry : versionMap.entrySet()) {
    String id=entry.getKey();
synchronized (dirtyLock(id)) {
      VersionValue versionValue=versionMap.get(id);
      if (versionValue == null) {
        continue;
      }
      if (time - versionValue.time() <= 0) {
        continue;
      }
      if (versionValue.delete()) {
        if ((time - versionValue.time()) > gcDeletesInMillis) {
          versionMap.remove(id);
        }
      }
 else {
        versionMap.remove(id);
      }
    }
  }
  if (searcher != null) {
    searcher.release();
  }
}
