{
  final String node_1=cluster().startNode(settingsBuilder().put("path.data","data/data1").build());
  client().prepareIndex("test","type1","1").setSource("field","value").execute().actionGet();
  cluster().startNode(settingsBuilder().put("path.data","data/data2").build());
  ClusterHealthResponse health=client().admin().cluster().prepareHealth().setWaitForEvents(Priority.LANGUID).setWaitForGreenStatus().execute().actionGet();
  assertThat(health.isTimedOut(),equalTo(false));
  cluster().fullRestart(new RestartCallback(){
    @Override public boolean doRestart(    String nodeName){
      return !node_1.equals(nodeName);
    }
  }
);
  health=client().admin().cluster().prepareHealth().setWaitForEvents(Priority.LANGUID).setWaitForYellowStatus().execute().actionGet();
  assertThat(health.isTimedOut(),equalTo(false));
  assertThat(client().admin().indices().prepareExists("test").execute().actionGet().isExists(),equalTo(true));
  assertHitCount(client().prepareCount("test").setQuery(QueryBuilders.matchAllQuery()).execute().actionGet(),1);
}
