{
  IndexShard indexShard=indicesService.indexServiceSafe(request.shardId().getIndex()).shardSafe(request.shardId().id());
  indexShard.optimize(new Engine.Optimize().waitForMerge(request.waitForMerge()).maxNumSegments(request.maxNumSegments()).onlyExpungeDeletes(request.onlyExpungeDeletes()).flush(request.flush()).upgrade(request.upgrade()));
  return new ShardOptimizeResponse(request.shardId());
}
