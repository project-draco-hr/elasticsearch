{
synchronized (optimizeMutex) {
    IndexShard indexShard=indicesService.indexServiceSafe(request.getIndex()).shardSafe(request.getShardId());
    indexShard.optimize(new Engine.Optimize().waitForMerge(request.isWaitForMerge()).maxNumSegments(request.getMaxNumSegments()).onlyExpungeDeletes(request.isOnlyExpungeDeletes()).flush(request.isFlush()).refresh(request.isRefresh()));
    return new ShardOptimizeResponse(request.getIndex(),request.getShardId());
  }
}
