{
synchronized (optimizeMutex) {
    IndexShard indexShard=indicesService.indexServiceSafe(request.index()).shardSafe(request.shardId());
    indexShard.optimize(new Engine.Optimize().waitForMerge(request.waitForMerge()).maxNumSegments(request.maxNumSegments()).onlyExpungeDeletes(request.onlyExpungeDeletes()).flush(request.flush()).refresh(request.refresh()));
    return new ShardOptimizeResponse(request.index(),request.shardId());
  }
}
