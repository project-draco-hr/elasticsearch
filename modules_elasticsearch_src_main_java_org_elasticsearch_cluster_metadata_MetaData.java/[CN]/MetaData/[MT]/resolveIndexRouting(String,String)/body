{
  ImmutableMap<String,AliasMetaData> indexAliases=aliases.get(aliasOrIndex);
  if (indexAliases == null || indexAliases.isEmpty()) {
    return routing;
  }
  if (indexAliases.size() > 1) {
    throw new ElasticSearchIllegalArgumentException("Alias [" + aliasOrIndex + "] has more than one index associated with it ["+ indexAliases.keySet()+ "], can't execute a single index op");
  }
  AliasMetaData aliasMd=indexAliases.values().iterator().next();
  if (aliasMd.indexRouting() != null) {
    if (routing != null) {
      if (routing.equals(aliasMd.indexRouting())) {
        return routing;
      }
 else {
        throw new ElasticSearchIllegalArgumentException("Alias [" + aliasOrIndex + "] has index routing associated with it ["+ aliasMd.indexRouting()+ "], and was provided with routing value ["+ routing+ "], rejecting operation");
      }
    }
    return aliasMd.indexRouting();
  }
 else {
    return routing;
  }
}
