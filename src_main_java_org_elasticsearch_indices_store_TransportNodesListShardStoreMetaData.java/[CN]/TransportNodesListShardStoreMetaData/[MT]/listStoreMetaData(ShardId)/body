{
  logger.trace("listing store meta data for {}",shardId);
  long startTime=System.currentTimeMillis();
  boolean exists=false;
  try {
    IndexService indexService=indicesService.indexService(shardId.index().name());
    if (indexService != null) {
      IndexShard indexShard=indexService.shard(shardId.id());
      if (indexShard != null) {
        final Store store=indexShard.store();
        store.incRef();
        try {
          exists=true;
          return new StoreFilesMetaData(true,shardId,store.getMetadataOrEmpty());
        }
  finally {
          store.decRef();
        }
      }
    }
    IndexMetaData metaData=clusterService.state().metaData().index(shardId.index().name());
    if (metaData == null) {
      return new StoreFilesMetaData(false,shardId,Store.MetadataSnapshot.EMPTY);
    }
    String storeType=metaData.settings().get(IndexStoreModule.STORE_TYPE,"fs");
    if (!storeType.contains("fs")) {
      return new StoreFilesMetaData(false,shardId,Store.MetadataSnapshot.EMPTY);
    }
    final ShardPath shardPath=ShardPath.loadShardPath(logger,nodeEnv,shardId,metaData.settings());
    if (shardPath == null) {
      return new StoreFilesMetaData(false,shardId,Store.MetadataSnapshot.EMPTY);
    }
    return new StoreFilesMetaData(false,shardId,Store.readMetadataSnapshot(shardPath.resolveIndex(),logger));
  }
  finally {
    TimeValue took=new TimeValue(System.currentTimeMillis() - startTime);
    if (exists) {
      logger.debug("{} loaded store meta data (took [{}])",shardId,took);
    }
 else {
      logger.trace("{} didn't find any store meta data to load (took [{}])",shardId,took);
    }
  }
}
