{
  Settings indexSettings=config.getIndexSettings();
  shardId=config.getShardId();
  filterCache=config.getQueryCache();
  filterCachingPolicy=config.getQueryCachingPolicy();
  final long seed=indexSettings.getAsLong(ESIntegTestCase.SETTING_INDEX_SEED,0l);
  Random random=new Random(seed);
  final double ratio=indexSettings.getAsDouble(WRAP_READER_RATIO,0.0d);
  String readerWrapperType=indexSettings.get(READER_WRAPPER_TYPE);
  Class<? extends AssertingDirectoryReader> wrapper;
  if (readerWrapperType == null) {
    wrapper=AssertingDirectoryReader.class;
  }
 else {
    wrapper=Classes.loadClass(getClass().getClassLoader(),readerWrapperType);
  }
  boolean wrapReader=random.nextDouble() < ratio;
  if (logger.isTraceEnabled()) {
    logger.trace("Using [{}] for shard [{}] seed: [{}] wrapReader: [{}]",this.getClass().getName(),shardId,seed,wrapReader);
  }
  mockContext=new MockContext(random,wrapReader,wrapper,indexSettings);
  this.searcherCloseable=new SearcherCloseable();
  LuceneTestCase.closeAfterSuite(searcherCloseable);
}
