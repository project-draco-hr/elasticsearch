{
  if (map.size() == 1 && map.containsKey(TYPE)) {
    map=(Map<String,Object>)map.values().iterator().next();
  }
  XContentBuilder builder=XContentFactory.smileBuilder().map(map);
  try (XContentParser parser=XContentFactory.xContent(XContentType.SMILE).createParser(builder.bytes())){
    parser.nextToken();
    return fromXContent(parser);
  }
 }
