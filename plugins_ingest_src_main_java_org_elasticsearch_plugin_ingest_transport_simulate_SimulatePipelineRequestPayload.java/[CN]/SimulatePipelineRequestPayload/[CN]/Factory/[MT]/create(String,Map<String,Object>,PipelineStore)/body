{
  Pipeline pipeline;
  if (pipelineId != null) {
    pipeline=pipelineStore.get(pipelineId);
  }
 else {
    Map<String,Object> pipelineConfig=(Map<String,Object>)config.get("pipeline");
    pipeline=(new Pipeline.Factory()).create("_pipeline_id",pipelineConfig,pipelineStore.getProcessorFactoryRegistry());
  }
  List<Map<String,Object>> docs=(List<Map<String,Object>>)config.get("docs");
  List<Data> dataList=new ArrayList<>();
  for (int i=0; i < docs.size(); i++) {
    Map<String,Object> dataMap=docs.get(i);
    Map<String,Object> document=(Map<String,Object>)dataMap.get("_source");
    Data data=new Data(ConfigurationUtils.readStringProperty(dataMap,"_index",null),ConfigurationUtils.readStringProperty(dataMap,"_type",null),ConfigurationUtils.readStringProperty(dataMap,"_id",null),document);
    dataList.add(data);
  }
  return new SimulatePipelineRequestPayload(pipeline,dataList);
}
