{
  this.clusterName=clusterName;
  this.numberOfPendingTasks=numberOfPendingTasks;
  this.numberOfInFlightFetch=numberOfInFlightFetch;
  RoutingTableValidation validation=clusterState.routingTable().validate(clusterState.metaData());
  validationFailures=validation.failures();
  numberOfNodes=clusterState.nodes().size();
  numberOfDataNodes=clusterState.nodes().dataNodes().size();
  for (  String index : concreteIndices) {
    IndexRoutingTable indexRoutingTable=clusterState.routingTable().index(index);
    IndexMetaData indexMetaData=clusterState.metaData().index(index);
    if (indexRoutingTable == null) {
      continue;
    }
    ClusterIndexHealth indexHealth=new ClusterIndexHealth(indexMetaData,indexRoutingTable);
    indices.put(indexHealth.getIndex(),indexHealth);
  }
  status=ClusterHealthStatus.GREEN;
  for (  ClusterIndexHealth indexHealth : indices.values()) {
    activePrimaryShards+=indexHealth.activePrimaryShards;
    activeShards+=indexHealth.activeShards;
    relocatingShards+=indexHealth.relocatingShards;
    initializingShards+=indexHealth.initializingShards;
    unassignedShards+=indexHealth.unassignedShards;
    if (indexHealth.getStatus() == ClusterHealthStatus.RED) {
      status=ClusterHealthStatus.RED;
    }
 else     if (indexHealth.getStatus() == ClusterHealthStatus.YELLOW && status != ClusterHealthStatus.RED) {
      status=ClusterHealthStatus.YELLOW;
    }
  }
  if (!validationFailures.isEmpty()) {
    status=ClusterHealthStatus.RED;
  }
 else   if (clusterState.blocks().hasGlobalBlock(RestStatus.SERVICE_UNAVAILABLE)) {
    status=ClusterHealthStatus.RED;
  }
}
