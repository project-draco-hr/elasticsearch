{
  TermQueryBuilder tqb=new TermQueryBuilder("foo","bar");
  WrapperQueryBuilder qb=new WrapperQueryBuilder(tqb.toString());
  try {
    qb.toQuery(createShardContext());
    fail();
  }
 catch (  UnsupportedOperationException e) {
    assertEquals("this query must be rewritten first",e.getMessage());
  }
  QueryBuilder<?> rewrite=qb.rewrite(createShardContext());
  assertEquals(tqb,rewrite);
}
