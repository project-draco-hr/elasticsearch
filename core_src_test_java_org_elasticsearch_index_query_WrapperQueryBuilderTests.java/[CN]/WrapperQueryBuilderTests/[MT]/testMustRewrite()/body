{
  TermQueryBuilder tqb=new TermQueryBuilder("foo","bar");
  WrapperQueryBuilder qb=new WrapperQueryBuilder(tqb.toString());
  try {
    qb.toQuery(queryShardContext());
    fail();
  }
 catch (  UnsupportedOperationException e) {
    assertEquals("this query must be rewritten first",e.getMessage());
  }
  QueryBuilder<?> rewrite=qb.rewrite(queryShardContext());
  assertEquals(tqb,rewrite);
}
