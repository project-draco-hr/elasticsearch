{
  ValueFormatter formatter;
  if (format != null) {
    formatter=ValueFormat.Patternable.Number.format(format).formatter();
  }
 else {
    formatter=ValueFormatter.RAW;
  }
  Long xAxisUnits=null;
  if (units != null) {
    DateTimeUnit dateTimeUnit=HistogramAggregator.DateHistogramFactory.DATE_FIELD_UNITS.get(units);
    if (dateTimeUnit != null) {
      xAxisUnits=dateTimeUnit.field().getDurationField().getUnitMillis();
    }
 else {
      TimeValue timeValue=TimeValue.parseTimeValue(units,null,getClass().getSimpleName() + ".unit");
      if (timeValue != null) {
        xAxisUnits=timeValue.getMillis();
      }
    }
  }
  return new DerivativePipelineAggregator(name,bucketsPaths,formatter,gapPolicy,xAxisUnits,metaData);
}
