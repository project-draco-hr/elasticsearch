def snapshot_index(client, cfg):
    client.cluster.put_settings(body={'persistent': {'cluster.routing.allocation.exclude.version_attr': cfg.version, }, })
    client.indices.put_template(name=('template_' + cfg.version.lower()), order=0, body={'template': 'te*', 'settings': {'number_of_shards': 1, }, 'mappings': {'type1': {'_source': {'enabled': False, }, }, }, 'aliases': {'alias1': {}, 'alias2': {'filter': {'term': {'version': cfg.version, }, }, 'routing': 'kimchy', }, '{index}-alias': {}, }, })
    client.snapshot.create_repository(repository='test_repo', body={'type': 'fs', 'settings': {'location': cfg.repo_dir, }, })
    client.snapshot.create(repository='test_repo', snapshot='test_1', wait_for_completion=True)
    client.snapshot.delete_repository(repository='test_repo')
