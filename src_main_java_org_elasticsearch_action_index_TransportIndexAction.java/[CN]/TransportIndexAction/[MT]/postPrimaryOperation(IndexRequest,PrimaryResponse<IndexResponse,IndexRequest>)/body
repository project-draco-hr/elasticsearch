{
  Engine.IndexingOperation op=(Engine.IndexingOperation)response.payload();
  if (!Strings.hasLength(request.getPercolate())) {
    return;
  }
  IndexService indexService=indicesService.indexServiceSafe(request.getIndex());
  try {
    PercolatorExecutor.Response percolate=indexService.percolateService().percolate(new PercolatorExecutor.DocAndSourceQueryRequest(op.parsedDoc(),request.getPercolate()));
    response.response().setMatches(percolate.matches());
  }
 catch (  Exception e) {
    logger.warn("failed to percolate [{}]",e,request);
  }
}
