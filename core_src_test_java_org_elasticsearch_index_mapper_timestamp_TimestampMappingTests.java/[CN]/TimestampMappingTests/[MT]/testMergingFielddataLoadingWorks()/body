{
  String mapping=XContentFactory.jsonBuilder().startObject().startObject("type").startObject("_timestamp").field("enabled",randomBoolean()).startObject("fielddata").field("loading","lazy").field("format","doc_values").endObject().field("store","yes").endObject().endObject().endObject().string();
  Settings indexSettings=Settings.builder().put(IndexMetaData.SETTING_VERSION_CREATED,Version.V_1_4_2.id).build();
  MapperService mapperService=createIndex("test",indexSettings).mapperService();
  DocumentMapper docMapper=mapperService.merge("type",new CompressedXContent(mapping),true,false);
  assertThat(docMapper.timestampFieldMapper().fieldType().fieldDataType().getLoading(),equalTo(MappedFieldType.Loading.LAZY));
  assertThat(docMapper.timestampFieldMapper().fieldType().fieldDataType().getFormat(indexSettings),equalTo("doc_values"));
  mapping=XContentFactory.jsonBuilder().startObject().startObject("type").startObject("_timestamp").field("enabled",randomBoolean()).startObject("fielddata").field("loading","eager").field("format","array").endObject().field("store","yes").endObject().endObject().endObject().string();
  docMapper=mapperService.merge("type",new CompressedXContent(mapping),false,false);
  assertThat(docMapper.timestampFieldMapper().fieldType().fieldDataType().getLoading(),equalTo(MappedFieldType.Loading.EAGER));
  assertThat(docMapper.timestampFieldMapper().fieldType().fieldDataType().getFormat(indexSettings),equalTo("array"));
}
