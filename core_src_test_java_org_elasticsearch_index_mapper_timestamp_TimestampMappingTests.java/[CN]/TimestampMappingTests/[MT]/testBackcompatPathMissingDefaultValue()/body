{
  XContentBuilder mapping=XContentFactory.jsonBuilder().startObject().startObject("type").startObject("_timestamp").field("enabled","yes").field("path","timestamp").field("ignore_missing",false).endObject().endObject().endObject();
  XContentBuilder doc=XContentFactory.jsonBuilder().startObject().field("foo","bar").endObject();
  MetaData metaData=MetaData.builder().build();
  DocumentMapper docMapper=createIndex("test",BWC_SETTINGS).mapperService().documentMapperParser().parse("type",new CompressedXContent(mapping.string()));
  MappingMetaData mappingMetaData=new MappingMetaData(docMapper);
  IndexRequest request=new IndexRequest("test","type","1").source(doc);
  try {
    request.process(metaData,mappingMetaData,true,"test");
    fail();
  }
 catch (  TimestampParsingException e) {
    assertThat(e.getDetailedMessage(),containsString("timestamp is required by mapping"));
  }
}
