{
  FragListBuilder fragListBuilder;
  FragmentsBuilder fragmentsBuilder;
  if (!settings.fragmentsAllowed()) {
    fragListBuilder=new SingleFragListBuilder();
    fragmentsBuilder=new SimpleFragmentsBuilder(settings.preTags(),settings.postTags());
  }
 else {
    fragListBuilder=new SimpleFragListBuilder();
    if (settings.scoreOrdered()) {
      fragmentsBuilder=new ScoreOrderFragmentsBuilder(settings.preTags(),settings.postTags());
    }
 else {
      fragmentsBuilder=new SimpleFragmentsBuilder(settings.preTags(),settings.postTags());
    }
  }
  String[] mask=Arrays.copyOf(settings.preTags(),settings.preTags().length + settings.postTags().length);
  System.arraycopy(settings.postTags(),0,mask,settings.preTags().length,settings.postTags().length);
  int key=(Arrays.toString(mask) + fragListBuilder.getClass().getSimpleName() + fragmentsBuilder.getClass().getSimpleName()).hashCode();
  FastVectorHighlighter highlighter=highlighterMap.get(key);
  if (highlighter == null) {
    highlighter=new FastVectorHighlighter(true,false,fragListBuilder,fragmentsBuilder);
    highlighterMap.put(key,highlighter);
  }
  return Tuple.tuple(key,highlighter);
}
