{
  Client client=transportClient();
  client.prepareIndex(lookupIndex,".percolator","1").setSource(jsonBuilder().startObject().startObject("query").startObject("match").field("name","star wars").endObject().endObject().endObject()).get();
  client.prepareIndex(lookupIndex,"type","1").setSource(jsonBuilder().startObject().field("name","Star Wars - The new republic").endObject()).get();
  client.admin().indices().prepareRefresh(lookupIndex).get();
  GetRequest getRequest=client.prepareGet(lookupIndex,"type","1").request();
  PercolateResponse response=client.preparePercolate().setDocumentType("type").setGetRequest(getRequest).get();
  assertThat(response.getCount(),is(1L));
  assertGetRequestsContainHeaders();
}
