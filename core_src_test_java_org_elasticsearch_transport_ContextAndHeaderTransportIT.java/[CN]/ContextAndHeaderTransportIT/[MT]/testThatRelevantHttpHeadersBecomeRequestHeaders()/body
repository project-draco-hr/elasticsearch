{
  String relevantHeaderName="relevant_" + randomHeaderKey;
  for (  RestController restController : internalCluster().getInstances(RestController.class)) {
    restController.registerRelevantHeaders(relevantHeaderName);
  }
  try (Response response=getRestClient().performRequest("GET","/" + queryIndex + "/_search",new BasicHeader(randomHeaderKey,randomHeaderValue),new BasicHeader(relevantHeaderName,randomHeaderValue))){
    assertThat(response.getStatusLine().getStatusCode(),equalTo(200));
    List<RequestAndHeaders> searchRequests=getRequests(SearchRequest.class);
    assertThat(searchRequests,hasSize(greaterThan(0)));
    for (    RequestAndHeaders requestAndHeaders : searchRequests) {
      assertThat(requestAndHeaders.headers.containsKey(relevantHeaderName),is(true));
      assertThat(requestAndHeaders.headers.containsKey(randomHeaderKey),is(false));
    }
  }
 }
