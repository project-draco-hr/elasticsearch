{
  final GeoPointFieldData fieldData=(GeoPointFieldData)fieldDataCache.cache(GeoPointFieldDataType.TYPE,reader,fieldName);
  if (topLeft.lon > bottomRight.lon) {
    return new GetDocSet(reader.maxDoc()){
      @Override public boolean isCacheable(){
        return false;
      }
      @Override public boolean get(      int doc) throws IOException {
        if (!fieldData.hasValue(doc)) {
          return false;
        }
        if (fieldData.multiValued()) {
          double[] lats=fieldData.latValues(doc);
          double[] lons=fieldData.lonValues(doc);
          for (int i=0; i < lats.length; i++) {
            double lat=lats[i];
            double lon=lons[i];
            if (((topLeft.lon <= lon && 180 >= lon) || (-180 <= lon && bottomRight.lon >= lon)) && (topLeft.lat >= lat && bottomRight.lat <= lat)) {
              return true;
            }
          }
        }
 else {
          double lat=fieldData.latValue(doc);
          double lon=fieldData.lonValue(doc);
          if (((topLeft.lon <= lon && 180 >= lon) || (-180 <= lon && bottomRight.lon >= lon)) && (topLeft.lat >= lat && bottomRight.lat <= lat)) {
            return true;
          }
        }
        return false;
      }
    }
;
  }
 else {
    return new GetDocSet(reader.maxDoc()){
      @Override public boolean isCacheable(){
        return false;
      }
      @Override public boolean get(      int doc) throws IOException {
        if (!fieldData.hasValue(doc)) {
          return false;
        }
        if (fieldData.multiValued()) {
          double[] lats=fieldData.latValues(doc);
          double[] lons=fieldData.lonValues(doc);
          for (int i=0; i < lats.length; i++) {
            if (topLeft.lon <= lons[i] && bottomRight.lon >= lons[i] && topLeft.lat >= lats[i] && bottomRight.lat <= lats[i]) {
              return true;
            }
          }
        }
 else {
          double lat=fieldData.latValue(doc);
          double lon=fieldData.lonValue(doc);
          if (topLeft.lon <= lon && bottomRight.lon >= lon && topLeft.lat >= lat && bottomRight.lat <= lat) {
            return true;
          }
        }
        return false;
      }
    }
;
  }
}
