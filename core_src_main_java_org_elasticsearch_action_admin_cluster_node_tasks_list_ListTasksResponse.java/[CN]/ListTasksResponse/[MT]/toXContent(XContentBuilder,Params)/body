{
  if (getTaskFailures() != null && getTaskFailures().size() > 0) {
    builder.startArray("task_failures");
    for (    TaskOperationFailure ex : getTaskFailures()) {
      builder.startObject();
      builder.value(ex);
      builder.endObject();
    }
    builder.endArray();
  }
  if (getNodeFailures() != null && getNodeFailures().size() > 0) {
    builder.startArray("node_failures");
    for (    FailedNodeException ex : getNodeFailures()) {
      builder.startObject();
      ex.toXContent(builder,params);
      builder.endObject();
    }
    builder.endArray();
  }
  builder.startObject("nodes");
  for (  Map.Entry<DiscoveryNode,List<TaskInfo>> entry : getPerNodeTasks().entrySet()) {
    DiscoveryNode node=entry.getKey();
    builder.startObject(node.getId(),XContentBuilder.FieldCaseConversion.NONE);
    builder.field("name",node.name());
    builder.field("transport_address",node.address().toString());
    builder.field("host",node.getHostName());
    builder.field("ip",node.getAddress());
    if (!node.attributes().isEmpty()) {
      builder.startObject("attributes");
      for (      ObjectObjectCursor<String,String> attr : node.attributes()) {
        builder.field(attr.key,attr.value,XContentBuilder.FieldCaseConversion.NONE);
      }
      builder.endObject();
    }
    builder.startArray("tasks");
    for (    TaskInfo task : entry.getValue()) {
      task.toXContent(builder,params);
    }
    builder.endArray();
    builder.endObject();
  }
  builder.endObject();
  return builder;
}
