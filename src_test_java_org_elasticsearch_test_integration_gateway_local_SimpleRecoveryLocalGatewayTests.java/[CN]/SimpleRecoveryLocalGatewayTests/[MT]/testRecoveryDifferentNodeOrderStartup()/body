{
  buildNode("node1",settingsBuilder().put("gateway.type","local").put("path.data","data/data1").build());
  buildNode("node2",settingsBuilder().put("gateway.type","local").put("path.data","data/data2").build());
  cleanAndCloseNodes();
  startNode("node1",settingsBuilder().put("gateway.type","local").put("path.data","data/data1").build());
  client("node1").prepareIndex("test","type1","1").setSource("field","value").execute().actionGet();
  startNode("node2",settingsBuilder().put("gateway.type","local").put("path.data","data/data2").build());
  ClusterHealthResponse health=client("node2").admin().cluster().prepareHealth().setWaitForEvents(Priority.LANGUID).setWaitForGreenStatus().execute().actionGet();
  assertThat(health.isTimedOut(),equalTo(false));
  closeNode("node1");
  closeNode("node2");
  startNode("node2",settingsBuilder().put("gateway.type","local").put("path.data","data/data2").build());
  health=client("node2").admin().cluster().prepareHealth().setWaitForEvents(Priority.LANGUID).setWaitForYellowStatus().execute().actionGet();
  assertThat(health.isTimedOut(),equalTo(false));
  assertThat(client("node2").admin().indices().prepareExists("test").execute().actionGet().isExists(),equalTo(true));
  assertThat(client("node2").prepareCount("test").setQuery(QueryBuilders.matchAllQuery()).execute().actionGet().getCount(),equalTo(1l));
}
