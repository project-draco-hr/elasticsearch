{
  parser=YamlXContent.yamlXContent.createParser("---\n" + "\"Index with ID\":\n" + "\n"+ " - do:\n"+ "      index:\n"+ "          index:  test-weird-index-??????\n"+ "          type:   weird.type\n"+ "          id:     1\n"+ "          body:   { foo: bar }\n"+ "\n"+ " - is_true:   ok\n"+ " - match:   { _index:   test-weird-index-?????? }\n"+ " - match:   { _type:    weird.type }\n"+ " - match:   { _id:      \"1\"}\n"+ " - match:   { _version: 1}\n"+ "\n"+ " - do:\n"+ "      get:\n"+ "          index:  test-weird-index-??????\n"+ "          type:   weird.type\n"+ "          id:     1\n"+ "\n"+ " - match:   { _index:   test-weird-index-?????? }\n"+ " - match:   { _type:    weird.type }\n"+ " - match:   { _id:      \"1\"}\n"+ " - match:   { _version: 1}\n"+ " - match:   { _source: { foo: bar }}");
  RestTestSuiteParser testParser=new RestTestSuiteParser();
  RestTestSuite restTestSuite=testParser.parse(new RestTestSuiteParseContext("api","suite",parser));
  assertThat(restTestSuite,notNullValue());
  assertThat(restTestSuite.getName(),equalTo("suite"));
  assertThat(restTestSuite.getSetupSection().isEmpty(),equalTo(true));
  assertThat(restTestSuite.getTestSections().size(),equalTo(1));
  assertThat(restTestSuite.getTestSections().get(0).getName(),equalTo("Index with ID"));
  assertThat(restTestSuite.getTestSections().get(0).getSkipSection().isEmpty(),equalTo(true));
  assertThat(restTestSuite.getTestSections().get(0).getExecutableSections().size(),equalTo(12));
  assertThat(restTestSuite.getTestSections().get(0).getExecutableSections().get(0),instanceOf(DoSection.class));
  DoSection doSection=(DoSection)restTestSuite.getTestSections().get(0).getExecutableSections().get(0);
  assertThat(doSection.getCatch(),nullValue());
  assertThat(doSection.getApiCallSection().getApi(),equalTo("index"));
  assertThat(doSection.getApiCallSection().getParams().size(),equalTo(3));
  assertThat(doSection.getApiCallSection().hasBody(),equalTo(true));
  assertThat(restTestSuite.getTestSections().get(0).getExecutableSections().get(1),instanceOf(IsTrueAssertion.class));
  IsTrueAssertion trueAssertion=(IsTrueAssertion)restTestSuite.getTestSections().get(0).getExecutableSections().get(1);
  assertThat(trueAssertion.getField(),equalTo("ok"));
  assertThat(restTestSuite.getTestSections().get(0).getExecutableSections().get(2),instanceOf(MatchAssertion.class));
  MatchAssertion matchAssertion=(MatchAssertion)restTestSuite.getTestSections().get(0).getExecutableSections().get(2);
  assertThat(matchAssertion.getField(),equalTo("_index"));
  assertThat(matchAssertion.getExpectedValue().toString(),equalTo("test-weird-index-??????"));
  assertThat(restTestSuite.getTestSections().get(0).getExecutableSections().get(3),instanceOf(MatchAssertion.class));
  matchAssertion=(MatchAssertion)restTestSuite.getTestSections().get(0).getExecutableSections().get(3);
  assertThat(matchAssertion.getField(),equalTo("_type"));
  assertThat(matchAssertion.getExpectedValue().toString(),equalTo("weird.type"));
  assertThat(restTestSuite.getTestSections().get(0).getExecutableSections().get(4),instanceOf(MatchAssertion.class));
  matchAssertion=(MatchAssertion)restTestSuite.getTestSections().get(0).getExecutableSections().get(4);
  assertThat(matchAssertion.getField(),equalTo("_id"));
  assertThat(matchAssertion.getExpectedValue().toString(),equalTo("1"));
  assertThat(restTestSuite.getTestSections().get(0).getExecutableSections().get(5),instanceOf(MatchAssertion.class));
  matchAssertion=(MatchAssertion)restTestSuite.getTestSections().get(0).getExecutableSections().get(5);
  assertThat(matchAssertion.getField(),equalTo("_version"));
  assertThat(matchAssertion.getExpectedValue().toString(),equalTo("1"));
  assertThat(restTestSuite.getTestSections().get(0).getExecutableSections().get(6),instanceOf(DoSection.class));
  doSection=(DoSection)restTestSuite.getTestSections().get(0).getExecutableSections().get(6);
  assertThat(doSection.getCatch(),nullValue());
  assertThat(doSection.getApiCallSection().getApi(),equalTo("get"));
  assertThat(doSection.getApiCallSection().getParams().size(),equalTo(3));
  assertThat(doSection.getApiCallSection().hasBody(),equalTo(false));
  assertThat(restTestSuite.getTestSections().get(0).getExecutableSections().get(7),instanceOf(MatchAssertion.class));
  matchAssertion=(MatchAssertion)restTestSuite.getTestSections().get(0).getExecutableSections().get(7);
  assertThat(matchAssertion.getField(),equalTo("_index"));
  assertThat(matchAssertion.getExpectedValue().toString(),equalTo("test-weird-index-??????"));
  assertThat(restTestSuite.getTestSections().get(0).getExecutableSections().get(8),instanceOf(MatchAssertion.class));
  matchAssertion=(MatchAssertion)restTestSuite.getTestSections().get(0).getExecutableSections().get(8);
  assertThat(matchAssertion.getField(),equalTo("_type"));
  assertThat(matchAssertion.getExpectedValue().toString(),equalTo("weird.type"));
  assertThat(restTestSuite.getTestSections().get(0).getExecutableSections().get(9),instanceOf(MatchAssertion.class));
  matchAssertion=(MatchAssertion)restTestSuite.getTestSections().get(0).getExecutableSections().get(9);
  assertThat(matchAssertion.getField(),equalTo("_id"));
  assertThat(matchAssertion.getExpectedValue().toString(),equalTo("1"));
  assertThat(restTestSuite.getTestSections().get(0).getExecutableSections().get(10),instanceOf(MatchAssertion.class));
  matchAssertion=(MatchAssertion)restTestSuite.getTestSections().get(0).getExecutableSections().get(10);
  assertThat(matchAssertion.getField(),equalTo("_version"));
  assertThat(matchAssertion.getExpectedValue().toString(),equalTo("1"));
  assertThat(restTestSuite.getTestSections().get(0).getExecutableSections().get(11),instanceOf(MatchAssertion.class));
  matchAssertion=(MatchAssertion)restTestSuite.getTestSections().get(0).getExecutableSections().get(11);
  assertThat(matchAssertion.getField(),equalTo("_source"));
  assertThat(matchAssertion.getExpectedValue(),instanceOf(Map.class));
  assertThat(((Map)matchAssertion.getExpectedValue()).get("foo").toString(),equalTo("bar"));
}
