{
  String bulkAction=copyToStringFromClasspath("/org/elasticsearch/action/bulk/bulk-log.json");
  BulkRequestBuilder bulkBuilder=new BulkRequestBuilder(client());
  bulkBuilder.add(bulkAction.getBytes(Charsets.UTF_8),0,bulkAction.length(),true,null,null);
  bulkBuilder.execute().actionGet();
  awaitBusy(new Predicate<Object>(){
    @Override public boolean apply(    Object input){
      try {
        GetMappingsResponse mappingsResponse=client().admin().indices().getMappings(new GetMappingsRequest()).get();
        return mappingsResponse.getMappings().containsKey("logstash-2014.03.30");
      }
 catch (      Throwable t) {
        return false;
      }
    }
  }
);
  awaitBusy(new Predicate<Object>(){
    @Override public boolean apply(    Object input){
      try {
        GetMappingsResponse mappingsResponse=client().admin().indices().getMappings(new GetMappingsRequest()).get();
        return mappingsResponse.getMappings().get("logstash-2014.03.30").containsKey("logs");
      }
 catch (      Throwable t) {
        return false;
      }
    }
  }
);
  ensureYellow();
  GetMappingsResponse mappingsResponse=client().admin().indices().getMappings(new GetMappingsRequest()).get();
  assertThat(mappingsResponse.mappings().size(),equalTo(1));
  assertTrue(mappingsResponse.getMappings().containsKey("logstash-2014.03.30"));
  assertTrue(mappingsResponse.getMappings().get("logstash-2014.03.30").containsKey("logs"));
}
