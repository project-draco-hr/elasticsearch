{
  final MemoryCircuitBreaker breaker=new MemoryCircuitBreaker(new ByteSizeValue(15),1.6,logger);
  breaker.addWithoutBreaking(7);
  try {
    breaker.addEstimateBytesAndMaybeBreak(3);
    fail("should never reach this");
  }
 catch (  CircuitBreakingException cbe) {
  }
  breaker.addEstimateBytesAndMaybeBreak(2);
  assertThat(breaker.getUsed(),equalTo(9L));
  breaker.addWithoutBreaking(3);
  try {
    breaker.addEstimateBytesAndMaybeBreak(0);
    fail("should never reach this");
  }
 catch (  CircuitBreakingException cbe) {
  }
}
