{
  Builder builder=new SynonymMap.Builder(true);
  for (int i=0; i < 256; i++) {
    builder.add(new CharsRef("" + (i + 1)),new CharsRef("" + (1000 + (i + 1))),true);
  }
  StringBuilder valueBuilder=new StringBuilder();
  for (int i=0; i < 8; i++) {
    valueBuilder.append(i + 1);
    valueBuilder.append(" ");
  }
  MockTokenizer tokenizer=new MockTokenizer(new StringReader(valueBuilder.toString()),MockTokenizer.WHITESPACE,true);
  SynonymFilter filter=new SynonymFilter(tokenizer,builder.build(),true);
  TokenStream suggestTokenStream=new CompletionTokenStream(filter,new BytesRef("Surface keyword|friggin payload|10"),new CompletionTokenStream.ToFiniteStrings(){
    @Override public Set<IntsRef> toFiniteStrings(    TokenStream stream) throws IOException {
      Set<IntsRef> finiteStrings=suggester.toFiniteStrings(suggester.getTokenStreamToAutomaton(),stream);
      return finiteStrings;
    }
  }
);
  suggestTokenStream.reset();
  ByteTermAttribute attr=suggestTokenStream.addAttribute(ByteTermAttribute.class);
  PositionIncrementAttribute posAttr=suggestTokenStream.addAttribute(PositionIncrementAttribute.class);
  int maxPos=0;
  int count=0;
  while (suggestTokenStream.incrementToken()) {
    count++;
    assertNotNull(attr.getBytesRef());
    assertTrue(attr.getBytesRef().length > 0);
    maxPos+=posAttr.getPositionIncrement();
  }
  suggestTokenStream.close();
  assertEquals(count,256);
  assertEquals(count,maxPos);
}
