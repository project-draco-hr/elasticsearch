{
  if (isAllIndices(aliasesOrIndices)) {
    return resolveSearchRoutingAllIndices(routing);
  }
  aliasesOrIndices=convertFromWildcards(aliasesOrIndices,IndicesOptions.lenientExpandOpen());
  if (aliasesOrIndices.length == 1) {
    return resolveSearchRoutingSingleValue(routing,aliasesOrIndices[0]);
  }
  Map<String,Set<String>> routings=null;
  Set<String> paramRouting=null;
  Set<String> norouting=new HashSet<>();
  if (routing != null) {
    paramRouting=Strings.splitStringByCommaToSet(routing);
  }
  for (  String aliasOrIndex : aliasesOrIndices) {
    ImmutableOpenMap<String,AliasMetaData> indexToRoutingMap=aliases.get(aliasOrIndex);
    if (indexToRoutingMap != null && !indexToRoutingMap.isEmpty()) {
      for (      ObjectObjectCursor<String,AliasMetaData> indexRouting : indexToRoutingMap) {
        if (!norouting.contains(indexRouting.key)) {
          if (!indexRouting.value.searchRoutingValues().isEmpty()) {
            if (routings == null) {
              routings=newHashMap();
            }
            Set<String> r=routings.get(indexRouting.key);
            if (r == null) {
              r=new HashSet<>();
              routings.put(indexRouting.key,r);
            }
            r.addAll(indexRouting.value.searchRoutingValues());
            if (paramRouting != null) {
              r.retainAll(paramRouting);
            }
            if (r.isEmpty()) {
              routings.remove(indexRouting.key);
            }
          }
 else {
            if (!norouting.contains(indexRouting.key)) {
              norouting.add(indexRouting.key);
              if (paramRouting != null) {
                Set<String> r=new HashSet<>(paramRouting);
                if (routings == null) {
                  routings=newHashMap();
                }
                routings.put(indexRouting.key,r);
              }
 else {
                if (routings != null) {
                  routings.remove(indexRouting.key);
                }
              }
            }
          }
        }
      }
    }
 else {
      if (!norouting.contains(aliasOrIndex)) {
        norouting.add(aliasOrIndex);
        if (paramRouting != null) {
          Set<String> r=new HashSet<>(paramRouting);
          if (routings == null) {
            routings=newHashMap();
          }
          routings.put(aliasOrIndex,r);
        }
 else {
          if (routings != null) {
            routings.remove(aliasOrIndex);
          }
        }
      }
    }
  }
  if (routings == null || routings.isEmpty()) {
    return null;
  }
  return routings;
}
