{
  if (aliasOrIndex == null) {
    if (routing == null) {
      return parent;
    }
    return routing;
  }
  AliasOrIndex result=getAliasAndIndexLookup().get(aliasOrIndex);
  if (result == null || result.isAlias() == false) {
    if (routing == null) {
      return parent;
    }
    return routing;
  }
  AliasOrIndex.Alias alias=(AliasOrIndex.Alias)result;
  if (result.getIndices().size() > 1) {
    String[] indexNames=new String[result.getIndices().size()];
    int i=0;
    for (    IndexMetaData indexMetaData : result.getIndices()) {
      indexNames[i++]=indexMetaData.getIndex().getName();
    }
    throw new IllegalArgumentException("Alias [" + aliasOrIndex + "] has more than one index associated with it ["+ Arrays.toString(indexNames)+ "], can't execute a single index op");
  }
  AliasMetaData aliasMd=alias.getFirstAliasMetaData();
  if (aliasMd.indexRouting() != null) {
    if (aliasMd.indexRouting().indexOf(',') != -1) {
      throw new IllegalArgumentException("index/alias [" + aliasOrIndex + "] provided with routing value ["+ aliasMd.getIndexRouting()+ "] that resolved to several routing values, rejecting operation");
    }
    if (routing != null) {
      if (!routing.equals(aliasMd.indexRouting())) {
        throw new IllegalArgumentException("Alias [" + aliasOrIndex + "] has index routing associated with it ["+ aliasMd.indexRouting()+ "], and was provided with routing value ["+ routing+ "], rejecting operation");
      }
    }
    return aliasMd.indexRouting();
  }
  if (routing == null) {
    return parent;
  }
  return routing;
}
