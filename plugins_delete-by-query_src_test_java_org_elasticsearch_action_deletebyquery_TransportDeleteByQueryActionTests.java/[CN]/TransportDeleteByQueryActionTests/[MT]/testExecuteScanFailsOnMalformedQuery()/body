{
  createIndex("test");
  DeleteByQueryRequest delete=new DeleteByQueryRequest().indices("test").source("{...}");
  TestActionListener listener=new TestActionListener();
  newAsyncAction(delete,listener).executeScan();
  waitForCompletion("scan request should fail on malformed query",listener);
  assertFailure(listener,"all shards failed");
  assertSearchContextsClosed();
}
