{
  Directory d=dir;
  if (dir instanceof FilterDirectory) {
    d=getLeafDirectory((FilterDirectory)dir);
  }
  if (targetClass.isAssignableFrom(d.getClass())) {
    return targetClass.cast(d);
  }
 else {
    return defaultValue;
  }
}
