{
  Directory current=dir;
  while (true) {
    if (current instanceof Store.StoreDirectory) {
      return (Store.StoreDirectory)current;
    }
    if (current instanceof FilterDirectory) {
      current=((FilterDirectory)current).getDelegate();
    }
 else     if (current instanceof CompoundFileDirectory) {
      current=((CompoundFileDirectory)current).getDirectory();
    }
 else {
      return null;
    }
  }
}
