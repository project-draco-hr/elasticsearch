{
  BytesReference ref=getRandomizedBytesReference(randomIntBetween(1,3 * PAGE_SIZE));
  ChannelBuffer channelBuffer=NettyUtils.toChannelBuffer(ref);
  BytesReference bytesReference=NettyUtils.toBytesReference(channelBuffer);
  if (ref instanceof ChannelBufferBytesReference) {
    assertEquals(channelBuffer,((ChannelBufferBytesReference)ref).toChannelBuffer());
  }
 else   if (ref.hasArray() == false) {
    assertTrue(channelBuffer instanceof CompositeChannelBuffer);
  }
  assertArrayEquals(ref.toBytes(),bytesReference.toBytes());
}
