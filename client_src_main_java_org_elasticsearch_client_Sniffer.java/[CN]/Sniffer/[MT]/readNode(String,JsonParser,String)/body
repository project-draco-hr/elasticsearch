{
  HttpHost httpHost=null;
  Set<Node.Role> roles=new HashSet<>();
  Map<String,String> attributes=new HashMap<>();
  String fieldName=null;
  while (parser.nextToken() != JsonToken.END_OBJECT) {
    if (parser.getCurrentToken() == JsonToken.FIELD_NAME) {
      fieldName=parser.getCurrentName();
    }
 else     if (parser.getCurrentToken() == JsonToken.START_ARRAY && "roles".equals(fieldName)) {
      while (parser.nextToken() != JsonToken.END_ARRAY) {
        roles.add(Node.Role.valueOf(parser.getValueAsString().toUpperCase(Locale.ROOT)));
      }
    }
 else     if (parser.getCurrentToken() == JsonToken.START_OBJECT) {
      if ("attributes".equals(fieldName)) {
        while (parser.nextToken() != JsonToken.END_OBJECT) {
          attributes.put(parser.getCurrentName(),parser.getValueAsString());
        }
      }
 else       if ("http".equals(fieldName)) {
        while (parser.nextToken() != JsonToken.END_OBJECT) {
          if (parser.getCurrentToken() == JsonToken.VALUE_STRING && "publish_address".equals(parser.getCurrentName())) {
            URI boundAddressAsURI=URI.create(scheme + "://" + parser.getValueAsString());
            httpHost=new HttpHost(boundAddressAsURI.getHost(),boundAddressAsURI.getPort(),boundAddressAsURI.getScheme());
          }
 else           if (parser.getCurrentToken() == JsonToken.START_OBJECT) {
            parser.skipChildren();
          }
        }
      }
 else {
        parser.skipChildren();
      }
    }
  }
  if (httpHost == null) {
    logger.debug("skipping node [" + nodeId + "] with http disabled");
    return null;
  }
  return new Node(httpHost,roles,attributes);
}
