{
  if (serverChannel != null) {
    try {
      serverChannel.close().awaitUninterruptibly();
    }
  finally {
      serverChannel=null;
    }
  }
  if (serverOpenChannels != null) {
    serverOpenChannels.close();
    serverOpenChannels=null;
  }
  if (serverBootstrap != null) {
    serverBootstrap.releaseExternalResources();
    serverBootstrap=null;
  }
  for (Iterator<Channel> it=connectedNodes.values().iterator(); it.hasNext(); ) {
    Channel channel=it.next();
    it.remove();
    closeChannel(channel);
  }
  if (clientBootstrap != null) {
    clientBootstrap.releaseExternalResources();
    clientBootstrap=null;
  }
}
