{
  if (!lifecycle.started()) {
    throw new ElasticSearchIllegalStateException("Can't add nodes to a stopped transport");
  }
  try {
    if (node == null) {
      throw new ConnectTransportException(node,"Can't connect to a null node");
    }
    Channel channel=connectedNodes.get(node);
    if (channel != null) {
      return;
    }
synchronized (this) {
      channel=connectedNodes.get(node);
      if (channel != null) {
        return;
      }
      InetSocketAddress address=((InetSocketTransportAddress)node.address()).address();
      ChannelFuture connectFuture=clientBootstrap.connect(address);
      connectFuture.awaitUninterruptibly((long)(connectTimeout.millis() * 1.25));
      if (!connectFuture.isSuccess()) {
        throw new ConnectTransportException(node,"connect_timeout[" + connectTimeout + "]",connectFuture.getCause());
      }
      channel=connectFuture.getChannel();
      channel.getCloseFuture().addListener(new ChannelCloseListener(node));
      connectedNodes.put(node,channel);
      if (logger.isDebugEnabled()) {
        logger.debug("Connected to node [{}]",node);
      }
    }
    transportServiceAdapter.raiseNodeConnected(node);
  }
 catch (  Exception e) {
    throw new ConnectTransportException(node,"General node connection failure",e);
  }
}
