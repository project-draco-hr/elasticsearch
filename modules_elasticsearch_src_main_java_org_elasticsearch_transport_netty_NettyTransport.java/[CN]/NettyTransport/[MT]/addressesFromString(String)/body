{
  int index=address.indexOf('[');
  if (index != -1) {
    String host=address.substring(0,index);
    Set<String> ports=Strings.commaDelimitedListToSet(address.substring(index + 1,address.indexOf(']')));
    List<TransportAddress> addresses=Lists.newArrayList();
    for (    String port : ports) {
      int[] iPorts=new PortsRange(port).ports();
      for (      int iPort : iPorts) {
        addresses.add(new InetSocketTransportAddress(host,iPort));
      }
    }
    return addresses.toArray(new TransportAddress[addresses.size()]);
  }
 else {
    index=address.lastIndexOf(':');
    if (index == -1) {
      throw new ElasticSearchIllegalStateException("Port must be provided to create inet address from [" + address + "]");
    }
    String host=address.substring(0,index);
    int port=Integer.parseInt(address.substring(index + 1));
    return new TransportAddress[]{new InetSocketTransportAddress(host,port)};
  }
}
