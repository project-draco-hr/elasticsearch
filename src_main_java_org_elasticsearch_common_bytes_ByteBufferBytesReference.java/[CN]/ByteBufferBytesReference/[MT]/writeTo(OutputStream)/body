{
  if (buffer.hasArray()) {
    os.write(buffer.array(),buffer.arrayOffset() + buffer.position(),buffer.remaining());
  }
 else {
    byte[] tmp=new byte[8192];
    ByteBuffer buf=buffer.duplicate();
    while (buf.hasRemaining()) {
      buf.get(tmp,0,Math.min(tmp.length,buf.remaining()));
      os.write(tmp);
    }
  }
}
