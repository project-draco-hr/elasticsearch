{
  client().prepareIndex("test","doc","1").setSource("foo",5).setRefresh(true).get();
  try {
    client().prepareSearch("test").setSource("{\"query\": {\"match_all\": {}}," + "\"sort\":{\"_script\": {\"script\": \"doc['foo'].value + 2\", \"type\": \"number\", \"lang\": \"groovy\"}}}").get();
    fail("shards should fail because the sandbox and dynamic scripting are disabled");
  }
 catch (  Exception e) {
    assertThat(ExceptionsHelper.detailedMessage(e),containsString("scripts of type [inline], operation [search] and lang [groovy] are disabled"));
  }
}
