{
  Builder builder=ImmutableSettings.settingsBuilder().put(defaultSettings).put(getRandomNodeSettings(nodeSeed)).put(FilterCacheModule.FilterCacheSettings.FILTER_CACHE_TYPE,hasFilterCache() ? WeightedFilterCache.class : NoneFilterCache.class);
  Settings settings=nodeSettingsSource.settings(nodeOrdinal);
  if (settings != null) {
    if (settings.get(ClusterName.SETTING) != null) {
      throw new ElasticsearchIllegalStateException("Tests must not set a '" + ClusterName.SETTING + "' as a node setting set '"+ ClusterName.SETTING+ "': ["+ settings.get(ClusterName.SETTING)+ "]");
    }
    builder.put(settings);
  }
  if (others != null) {
    builder.put(others);
  }
  builder.put(ClusterName.SETTING,clusterName);
  return builder.build();
}
