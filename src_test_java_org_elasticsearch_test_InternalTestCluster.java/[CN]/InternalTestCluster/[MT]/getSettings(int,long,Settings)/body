{
  Builder builder=ImmutableSettings.settingsBuilder().put(defaultSettings).put(getRandomNodeSettings(nodeSeed));
  Settings settings=settingsSource.node(nodeOrdinal);
  if (settings != null) {
    if (settings.get(ClusterName.SETTING) != null) {
      throw new ElasticsearchIllegalStateException("Tests must not set a '" + ClusterName.SETTING + "' as a node setting set '"+ ClusterName.SETTING+ "': ["+ settings.get(ClusterName.SETTING)+ "]");
    }
    builder.put(settings);
  }
  if (others != null) {
    builder.put(others);
  }
  builder.put(ClusterName.SETTING,clusterName);
  return builder.build();
}
