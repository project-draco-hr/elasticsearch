{
  assertThat(shard,greaterThanOrEqualTo(0));
  assertThat(shard,greaterThanOrEqualTo(0));
  for (  NodeAndClient n : nodes.values()) {
    InternalNode node=(InternalNode)n.node;
    IndicesService indicesService=getInstanceFromNode(IndicesService.class,node);
    ClusterService clusterService=getInstanceFromNode(ClusterService.class,node);
    IndexService indexService=indicesService.indexService(index);
    if (indexService != null) {
      assertThat(indexService.settingsService().getSettings().getAsInt(IndexMetaData.SETTING_NUMBER_OF_SHARDS,-1),greaterThan(shard));
      OperationRouting operationRouting=indexService.injector().getInstance(OperationRouting.class);
      while (true) {
        String routing=RandomStrings.randomAsciiOfLength(random,10);
        final int targetShard=operationRouting.indexShards(clusterService.state(),index,type,null,routing).shardId().getId();
        if (shard == targetShard) {
          return routing;
        }
      }
    }
  }
  fail("Could not find a node that holds " + index);
  return null;
}
