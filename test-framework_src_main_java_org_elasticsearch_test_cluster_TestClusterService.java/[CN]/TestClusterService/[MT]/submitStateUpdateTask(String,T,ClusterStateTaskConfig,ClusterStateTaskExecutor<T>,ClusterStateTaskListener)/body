{
  logger.debug("processing [{}]",source);
  if (state().nodes().localNodeMaster() == false && executor.runOnlyOnMaster()) {
    listener.onNoLongerMaster(source);
    logger.debug("failed [{}], no longer master",source);
    return;
  }
  ClusterStateTaskExecutor.Result result;
  ClusterState previousClusterState=state;
  try {
    result=executor.execute(previousClusterState,Arrays.asList(task));
  }
 catch (  Exception e) {
    result=new ClusterStateTaskExecutor.Result(previousClusterState,Arrays.asList(e));
  }
  if (result.failures.get(0) != null) {
    listener.onFailure(source,new ElasticsearchException("failed to process cluster state update task [" + source + "]",result.failures.get(0)));
    return;
  }
  setStateAndNotifyListeners(result.resultingState);
  listener.clusterStateProcessed(source,previousClusterState,result.resultingState);
  logger.debug("finished [{}]",source);
}
