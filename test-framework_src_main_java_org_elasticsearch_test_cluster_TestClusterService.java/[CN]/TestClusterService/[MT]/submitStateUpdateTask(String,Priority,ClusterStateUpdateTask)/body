{
  logger.debug("processing [{}]",source);
  if (state().nodes().localNodeMaster() == false && updateTask.runOnlyOnMaster()) {
    updateTask.onNoLongerMaster(source);
    logger.debug("failed [{}], no longer master",source);
    return;
  }
  ClusterState newState;
  ClusterState previousClusterState=state;
  try {
    newState=updateTask.execute(previousClusterState);
  }
 catch (  Exception e) {
    updateTask.onFailure(source,new ElasticsearchException("failed to process cluster state update task [" + source + "]",e));
    return;
  }
  setStateAndNotifyListeners(newState);
  if (updateTask instanceof ClusterStateUpdateTask) {
    ((ClusterStateUpdateTask)updateTask).clusterStateProcessed(source,previousClusterState,newState);
  }
  logger.debug("finished [{}]",source);
}
