{
  List<DocIdSet> iterators=new ArrayList<DocIdSet>(sets.length);
  List<Bits> bits=new ArrayList<Bits>(sets.length);
  for (  DocIdSet set : sets) {
    if (DocIdSets.isFastIterator(set)) {
      iterators.add(set);
    }
 else {
      Bits bit=set.bits();
      if (bit != null) {
        bits.add(bit);
      }
 else {
        iterators.add(set);
      }
    }
  }
  if (bits.isEmpty()) {
    return new IteratorBasedIterator(iterators.toArray(new DocIdSet[iterators.size()]));
  }
  if (iterators.isEmpty()) {
    return new BitsDocIdSetIterator(new AndBits(bits.toArray(new Bits[bits.size()])));
  }
  return new BitsDocIdSetIterator.FilteredIterator(new IteratorBasedIterator(iterators.toArray(new DocIdSet[iterators.size()])),new AndBits(bits.toArray(new Bits[bits.size()])));
}
