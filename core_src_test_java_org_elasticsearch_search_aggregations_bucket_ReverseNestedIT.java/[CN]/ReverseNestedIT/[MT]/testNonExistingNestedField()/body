{
  SearchResponse searchResponse=client().prepareSearch("idx").setQuery(matchAllQuery()).addAggregation(nested("nested2").path("nested1.nested2").subAggregation(reverseNested("incorrect").path("nested3"))).execute().actionGet();
  Nested nested=searchResponse.getAggregations().get("nested2");
  assertThat(nested,Matchers.notNullValue());
  assertThat(nested.getName(),equalTo("nested2"));
  ReverseNested reverseNested=nested.getAggregations().get("incorrect");
  assertThat(reverseNested.getDocCount(),is(0l));
}
