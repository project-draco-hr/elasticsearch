{
  indexWriter.addDocument(doc().add(field("test","1")).build());
  indexWriter.commit();
  assertThat(listCommits(dir).size(),equalTo(1));
  SnapshotIndexCommit snapshot1=deletionPolicy.snapshot();
  SnapshotIndexCommit snapshot2=deletionPolicy.snapshot();
  indexWriter.addDocument(doc().add(field("test","1")).build());
  indexWriter.commit();
  assertThat(listCommits(dir).size(),equalTo(2));
  assertThat(snapshot1.release(),equalTo(true));
  indexWriter.addDocument(doc().add(field("test","1")).build());
  indexWriter.commit();
  assertThat(listCommits(dir).size(),equalTo(2));
  assertThat(snapshot2.release(),equalTo(true));
  indexWriter.addDocument(doc().add(field("test","1")).build());
  indexWriter.commit();
  assertThat(listCommits(dir).size(),equalTo(1));
}
