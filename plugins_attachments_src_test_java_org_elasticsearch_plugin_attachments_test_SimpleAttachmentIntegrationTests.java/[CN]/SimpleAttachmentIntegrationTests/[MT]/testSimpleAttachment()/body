{
  String mapping=copyToStringFromClasspath("/org/elasticsearch/plugin/attachments/index/mapper/test-mapping.json");
  node.client().admin().indices().putMapping(putMappingRequest("test").mappingSource(mapping)).actionGet();
  node.client().index(indexRequest("test").type("person").source(jsonBuilder().startObject().field("file",copyToBytesFromClasspath("/org/elasticsearch/plugin/attachments/index/mapper/testXHTML.html")).endObject())).actionGet();
  node.client().admin().indices().refresh(refreshRequest()).actionGet();
  CountResponse countResponse=node.client().count(countRequest("test").querySource(fieldQuery("file.title","test document"))).actionGet();
  assertThat(countResponse.count(),equalTo(1l));
  countResponse=node.client().count(countRequest("test").querySource(fieldQuery("file","tests the ability"))).actionGet();
  assertThat(countResponse.count(),equalTo(1l));
}
