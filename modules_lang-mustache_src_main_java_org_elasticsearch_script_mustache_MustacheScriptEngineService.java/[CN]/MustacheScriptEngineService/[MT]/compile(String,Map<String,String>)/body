{
  String contentType=params.getOrDefault(CONTENT_TYPE_PARAM,JSON_CONTENT_TYPE);
  final DefaultMustacheFactory mustacheFactory;
switch (contentType) {
case PLAIN_TEXT_CONTENT_TYPE:
    mustacheFactory=new NoneEscapingMustacheFactory();
  break;
case JSON_CONTENT_TYPE:
default :
mustacheFactory=new JsonEscapingMustacheFactory();
break;
}
mustacheFactory.setObjectHandler(new CustomReflectionObjectHandler());
Reader reader=new FastStringReader(template);
return mustacheFactory.compile(reader,"query-template");
}
