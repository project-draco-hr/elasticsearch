{
  final BytesStreamOutput result=new BytesStreamOutput();
  try (UTF8StreamWriter writer=utf8StreamWriter().setOutput(result)){
    SecurityManager sm=System.getSecurityManager();
    if (sm != null) {
      sm.checkPermission(SPECIAL_PERMISSION);
    }
    AccessController.doPrivileged(new PrivilegedAction<Void>(){
      @Override public Void run(){
        ((Mustache)template.compiled()).execute(writer,vars);
        return null;
      }
    }
);
  }
 catch (  Exception e) {
    logger.error("Error running " + template,e);
    throw new ScriptException("Error running " + template,e);
  }
  return result.bytes();
}
