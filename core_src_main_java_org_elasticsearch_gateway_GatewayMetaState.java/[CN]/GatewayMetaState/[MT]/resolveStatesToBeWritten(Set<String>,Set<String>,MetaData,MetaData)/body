{
  List<GatewayMetaState.IndexMetaWriteInfo> indicesToWrite=new ArrayList<>();
  for (  String index : potentiallyUnwrittenIndices) {
    IndexMetaData newIndexMetaData=newMetaData.index(index);
    IndexMetaData previousIndexMetaData=previousMetaData == null ? null : previousMetaData.index(index);
    String writeReason=null;
    if (previouslyWrittenIndices.contains(index) == false || previousIndexMetaData == null) {
      writeReason="freshly created";
    }
 else     if (previousIndexMetaData.version() != newIndexMetaData.version()) {
      writeReason="version changed from [" + previousIndexMetaData.version() + "] to ["+ newIndexMetaData.version()+ "]";
    }
    if (writeReason != null) {
      indicesToWrite.add(new GatewayMetaState.IndexMetaWriteInfo(newIndexMetaData,previousIndexMetaData,writeReason));
    }
  }
  return indicesToWrite;
}
