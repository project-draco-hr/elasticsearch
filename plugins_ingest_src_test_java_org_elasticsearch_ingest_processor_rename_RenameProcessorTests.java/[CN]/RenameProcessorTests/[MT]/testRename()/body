{
  IngestDocument ingestDocument=RandomDocumentPicks.randomIngestDocument(random());
  int numFields=randomIntBetween(1,5);
  Map<String,String> fields=new HashMap<>();
  Map<String,Object> newFields=new HashMap<>();
  for (int i=0; i < numFields; i++) {
    String fieldName=RandomDocumentPicks.randomExistingFieldName(random(),ingestDocument);
    if (fields.containsKey(fieldName)) {
      continue;
    }
    String newFieldName;
    do {
      newFieldName=RandomDocumentPicks.randomFieldName(random());
    }
 while (RandomDocumentPicks.canAddField(newFieldName,ingestDocument) == false || newFields.containsKey(newFieldName));
    newFields.put(newFieldName,ingestDocument.getFieldValue(fieldName,Object.class));
    fields.put(fieldName,newFieldName);
  }
  Processor processor=new RenameProcessor(fields);
  processor.execute(ingestDocument);
  for (  Map.Entry<String,Object> entry : newFields.entrySet()) {
    assertThat(ingestDocument.getFieldValue(entry.getKey(),Object.class),equalTo(entry.getValue()));
  }
}
