{
  String threadPoolName=randomThreadPoolName();
  ThreadPool.ThreadPoolType invalidThreadPoolType=randomIncorrectThreadPoolType(threadPoolName);
  ThreadPool.ThreadPoolType validThreadPoolType=ThreadPool.THREAD_POOL_TYPES.get(threadPoolName);
  ThreadPool threadPool=null;
  try {
    threadPool=new ThreadPool(Settings.builder().put("node.name","testUpdateSettingsCanNotChangeThreadPoolType").build());
    ClusterSettings clusterSettings=new ClusterSettings(Settings.EMPTY,ClusterSettings.BUILT_IN_CLUSTER_SETTINGS);
    threadPool.setClusterSettings(clusterSettings);
    clusterSettings.applySettings(Settings.builder().put("threadpool." + threadPoolName + ".type",invalidThreadPoolType.getType()).build());
    fail("expected IllegalArgumentException");
  }
 catch (  IllegalArgumentException e) {
    assertEquals("illegal value can't update [threadpool.] from [{}] to [{" + threadPoolName + ".type="+ invalidThreadPoolType.getType()+ "}]",e.getMessage());
    assertThat(e.getCause().getMessage(),is("setting threadpool." + threadPoolName + ".type to "+ invalidThreadPoolType.getType()+ " is not permitted; must be "+ validThreadPoolType.getType()));
  }
 finally {
    terminateThreadPoolIfNeeded(threadPool);
  }
}
