{
  String threadPoolName=randomThreadPool(ThreadPool.ThreadPoolType.FIXED);
  ThreadPool threadPool=null;
  try {
    Settings nodeSettings=Settings.settingsBuilder().put("name","testFixedExecutorType").build();
    threadPool=new ThreadPool(nodeSettings);
    ClusterSettingsService clusterSettingsService=new ClusterSettingsService(nodeSettings,new ClusterSettings(ClusterSettings.BUILT_IN_CLUSTER_SETTINGS));
    threadPool.setNodeSettingsService(clusterSettingsService);
    assertThat(threadPool.executor(threadPoolName),instanceOf(EsThreadPoolExecutor.class));
    Settings settings=clusterSettingsService.applySettings(settingsBuilder().put("threadpool." + threadPoolName + ".size","15").build());
    assertEquals(info(threadPool,threadPoolName).getThreadPoolType(),ThreadPool.ThreadPoolType.FIXED);
    assertThat(threadPool.executor(threadPoolName),instanceOf(EsThreadPoolExecutor.class));
    assertThat(((EsThreadPoolExecutor)threadPool.executor(threadPoolName)).getCorePoolSize(),equalTo(15));
    assertThat(((EsThreadPoolExecutor)threadPool.executor(threadPoolName)).getMaximumPoolSize(),equalTo(15));
    assertThat(info(threadPool,threadPoolName).getMin(),equalTo(15));
    assertThat(info(threadPool,threadPoolName).getMax(),equalTo(15));
    assertThat(((EsThreadPoolExecutor)threadPool.executor(threadPoolName)).getKeepAliveTime(TimeUnit.MINUTES),equalTo(0L));
    settings=clusterSettingsService.applySettings(Settings.EMPTY);
    assertEquals(info(threadPool,threadPoolName).getThreadPoolType(),ThreadPool.ThreadPoolType.FIXED);
    assertThat(info(threadPool,threadPoolName).getKeepAlive(),nullValue());
    assertThat(info(threadPool,threadPoolName).getMin(),equalTo(15));
    assertThat(info(threadPool,threadPoolName).getMax(),equalTo(15));
    assertThat(threadPool.executor(threadPoolName),instanceOf(EsThreadPoolExecutor.class));
    assertThat(((EsThreadPoolExecutor)threadPool.executor(threadPoolName)).getCorePoolSize(),equalTo(15));
    assertThat(((EsThreadPoolExecutor)threadPool.executor(threadPoolName)).getMaximumPoolSize(),equalTo(15));
    Executor oldExecutor=threadPool.executor(threadPoolName);
    settings=clusterSettingsService.applySettings(settingsBuilder().put(settings).put("threadpool." + threadPoolName + ".size","10").build());
    assertThat(info(threadPool,threadPoolName).getMax(),equalTo(10));
    assertThat(info(threadPool,threadPoolName).getMin(),equalTo(10));
    assertThat(((EsThreadPoolExecutor)threadPool.executor(threadPoolName)).getMaximumPoolSize(),equalTo(10));
    assertThat(((EsThreadPoolExecutor)threadPool.executor(threadPoolName)).getCorePoolSize(),equalTo(10));
    assertEquals(info(threadPool,threadPoolName).getThreadPoolType(),ThreadPool.ThreadPoolType.FIXED);
    assertThat(threadPool.executor(threadPoolName),sameInstance(oldExecutor));
    settings=clusterSettingsService.applySettings(settingsBuilder().put(settings).put("threadpool." + threadPoolName + ".queue","500").build());
  }
  finally {
    terminateThreadPoolIfNeeded(threadPool);
  }
}
