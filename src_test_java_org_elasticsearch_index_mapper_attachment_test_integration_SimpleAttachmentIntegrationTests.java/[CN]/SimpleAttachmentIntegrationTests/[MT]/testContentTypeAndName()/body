{
  String dummyContentType="text/my-dummy-content-type";
  String dummyName="my-dummy-name-txt";
  String mapping=copyToStringFromClasspath("/org/elasticsearch/index/mapper/attachment/test/integration/simple/test-mapping-store-content-type.json");
  byte[] txt=copyToBytesFromClasspath("/org/elasticsearch/index/mapper/attachment/test/sample-files/testContentLength.txt");
  client().admin().indices().putMapping(putMappingRequest("test").type("person").source(mapping)).actionGet();
  index("test","person",jsonBuilder().startObject().field("file").startObject().field("_content",txt).field("_content_type",dummyContentType).field("_name",dummyName).endObject());
  refresh();
  SearchResponse response=client().prepareSearch("test").addField("file.content_type").addField("file.name").execute().get();
  logger.info("{}",response);
  assertThat(response.getHits().totalHits(),is(1L));
  if (assertThatWithError(response.getHits().getAt(0).getFields().get("file.content_type"),notNullValue())) {
    String contentType=response.getHits().getAt(0).getFields().get("file.content_type").getValue();
    assertThat(contentType,is(dummyContentType));
  }
  if (assertThatWithError(response.getHits().getAt(0).getFields().get("file.name"),notNullValue())) {
    String name=response.getHits().getAt(0).getFields().get("file.name").getValue();
    assertThat(name,is(dummyName));
  }
}
