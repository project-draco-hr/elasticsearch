{
  String mapping=copyToStringFromClasspath("/org/elasticsearch/index/mapper/attachment/test/integration/simple/test-mapping.json");
  byte[] txt=copyToBytesFromClasspath("/org/elasticsearch/index/mapper/attachment/test/sample-files/testContentLength.txt");
  final int CONTENT_LENGTH_LIMIT=20;
  client().admin().indices().putMapping(putMappingRequest("test").type("person").source(mapping)).actionGet();
  index("test","person",jsonBuilder().startObject().field("file").startObject().field("_content",txt).field("_indexed_chars",CONTENT_LENGTH_LIMIT).endObject());
  refresh();
  CountResponse countResponse=client().prepareCount("test").setQuery(queryStringQuery("BeforeLimit").defaultField("file.content")).execute().get();
  assertThatWithError(countResponse.getCount(),equalTo(1l));
  countResponse=client().prepareCount("test").setQuery(queryStringQuery("AfterLimit").defaultField("file.content")).execute().get();
  assertThat(countResponse.getCount(),equalTo(0l));
}
