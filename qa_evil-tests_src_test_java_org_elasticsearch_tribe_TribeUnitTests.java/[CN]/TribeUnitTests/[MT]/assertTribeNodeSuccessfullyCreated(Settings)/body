{
  Settings settings=Settings.builder().put("http.enabled",false).put("node.name","tribe_node").put("tribe.t1.node.mode",NODE_MODE).put("tribe.t2.node.mode",NODE_MODE).put(Environment.PATH_HOME_SETTING.getKey(),createTempDir()).put(Node.NODE_MODE_SETTING.getKey(),NODE_MODE).put(extraSettings).build();
  try (Node node=new Node(settings).start()){
    try (Client client=node.client()){
      assertBusy(new Runnable(){
        @Override public void run(){
          ClusterState state=client.admin().cluster().prepareState().clear().setNodes(true).get().getState();
          assertThat(state.getClusterName().value(),equalTo("tribe_node_cluster"));
          assertThat(state.getNodes().getSize(),equalTo(5));
          for (          DiscoveryNode discoveryNode : state.getNodes()) {
            assertThat(discoveryNode.getName(),either(equalTo("tribe1_node")).or(equalTo("tribe2_node")).or(equalTo("tribe_node")).or(equalTo("tribe_node/t1")).or(equalTo("tribe_node/t2")));
          }
        }
      }
);
    }
   }
 }
