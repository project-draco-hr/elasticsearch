{
  searchContext.idCache().refresh(searchContext.searcher().getTopReaderContext().leaves());
  collectedUids=searchContext.cacheRecycler().popHashSet();
  UidCollector collector=new UidCollector(parentType,searchContext,collectedUids);
  searchContext.searcher().search(childQuery,collector);
  remaining=collectedUids.size();
  if (remaining == 0) {
    shortCircuitFilter=Queries.MATCH_NO_FILTER;
  }
 else   if (remaining == 1) {
    BytesRef id=collectedUids.iterator().next().toBytesRef();
    shortCircuitFilter=new TermFilter(new Term(UidFieldMapper.NAME,Uid.createUidAsBytes(parentType,id)));
  }
 else   if (remaining <= shortCircuitParentDocSet) {
    shortCircuitFilter=new ParentIdsFilter(parentType,collectedUids);
  }
}
