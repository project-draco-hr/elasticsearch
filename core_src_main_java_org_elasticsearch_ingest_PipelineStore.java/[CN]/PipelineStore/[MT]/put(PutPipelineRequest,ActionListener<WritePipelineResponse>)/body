{
  try {
    Map<String,Object> pipelineConfig=XContentHelper.convertToMap(request.source(),false).v2();
    constructPipeline(request.id(),pipelineConfig);
  }
 catch (  Exception e) {
    throw new IllegalArgumentException("Invalid pipeline configuration",e);
  }
  clusterService.submitStateUpdateTask("put-pipeline-" + request.id(),new AckedClusterStateUpdateTask<WritePipelineResponse>(request,listener){
    @Override protected WritePipelineResponse newResponse(    boolean acknowledged){
      return new WritePipelineResponse(acknowledged);
    }
    @Override public ClusterState execute(    ClusterState currentState) throws Exception {
      return innerPut(request,currentState);
    }
  }
);
}
