{
  client.admin().indices().prepareDelete("test").execute().actionGet();
  client.admin().indices().prepareCreate("test").setSettings(ImmutableSettings.settingsBuilder().put("index.refresh_interval",-1)).execute().actionGet();
  client.prepareIndex("test","test","1").setSource("field","value1").execute().actionGet();
  ExplainResponse response=client.prepareExplain("test","test","1").setQuery(QueryBuilders.matchAllQuery()).execute().actionGet();
  assertNotNull(response);
  assertFalse(response.exists());
  assertFalse(response.match());
  client.admin().indices().prepareRefresh("test").execute().actionGet();
  response=client.prepareExplain("test","test","1").setQuery(QueryBuilders.matchAllQuery()).execute().actionGet();
  assertNotNull(response);
  assertTrue(response.match());
  assertNotNull(response.explanation());
  assertTrue(response.explanation().isMatch());
  assertThat(response.explanation().getValue(),equalTo(1.0f));
  client.admin().indices().prepareRefresh("test").execute().actionGet();
  response=client.prepareExplain("test","test","1").setQuery(QueryBuilders.termQuery("field","value2")).execute().actionGet();
  assertNotNull(response);
  assertTrue(response.exists());
  assertFalse(response.match());
  assertNotNull(response.explanation());
  assertFalse(response.explanation().isMatch());
  client.admin().indices().prepareRefresh("test").execute().actionGet();
  response=client.prepareExplain("test","test","1").setQuery(QueryBuilders.boolQuery().must(QueryBuilders.termQuery("field","value1")).must(QueryBuilders.termQuery("field","value2"))).execute().actionGet();
  assertNotNull(response);
  assertTrue(response.exists());
  assertFalse(response.match());
  assertNotNull(response.explanation());
  assertFalse(response.explanation().isMatch());
  assertThat(response.explanation().getDetails().length,equalTo(2));
  response=client.prepareExplain("test","test","2").setQuery(QueryBuilders.matchAllQuery()).execute().actionGet();
  assertNotNull(response);
  assertFalse(response.exists());
  assertFalse(response.match());
}
