{
  cluster().ensureAtLeastNumNodes(2);
  try {
    client().admin().indices().prepareDelete("test").execute().actionGet();
  }
 catch (  IndexMissingException e) {
  }
  client().admin().indices().prepareCreate("test").execute().actionGet();
  client().admin().cluster().prepareHealth("test").setWaitForGreenStatus().execute().actionGet();
  client().prepareIndex("test","test","1").setSource(jsonBuilder().startObject().startObject("obj1").field("field1","value1").field("field2","value2").endObject().endObject()).execute().actionGet();
  client().admin().indices().prepareRefresh("test").execute().actionGet();
  ExplainResponse response=client().prepareExplain("test","test","1").setQuery(QueryBuilders.matchAllQuery()).setFields("obj1.field1").execute().actionGet();
  assertNotNull(response);
  assertTrue(response.isMatch());
  assertNotNull(response.getExplanation());
  assertTrue(response.getExplanation().isMatch());
  assertThat(response.getExplanation().getValue(),equalTo(1.0f));
  assertThat(response.getGetResult().isExists(),equalTo(true));
  assertThat(response.getGetResult().getId(),equalTo("1"));
  assertThat(response.getGetResult().getFields().size(),equalTo(1));
  assertThat(response.getGetResult().getFields().get("obj1.field1").getValue().toString(),equalTo("value1"));
  response=client().prepareExplain("test","test","1").setQuery(QueryBuilders.matchAllQuery()).setFields("_source.obj1").execute().actionGet();
  assertNotNull(response);
  assertTrue(response.isMatch());
  assertThat(response.getGetResult().getFields().size(),equalTo(1));
  Map<String,String> fields=(Map<String,String>)response.getGetResult().field("_source.obj1").getValue();
  assertThat(fields.size(),equalTo(2));
  assertThat(fields.get("field1"),equalTo("value1"));
  assertThat(fields.get("field2"),equalTo("value2"));
}
