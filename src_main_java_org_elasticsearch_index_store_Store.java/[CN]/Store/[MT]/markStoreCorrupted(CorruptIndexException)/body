{
  ensureOpen();
  if (!isMarkedCorrupted()) {
    String uuid=CORRUPTED + Strings.randomBase64UUID();
    try (IndexOutput output=this.directory().createOutput(uuid,IOContext.DEFAULT)){
      CodecUtil.writeHeader(output,CODEC,VERSION);
      output.writeString(ExceptionsHelper.detailedMessage(exception,true,0));
      output.writeString(ExceptionsHelper.stackTrace(exception));
      CodecUtil.writeFooter(output);
    }
 catch (    IOException ex) {
      logger.warn("Can't mark store as corrupted",ex);
    }
    directory().sync(Collections.singleton(uuid));
  }
}
