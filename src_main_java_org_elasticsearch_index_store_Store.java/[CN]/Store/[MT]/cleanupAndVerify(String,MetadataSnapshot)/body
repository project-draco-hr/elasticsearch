{
  failIfCorrupted();
  metadataLock.writeLock().lock();
  try {
    final StoreDirectory dir=directory;
    for (    String existingFile : dir.listAll()) {
      if (!sourceMetaData.contains(existingFile) && !Store.isChecksum(existingFile)) {
        try {
          dir.deleteFile(reason,existingFile);
        }
 catch (        Exception ex) {
          logger.debug("failed to delete file [{}]",ex,existingFile);
        }
      }
    }
    final Store.MetadataSnapshot metadataOrEmpty=getMetadata();
    verifyAfterCleanup(sourceMetaData,metadataOrEmpty);
  }
  finally {
    metadataLock.writeLock().unlock();
  }
}
