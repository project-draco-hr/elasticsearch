{
  this.distributor=distributor;
synchronized (mutex) {
    ImmutableOpenMap.Builder<String,StoreFileMetaData> builder=ImmutableOpenMap.builder();
    Map<String,String> checksums=readChecksums(distributor.all(),new HashMap<String,String>());
    for (    Directory delegate : distributor.all()) {
      for (      String file : delegate.listAll()) {
        String checksum=checksums.get(file);
        builder.put(file,new StoreFileMetaData(file,delegate.fileLength(file),checksum,delegate));
      }
    }
    filesMetadata=builder.build();
    files=filesMetadata.keys().toArray(String.class);
  }
}
