{
  this.delegates=delegates;
synchronized (mutex) {
    MapBuilder<String,StoreFileMetaData> builder=MapBuilder.newMapBuilder();
    Map<String,String> checksums=readChecksums(delegates,new HashMap<String,String>());
    for (    Directory delegate : delegates) {
      for (      String file : delegate.listAll()) {
        String checksum=checksums.get(file);
        builder.put(file,new StoreFileMetaData(file,delegate.fileLength(file),checksum,delegate));
      }
    }
    filesMetadata=builder.immutableMap();
    files=filesMetadata.keySet().toArray(new String[filesMetadata.size()]);
  }
}
