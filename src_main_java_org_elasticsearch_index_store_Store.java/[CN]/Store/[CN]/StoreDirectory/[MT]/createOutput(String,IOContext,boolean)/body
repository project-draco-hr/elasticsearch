{
  Directory directory;
  if (isChecksum(name)) {
    directory=distributor.primary();
  }
 else {
    directory=distributor.any();
  }
  IndexOutput out=directory.createOutput(name,context);
synchronized (mutex) {
    StoreFileMetaData metaData=new StoreFileMetaData(name,-1,null,directory);
    filesMetadata=MapBuilder.newMapBuilder(filesMetadata).put(name,metaData).immutableMap();
    files=filesMetadata.keySet().toArray(new String[filesMetadata.size()]);
    boolean computeChecksum=!raw;
    if (computeChecksum) {
      if ("segments.gen".equals(name) || name.startsWith("segments")) {
        computeChecksum=false;
      }
    }
    if (computeChecksum) {
      out=new BufferedChecksumIndexOutput(out,new Adler32());
    }
    return new StoreIndexOutput(metaData,out,name);
  }
}
