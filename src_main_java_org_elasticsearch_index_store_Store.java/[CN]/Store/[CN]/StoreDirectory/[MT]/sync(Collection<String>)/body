{
  ensureOpen();
  if (sync) {
    Map<Directory,Collection<String>> map=Maps.newHashMap();
    for (    String name : names) {
      StoreFileMetaData metaData=filesMetadata.get(name);
      if (metaData == null) {
        throw new FileNotFoundException(name);
      }
      Collection<String> dirNames=map.get(metaData.directory());
      if (dirNames == null) {
        dirNames=new ArrayList<String>();
        map.put(metaData.directory(),dirNames);
      }
      dirNames.add(name);
    }
    for (    Map.Entry<Directory,Collection<String>> entry : map.entrySet()) {
      entry.getKey().sync(entry.getValue());
    }
  }
  for (  String name : names) {
    if (!name.equals("segments.gen") && name.startsWith("segments")) {
      writeChecksums();
      break;
    }
  }
}
