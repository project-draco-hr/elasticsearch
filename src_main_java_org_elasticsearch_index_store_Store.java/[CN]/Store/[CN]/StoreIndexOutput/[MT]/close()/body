{
  out.close();
  String checksum=null;
  IndexOutput underlying=out;
  if (underlying instanceof BufferedChecksumIndexOutput) {
    checksum=Long.toString(((BufferedChecksumIndexOutput)underlying).digest().getValue(),Character.MAX_RADIX);
  }
 else   if (underlying instanceof ChecksumIndexOutput) {
    checksum=Long.toString(((ChecksumIndexOutput)underlying).digest().getValue(),Character.MAX_RADIX);
  }
synchronized (mutex) {
    StoreFileMetaData md=new StoreFileMetaData(name,metaData.directory().fileLength(name),checksum,metaData.directory());
    filesMetadata=ImmutableOpenMap.builder(filesMetadata).fPut(name,md).build();
    files=filesMetadata.keys().toArray(String.class);
  }
}
