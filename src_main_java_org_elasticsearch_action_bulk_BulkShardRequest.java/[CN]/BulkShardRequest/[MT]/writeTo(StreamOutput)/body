{
  super.writeTo(out);
  out.writeVInt(shardId);
  out.writeVInt(items.length);
  for (  BulkItemRequest item : items) {
    if (item != null) {
      if (item.isIgnoreOnReplica() && out.getVersion().before(Version.V_1_4_0_Beta1)) {
        out.writeBoolean(false);
      }
 else {
        out.writeBoolean(true);
        item.writeTo(out);
      }
    }
 else {
      out.writeBoolean(false);
    }
  }
  out.writeBoolean(refresh);
}
