{
  MapperService mapperService=shardContext.getMapperService();
  final CompletionSuggestionContext suggestion=new CompletionSuggestionContext(shardContext);
  final ContextAndSuggest contextAndSuggest=new ContextAndSuggest(mapperService);
  TLP_PARSER.parse(parser,suggestion,contextAndSuggest);
  final XContentParser contextParser=contextAndSuggest.contextParser;
  MappedFieldType mappedFieldType=mapperService.fullName(suggestion.getField());
  if (mappedFieldType == null) {
    throw new ElasticsearchException("Field [" + suggestion.getField() + "] is not a completion suggest field");
  }
 else   if (mappedFieldType instanceof CompletionFieldMapper.CompletionFieldType) {
    CompletionFieldMapper.CompletionFieldType type=(CompletionFieldMapper.CompletionFieldType)mappedFieldType;
    if (type.hasContextMappings() == false && contextParser != null) {
      throw new IllegalArgumentException("suggester [" + type.name() + "] doesn't expect any context");
    }
    suggestion.setQueryContexts(CompletionSuggestionBuilder.parseQueryContexts(contextParser,type));
    suggestion.setFieldType(type);
    return suggestion;
  }
 else {
    throw new IllegalArgumentException("Field [" + suggestion.getField() + "] is not a completion suggest field");
  }
}
