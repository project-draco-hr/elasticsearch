{
  boolean cache=componentSettings.getAsBoolean("memory.enabled",false);
  if (!cache) {
    return null;
  }
  ByteSizeValue bufferSize=componentSettings.getAsBytesSize("memory.buffer_size",new ByteSizeValue(100,ByteSizeUnit.KB));
  ByteSizeValue cacheSize=componentSettings.getAsBytesSize("memory.cache_size",new ByteSizeValue(20,ByteSizeUnit.MB));
  boolean direct=componentSettings.getAsBoolean("memory.direct",true);
  boolean warmCache=componentSettings.getAsBoolean("memory.warm_cache",true);
  Directory memDir;
  if (direct) {
    memDir=new ByteBufferDirectory((int)bufferSize.bytes(),(int)cacheSize.bytes(),true,warmCache);
  }
 else {
    memDir=new HeapDirectory(bufferSize,cacheSize,warmCache);
  }
  String[] primaryExtensions=componentSettings.getAsArray("memory.extensions",new String[]{"","del","gen"});
  return new SwitchDirectory(ImmutableSet.copyOf(primaryExtensions),memDir,fsDirectory,true);
}
