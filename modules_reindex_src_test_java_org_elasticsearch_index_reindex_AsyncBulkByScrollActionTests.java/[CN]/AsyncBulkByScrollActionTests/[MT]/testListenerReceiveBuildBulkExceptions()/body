{
  DummyAbstractAsyncBulkByScrollAction action=new DummyAbstractAsyncBulkByScrollAction(){
    @Override protected BulkRequest buildBulk(    Iterable<SearchHit> docs){
      throw new RuntimeException("surprise");
    }
  }
;
  InternalSearchHit hit=new InternalSearchHit(0,"id",new Text("type"),emptyMap());
  InternalSearchHits hits=new InternalSearchHits(new InternalSearchHit[]{hit},0,0);
  InternalSearchResponse searchResponse=new InternalSearchResponse(hits,null,null,null,false,false);
  action.onScrollResponse(new SearchResponse(searchResponse,scrollId(),5,4,randomLong(),null));
  try {
    listener.get();
    fail("Expected failure.");
  }
 catch (  ExecutionException e) {
    assertThat(e.getCause(),instanceOf(RuntimeException.class));
    assertThat(e.getCause().getMessage(),equalTo("surprise"));
  }
}
