{
  threadPool.shutdown();
  threadPool=new ThreadPool(getTestName()){
    @Override public Executor generic(){
      return new Executor(){
        @Override public void execute(        Runnable command){
          command.run();
        }
      }
;
    }
  }
;
  int maxBatches=randomIntBetween(0,100);
  for (int batches=1; batches < maxBatches; batches++) {
    InternalSearchHit hit=new InternalSearchHit(0,"id",new Text("type"),emptyMap());
    InternalSearchHits hits=new InternalSearchHits(new InternalSearchHit[]{hit},0,0);
    InternalSearchResponse searchResponse=new InternalSearchResponse(hits,null,null,null,false,false);
    new DummyAbstractAsyncBulkByScrollAction().onScrollResponse(new SearchResponse(searchResponse,scrollId(),5,4,randomLong(),null));
    assertEquals(batches,task.getStatus().getBatches());
  }
}
