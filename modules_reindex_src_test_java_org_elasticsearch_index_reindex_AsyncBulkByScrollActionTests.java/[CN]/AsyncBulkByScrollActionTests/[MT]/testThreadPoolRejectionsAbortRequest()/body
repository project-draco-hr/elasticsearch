{
  threadPool.shutdown();
  threadPool=new ThreadPool(getTestName()){
    @Override public Executor generic(){
      return new Executor(){
        @Override public void execute(        Runnable command){
          ((AbstractRunnable)command).onRejection(new EsRejectedExecutionException("test"));
        }
      }
;
    }
  }
;
  InternalSearchHits hits=new InternalSearchHits(null,0,0);
  InternalSearchResponse searchResponse=new InternalSearchResponse(hits,null,null,null,false,false);
  new DummyAbstractAsyncBulkByScrollAction().onScrollResponse(new SearchResponse(searchResponse,scrollId(),5,4,randomLong(),null));
  try {
    listener.get();
    fail("Expected a failure");
  }
 catch (  ExecutionException e) {
    assertThat(e.getMessage(),equalTo("EsRejectedExecutionException[test]"));
  }
  assertThat(client.scrollsCleared,contains(scrollId));
}
