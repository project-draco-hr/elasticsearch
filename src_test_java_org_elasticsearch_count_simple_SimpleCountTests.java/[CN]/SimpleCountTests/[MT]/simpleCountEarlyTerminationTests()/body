{
  prepareCreate("test").setSettings(SETTING_NUMBER_OF_SHARDS,1,SETTING_NUMBER_OF_REPLICAS,0).get();
  ensureGreen();
  int max=randomIntBetween(3,29);
  List<IndexRequestBuilder> docbuilders=new ArrayList<>(max);
  for (int i=1; i <= max; i++) {
    String id=String.valueOf(i);
    docbuilders.add(client().prepareIndex("test","type1",id).setSource("field","2010-01-" + id + "T02:00"));
  }
  indexRandom(true,docbuilders);
  ensureGreen();
  refresh();
  String upperBound="2010-01-" + String.valueOf(max + 1) + "||+2d";
  String lowerBound="2009-12-01||+2d";
  CountResponse countResponse=client().prepareCount("test").setQuery(QueryBuilders.rangeQuery("field").gte(lowerBound).lte(upperBound)).execute().actionGet();
  assertHitCount(countResponse,max);
  for (int i=1; i <= max; i++) {
    countResponse=client().prepareCount("test").setQuery(QueryBuilders.rangeQuery("field").gte(lowerBound).lte(upperBound)).setTerminateAfter(i).execute().actionGet();
    assertHitCount(countResponse,i);
    assertTrue(countResponse.terminatedEarly());
  }
  countResponse=client().prepareCount("test").setQuery(QueryBuilders.rangeQuery("field").gte(lowerBound).lte(upperBound)).setTerminateAfter(max + randomIntBetween(1,max)).execute().actionGet();
  assertHitCount(countResponse,max);
  assertFalse(countResponse.terminatedEarly());
}
