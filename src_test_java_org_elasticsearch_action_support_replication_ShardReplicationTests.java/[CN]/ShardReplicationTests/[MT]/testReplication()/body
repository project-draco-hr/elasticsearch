{
  final String index="test";
  final ShardId shardId=new ShardId(index,0);
  clusterService.setState(stateWithStartedPrimary(index,true,randomInt(5)));
  final IndexShardRoutingTable shardRoutingTable=clusterService.state().routingTable().index(index).shard(shardId.id());
  int assignedReplicas=0;
  int totalShards=0;
  for (  ShardRouting shard : shardRoutingTable) {
    totalShards++;
    if (shard.primary() == false && shard.assignedToNode()) {
      assignedReplicas++;
    }
    if (shard.relocating()) {
      assignedReplicas++;
      totalShards++;
    }
  }
  runReplicateTest(shardRoutingTable,assignedReplicas,totalShards);
}
