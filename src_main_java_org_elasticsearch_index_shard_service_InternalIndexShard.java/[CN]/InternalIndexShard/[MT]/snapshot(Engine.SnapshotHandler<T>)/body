{
  IndexShardState state=this.state;
  if (state != IndexShardState.POST_RECOVERY && state != IndexShardState.STARTED && state != IndexShardState.RELOCATED && state != IndexShardState.CLOSED) {
    throw new IllegalIndexShardStateException(shardId,state,"snapshot is not allowed");
  }
  return engine.snapshot(snapshotHandler);
}
