{
  if (withFlush) {
    engine.flush(new Engine.Flush());
  }
  translog.clearUnreferenced();
  engine.refresh(new Engine.Refresh("recovery_finalization").force(true));
synchronized (mutex) {
    changeState(IndexShardState.POST_RECOVERY,"post recovery");
  }
  indicesLifecycle.afterIndexShardPostRecovery(this);
  startScheduledTasksIfNeeded();
  engine.enableGcDeletes(true);
}
