{
  IndexShardState state=this.state;
switch (mode) {
case READ:
    if (state != IndexShardState.STARTED && state != IndexShardState.RELOCATED) {
      throw new IllegalIndexShardStateException(shardId,state,"operations only allowed when started/relocated");
    }
  break;
case WRITE:
if (state != IndexShardState.STARTED && state != IndexShardState.RELOCATED && state != IndexShardState.RECOVERING && state != IndexShardState.POST_RECOVERY) {
  throw new IllegalIndexShardStateException(shardId,state,"operations only allowed when started/relocated");
}
break;
}
}
