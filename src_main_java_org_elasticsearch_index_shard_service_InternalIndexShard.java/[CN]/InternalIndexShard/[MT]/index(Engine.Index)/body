{
  writeAllowed(index.origin());
  index=indexingService.preIndex(index);
  try {
    if (logger.isTraceEnabled()) {
      logger.trace("index [{}][{}]{}",index.type(),index.id(),index.docs());
    }
    engine.index(index);
    index.endTime(System.nanoTime());
  }
 catch (  RuntimeException ex) {
    indexingService.failedIndex(index);
    throw ex;
  }
  indexingService.postIndex(index);
  return index.parsedDoc();
}
