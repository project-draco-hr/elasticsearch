{
  ShardRouting currentRouting=this.shardRouting;
  if (!shardRouting.shardId().equals(shardId())) {
    throw new ElasticSearchIllegalArgumentException("Trying to set a routing entry with shardId [" + shardRouting.shardId() + "] on a shard with shardId ["+ shardId()+ "]");
  }
  if (currentRouting != null) {
    if (!shardRouting.primary() && currentRouting.primary()) {
      logger.warn("suspect illegal state: trying to move shard from primary mode to replica mode");
    }
    if (currentRouting.equals(shardRouting)) {
      return this;
    }
  }
  this.shardRouting=shardRouting;
  indicesLifecycle.shardRoutingChanged(this,currentRouting,shardRouting);
  return this;
}
