{
synchronized (mutex) {
    indexSettingsService.removeListener(applyRefreshSettings);
    if (state != IndexShardState.CLOSED) {
      FutureUtils.cancel(refreshScheduledFuture);
      refreshScheduledFuture=null;
      FutureUtils.cancel(mergeScheduleFuture);
      mergeScheduleFuture=null;
    }
    changeState(IndexShardState.CLOSED,reason);
  }
}
