{
synchronized (mutex) {
    indexSettingsService.removeListener(applyRefreshSettings);
    if (state != IndexShardState.CLOSED) {
      if (refreshScheduledFuture != null) {
        refreshScheduledFuture.cancel(true);
        refreshScheduledFuture=null;
      }
      if (mergeScheduleFuture != null) {
        mergeScheduleFuture.cancel(true);
        mergeScheduleFuture=null;
      }
    }
    changeState(IndexShardState.CLOSED,reason);
  }
}
