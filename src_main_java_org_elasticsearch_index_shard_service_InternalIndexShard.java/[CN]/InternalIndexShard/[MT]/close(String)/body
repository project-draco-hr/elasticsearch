{
synchronized (mutex) {
    indexSettingsService.removeListener(applyRefreshSettings);
    if (state != IndexShardState.CLOSED) {
      if (refreshScheduledFuture != null) {
        refreshScheduledFuture.cancel(true);
        refreshScheduledFuture=null;
      }
      if (mergeScheduleFuture != null) {
        mergeScheduleFuture.cancel(true);
        mergeScheduleFuture=null;
      }
    }
    if (logger.isDebugEnabled()) {
      logger.debug("state: [{}]->[{}], reason [{}]",state,IndexShardState.CLOSED,reason);
    }
    state=IndexShardState.CLOSED;
  }
}
