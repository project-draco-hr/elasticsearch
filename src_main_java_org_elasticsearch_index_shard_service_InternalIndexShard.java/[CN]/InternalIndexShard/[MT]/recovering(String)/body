{
synchronized (mutex) {
    IndexShardState returnValue=state;
    if (state == IndexShardState.CLOSED) {
      throw new IndexShardClosedException(shardId);
    }
    if (state == IndexShardState.STARTED) {
      throw new IndexShardStartedException(shardId);
    }
    if (state == IndexShardState.RELOCATED) {
      throw new IndexShardRelocatedException(shardId);
    }
    if (state == IndexShardState.RECOVERING) {
      throw new IndexShardRecoveringException(shardId);
    }
    logger.debug("state: [{}]->[{}], reason [{}]",state,IndexShardState.RECOVERING,reason);
    state=IndexShardState.RECOVERING;
    return returnValue;
  }
}
