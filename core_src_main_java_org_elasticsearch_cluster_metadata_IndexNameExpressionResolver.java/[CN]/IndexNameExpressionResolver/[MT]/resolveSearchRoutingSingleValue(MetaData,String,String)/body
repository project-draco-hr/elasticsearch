{
  Map<String,Set<String>> routings=null;
  Set<String> paramRouting=null;
  if (routing != null) {
    paramRouting=Strings.splitStringByCommaToSet(routing);
  }
  ImmutableOpenMap<String,AliasMetaData> indexToRoutingMap=metaData.getAliases().get(aliasOrIndex);
  if (indexToRoutingMap != null && !indexToRoutingMap.isEmpty()) {
    for (    ObjectObjectCursor<String,AliasMetaData> indexRouting : indexToRoutingMap) {
      if (!indexRouting.value.searchRoutingValues().isEmpty()) {
        Set<String> r=new HashSet<>(indexRouting.value.searchRoutingValues());
        if (paramRouting != null) {
          r.retainAll(paramRouting);
        }
        if (!r.isEmpty()) {
          if (routings == null) {
            routings=newHashMap();
          }
          routings.put(indexRouting.key,r);
        }
      }
 else {
        if (paramRouting != null) {
          Set<String> r=new HashSet<>(paramRouting);
          if (routings == null) {
            routings=newHashMap();
          }
          routings.put(indexRouting.key,r);
        }
      }
    }
  }
 else {
    if (paramRouting != null) {
      routings=ImmutableMap.of(aliasOrIndex,paramRouting);
    }
  }
  return routings;
}
