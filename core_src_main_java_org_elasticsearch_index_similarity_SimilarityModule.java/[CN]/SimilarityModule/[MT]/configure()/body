{
  MapBinder<String,SimilarityProvider.Factory> similarityBinder=MapBinder.newMapBinder(binder(),String.class,SimilarityProvider.Factory.class);
  Map<String,Settings> similaritySettings=settings.getGroups(SIMILARITY_SETTINGS_PREFIX);
  for (  Map.Entry<String,Settings> entry : similaritySettings.entrySet()) {
    String name=entry.getKey();
    Settings settings=entry.getValue();
    String typeName=settings.get("type");
    if (typeName == null) {
      throw new IllegalArgumentException("Similarity [" + name + "] must have an associated type");
    }
 else     if (similarities.containsKey(typeName) == false) {
      throw new IllegalArgumentException("Unknown Similarity type [" + typeName + "] for ["+ name+ "]");
    }
    similarityBinder.addBinding(entry.getKey()).toProvider(FactoryProvider.newFactory(SimilarityProvider.Factory.class,similarities.get(typeName))).in(Scopes.SINGLETON);
  }
  for (  PreBuiltSimilarityProvider.Factory factory : Similarities.listFactories()) {
    if (!similarities.containsKey(factory.name())) {
      similarityBinder.addBinding(factory.name()).toInstance(factory);
    }
  }
  bind(SimilarityLookupService.class).asEagerSingleton();
  bind(SimilarityService.class).asEagerSingleton();
}
