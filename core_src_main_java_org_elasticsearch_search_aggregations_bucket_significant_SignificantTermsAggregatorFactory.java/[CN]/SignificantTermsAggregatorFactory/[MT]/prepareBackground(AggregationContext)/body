{
  if (termsEnum != null) {
    return termsEnum.getNumDocs();
  }
  SearchContext searchContext=context.searchContext();
  IndexReader reader=searchContext.searcher().getIndexReader();
  Query filter=null;
  try {
    if (filterBuilder != null) {
      filter=filterBuilder.toFilter(context.searchContext().getQueryShardContext());
    }
  }
 catch (  IOException e) {
    throw new ElasticsearchException("failed to create filter: " + filterBuilder.toString(),e);
  }
  try {
    if (numberOfAggregatorsCreated == 1) {
      termsEnum=new FilterableTermsEnum(reader,indexedFieldName,PostingsEnum.NONE,filter);
    }
 else {
      termsEnum=new FreqTermsEnum(reader,indexedFieldName,true,false,filter,searchContext.bigArrays());
    }
  }
 catch (  IOException e) {
    throw new ElasticsearchException("failed to build terms enumeration",e);
  }
  return termsEnum.getNumDocs();
}
