{
  SimulateExecutionService.Listener listener=mock(SimulateExecutionService.Listener.class);
  ParsedSimulateRequest request=new ParsedSimulateRequest(pipeline,Collections.singletonList(data),true);
  SimulatedItemResponse itemResponse=new SimulatedItemResponse(Arrays.asList(new ProcessedData("processor[mock]-0",data),new ProcessedData("processor[mock]-1",data)));
  executionService.execute(request,listener);
  SimulatePipelineResponse response=new SimulatePipelineResponse("_id",Collections.singletonList(itemResponse));
  assertBusy(new Runnable(){
    @Override public void run(){
      verify(processor,times(2)).execute(data);
      verify(listener).onResponse(response);
    }
  }
);
}
