{
  if (routing == null || routing.isEmpty()) {
    return indexRoutingTable(clusterState,index).groupByShardsIt();
  }
  HashSet<ShardIterator> set=new HashSet<>();
  IndexRoutingTable indexRouting=indexRoutingTable(clusterState,index);
  for (  String r : routing) {
    int shardId=shardId(clusterState,index,null,null,r);
    IndexShardRoutingTable indexShard=indexRouting.shard(shardId);
    if (indexShard == null) {
      throw new IndexShardMissingException(new ShardId(index,shardId));
    }
    set.add(indexShard.shardsRandomIt());
  }
  return new GroupShardsIterator(Lists.newArrayList(set));
}
