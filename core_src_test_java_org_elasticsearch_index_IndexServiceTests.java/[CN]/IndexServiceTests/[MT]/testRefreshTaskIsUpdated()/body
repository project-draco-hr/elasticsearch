{
  IndexService indexService=newIndexService();
  IndexService.AsyncRefreshTask refreshTask=indexService.getRefreshTask();
  assertEquals(1000,refreshTask.getInterval().millis());
  assertTrue(indexService.getRefreshTask().mustReschedule());
  IndexMetaData metaData=IndexMetaData.builder(indexService.getMetaData()).settings(Settings.builder().put(indexService.getMetaData().getSettings()).put(IndexSettings.INDEX_REFRESH_INTERVAL_SETTING.getKey(),-1)).build();
  indexService.updateMetaData(metaData);
  assertNotSame(refreshTask,indexService.getRefreshTask());
  assertTrue(refreshTask.isClosed());
  assertFalse(refreshTask.isScheduled());
  assertFalse(indexService.getRefreshTask().mustReschedule());
  metaData=IndexMetaData.builder(indexService.getMetaData()).settings(Settings.builder().put(indexService.getMetaData().getSettings()).put(IndexSettings.INDEX_REFRESH_INTERVAL_SETTING.getKey(),"100ms")).build();
  indexService.updateMetaData(metaData);
  assertNotSame(refreshTask,indexService.getRefreshTask());
  assertTrue(refreshTask.isClosed());
  refreshTask=indexService.getRefreshTask();
  assertTrue(refreshTask.mustReschedule());
  assertTrue(refreshTask.isScheduled());
  assertEquals(100,refreshTask.getInterval().millis());
  metaData=IndexMetaData.builder(indexService.getMetaData()).settings(Settings.builder().put(indexService.getMetaData().getSettings()).put(IndexSettings.INDEX_REFRESH_INTERVAL_SETTING.getKey(),"200ms")).build();
  indexService.updateMetaData(metaData);
  assertNotSame(refreshTask,indexService.getRefreshTask());
  assertTrue(refreshTask.isClosed());
  refreshTask=indexService.getRefreshTask();
  assertTrue(refreshTask.mustReschedule());
  assertTrue(refreshTask.isScheduled());
  assertEquals(200,refreshTask.getInterval().millis());
  metaData=IndexMetaData.builder(indexService.getMetaData()).settings(Settings.builder().put(indexService.getMetaData().getSettings()).put(IndexSettings.INDEX_REFRESH_INTERVAL_SETTING.getKey(),"200ms")).build();
  indexService.updateMetaData(metaData);
  assertSame(refreshTask,indexService.getRefreshTask());
  assertTrue(indexService.getRefreshTask().mustReschedule());
  assertTrue(refreshTask.isScheduled());
  assertFalse(refreshTask.isClosed());
  assertEquals(200,refreshTask.getInterval().millis());
  indexService.close("simon says",false);
  assertFalse(refreshTask.isScheduled());
  assertTrue(refreshTask.isClosed());
}
