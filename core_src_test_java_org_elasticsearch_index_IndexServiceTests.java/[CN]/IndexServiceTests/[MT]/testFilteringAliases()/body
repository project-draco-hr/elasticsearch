{
  IndexService indexService=newIndexService();
  IndexShard shard=indexService.getShard(0);
  add(indexService,"cats",filter(termQuery("animal","cat")));
  add(indexService,"dogs",filter(termQuery("animal","dog")));
  add(indexService,"all",null);
  assertThat(indexService.getMetaData().getAliases().containsKey("cats"),equalTo(true));
  assertThat(indexService.getMetaData().getAliases().containsKey("dogs"),equalTo(true));
  assertThat(indexService.getMetaData().getAliases().containsKey("turtles"),equalTo(false));
  assertThat(indexService.aliasFilter(shard.getQueryShardContext(),"cats").toString(),equalTo("animal:cat"));
  assertThat(indexService.aliasFilter(shard.getQueryShardContext(),"cats","dogs").toString(),equalTo("animal:cat animal:dog"));
  assertThat(indexService.aliasFilter(shard.getQueryShardContext(),"all"),nullValue());
  assertThat(indexService.aliasFilter(shard.getQueryShardContext(),"cats","all"),nullValue());
  assertThat(indexService.aliasFilter(shard.getQueryShardContext(),"all","cats"),nullValue());
  add(indexService,"cats",filter(termQuery("animal","feline")));
  add(indexService,"dogs",filter(termQuery("animal","canine")));
  assertThat(indexService.aliasFilter(shard.getQueryShardContext(),"dogs","cats").toString(),equalTo("animal:canine animal:feline"));
}
