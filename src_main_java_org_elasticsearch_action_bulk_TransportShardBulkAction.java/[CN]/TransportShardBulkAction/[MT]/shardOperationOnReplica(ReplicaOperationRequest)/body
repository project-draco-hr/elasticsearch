{
  IndexShard indexShard=indicesService.indexServiceSafe(shardRequest.request.getIndex()).shardSafe(shardRequest.shardId);
  final BulkShardRequest request=shardRequest.request;
  for (int i=0; i < request.getItems().length; i++) {
    BulkItemRequest item=request.getItems()[i];
    if (item == null) {
      continue;
    }
    if (item.getRequest() instanceof IndexRequest) {
      IndexRequest indexRequest=(IndexRequest)item.getRequest();
      try {
        SourceToParse sourceToParse=SourceToParse.source(indexRequest.getSource()).type(indexRequest.getType()).id(indexRequest.getId()).routing(indexRequest.getRouting()).parent(indexRequest.getParent()).timestamp(indexRequest.getTimestamp()).ttl(indexRequest.getTtl());
        if (indexRequest.getOpType() == IndexRequest.OpType.INDEX) {
          Engine.Index index=indexShard.prepareIndex(sourceToParse).version(indexRequest.getVersion()).origin(Engine.Operation.Origin.REPLICA);
          indexShard.index(index);
        }
 else {
          Engine.Create create=indexShard.prepareCreate(sourceToParse).version(indexRequest.getVersion()).origin(Engine.Operation.Origin.REPLICA);
          indexShard.create(create);
        }
      }
 catch (      Exception e) {
      }
    }
 else     if (item.getRequest() instanceof DeleteRequest) {
      DeleteRequest deleteRequest=(DeleteRequest)item.getRequest();
      try {
        Engine.Delete delete=indexShard.prepareDelete(deleteRequest.getType(),deleteRequest.getId(),deleteRequest.getVersion()).origin(Engine.Operation.Origin.REPLICA);
        indexShard.delete(delete);
      }
 catch (      Exception e) {
      }
    }
  }
  if (request.isRefresh()) {
    try {
      indexShard.refresh(new Engine.Refresh(false));
    }
 catch (    Exception e) {
    }
  }
}
