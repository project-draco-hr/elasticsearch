{
  GeometryCollectionBuilder gcb=RandomShapeGenerator.createGeometryCollection(getRandom());
  logger.info("Created Random GeometryCollection containing " + gcb.numShapes() + " shapes");
  createIndex("randshapes");
  assertAcked(prepareCreate("test").addMapping("type","location","type=geo_shape"));
  XContentBuilder docSource=gcb.toXContent(jsonBuilder().startObject().field("location"),null).endObject();
  indexRandom(true,client().prepareIndex("test","type","1").setSource(docSource));
  ensureSearchable("test");
  ShapeBuilder filterShape=(gcb.getShapeAt(randomIntBetween(0,gcb.numShapes() - 1)));
  GeoShapeQueryBuilder filter=QueryBuilders.geoShapeQuery("location",filterShape,ShapeRelation.INTERSECTS);
  SearchResponse result=client().prepareSearch("test").setQuery(QueryBuilders.matchAllQuery()).setPostFilter(filter).get();
  assertSearchResponse(result);
  assertHitCount(result,1);
}
