{
  MapperService mapperService=createIndex("test").mapperService();
  mapperService.documentMapperParser().putRootTypeParser(ExternalMetadataMapper.CONTENT_TYPE,new ExternalMetadataMapper.TypeParser());
  mapperService.documentMapperParser().putTypeParser(RegisterExternalTypes.EXTERNAL,new ExternalMapper.TypeParser(RegisterExternalTypes.EXTERNAL,"foo"));
  DocumentMapper documentMapper=mapperService.documentMapperParser().parse(XContentFactory.jsonBuilder().startObject().startObject("type").startObject(ExternalMetadataMapper.CONTENT_TYPE).endObject().startObject("properties").startObject("field").field("type","external").endObject().endObject().endObject().endObject().string());
  ParsedDocument doc=documentMapper.parse("type","1",XContentFactory.jsonBuilder().startObject().field("field","1234").endObject().bytes());
  assertThat(doc.rootDoc().getField("field.bool"),notNullValue());
  assertThat(doc.rootDoc().getField("field.bool").stringValue(),is("T"));
  assertThat(doc.rootDoc().getField("field.point"),notNullValue());
  assertThat(doc.rootDoc().getField("field.point").stringValue(),is("42.0,51.0"));
  assertThat(doc.rootDoc().getField("field.shape"),notNullValue());
  assertThat(doc.rootDoc().getField("field.field"),notNullValue());
  assertThat(doc.rootDoc().getField("field.field").stringValue(),is("foo"));
  assertThat(doc.rootDoc().getField(ExternalMetadataMapper.FIELD_NAME).stringValue(),is(ExternalMetadataMapper.FIELD_VALUE));
}
