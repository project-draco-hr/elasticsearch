{
  Version version=VersionUtils.randomVersionBetween(getRandom(),Version.V_3_0_0,Version.CURRENT);
  Settings settings=Settings.builder().put(IndexMetaData.SETTING_VERSION_CREATED,version).build();
  IndicesAnalysisService indicesAnalysisService=new IndicesAnalysisService(settings);
  try {
    AnalysisService analysisService=new AnalysisService(new Index("index"),settings,indicesAnalysisService,Collections.singletonMap("default_index",new PreBuiltAnalyzerProviderFactory("default_index",AnalyzerScope.INDEX,new EnglishAnalyzer())),Collections.emptyMap(),Collections.emptyMap(),Collections.emptyMap());
    fail("Expected ISE");
  }
 catch (  IllegalArgumentException e) {
    assertTrue(e.getMessage().contains("[index.analysis.analyzer.default_index] is not supported"));
  }
}
