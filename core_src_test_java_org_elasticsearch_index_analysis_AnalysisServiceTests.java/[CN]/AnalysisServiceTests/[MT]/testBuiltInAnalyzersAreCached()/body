{
  Settings settings=Settings.builder().put("path.home",createTempDir().toString()).build();
  Settings indexSettings=settingsBuilder().put(IndexMetaData.SETTING_VERSION_CREATED,Version.CURRENT).build();
  IndexSettings idxSettings=IndexSettingsModule.newIndexSettings(new Index("index"),indexSettings);
  AnalysisService analysisService=new AnalysisRegistry(null,new Environment(settings)).build(idxSettings);
  AnalysisService otherAnalysisSergice=new AnalysisRegistry(null,new Environment(settings)).build(idxSettings);
  final int numIters=randomIntBetween(5,20);
  for (int i=0; i < numIters; i++) {
    PreBuiltAnalyzers preBuiltAnalyzers=RandomPicks.randomFrom(random(),PreBuiltAnalyzers.values());
    assertSame(analysisService.analyzer(preBuiltAnalyzers.name()),otherAnalysisSergice.analyzer(preBuiltAnalyzers.name()));
  }
}
