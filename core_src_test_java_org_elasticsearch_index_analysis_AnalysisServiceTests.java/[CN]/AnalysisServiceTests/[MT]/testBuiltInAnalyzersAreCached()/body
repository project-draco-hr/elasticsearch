{
  Settings settings=Settings.builder().put(Environment.PATH_HOME_SETTING.getKey(),createTempDir().toString()).build();
  Settings indexSettings=Settings.builder().put(IndexMetaData.SETTING_VERSION_CREATED,Version.CURRENT).build();
  IndexSettings idxSettings=IndexSettingsModule.newIndexSettings("index",indexSettings);
  AnalysisService analysisService=new AnalysisRegistry(new Environment(settings),emptyMap(),emptyMap(),emptyMap(),emptyMap()).build(idxSettings);
  AnalysisService otherAnalysisSergice=new AnalysisRegistry(new Environment(settings),emptyMap(),emptyMap(),emptyMap(),emptyMap()).build(idxSettings);
  final int numIters=randomIntBetween(5,20);
  for (int i=0; i < numIters; i++) {
    PreBuiltAnalyzers preBuiltAnalyzers=RandomPicks.randomFrom(random(),PreBuiltAnalyzers.values());
    assertSame(analysisService.analyzer(preBuiltAnalyzers.name()),otherAnalysisSergice.analyzer(preBuiltAnalyzers.name()));
  }
}
