{
  MetaData metaData=newMetaDataBuilder().put(newIndexMetaDataBuilder("test").numberOfShards(10).numberOfReplicas(1)).build();
  RoutingTable routingTable=routingTable().add(indexRoutingTable("test").initializeEmpty(metaData.index("test"))).build();
  DiscoveryNodes nodes=DiscoveryNodes.newNodesBuilder().put(newNode("node1")).put(newNode("node2")).put(newNode("node3")).localNodeId("node1").masterNodeId("node2").build();
  ClusterState clusterState=newClusterStateBuilder().nodes(nodes).metaData(metaData).routingTable(routingTable).build();
  ShardsRoutingStrategy strategy=new ShardsRoutingStrategy();
  clusterState=newClusterStateBuilder().state(clusterState).routingTable(strategy.reroute(clusterState)).build();
  ClusterState serializedClusterState=ClusterState.Builder.fromBytes(ClusterState.Builder.toBytes(clusterState),ImmutableSettings.settingsBuilder().build(),newNode("node1"));
  assertThat(serializedClusterState.routingTable().prettyPrint(),equalTo(clusterState.routingTable().prettyPrint()));
}
