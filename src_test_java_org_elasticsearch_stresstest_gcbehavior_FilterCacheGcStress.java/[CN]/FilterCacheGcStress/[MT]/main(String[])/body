{
  Settings settings=ImmutableSettings.EMPTY;
  Node node=NodeBuilder.nodeBuilder().settings(settings).node();
  final Client client=node.client();
  client.admin().indices().prepareCreate("test").execute().actionGet();
  client.admin().cluster().prepareHealth().setWaitForYellowStatus().execute().actionGet();
  final AtomicBoolean stop=new AtomicBoolean();
  Thread indexingThread=new Thread(){
    @Override public void run(){
      while (!stop.get()) {
        client.prepareIndex("test","type1").setSource("field",System.currentTimeMillis()).execute().actionGet();
      }
    }
  }
;
  indexingThread.start();
  Thread searchThread=new Thread(){
    @Override public void run(){
      while (!stop.get()) {
        client.prepareSearch().setQuery(filteredQuery(matchAllQuery(),rangeQuery("field").from(System.currentTimeMillis() - 1000000))).execute().actionGet();
      }
    }
  }
;
  searchThread.start();
}
