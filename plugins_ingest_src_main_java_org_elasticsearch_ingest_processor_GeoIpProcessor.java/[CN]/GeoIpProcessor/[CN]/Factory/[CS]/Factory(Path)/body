{
  Path geoIpConfigDirectory=configDirectory.resolve("ingest").resolve("geoip");
  if (Files.exists(geoIpConfigDirectory) == false && Files.isDirectory(geoIpConfigDirectory)) {
    throw new IllegalStateException("the geoip directory [" + geoIpConfigDirectory + "] containing databases doesn't exist");
  }
  try (Stream<Path> databaseFiles=Files.list(geoIpConfigDirectory)){
    Map<String,DatabaseReader> databaseReaders=new HashMap<>();
    PathMatcher pathMatcher=geoIpConfigDirectory.getFileSystem().getPathMatcher("glob:**.mmdb");
    Iterator<Path> iterator=databaseFiles.iterator();
    while (iterator.hasNext()) {
      Path databasePath=iterator.next();
      if (Files.isRegularFile(databasePath) && pathMatcher.matches(databasePath)) {
        try (InputStream inputStream=Files.newInputStream(databasePath,StandardOpenOption.READ)){
          databaseReaders.put(databasePath.getFileName().toString(),new DatabaseReader.Builder(inputStream).build());
        }
       }
    }
    this.databaseReaders=Collections.unmodifiableMap(databaseReaders);
  }
 catch (  IOException e) {
    throw new RuntimeException(e);
  }
}
