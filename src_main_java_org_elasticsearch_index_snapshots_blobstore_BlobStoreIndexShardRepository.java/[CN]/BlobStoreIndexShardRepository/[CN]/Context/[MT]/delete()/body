{
  final ImmutableMap<String,BlobMetaData> blobs;
  try {
    blobs=blobContainer.listBlobs();
  }
 catch (  IOException e) {
    throw new IndexShardSnapshotException(shardId,"Failed to list content of gateway",e);
  }
  BlobStoreIndexShardSnapshots snapshots=buildBlobStoreIndexShardSnapshots(blobs);
  String commitPointName=snapshotBlobName(snapshotId);
  try {
    blobContainer.deleteBlob(commitPointName);
  }
 catch (  IOException e) {
    logger.debug("[{}] [{}] failed to delete shard snapshot file",shardId,snapshotId);
  }
  List<BlobStoreIndexShardSnapshot> newSnapshotsList=Lists.newArrayList();
  for (  BlobStoreIndexShardSnapshot point : snapshots) {
    if (!point.snapshot().equals(snapshotId.getSnapshot())) {
      newSnapshotsList.add(point);
    }
  }
  cleanup(newSnapshotsList,blobs);
}
