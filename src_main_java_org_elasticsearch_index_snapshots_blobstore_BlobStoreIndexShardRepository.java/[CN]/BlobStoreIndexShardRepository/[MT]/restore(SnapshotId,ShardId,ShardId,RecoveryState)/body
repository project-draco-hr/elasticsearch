{
  final RestoreContext snapshotContext=new RestoreContext(snapshotId,shardId,snapshotShardId,recoveryState);
  try {
    recoveryState.getIndex().startTime(System.currentTimeMillis());
    snapshotContext.restore();
    recoveryState.getIndex().time(System.currentTimeMillis() - recoveryState.getIndex().startTime());
  }
 catch (  Throwable e) {
    throw new IndexShardRestoreFailedException(shardId,"failed to restore snapshot [" + snapshotId.getSnapshot() + "]",e);
  }
}
