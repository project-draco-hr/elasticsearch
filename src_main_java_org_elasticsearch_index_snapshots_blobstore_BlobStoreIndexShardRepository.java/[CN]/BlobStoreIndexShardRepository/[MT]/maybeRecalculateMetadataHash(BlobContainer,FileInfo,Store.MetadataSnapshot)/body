{
  final StoreFileMetaData metadata;
  if (fileInfo != null && (metadata=snapshot.get(fileInfo.physicalName())) != null) {
    if (metadata.hash().length > 0 && fileInfo.metadata().hash().length == 0) {
      try (final InputStream stream=new PartSliceStream(blobContainer,fileInfo)){
        BytesRefBuilder builder=new BytesRefBuilder();
        Store.MetadataSnapshot.hashFile(builder,stream,fileInfo.length());
        BytesRef hash=metadata.hash();
        hash.bytes=builder.bytes();
        hash.offset=0;
        hash.length=builder.length();
      }
     }
  }
}
