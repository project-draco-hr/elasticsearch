{
  client().admin().indices().prepareCreate("test").addMapping(MapperService.DEFAULT_MAPPING,JsonXContent.contentBuilder().startObject().startObject(MapperService.DEFAULT_MAPPING).field("date_detection",false).endObject().endObject()).get();
  GetMappingsResponse response=client().admin().indices().prepareGetMappings("test").addTypes(MapperService.DEFAULT_MAPPING).get();
  Map<String,Object> defaultMapping=response.getMappings().get("test").get(MapperService.DEFAULT_MAPPING).sourceAsMap();
  assertThat(defaultMapping,hasKey("date_detection"));
  client().admin().indices().preparePutMapping("test").setType(MapperService.DEFAULT_MAPPING).setSource(JsonXContent.contentBuilder().startObject().startObject(MapperService.DEFAULT_MAPPING).endObject().endObject()).get();
  response=client().admin().indices().prepareGetMappings("test").addTypes(MapperService.DEFAULT_MAPPING).get();
  defaultMapping=response.getMappings().get("test").get(MapperService.DEFAULT_MAPPING).sourceAsMap();
  assertThat(defaultMapping,not(hasKey("date_detection")));
  client().admin().indices().preparePutMapping("test").setType(MapperService.DEFAULT_MAPPING).setSource(JsonXContent.contentBuilder().startObject().startObject(MapperService.DEFAULT_MAPPING).startObject("properties").startObject("f").field("type","string").field("index","analyzed").endObject().endObject().endObject().endObject()).get();
  client().admin().indices().preparePutMapping("test").setType(MapperService.DEFAULT_MAPPING).setSource(JsonXContent.contentBuilder().startObject().startObject(MapperService.DEFAULT_MAPPING).startObject("properties").startObject("f").field("type","string").field("index","not_analyzed").endObject().endObject().endObject().endObject()).get();
  response=client().admin().indices().prepareGetMappings("test").addTypes(MapperService.DEFAULT_MAPPING).get();
  defaultMapping=response.getMappings().get("test").get(MapperService.DEFAULT_MAPPING).sourceAsMap();
  Map<String,Object> fieldSettings=(Map<String,Object>)((Map)defaultMapping.get("properties")).get("f");
  assertThat(fieldSettings,hasEntry("index",(Object)"not_analyzed"));
  assertThrows(client().admin().indices().preparePutMapping("test").setType(MapperService.DEFAULT_MAPPING).setSource(JsonXContent.contentBuilder().startObject().startObject(MapperService.DEFAULT_MAPPING).startObject("properties").startObject("f").field("type","DOESNT_EXIST").endObject().endObject().endObject().endObject()),MapperParsingException.class);
}
