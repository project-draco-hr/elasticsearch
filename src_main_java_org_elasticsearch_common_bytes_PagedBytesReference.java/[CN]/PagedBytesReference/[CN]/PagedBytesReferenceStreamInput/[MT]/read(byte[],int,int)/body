{
  if (len == 0) {
    return 0;
  }
  if (pos >= offset + length) {
    return -1;
  }
  int todo=Math.min(len,length);
  long bytearrayOffset=offset + pos;
  int written=0;
  while (written < todo) {
    long pagefragment=PAGE_SIZE - (bytearrayOffset % PAGE_SIZE);
    int bulksize=(int)Math.min(pagefragment,todo - written);
    boolean copied=bytearray.get(bytearrayOffset,bulksize,ref);
    assert(copied == false);
    System.arraycopy(ref.bytes,ref.offset,b,bOffset + written,bulksize);
    written+=bulksize;
    bytearrayOffset+=bulksize;
  }
  pos+=written;
  return written;
}
