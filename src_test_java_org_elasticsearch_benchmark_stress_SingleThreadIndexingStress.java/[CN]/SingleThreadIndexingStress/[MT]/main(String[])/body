{
  Settings settings=settingsBuilder().put("index.refresh_interval","1s").put("index.merge.async",true).put("index.translog.flush_threshold_ops",5000).put(SETTING_NUMBER_OF_SHARDS,2).put(SETTING_NUMBER_OF_REPLICAS,1).build();
  Node[] nodes=new Node[1];
  for (int i=0; i < nodes.length; i++) {
    nodes[i]=nodeBuilder().settings(settingsBuilder().put(settings).put("name","node" + i)).node();
  }
  Node client=nodeBuilder().settings(settingsBuilder().put(settings).put("name","client")).client(true).node();
  Client client1=client.client();
  Thread.sleep(1000);
  client1.admin().indices().create(createIndexRequest("test")).actionGet();
  Thread.sleep(5000);
  StopWatch stopWatch=new StopWatch().start();
  int COUNT=200000;
  int ID_RANGE=100;
  System.out.println("Indexing [" + COUNT + "] ...");
  int i=1;
  for (; i <= COUNT; i++) {
    client1.prepareIndex("test","type1").setId(Integer.toString(i % ID_RANGE)).setSource(source(Integer.toString(i),"test" + i)).setCreate(false).execute().actionGet();
    if ((i % 10000) == 0) {
      System.out.println("Indexed " + i + " took "+ stopWatch.stop().lastTaskTime());
      stopWatch.start();
    }
  }
  System.out.println("Indexing took " + stopWatch.totalTime() + ", TPS "+ (((double)COUNT) / stopWatch.totalTime().secondsFrac()));
  client.client().admin().indices().prepareRefresh().execute().actionGet();
  System.out.println("Count: " + client.client().prepareCount().setQuery(matchAllQuery()).execute().actionGet().getCount());
  client.close();
  for (  Node node : nodes) {
    node.close();
  }
}
