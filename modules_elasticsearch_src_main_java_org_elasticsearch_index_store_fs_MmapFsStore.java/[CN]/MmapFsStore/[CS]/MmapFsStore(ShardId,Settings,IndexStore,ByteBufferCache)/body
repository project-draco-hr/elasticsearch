{
  super(shardId,indexSettings,indexStore);
  LockFactory lockFactory=buildLockFactory();
  File location=((FsIndexStore)indexStore).shardIndexLocation(shardId);
  FileSystemUtils.mkdirs(location);
  this.fsDirectory=new MMapDirectory(location,lockFactory);
  boolean suggestUseCompoundFile;
  Tuple<SwitchDirectory,Boolean> switchDirectory=buildSwitchDirectoryIfNeeded(fsDirectory,byteBufferCache);
  if (switchDirectory != null) {
    suggestUseCompoundFile=DEFAULT_SUGGEST_USE_COMPOUND_FILE;
    if (switchDirectory.v2() != null) {
      suggestUseCompoundFile=switchDirectory.v2();
    }
    logger.debug("using [mmap_fs] store with path [{}], cache [true] with extensions [{}]",fsDirectory.getDirectory(),switchDirectory.v1().primaryExtensions());
    directory=wrapDirectory(switchDirectory.v1());
  }
 else {
    suggestUseCompoundFile=DEFAULT_SUGGEST_USE_COMPOUND_FILE;
    directory=wrapDirectory(fsDirectory);
    logger.debug("using [mmap_fs] store with path [{}]",fsDirectory.getDirectory());
  }
  this.suggestUseCompoundFile=suggestUseCompoundFile;
}
