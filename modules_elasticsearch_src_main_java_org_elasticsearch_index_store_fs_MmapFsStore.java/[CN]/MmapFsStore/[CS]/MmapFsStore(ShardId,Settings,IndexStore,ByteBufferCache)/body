{
  super(shardId,indexSettings);
  LockFactory lockFactory=buildLockFactory();
  File location=((FsIndexStore)indexStore).shardIndexLocation(shardId);
  location.mkdirs();
  this.fsDirectory=new MMapDirectory(location,lockFactory);
  SwitchDirectory switchDirectory=buildSwitchDirectoryIfNeeded(fsDirectory,byteBufferCache);
  if (switchDirectory != null) {
    suggestUseCompoundFile=false;
    logger.debug("Using [mmap_fs] Store with path [{}], cache [true] with extensions [{}]",fsDirectory.getFile(),switchDirectory.primaryExtensions());
    directory=wrapDirectory(switchDirectory);
  }
 else {
    suggestUseCompoundFile=true;
    directory=wrapDirectory(fsDirectory);
    logger.debug("Using [mmap_fs] Store with path [{}]",fsDirectory.getFile());
  }
}
