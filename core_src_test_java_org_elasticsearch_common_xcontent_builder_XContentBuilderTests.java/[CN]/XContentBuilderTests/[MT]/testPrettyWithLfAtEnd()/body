{
  FastCharArrayWriter writer=new FastCharArrayWriter();
  XContentGenerator generator=XContentFactory.xContent(XContentType.JSON).createGenerator(writer);
  generator.usePrettyPrint();
  generator.usePrintLineFeedAtEnd();
  generator.writeStartObject();
  generator.writeStringField("test","value");
  generator.writeEndObject();
  generator.flush();
  generator.close();
  generator.close();
  assertThat(writer.unsafeCharArray()[writer.size() - 1],equalTo('\n'));
}
