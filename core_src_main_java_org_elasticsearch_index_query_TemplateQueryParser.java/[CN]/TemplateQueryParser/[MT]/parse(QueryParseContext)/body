{
  XContentParser parser=parseContext.parser();
  Template template=parse(parser);
  ExecutableScript executable=this.scriptService.executable(template,ScriptContext.Standard.SEARCH);
  BytesReference querySource=(BytesReference)executable.run();
  try (XContentParser qSourceParser=XContentFactory.xContent(querySource).createParser(querySource)){
    final QueryParseContext context=new QueryParseContext(parseContext.index(),parseContext.indexQueryParserService());
    context.reset(qSourceParser);
    return context.parseInnerQuery();
  }
 }
