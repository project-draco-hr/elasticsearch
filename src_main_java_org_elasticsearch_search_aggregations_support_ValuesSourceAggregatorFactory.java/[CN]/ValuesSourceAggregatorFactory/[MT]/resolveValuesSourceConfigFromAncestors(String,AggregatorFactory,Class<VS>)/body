{
  ValuesSourceConfig config;
  while (parent != null) {
    if (parent instanceof ValuesSourceAggregatorFactory) {
      config=((ValuesSourceAggregatorFactory)parent).config;
      if (config != null && config.valid()) {
        if (requiredValuesSourceType == null || requiredValuesSourceType.isAssignableFrom(config.valueSourceType)) {
          this.config=config;
          this.formatter=((ValuesSourceAggregatorFactory)parent).formatter;
          this.parser=((ValuesSourceAggregatorFactory)parent).parser;
          return;
        }
      }
    }
    parent=parent.parent();
  }
  throw new AggregationExecutionException("could not find the appropriate value context to perform aggregation [" + aggName + "]");
}
