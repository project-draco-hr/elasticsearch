{
  serviceA.registerHandler("sayHello",new BaseTransportRequestHandler<StringMessage>(){
    @Override public StringMessage newInstance(){
      return new StringMessage();
    }
    @Override public void messageReceived(    StringMessage request,    TransportChannel channel){
      assertThat("moshe",equalTo(request.message));
      try {
        channel.sendResponse(new StringMessage("hello " + request.message));
      }
 catch (      IOException e) {
        e.printStackTrace();
        assertThat(e.getMessage(),false,equalTo(true));
      }
    }
  }
);
  TransportFuture<StringMessage> res=serviceB.submitRequest(serviceANode,"sayHello",new StringMessage("moshe"),new BaseTransportResponseHandler<StringMessage>(){
    @Override public StringMessage newInstance(){
      return new StringMessage();
    }
    @Override public void handleResponse(    StringMessage response){
      assertThat("hello moshe",equalTo(response.message));
    }
    @Override public void handleException(    TransportException exp){
      exp.printStackTrace();
      assertThat("got exception instead of a response: " + exp.getMessage(),false,equalTo(true));
    }
  }
);
  try {
    StringMessage message=res.get();
    assertThat("hello moshe",equalTo(message.message));
  }
 catch (  Exception e) {
    assertThat(e.getMessage(),false,equalTo(true));
  }
  serviceA.removeHandler("sayHello");
}
