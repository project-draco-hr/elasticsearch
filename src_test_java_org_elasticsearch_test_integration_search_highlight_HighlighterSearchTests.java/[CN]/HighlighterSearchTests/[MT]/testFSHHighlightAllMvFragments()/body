{
  client().admin().indices().prepareCreate("test").setSettings(ImmutableSettings.settingsBuilder().put("index.number_of_shards",1).put("index.number_of_replicas",0)).addMapping("type1",jsonBuilder().startObject().startObject("type1").startObject("properties").startObject("tags").field("type","string").field("term_vector","with_positions_offsets").endObject().endObject().endObject().endObject()).execute().actionGet();
  ensureGreen();
  client().prepareIndex("test","type1","1").setSource(jsonBuilder().startObject().field("tags","this is a really long tag i would like to highlight","here is another one that is very long and has the tag token near the end").endObject()).execute().actionGet();
  refresh();
  SearchResponse response=client().prepareSearch("test").setQuery(QueryBuilders.matchQuery("tags","tag")).addHighlightedField("tags",-1,0).execute().actionGet();
  assertThat(response.getHits().hits()[0].highlightFields().get("tags").fragments().length,equalTo(2));
  assertThat(response.getHits().hits()[0].highlightFields().get("tags").fragments()[0].string(),equalTo("this is a really long <em>tag</em> i would like to highlight"));
  assertThat(response.getHits().hits()[0].highlightFields().get("tags").fragments()[1].string(),equalTo("here is another one that is very long and has the <em>tag</em> token near the end"));
}
