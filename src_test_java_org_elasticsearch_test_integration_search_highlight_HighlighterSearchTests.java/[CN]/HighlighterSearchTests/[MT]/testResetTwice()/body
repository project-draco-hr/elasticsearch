{
  prepareCreate("test").setSettings(ImmutableSettings.builder().put("analysis.analyzer.my_analyzer.type","pattern").put("analysis.analyzer.my_analyzer.pattern","\\s+").build()).addMapping("type",jsonBuilder().startObject().startObject("type").startObject("properties").startObject("text").field("type","string").field("analyzer","my_analyzer").endObject().endObject().endObject().endObject()).execute().actionGet();
  ensureGreen();
  client().prepareIndex("test","type","1").setSource(jsonBuilder().startObject().field("text","elasticsearch test").endObject()).setRefresh(true).execute().actionGet();
  SearchResponse response=client().prepareSearch("test").setQuery(QueryBuilders.matchQuery("text","test").type(MatchQueryBuilder.Type.BOOLEAN)).addHighlightedField("text").execute().actionGet();
  assertThat(response.getHits().totalHits(),equalTo(1L));
  assertThat(response.getFailedShards(),equalTo(0));
}
