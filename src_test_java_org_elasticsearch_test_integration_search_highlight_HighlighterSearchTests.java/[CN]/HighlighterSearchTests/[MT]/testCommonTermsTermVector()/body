{
  try {
    client.admin().indices().prepareDelete("test").execute().actionGet();
  }
 catch (  Exception e) {
  }
  client.admin().indices().prepareCreate("test").addMapping("type1",type1TermVectorMapping()).execute().actionGet();
  client.admin().cluster().prepareHealth("test").setWaitForGreenStatus().execute().actionGet();
  client.prepareIndex("test","type1").setSource("field1","this is a test","field2","The quick brown fox jumps over the lazy dog").setRefresh(true).execute().actionGet();
  logger.info("--> highlighting and searching on field1");
  SearchSourceBuilder source=searchSource().query(commonTerms("field2","quick brown").cutoffFrequency(100)).from(0).size(60).explain(true).highlight(highlight().field("field2").order("score").preTags("<x>").postTags("</x>"));
  SearchResponse searchResponse=client.search(searchRequest("test").setSource(source).setSearchType(QUERY_THEN_FETCH).setScroll(timeValueMinutes(10))).actionGet();
  assertThat("Failures " + Arrays.toString(searchResponse.getShardFailures()),searchResponse.getShardFailures().length,equalTo(0));
  assertThat(searchResponse.getHits().totalHits(),equalTo(1l));
  assertThat(searchResponse.getHits().getAt(0).highlightFields().get("field2").fragments()[0].string(),equalTo("The <x>quick</x> <x>brown</x> fox jumps over the lazy dog"));
}
