{
  Settings settings=Settings.builder().put(NettyHttpServerTransport.SETTING_CORS_ENABLED,true).put(NettyHttpServerTransport.SETTING_CORS_ALLOW_ORIGIN,"remote-host").build();
  httpServerTransport=new NettyHttpServerTransport(settings,networkService,bigArrays);
  HttpRequest httpRequest=new TestHttpRequest();
  httpRequest.headers().add(HttpHeaders.Names.ORIGIN,"remote");
  httpRequest.headers().add(HttpHeaders.Names.USER_AGENT,"Mozilla fake");
  WriteCapturingChannel writeCapturingChannel=new WriteCapturingChannel();
  NettyHttpRequest request=new NettyHttpRequest(httpRequest,writeCapturingChannel);
  NettyHttpChannel channel=new NettyHttpChannel(httpServerTransport,request,null,randomBoolean());
  channel.sendResponse(new TestReponse());
  List<Object> writtenObjects=writeCapturingChannel.getWrittenObjects();
  assertThat(writtenObjects.size(),is(1));
  HttpResponse response=(HttpResponse)writtenObjects.get(0);
  assertThat(response.headers().get(HttpHeaders.Names.ACCESS_CONTROL_ALLOW_ORIGIN),notNullValue());
  String allowedOrigins=response.headers().get(HttpHeaders.Names.ACCESS_CONTROL_ALLOW_ORIGIN);
  assertThat(allowedOrigins,is("remote-host"));
}
