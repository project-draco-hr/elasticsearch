{
  httpServerTransport=new NettyHttpServerTransport(settings,networkService,bigArrays,threadPool);
  HttpRequest httpRequest=new TestHttpRequest();
  httpRequest.headers().add(HttpHeaders.Names.ORIGIN,originValue);
  httpRequest.headers().add(HttpHeaders.Names.USER_AGENT,"Mozilla fake");
  httpRequest.headers().add(HttpHeaders.Names.HOST,host);
  WriteCapturingChannel writeCapturingChannel=new WriteCapturingChannel();
  NettyHttpRequest request=new NettyHttpRequest(httpRequest,writeCapturingChannel);
  NettyHttpChannel channel=new NettyHttpChannel(httpServerTransport,request,null,randomBoolean());
  channel.sendResponse(new TestReponse());
  List<Object> writtenObjects=writeCapturingChannel.getWrittenObjects();
  assertThat(writtenObjects.size(),is(1));
  return (HttpResponse)writtenObjects.get(0);
}
