{
  if (running.compareAndSet(false,true)) {
    try {
      List<HttpHost> sniffedNodes=hostsSniffer.sniffHosts();
      if (excludeHost != null) {
        sniffedNodes.remove(excludeHost);
      }
      logger.debug("sniffed nodes: " + sniffedNodes);
      this.restClient.setHosts(sniffedNodes.toArray(new HttpHost[sniffedNodes.size()]));
    }
 catch (    Throwable t) {
      logger.error("error while sniffing nodes",t);
    }
 finally {
      scheduleNextRun(nextSniffDelayMillis);
      running.set(false);
    }
  }
}
