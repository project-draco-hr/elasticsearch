{
  RecoveryStatus onGoingRecovery=onGoingRecoveries.get(request.recoveryId());
  if (onGoingRecovery == null) {
    throw new IndexShardClosedException(request.shardId());
  }
  if (onGoingRecovery.isCanceled()) {
    onGoingRecovery.sentCanceledToSource=true;
    throw new IndexShardClosedException(request.shardId());
  }
  InternalIndexShard shard=(InternalIndexShard)indicesService.indexServiceSafe(request.shardId().index().name()).shardSafe(request.shardId().id());
  for (  Translog.Operation operation : request.operations()) {
    if (onGoingRecovery.isCanceled()) {
      onGoingRecovery.sentCanceledToSource=true;
      throw new IndexShardClosedException(request.shardId());
    }
    shard.performRecoveryOperation(operation);
    onGoingRecovery.currentTranslogOperations++;
  }
  channel.sendResponse(TransportResponse.Empty.INSTANCE);
}
