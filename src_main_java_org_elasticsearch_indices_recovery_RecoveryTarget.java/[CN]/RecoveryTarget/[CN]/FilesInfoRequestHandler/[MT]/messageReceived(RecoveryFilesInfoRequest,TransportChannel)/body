{
  try (RecoveriesCollection.StatusRef statusRef=onGoingRecoveries.getStatusSafe(request.recoveryId(),request.shardId())){
    final RecoveryStatus recoveryStatus=statusRef.status();
    final RecoveryState.Index index=recoveryStatus.state().getIndex();
    for (int i=0; i < request.phase1ExistingFileNames.size(); i++) {
      index.addFileDetail(request.phase1ExistingFileNames.get(i),request.phase1ExistingFileSizes.get(i),true);
    }
    for (int i=0; i < request.phase1FileNames.size(); i++) {
      index.addFileDetail(request.phase1FileNames.get(i),request.phase1FileSizes.get(i),false);
    }
    recoveryStatus.stage(RecoveryState.Stage.INDEX);
    channel.sendResponse(TransportResponse.Empty.INSTANCE);
  }
 }
