{
  RecoveryStatus onGoingRecovery=onGoingRecoveries.get(request.recoveryId());
  if (onGoingRecovery == null) {
    throw new IndexShardClosedException(request.shardId());
  }
  if (onGoingRecovery.isCanceled()) {
    onGoingRecovery.sentCanceledToSource=true;
    throw new IndexShardClosedException(request.shardId());
  }
  onGoingRecovery.recoveryState().getIndex().addFileDetails(request.phase1FileNames,request.phase1FileSizes);
  onGoingRecovery.recoveryState().getIndex().addReusedFileDetails(request.phase1ExistingFileNames,request.phase1ExistingFileSizes);
  onGoingRecovery.recoveryState().getIndex().totalByteCount(request.phase1TotalSize);
  onGoingRecovery.recoveryState().getIndex().reusedByteCount(request.phase1ExistingTotalSize);
  onGoingRecovery.recoveryState().getIndex().totalFileCount(request.phase1FileNames.size());
  onGoingRecovery.stage(RecoveryState.Stage.INDEX);
  channel.sendResponse(TransportResponse.Empty.INSTANCE);
}
