{
  try (RecoveriesCollection.StatusRef statusRef=onGoingRecoveries.getStatusSafe(request.recoveryId(),request.shardId())){
    final RecoveryStatus recoveryStatus=statusRef.status();
    recoveryStatus.renameAllTempFiles();
    final Store store=recoveryStatus.store();
    recoveryStatus.legacyChecksums().write(store);
    for (    String existingFile : store.directory().listAll()) {
      if (!request.snapshotFiles().contains(existingFile) && !Store.isChecksum(existingFile)) {
        try {
          store.directory().deleteFile(existingFile);
        }
 catch (        Exception e) {
        }
      }
    }
    channel.sendResponse(TransportResponse.Empty.INSTANCE);
  }
 }
