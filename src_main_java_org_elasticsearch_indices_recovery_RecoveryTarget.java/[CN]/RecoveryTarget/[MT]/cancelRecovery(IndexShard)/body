{
  RecoveryStatus recoveryStatus=findRecoveryByShard(indexShard);
  if (recoveryStatus == null) {
    return;
  }
  if (recoveryStatus.sentCanceledToSource) {
    return;
  }
  recoveryStatus.cancel();
  try {
    if (recoveryStatus.recoveryThread != null) {
      recoveryStatus.recoveryThread.interrupt();
    }
    final long sleepTime=100;
    final long maxSleepTime=10000;
    long rounds=Math.round(maxSleepTime / sleepTime);
    while (!recoveryStatus.sentCanceledToSource && transportService.nodeConnected(recoveryStatus.sourceNode) && rounds > 0) {
      rounds--;
      try {
        Thread.sleep(sleepTime);
      }
 catch (      InterruptedException e) {
        Thread.currentThread().interrupt();
        break;
      }
    }
  }
  finally {
    removeAndCleanOnGoingRecovery(recoveryStatus);
  }
}
