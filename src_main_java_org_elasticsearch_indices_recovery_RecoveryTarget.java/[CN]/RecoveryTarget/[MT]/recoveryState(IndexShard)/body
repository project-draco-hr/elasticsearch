{
  try (RecoveriesCollection.StatusRef statusRef=onGoingRecoveries.findRecoveryByShard(indexShard)){
    if (statusRef == null) {
      return null;
    }
    final RecoveryStatus recoveryStatus=statusRef.status();
    if (recoveryStatus.state().getTimer().startTime() > 0 && recoveryStatus.stage() != RecoveryState.Stage.DONE) {
      recoveryStatus.state().getTimer().time(System.currentTimeMillis() - recoveryStatus.state().getTimer().startTime());
    }
    return recoveryStatus.state();
  }
 catch (  Exception e) {
    throw new ElasticsearchException("error while getting recovery state",e);
  }
}
