{
  ClusterName clusterName=new ClusterName("abc");
  DiscoveryNodes nodes=DiscoveryNodes.builder().masterNodeId("a").build();
  int numUpdates=scaledRandomIntBetween(50,100);
  LinkedList<ProcessClusterState> queue=new LinkedList<>();
  for (int i=0; i < numUpdates; i++) {
    queue.add(new ProcessClusterState(ClusterState.builder(clusterName).version(i).nodes(nodes).build(),null));
  }
  ProcessClusterState mostRecent=queue.get(numUpdates - 1);
  Collections.shuffle(queue,getRandom());
  assertThat(ZenDiscovery.selectNextStateToProcess(queue),sameInstance(mostRecent.clusterState));
  assertThat(mostRecent.processed,is(true));
  assertThat(queue.size(),equalTo(0));
}
