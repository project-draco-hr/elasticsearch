{
  if (size() > 0) {
    for (    NodeAndClient nodeAndClient : nodes.values()) {
      final IndicesFieldDataCache fdCache=getInstanceFromNode(IndicesFieldDataCache.class,nodeAndClient.node);
      fdCache.getCache().cleanUp();
      final String name=nodeAndClient.name;
      final CircuitBreakerService breakerService=getInstanceFromNode(CircuitBreakerService.class,nodeAndClient.node);
      CircuitBreaker fdBreaker=breakerService.getBreaker(CircuitBreaker.FIELDDATA);
      assertThat("Fielddata breaker not reset to 0 on node: " + name,fdBreaker.getUsed(),equalTo(0L));
      try {
        assertBusy(new Runnable(){
          @Override public void run(){
            CircuitBreaker reqBreaker=breakerService.getBreaker(CircuitBreaker.REQUEST);
            assertThat("Request breaker not reset to 0 on node: " + name,reqBreaker.getUsed(),equalTo(0L));
          }
        }
);
      }
 catch (      Exception e) {
        fail("Exception during check for request breaker reset to 0: " + e);
      }
      NodeService nodeService=getInstanceFromNode(NodeService.class,nodeAndClient.node);
      NodeStats stats=nodeService.stats(CommonStatsFlags.ALL,false,false,false,false,false,false,false,false,false);
      assertThat("Fielddata size must be 0 on node: " + stats.getNode(),stats.getIndices().getFieldData().getMemorySizeInBytes(),equalTo(0l));
      assertThat("Query cache size must be 0 on node: " + stats.getNode(),stats.getIndices().getQueryCache().getMemorySizeInBytes(),equalTo(0l));
      assertThat("FixedBitSet cache size must be 0 on node: " + stats.getNode(),stats.getIndices().getSegments().getBitsetMemoryInBytes(),equalTo(0l));
    }
  }
}
