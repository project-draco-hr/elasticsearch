{
  Set<Class<? extends Plugin>> plugins=new HashSet<>(nodeConfigurationSource.nodePlugins());
  Random random=new Random(seed);
  if (ENABLE_MOCK_MODULES && usually(random)) {
    plugins.add(MockTransportService.TestPlugin.class);
    plugins.add(MockFSIndexStore.TestPlugin.class);
    plugins.add(NodeMocksPlugin.class);
    plugins.add(MockEngineFactoryPlugin.class);
    plugins.add(MockSearchService.TestPlugin.class);
  }
  if (isLocalTransportConfigured()) {
    plugins.add(AssertingLocalTransport.TestPlugin.class);
  }
  return plugins;
}
