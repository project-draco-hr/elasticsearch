{
  TransportAddress addr=node.injector().getInstance(TransportService.class).boundAddress().publishAddress();
  Settings nodeSettings=node.settings();
  Builder builder=settingsBuilder().put("client.transport.nodes_sampler_interval","1s").put("path.home",baseDir).put("name",TRANSPORT_CLIENT_PREFIX + node.settings().get("name")).put(ClusterName.SETTING,clusterName).put("client.transport.sniff",sniff).put("node.mode",nodeSettings.get("node.mode",nodeMode)).put("node.local",nodeSettings.get("node.local","")).put("logger.prefix",nodeSettings.get("logger.prefix","")).put("logger.level",nodeSettings.get("logger.level","INFO")).put(InternalSettingsPreparer.IGNORE_SYSTEM_PROPERTIES_SETTING,true).put(settings);
  TransportClient.Builder clientBuilder=TransportClient.builder().settings(builder.build());
  for (  Class<? extends Plugin> plugin : plugins) {
    clientBuilder.addPlugin(plugin);
  }
  TransportClient client=clientBuilder.build();
  client.addTransportAddress(addr);
  return client;
}
