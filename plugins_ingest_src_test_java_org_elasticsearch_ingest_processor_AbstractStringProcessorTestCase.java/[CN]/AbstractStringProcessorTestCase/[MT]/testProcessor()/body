{
  IngestDocument ingestDocument=RandomDocumentPicks.randomIngestDocument(random());
  int numFields=randomIntBetween(1,5);
  Map<String,String> expected=new HashMap<>();
  for (int i=0; i < numFields; i++) {
    String fieldValue=RandomDocumentPicks.randomString(random());
    String fieldName=RandomDocumentPicks.addRandomField(random(),ingestDocument,modifyInput(fieldValue));
    expected.put(fieldName,expectedResult(fieldValue));
  }
  Processor processor=newProcessor(expected.keySet());
  processor.execute(ingestDocument);
  for (  Map.Entry<String,String> entry : expected.entrySet()) {
    assertThat(ingestDocument.getFieldValue(entry.getKey(),String.class),equalTo(entry.getValue()));
  }
}
