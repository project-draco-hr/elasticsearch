{
  super(facetName);
  this.fieldDataCache=context.fieldDataCache();
  this.size=size;
  this.comparatorType=comparatorType;
  this.numberOfShards=context.numberOfShards();
  MapperService.SmartNameFieldMappers smartMappers=context.smartFieldMappers(fieldName);
  if (smartMappers == null || !smartMappers.hasMapper()) {
    throw new ElasticSearchIllegalArgumentException("Field [" + fieldName + "] doesn't have a type, can't run terms double facet collector on it");
  }
  if (smartMappers.hasDocMapper() && smartMappers.explicitTypeInName()) {
    setFilter(context.filterCache().cache(smartMappers.docMapper().typeFilter()));
  }
  if (smartMappers.mapper().fieldDataType() != FieldDataType.DefaultTypes.DOUBLE) {
    throw new ElasticSearchIllegalArgumentException("Field [" + fieldName + "] is not of double type, can't run terms double facet collector on it");
  }
  this.indexFieldName=smartMappers.mapper().names().indexName();
  this.fieldDataType=smartMappers.mapper().fieldDataType();
  if (excluded == null || excluded.isEmpty()) {
    this.excluded=null;
  }
 else {
    this.excluded=new TDoubleHashSet(excluded.size());
    for (    String s : excluded) {
      this.excluded.add(Double.parseDouble(s));
    }
  }
  if (allTerms) {
    minCount=-1;
  }
 else {
    minCount=0;
  }
  this.aggregators=new ArrayList<ReaderAggregator>(context.searcher().subReaders().length);
}
