{
  try {
    return (new BigDecimal(Double.toString(x)).setScale(scale,roundingMethod)).doubleValue();
  }
 catch (  NumberFormatException ex) {
    if (Double.isInfinite(x)) {
      return x;
    }
 else {
      return Double.NaN;
    }
  }
}
