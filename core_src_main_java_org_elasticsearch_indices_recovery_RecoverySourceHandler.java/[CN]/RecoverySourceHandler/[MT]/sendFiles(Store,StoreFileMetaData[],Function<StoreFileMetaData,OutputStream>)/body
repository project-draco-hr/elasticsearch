{
  store.incRef();
  try {
    Future[] runners=asyncSendFiles(store,files,outputStreamFactory);
    IOException corruptedEngine=null;
    final List<Throwable> exceptions=new ArrayList<>();
    for (int i=0; i < runners.length; i++) {
      StoreFileMetaData md=files[i];
      try {
        runners[i].get();
      }
 catch (      ExecutionException t) {
        corruptedEngine=handleExecutionException(store,corruptedEngine,exceptions,md,t.getCause());
      }
catch (      InterruptedException t) {
        corruptedEngine=handleExecutionException(store,corruptedEngine,exceptions,md,t);
      }
    }
    if (corruptedEngine != null) {
      failEngine(corruptedEngine);
      throw corruptedEngine;
    }
 else {
      ExceptionsHelper.rethrowAndSuppress(exceptions);
    }
  }
  finally {
    store.decRef();
  }
}
