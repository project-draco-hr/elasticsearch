{
  logger.debug("Failed to transfer file [" + md + "] on recovery");
  final IOException corruptIndexException;
  final boolean checkIntegrity=corruptedEngine == null;
  if ((corruptIndexException=ExceptionsHelper.unwrapCorruption(t)) != null) {
    if (checkIntegrity && store.checkIntegrityNoException(md) == false) {
      logger.warn("{} Corrupted file detected {} checksum mismatch",shardId,md);
      corruptedEngine=corruptIndexException;
    }
 else {
      RemoteTransportException exception=new RemoteTransportException("File corruption occurred on recovery but checksums are ok",null);
      exception.addSuppressed(t);
      if (checkIntegrity) {
        logger.warn("{} Remote file corruption on node {}, recovering {}. local checksum OK",corruptIndexException,shardId,request.targetNode(),md);
      }
 else {
        logger.warn("{} Remote file corruption on node {}, recovering {}. local checksum are skipped",corruptIndexException,shardId,request.targetNode(),md);
      }
      exceptions.add(exception);
    }
  }
 else {
    exceptions.add(t);
  }
  return corruptedEngine;
}
