{
  if (shard.state() == IndexShardState.CLOSED) {
    throw new IndexShardClosedException(request.shardId());
  }
  cancellableThreads.checkForCancel();
  StopWatch stopWatch=new StopWatch().start();
  logger.trace("[{}][{}] finalizing recovery to {}",indexName,shardId,request.targetNode());
  cancellableThreads.execute(new Interruptable(){
    @Override public void run() throws InterruptedException {
      transportService.submitRequest(request.targetNode(),RecoveryTarget.Actions.FINALIZE,new RecoveryFinalizeRecoveryRequest(request.recoveryId(),request.shardId()),TransportRequestOptions.builder().withTimeout(recoverySettings.internalActionLongTimeout()).build(),EmptyTransportResponseHandler.INSTANCE_SAME).txGet();
    }
  }
);
  if (isPrimaryRelocation()) {
    try {
      shard.relocated("to " + request.targetNode());
    }
 catch (    IllegalIndexShardStateException e) {
    }
  }
  stopWatch.stop();
  logger.trace("[{}][{}] finalizing recovery to {}: took [{}]",indexName,shardId,request.targetNode(),stopWatch.totalTime());
}
