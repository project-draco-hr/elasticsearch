{
  if (keys == null) {
    throw new SearchParseException(context,"Missing token values in [" + aggregationName + "].",null);
  }
  if (method == PercentilesMethod.TDIGEST) {
    return new TDigestPercentileRanksAggregator.Factory(aggregationName,valuesSourceInput,keys,compression,keyed);
  }
 else   if (method == PercentilesMethod.HDR) {
    return new HDRPercentileRanksAggregator.Factory(aggregationName,valuesSourceInput,keys,numberOfSignificantValueDigits,keyed);
  }
 else {
    throw new AssertionError();
  }
}
