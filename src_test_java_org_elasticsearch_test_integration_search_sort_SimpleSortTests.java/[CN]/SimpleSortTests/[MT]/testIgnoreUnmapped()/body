{
  createIndex("test");
  client().prepareIndex("test","type1","1").setSource(jsonBuilder().startObject().field("id","1").field("i_value",-1).field("d_value",-1.1).endObject()).execute().actionGet();
  ensureYellow();
  logger.info("--> sort with an unmapped field, verify it fails");
  try {
    SearchResponse result=client().prepareSearch().setQuery(matchAllQuery()).addSort(SortBuilders.fieldSort("kkk")).execute().actionGet();
    assertThat("Expected exception but returned with",result,nullValue());
  }
 catch (  SearchPhaseExecutionException e) {
  }
  ensureYellow();
  SearchResponse searchResponse=client().prepareSearch().setQuery(matchAllQuery()).addSort(SortBuilders.fieldSort("kkk").ignoreUnmapped(true)).execute().actionGet();
  assertNoFailures(searchResponse);
}
