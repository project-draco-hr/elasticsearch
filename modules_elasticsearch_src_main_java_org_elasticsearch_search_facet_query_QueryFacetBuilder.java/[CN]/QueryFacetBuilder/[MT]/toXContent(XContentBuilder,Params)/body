{
  if (query == null) {
    throw new SearchSourceBuilderException("query must be set on query facet for facet [" + name + "]");
  }
  builder.startObject(name);
  builder.field(QueryFacet.TYPE);
  query.toXContent(builder,params);
  addFilterFacetAndGlobal(builder,params);
  builder.endObject();
  return builder;
}
