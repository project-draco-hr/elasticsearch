{
  Path path=createTempDir();
  ImmutableSettings.Builder settingsBuilder=ImmutableSettings.builder();
  settingsBuilder.put("path.home",path.resolve("home").toString());
  settingsBuilder.put("path.conf",path.resolve("conf").toString());
  settingsBuilder.put("path.plugins",path.resolve("plugins").toString());
  settingsBuilder.putArray("path.data",path.resolve("data1").toString(),path.resolve("data2").toString());
  settingsBuilder.put("path.logs",path.resolve("logs").toString());
  settingsBuilder.put("pidfile",path.resolve("test.pid").toString());
  Settings settings=settingsBuilder.build();
  Path fakeTmpDir=createTempDir();
  String realTmpDir=System.getProperty("java.io.tmpdir");
  Permissions permissions;
  Environment environment;
  try {
    System.setProperty("java.io.tmpdir",fakeTmpDir.toString());
    environment=new Environment(settings);
    permissions=Security.createPermissions(environment);
  }
  finally {
    System.setProperty("java.io.tmpdir",realTmpDir);
  }
  assertTrue(permissions.implies(new FilePermission(environment.homeFile().toString(),"read,readlink,write,delete")));
  assertTrue(permissions.implies(new FilePermission(environment.configFile().toString(),"read,readlink,write,delete")));
  assertTrue(permissions.implies(new FilePermission(environment.pluginsFile().toString(),"read,readlink,write,delete")));
  for (  Path dataPath : environment.dataFiles()) {
    assertTrue(permissions.implies(new FilePermission(dataPath.toString(),"read,readlink,write,delete")));
  }
  for (  Path dataPath : environment.dataWithClusterFiles()) {
    assertTrue(permissions.implies(new FilePermission(dataPath.toString(),"read,readlink,write,delete")));
  }
  assertTrue(permissions.implies(new FilePermission(environment.logsFile().toString(),"read,readlink,write,delete")));
  assertTrue(permissions.implies(new FilePermission(fakeTmpDir.toString(),"read,readlink,write,delete")));
  assertFalse(permissions.implies(new FilePermission(realTmpDir.toString(),"read")));
  assertTrue(permissions.implies(new FilePermission(environment.pidFile().toString(),"read,readlink,write,delete")));
}
