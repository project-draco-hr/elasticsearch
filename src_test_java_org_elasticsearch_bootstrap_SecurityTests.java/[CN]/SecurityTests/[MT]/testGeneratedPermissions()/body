{
  Path path=createTempDir();
  Path esHome=path.resolve("esHome");
  ImmutableSettings.Builder settingsBuilder=ImmutableSettings.builder();
  settingsBuilder.put("path.home",esHome.toString());
  Settings settings=settingsBuilder.build();
  Environment environment=new Environment(settings);
  Path policyFile=Security.processTemplate(new ByteArrayInputStream(new byte[0]),environment);
  ProtectionDomain domain=getClass().getProtectionDomain();
  Policy policy=Policy.getInstance("JavaPolicy",new URIParameter(policyFile.toUri()));
  assertTrue(policy.implies(domain,new FilePermission(esHome.toString(),"read")));
  assertFalse(policy.implies(domain,new FilePermission(path.toString(),"read")));
  assertFalse(policy.implies(domain,new FilePermission(path.resolve("other").toString(),"read")));
}
