{
  final StandardTokenizer src=new StandardTokenizer(getVersion(),reader);
  src.setMaxTokenLength(StandardAnalyzer.DEFAULT_MAX_TOKEN_LENGTH);
  TokenStream tok=new StandardFilter(getVersion(),src);
  tok=new LowerCaseFilter(getVersion(),tok);
  if (!stopwords.isEmpty()) {
    tok=new StopFilter(getVersion(),tok,stopwords);
  }
  return new TokenStreamComponents(src,tok){
    @Override protected void setReader(    final Reader reader) throws IOException {
      src.setMaxTokenLength(StandardAnalyzer.DEFAULT_MAX_TOKEN_LENGTH);
      super.setReader(reader);
    }
  }
;
}
