{
  if (indicesUpgradeStatus != null) {
    return indicesUpgradeStatus;
  }
  Map<String,IndexUpgradeStatus> indicesUpgradeStats=Maps.newHashMap();
  Set<String> indices=Sets.newHashSet();
  for (  ShardUpgradeStatus shard : shards) {
    indices.add(shard.getIndex());
  }
  for (  String index : indices) {
    List<ShardUpgradeStatus> shards=Lists.newArrayList();
    for (    ShardUpgradeStatus shard : this.shards) {
      if (shard.getShardRouting().index().equals(index)) {
        shards.add(shard);
      }
    }
    indicesUpgradeStats.put(index,new IndexUpgradeStatus(index,shards.toArray(new ShardUpgradeStatus[shards.size()])));
  }
  this.indicesUpgradeStatus=indicesUpgradeStats;
  return indicesUpgradeStats;
}
