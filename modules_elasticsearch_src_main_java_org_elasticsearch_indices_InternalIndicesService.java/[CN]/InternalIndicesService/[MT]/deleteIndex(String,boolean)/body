{
  Injector indexInjector=indicesInjectors.remove(index);
  if (indexInjector == null) {
    if (!delete) {
      return;
    }
    throw new IndexMissingException(new Index(index));
  }
  if (delete) {
    logger.debug("Deleting Index [{}]",index);
  }
  Map<String,IndexService> tmpMap=newHashMap(indices);
  IndexService indexService=tmpMap.remove(index);
  indices=ImmutableMap.copyOf(tmpMap);
  for (  Class<? extends CloseableIndexComponent> closeable : pluginsService.indexServices()) {
    indexInjector.getInstance(closeable).close(delete);
  }
  indexService.close(delete);
  indexInjector.getInstance(FilterCache.class).close();
  indexInjector.getInstance(AnalysisService.class).close();
  indexInjector.getInstance(IndexServiceManagement.class).close();
  indexInjector.getInstance(IndexGateway.class).close(delete);
  Injectors.close(injector);
}
