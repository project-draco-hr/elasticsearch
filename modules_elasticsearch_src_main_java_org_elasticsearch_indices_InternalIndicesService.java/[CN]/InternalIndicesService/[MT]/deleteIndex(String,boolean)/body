{
  Injector indexInjector=indicesInjectors.remove(index);
  if (indexInjector == null) {
    if (internalClose) {
      return;
    }
    throw new IndexMissingException(new Index(index));
  }
  if (!internalClose) {
    logger.debug("Deleting Index [{}]",index);
  }
  Map<String,IndexService> tmpMap=newHashMap(indices);
  IndexService indexService=tmpMap.remove(index);
  indices=ImmutableMap.copyOf(tmpMap);
  for (  Class<? extends CloseableComponent> closeable : pluginsService.indexServices()) {
    indexInjector.getInstance(closeable).close();
  }
  indexService.close();
  indexInjector.getInstance(FilterCache.class).close();
  indexInjector.getInstance(AnalysisService.class).close();
  indexInjector.getInstance(IndexServiceManagement.class).close();
  if (!internalClose) {
    indexInjector.getInstance(IndexGateway.class).delete();
  }
  indexInjector.getInstance(IndexGateway.class).close();
  Injectors.close(injector);
}
