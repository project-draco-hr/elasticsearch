{
  long start=System.currentTimeMillis();
  while (System.currentTimeMillis() - start < timeout.millis()) {
    ImmutableList<SnapshotInfo> snapshotInfos=run(client().admin().cluster().prepareGetSnapshots(repository).setSnapshots(snapshot)).getSnapshots();
    assertThat(snapshotInfos.size(),equalTo(1));
    if (snapshotInfos.get(0).state().completed()) {
      return snapshotInfos.get(0);
    }
    Thread.sleep(100);
  }
  fail("Timeout!!!");
  return null;
}
