{
  Request request=new Request();
  PlainActionFuture<Response> listener=new PlainActionFuture<>();
  ClusterBlocks.Builder block=ClusterBlocks.builder().addGlobalBlock(new ClusterBlock(1,"",false,true,RestStatus.SERVICE_UNAVAILABLE,ClusterBlockLevel.ALL));
  clusterService.setState(ClusterState.builder(clusterService.state()).blocks(block));
  try {
    action.new AsyncSingleAction(request,listener).start();
    listener.get();
    fail("expected ClusterBlockException");
  }
 catch (  Throwable t) {
    if (ExceptionsHelper.unwrap(t,ClusterBlockException.class) == null) {
      logger.info("expected ClusterBlockException  but got ",t);
      fail("expected ClusterBlockException");
    }
  }
}
