{
  client.admin().indices().prepareDelete().execute().actionGet();
  client.admin().indices().prepareCreate("test").setSettings(settingsBuilder().put(SETTING_NUMBER_OF_SHARDS,5).put(SETTING_NUMBER_OF_REPLICAS,0)).execute().actionGet();
  client.admin().cluster().prepareHealth("test").setWaitForGreenStatus().execute().actionGet();
  client.prepareIndex("test","type1","1").setSource(XContentFactory.jsonBuilder().startObject().field("field1","foobar1").endObject()).setRouting("1").execute().actionGet();
  client.prepareIndex("test","type1","2").setSource(XContentFactory.jsonBuilder().startObject().field("field1","foobar2").endObject()).setRouting("2").execute().actionGet();
  client.prepareIndex("test","type1","3").setSource(XContentFactory.jsonBuilder().startObject().field("field1","foobar3").endObject()).setRouting("1").execute().actionGet();
  client.admin().indices().prepareRefresh().execute().actionGet();
  SearchResponse search=client.prepareSearch().setSuggestText("foobar").addSuggestion(termSuggestion("simple").size(10).minDocFreq(0).field("field1").suggestMode("always")).execute().actionGet();
  assertThat(Arrays.toString(search.getShardFailures()),search.getFailedShards(),equalTo(0));
  assertThat(search.getSuggest(),notNullValue());
  assertThat(search.getSuggest().size(),equalTo(1));
  assertThat(search.getSuggest().getSuggestion("simple").getName(),equalTo("simple"));
  assertThat(search.getSuggest().getSuggestion("simple").getEntries().size(),equalTo(1));
  assertThat(search.getSuggest().getSuggestion("simple").getEntries().get(0).getOptions().size(),equalTo(3));
}
