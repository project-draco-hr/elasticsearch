{
  client().admin().indices().prepareDelete().execute().actionGet();
  client().admin().indices().prepareCreate("test").setSettings(settingsBuilder().put(SETTING_NUMBER_OF_SHARDS,5).put(SETTING_NUMBER_OF_REPLICAS,0)).execute().actionGet();
  client().admin().cluster().prepareHealth("test").setWaitForGreenStatus().execute().actionGet();
  Map<String,Integer> termsAndDocCount=new HashMap<String,Integer>();
  termsAndDocCount.put("prefix_aaad",20);
  termsAndDocCount.put("prefix_abbb",18);
  termsAndDocCount.put("prefix_aaca",16);
  termsAndDocCount.put("prefix_abba",14);
  termsAndDocCount.put("prefix_accc",12);
  termsAndDocCount.put("prefix_addd",10);
  termsAndDocCount.put("prefix_abaa",8);
  termsAndDocCount.put("prefix_dbca",6);
  termsAndDocCount.put("prefix_cbad",4);
  termsAndDocCount.put("prefix_aacd",1);
  termsAndDocCount.put("prefix_abcc",1);
  termsAndDocCount.put("prefix_accd",1);
  for (  Map.Entry<String,Integer> entry : termsAndDocCount.entrySet()) {
    for (int i=0; i < entry.getValue(); i++) {
      client().prepareIndex("test","type1").setSource(XContentFactory.jsonBuilder().startObject().field("field1",entry.getKey()).endObject()).execute().actionGet();
    }
  }
  client().admin().indices().prepareRefresh().execute().actionGet();
  Suggest suggest=searchSuggest(client(),"prefix_abcd",termSuggestion("size3SortScoreFirst").size(3).minDocFreq(0).field("field1").suggestMode("always"),termSuggestion("size10SortScoreFirst").size(10).minDocFreq(0).field("field1").suggestMode("always").shardSize(50),termSuggestion("size3SortScoreFirstMaxEdits1").maxEdits(1).size(10).minDocFreq(0).field("field1").suggestMode("always"),termSuggestion("size10SortFrequencyFirst").size(10).sort("frequency").shardSize(1000).minDocFreq(0).field("field1").suggestMode("always"));
  assertThat(suggest,notNullValue());
  assertThat(suggest.size(),equalTo(4));
  assertThat(suggest.getSuggestion("size3SortScoreFirst").getName(),equalTo("size3SortScoreFirst"));
  assertThat(suggest.getSuggestion("size3SortScoreFirst").getEntries().size(),equalTo(1));
  assertThat(suggest.getSuggestion("size3SortScoreFirst").getEntries().get(0).getOptions().size(),equalTo(3));
  assertThat(suggest.getSuggestion("size3SortScoreFirst").getEntries().get(0).getOptions().get(0).getText().string(),equalTo("prefix_aacd"));
  assertThat(suggest.getSuggestion("size3SortScoreFirst").getEntries().get(0).getOptions().get(1).getText().string(),equalTo("prefix_abcc"));
  assertThat(suggest.getSuggestion("size3SortScoreFirst").getEntries().get(0).getOptions().get(2).getText().string(),equalTo("prefix_accd"));
  assertThat(suggest.getSuggestion("size10SortScoreFirst").getName(),equalTo("size10SortScoreFirst"));
  assertThat(suggest.getSuggestion("size10SortScoreFirst").getEntries().size(),equalTo(1));
  assertThat(suggest.getSuggestion("size10SortScoreFirst").getEntries().get(0).getOptions().size(),equalTo(10));
  assertThat(suggest.getSuggestion("size10SortScoreFirst").getEntries().get(0).getOptions().get(0).getText().string(),equalTo("prefix_aacd"));
  assertThat(suggest.getSuggestion("size10SortScoreFirst").getEntries().get(0).getOptions().get(1).getText().string(),equalTo("prefix_abcc"));
  assertThat(suggest.getSuggestion("size10SortScoreFirst").getEntries().get(0).getOptions().get(2).getText().string(),equalTo("prefix_accd"));
  assertThat(suggest.getSuggestion("size3SortScoreFirstMaxEdits1").getName(),equalTo("size3SortScoreFirstMaxEdits1"));
  assertThat(suggest.getSuggestion("size3SortScoreFirstMaxEdits1").getEntries().size(),equalTo(1));
  assertThat(suggest.getSuggestion("size3SortScoreFirstMaxEdits1").getEntries().get(0).getOptions().size(),equalTo(3));
  assertThat(suggest.getSuggestion("size3SortScoreFirstMaxEdits1").getEntries().get(0).getOptions().get(0).getText().string(),equalTo("prefix_aacd"));
  assertThat(suggest.getSuggestion("size3SortScoreFirstMaxEdits1").getEntries().get(0).getOptions().get(1).getText().string(),equalTo("prefix_abcc"));
  assertThat(suggest.getSuggestion("size3SortScoreFirstMaxEdits1").getEntries().get(0).getOptions().get(2).getText().string(),equalTo("prefix_accd"));
  assertThat(suggest.getSuggestion("size10SortFrequencyFirst").getName(),equalTo("size10SortFrequencyFirst"));
  assertThat(suggest.getSuggestion("size10SortFrequencyFirst").getEntries().size(),equalTo(1));
  assertThat(suggest.getSuggestion("size10SortFrequencyFirst").getEntries().get(0).getOptions().size(),equalTo(10));
  assertThat(suggest.getSuggestion("size10SortFrequencyFirst").getEntries().get(0).getOptions().get(0).getText().string(),equalTo("prefix_aaad"));
  assertThat(suggest.getSuggestion("size10SortFrequencyFirst").getEntries().get(0).getOptions().get(1).getText().string(),equalTo("prefix_abbb"));
  assertThat(suggest.getSuggestion("size10SortFrequencyFirst").getEntries().get(0).getOptions().get(2).getText().string(),equalTo("prefix_aaca"));
  assertThat(suggest.getSuggestion("size10SortFrequencyFirst").getEntries().get(0).getOptions().get(3).getText().string(),equalTo("prefix_abba"));
  assertThat(suggest.getSuggestion("size10SortFrequencyFirst").getEntries().get(0).getOptions().get(4).getText().string(),equalTo("prefix_accc"));
  assertThat(suggest.getSuggestion("size10SortFrequencyFirst").getEntries().get(0).getOptions().get(5).getText().string(),equalTo("prefix_addd"));
  assertThat(suggest.getSuggestion("size10SortFrequencyFirst").getEntries().get(0).getOptions().get(6).getText().string(),equalTo("prefix_abaa"));
  assertThat(suggest.getSuggestion("size10SortFrequencyFirst").getEntries().get(0).getOptions().get(7).getText().string(),equalTo("prefix_dbca"));
  assertThat(suggest.getSuggestion("size10SortFrequencyFirst").getEntries().get(0).getOptions().get(8).getText().string(),equalTo("prefix_cbad"));
  assertThat(suggest.getSuggestion("size10SortFrequencyFirst").getEntries().get(0).getOptions().get(9).getText().string(),equalTo("prefix_aacd"));
}
