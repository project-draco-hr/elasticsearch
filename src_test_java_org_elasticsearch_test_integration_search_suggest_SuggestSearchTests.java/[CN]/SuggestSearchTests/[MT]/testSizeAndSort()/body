{
  client.admin().indices().prepareDelete().execute().actionGet();
  client.admin().indices().prepareCreate("test").setSettings(settingsBuilder().put(SETTING_NUMBER_OF_SHARDS,5).put(SETTING_NUMBER_OF_REPLICAS,0)).execute().actionGet();
  client.admin().cluster().prepareHealth("test").setWaitForGreenStatus().execute().actionGet();
  Map<String,Integer> termsAndDocCount=new HashMap<String,Integer>();
  termsAndDocCount.put("prefix_aaad",20);
  termsAndDocCount.put("prefix_abbb",18);
  termsAndDocCount.put("prefix_aaca",16);
  termsAndDocCount.put("prefix_abba",14);
  termsAndDocCount.put("prefix_accc",12);
  termsAndDocCount.put("prefix_addd",10);
  termsAndDocCount.put("prefix_abaa",8);
  termsAndDocCount.put("prefix_dbca",6);
  termsAndDocCount.put("prefix_cbad",4);
  termsAndDocCount.put("prefix_aacd",1);
  termsAndDocCount.put("prefix_abcc",1);
  termsAndDocCount.put("prefix_accd",1);
  for (  Map.Entry<String,Integer> entry : termsAndDocCount.entrySet()) {
    for (int i=0; i < entry.getValue(); i++) {
      client.prepareIndex("test","type1").setSource(XContentFactory.jsonBuilder().startObject().field("field1",entry.getKey()).endObject()).execute().actionGet();
    }
  }
  client.admin().indices().prepareRefresh().execute().actionGet();
  SearchResponse search=client.prepareSearch().setSuggestText("prefix_abcd").addSuggestion(fuzzySuggestion("size3SortScoreFirst").setSize(3).setMinDocFreq(0).setField("field1").setSuggestMode("always")).addSuggestion(fuzzySuggestion("size10SortScoreFirst").setSize(10).setMinDocFreq(0).setField("field1").setSuggestMode("always").setShardSize(50)).addSuggestion(fuzzySuggestion("size3SortScoreFirstMaxEdits1").setMaxEdits(1).setSize(10).setMinDocFreq(0).setField("field1").setSuggestMode("always")).addSuggestion(fuzzySuggestion("size10SortFrequencyFirst").setSize(10).setSort("frequency").setShardSize(1000).setMinDocFreq(0).setField("field1").setSuggestMode("always")).execute().actionGet();
  assertThat(Arrays.toString(search.shardFailures()),search.failedShards(),equalTo(0));
  assertThat(search.suggest(),notNullValue());
  assertThat(search.suggest().getSuggestions().size(),equalTo(4));
  assertThat(search.suggest().getSuggestions().get(0).getName(),equalTo("size3SortScoreFirst"));
  assertThat(search.suggest().getSuggestions().get(0).getEntries().size(),equalTo(1));
  assertThat(search.suggest().getSuggestions().get(0).getEntries().get(0).getOptions().size(),equalTo(3));
  assertThat(search.suggest().getSuggestions().get(0).getEntries().get(0).getOptions().get(0).getText().string(),equalTo("prefix_aacd"));
  assertThat(search.suggest().getSuggestions().get(0).getEntries().get(0).getOptions().get(1).getText().string(),equalTo("prefix_abcc"));
  assertThat(search.suggest().getSuggestions().get(0).getEntries().get(0).getOptions().get(2).getText().string(),equalTo("prefix_accd"));
  assertThat(search.suggest().getSuggestions().get(1).getName(),equalTo("size10SortScoreFirst"));
  assertThat(search.suggest().getSuggestions().get(1).getEntries().size(),equalTo(1));
  assertThat(search.suggest().getSuggestions().get(1).getEntries().get(0).getOptions().size(),equalTo(10));
  assertThat(search.suggest().getSuggestions().get(1).getEntries().get(0).getOptions().get(0).getText().string(),equalTo("prefix_aacd"));
  assertThat(search.suggest().getSuggestions().get(1).getEntries().get(0).getOptions().get(1).getText().string(),equalTo("prefix_abcc"));
  assertThat(search.suggest().getSuggestions().get(1).getEntries().get(0).getOptions().get(2).getText().string(),equalTo("prefix_accd"));
  assertThat(search.suggest().getSuggestions().get(2).getName(),equalTo("size3SortScoreFirstMaxEdits1"));
  assertThat(search.suggest().getSuggestions().get(2).getEntries().size(),equalTo(1));
  assertThat(search.suggest().getSuggestions().get(2).getEntries().get(0).getOptions().size(),equalTo(3));
  assertThat(search.suggest().getSuggestions().get(2).getEntries().get(0).getOptions().get(0).getText().string(),equalTo("prefix_aacd"));
  assertThat(search.suggest().getSuggestions().get(2).getEntries().get(0).getOptions().get(1).getText().string(),equalTo("prefix_abcc"));
  assertThat(search.suggest().getSuggestions().get(2).getEntries().get(0).getOptions().get(2).getText().string(),equalTo("prefix_accd"));
  assertThat(search.suggest().getSuggestions().get(3).getName(),equalTo("size10SortFrequencyFirst"));
  assertThat(search.suggest().getSuggestions().get(3).getEntries().size(),equalTo(1));
  assertThat(search.suggest().getSuggestions().get(3).getEntries().get(0).getOptions().size(),equalTo(10));
  assertThat(search.suggest().getSuggestions().get(3).getEntries().get(0).getOptions().get(0).getText().string(),equalTo("prefix_aaad"));
  assertThat(search.suggest().getSuggestions().get(3).getEntries().get(0).getOptions().get(1).getText().string(),equalTo("prefix_abbb"));
  assertThat(search.suggest().getSuggestions().get(3).getEntries().get(0).getOptions().get(2).getText().string(),equalTo("prefix_aaca"));
  assertThat(search.suggest().getSuggestions().get(3).getEntries().get(0).getOptions().get(3).getText().string(),equalTo("prefix_abba"));
  assertThat(search.suggest().getSuggestions().get(3).getEntries().get(0).getOptions().get(4).getText().string(),equalTo("prefix_accc"));
  assertThat(search.suggest().getSuggestions().get(3).getEntries().get(0).getOptions().get(5).getText().string(),equalTo("prefix_addd"));
  assertThat(search.suggest().getSuggestions().get(3).getEntries().get(0).getOptions().get(6).getText().string(),equalTo("prefix_abaa"));
  assertThat(search.suggest().getSuggestions().get(3).getEntries().get(0).getOptions().get(7).getText().string(),equalTo("prefix_dbca"));
  assertThat(search.suggest().getSuggestions().get(3).getEntries().get(0).getOptions().get(8).getText().string(),equalTo("prefix_cbad"));
  assertThat(search.suggest().getSuggestions().get(3).getEntries().get(0).getOptions().get(9).getText().string(),equalTo("prefix_aacd"));
}
