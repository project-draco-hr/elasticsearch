{
  client.admin().indices().prepareDelete().execute().actionGet();
  client.admin().indices().prepareCreate("test").setSettings(settingsBuilder().put(SETTING_NUMBER_OF_SHARDS,5).put(SETTING_NUMBER_OF_REPLICAS,0)).execute().actionGet();
  client.admin().cluster().prepareHealth("test").setWaitForGreenStatus().execute().actionGet();
  client.prepareIndex("test","type1").setSource(XContentFactory.jsonBuilder().startObject().field("text","abcd").endObject()).execute().actionGet();
  client.prepareIndex("test","type1").setSource(XContentFactory.jsonBuilder().startObject().field("text","aacd").endObject()).execute().actionGet();
  client.prepareIndex("test","type1").setSource(XContentFactory.jsonBuilder().startObject().field("text","abbd").endObject()).execute().actionGet();
  client.prepareIndex("test","type1").setSource(XContentFactory.jsonBuilder().startObject().field("text","abcc").endObject()).execute().actionGet();
  client.admin().indices().prepareRefresh().execute().actionGet();
  SearchResponse search=client.prepareSearch().setQuery(matchQuery("text","spellcecker")).addSuggestion(termSuggestion("test").suggestMode("always").text("abcd").field("text")).execute().actionGet();
  assertThat(Arrays.toString(search.getShardFailures()),search.getFailedShards(),equalTo(0));
  assertThat(search.getSuggest(),notNullValue());
  assertThat(search.getSuggest().size(),equalTo(1));
  assertThat(search.getSuggest().getSuggestion("test").getName(),equalTo("test"));
  assertThat(search.getSuggest().getSuggestion("test").getEntries().size(),equalTo(1));
  assertThat(search.getSuggest().getSuggestion("test").getEntries().get(0).getText().string(),equalTo("abcd"));
  assertThat(search.getSuggest().getSuggestion("test").getEntries().get(0).getOptions().size(),equalTo(3));
  assertThat(search.getSuggest().getSuggestion("test").getEntries().get(0).getOptions().get(0).getText().string(),equalTo("aacd"));
  assertThat(search.getSuggest().getSuggestion("test").getEntries().get(0).getOptions().get(1).getText().string(),equalTo("abbd"));
  assertThat(search.getSuggest().getSuggestion("test").getEntries().get(0).getOptions().get(2).getText().string(),equalTo("abcc"));
  client.prepareSearch().addSuggestion(termSuggestion("test").suggestMode("always").text("abcd").field("text")).execute().actionGet();
  assertThat(Arrays.toString(search.getShardFailures()),search.getFailedShards(),equalTo(0));
  assertThat(search.getSuggest(),notNullValue());
  assertThat(search.getSuggest().size(),equalTo(1));
  assertThat(search.getSuggest().getSuggestion("test").getName(),equalTo("test"));
  assertThat(search.getSuggest().getSuggestion("test").getEntries().size(),equalTo(1));
  assertThat(search.getSuggest().getSuggestion("test").getEntries().get(0).getOptions().size(),equalTo(3));
  assertThat(search.getSuggest().getSuggestion("test").getEntries().get(0).getOptions().get(0).getText().string(),equalTo("aacd"));
  assertThat(search.getSuggest().getSuggestion("test").getEntries().get(0).getOptions().get(1).getText().string(),equalTo("abbd"));
  assertThat(search.getSuggest().getSuggestion("test").getEntries().get(0).getOptions().get(2).getText().string(),equalTo("abcc"));
}
