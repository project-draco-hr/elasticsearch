{
  CreateIndexRequestBuilder builder=prepareCreate("test").setSettings(settingsBuilder().put(SETTING_NUMBER_OF_SHARDS,5).put(SETTING_NUMBER_OF_REPLICAS,0).put("index.analysis.analyzer.suggest.tokenizer","standard").putArray("index.analysis.analyzer.suggest.filter","standard","lowercase","shingler").put("index.analysis.filter.shingler.type","shingle").put("index.analysis.filter.shingler.min_shingle_size",2).put("index.analysis.filter.shingler.max_shingle_size",5).put("index.analysis.filter.shingler.output_unigrams",true));
  addMapping(builder,"type1",new Object[]{"name","type","multi_field","path","just_name","fields",ImmutableMap.of("name",ImmutableMap.of("type","string","analyzer","suggest"))});
  builder.get();
  ensureGreen();
  index("text","type2","1","foo","bar");
  index("text","type2","2","foo","bar");
  index("text","type1","1","name","Just testing the suggestions api");
  index("text","type1","2","name","An other title about equal length");
  refresh();
  SearchResponse searchResponse=client().prepareSearch().setSearchType(SearchType.COUNT).setSuggestText("tetsting sugestion").addSuggestion(phraseSuggestion("did_you_mean").field("name").maxErrors(5.0f)).get();
  assertNoFailures(searchResponse);
  assertSuggestion(searchResponse.getSuggest(),0,0,"did_you_mean","testing suggestions");
}
