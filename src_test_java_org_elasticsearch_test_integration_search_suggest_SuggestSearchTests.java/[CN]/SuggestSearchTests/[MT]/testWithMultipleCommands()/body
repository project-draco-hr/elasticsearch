{
  client.admin().indices().prepareDelete().execute().actionGet();
  client.admin().indices().prepareCreate("test").setSettings(settingsBuilder().put(SETTING_NUMBER_OF_SHARDS,5).put(SETTING_NUMBER_OF_REPLICAS,0)).execute().actionGet();
  client.admin().cluster().prepareHealth("test").setWaitForGreenStatus().execute().actionGet();
  client.prepareIndex("test","type1").setSource(XContentFactory.jsonBuilder().startObject().field("field1","prefix_abcd").field("field2","prefix_efgh").endObject()).execute().actionGet();
  client.prepareIndex("test","type1").setSource(XContentFactory.jsonBuilder().startObject().field("field1","prefix_aacd").field("field2","prefix_eeeh").endObject()).execute().actionGet();
  client.prepareIndex("test","type1").setSource(XContentFactory.jsonBuilder().startObject().field("field1","prefix_abbd").field("field2","prefix_efff").endObject()).execute().actionGet();
  client.prepareIndex("test","type1").setSource(XContentFactory.jsonBuilder().startObject().field("field1","prefix_abcc").field("field2","prefix_eggg").endObject()).execute().actionGet();
  client.admin().indices().prepareRefresh().execute().actionGet();
  SearchResponse search=client.prepareSearch().addSuggestion(fuzzySuggestion("size1").setSize(1).setText("prefix_abcd").setMaxTermFreq(10).setMinDocFreq(0).setField("field1").setSuggestMode("always")).addSuggestion(fuzzySuggestion("field2").setField("field2").setText("prefix_eeeh prefix_efgh").setMaxTermFreq(10).setMinDocFreq(0).setSuggestMode("always")).addSuggestion(fuzzySuggestion("accuracy").setField("field2").setText("prefix_efgh").setAccuracy(1f).setMaxTermFreq(10).setMinDocFreq(0).setSuggestMode("always")).execute().actionGet();
  assertThat(Arrays.toString(search.shardFailures()),search.failedShards(),equalTo(0));
  assertThat(search.suggest(),notNullValue());
  assertThat(search.suggest().getSuggestions().size(),equalTo(3));
  assertThat(search.suggest().getSuggestions().get(0).getName(),equalTo("size1"));
  assertThat(search.suggest().getSuggestions().get(0).getEntries().size(),equalTo(1));
  assertThat(search.suggest().getSuggestions().get(0).getEntries().get(0).getOptions().size(),equalTo(1));
  assertThat(search.suggest().getSuggestions().get(0).getEntries().get(0).getOptions().get(0).getText().string(),equalTo("prefix_aacd"));
  assertThat(search.suggest().getSuggestions().get(1).getName(),equalTo("field2"));
  assertThat(search.suggest().getSuggestions().get(1).getEntries().size(),equalTo(2));
  assertThat(search.suggest().getSuggestions().get(1).getEntries().get(0).getText().string(),equalTo("prefix_eeeh"));
  assertThat(search.suggest().getSuggestions().get(1).getEntries().get(0).getOffset(),equalTo(0));
  assertThat(search.suggest().getSuggestions().get(1).getEntries().get(0).getLength(),equalTo(11));
  assertThat(search.suggest().getSuggestions().get(1).getEntries().get(0).getOptions().size(),equalTo(1));
  assertThat(search.suggest().getSuggestions().get(1).getEntries().get(1).getText().string(),equalTo("prefix_efgh"));
  assertThat(search.suggest().getSuggestions().get(1).getEntries().get(1).getOffset(),equalTo(12));
  assertThat(search.suggest().getSuggestions().get(1).getEntries().get(1).getLength(),equalTo(11));
  assertThat(search.suggest().getSuggestions().get(1).getEntries().get(1).getOptions().size(),equalTo(3));
  assertThat(search.suggest().getSuggestions().get(1).getEntries().get(1).getOptions().get(0).getText().string(),equalTo("prefix_eeeh"));
  assertThat(search.suggest().getSuggestions().get(1).getEntries().get(1).getOptions().get(1).getText().string(),equalTo("prefix_efff"));
  assertThat(search.suggest().getSuggestions().get(1).getEntries().get(1).getOptions().get(2).getText().string(),equalTo("prefix_eggg"));
  assertThat(search.suggest().getSuggestions().get(2).getName(),equalTo("accuracy"));
  assertThat(search.suggest().getSuggestions().get(2).getEntries().get(0).getOptions().isEmpty(),equalTo(true));
}
