{
  client.admin().indices().prepareDelete().execute().actionGet();
  client.admin().indices().prepareCreate("test").setSettings(settingsBuilder().put(SETTING_NUMBER_OF_SHARDS,5).put(SETTING_NUMBER_OF_REPLICAS,0)).execute().actionGet();
  client.admin().cluster().prepareHealth("test").setWaitForGreenStatus().execute().actionGet();
  client.prepareIndex("test","type1").setSource(XContentFactory.jsonBuilder().startObject().field("field1","prefix_abcd").field("field2","prefix_efgh").endObject()).execute().actionGet();
  client.prepareIndex("test","type1").setSource(XContentFactory.jsonBuilder().startObject().field("field1","prefix_aacd").field("field2","prefix_eeeh").endObject()).execute().actionGet();
  client.prepareIndex("test","type1").setSource(XContentFactory.jsonBuilder().startObject().field("field1","prefix_abbd").field("field2","prefix_efff").endObject()).execute().actionGet();
  client.prepareIndex("test","type1").setSource(XContentFactory.jsonBuilder().startObject().field("field1","prefix_abcc").field("field2","prefix_eggg").endObject()).execute().actionGet();
  client.admin().indices().prepareRefresh().execute().actionGet();
  SearchResponse search=client.prepareSearch().addSuggestion(termSuggestion("size1").size(1).text("prefix_abcd").maxTermFreq(10).minDocFreq(0).field("field1").suggestMode("always")).addSuggestion(termSuggestion("field2").field("field2").text("prefix_eeeh prefix_efgh").maxTermFreq(10).minDocFreq(0).suggestMode("always")).addSuggestion(termSuggestion("accuracy").field("field2").text("prefix_efgh").setAccuracy(1f).maxTermFreq(10).minDocFreq(0).suggestMode("always")).execute().actionGet();
  assertThat(Arrays.toString(search.getShardFailures()),search.getFailedShards(),equalTo(0));
  assertThat(search.getSuggest(),notNullValue());
  assertThat(search.getSuggest().size(),equalTo(3));
  assertThat(search.getSuggest().getSuggestion("size1").getName(),equalTo("size1"));
  assertThat(search.getSuggest().getSuggestion("size1").getEntries().size(),equalTo(1));
  assertThat(search.getSuggest().getSuggestion("size1").getEntries().get(0).getOptions().size(),equalTo(1));
  assertThat(search.getSuggest().getSuggestion("size1").getEntries().get(0).getOptions().get(0).getText().string(),equalTo("prefix_aacd"));
  assertThat(search.getSuggest().getSuggestion("field2").getName(),equalTo("field2"));
  assertThat(search.getSuggest().getSuggestion("field2").getEntries().size(),equalTo(2));
  assertThat(search.getSuggest().getSuggestion("field2").getEntries().get(0).getText().string(),equalTo("prefix_eeeh"));
  assertThat(search.getSuggest().getSuggestion("field2").getEntries().get(0).getOffset(),equalTo(0));
  assertThat(search.getSuggest().getSuggestion("field2").getEntries().get(0).getLength(),equalTo(11));
  assertThat(search.getSuggest().getSuggestion("field2").getEntries().get(0).getOptions().size(),equalTo(1));
  assertThat(search.getSuggest().getSuggestion("field2").getEntries().get(1).getText().string(),equalTo("prefix_efgh"));
  assertThat(search.getSuggest().getSuggestion("field2").getEntries().get(1).getOffset(),equalTo(12));
  assertThat(search.getSuggest().getSuggestion("field2").getEntries().get(1).getLength(),equalTo(11));
  assertThat(search.getSuggest().getSuggestion("field2").getEntries().get(1).getOptions().size(),equalTo(3));
  assertThat(search.getSuggest().getSuggestion("field2").getEntries().get(1).getOptions().get(0).getText().string(),equalTo("prefix_eeeh"));
  assertThat(search.getSuggest().getSuggestion("field2").getEntries().get(1).getOptions().get(1).getText().string(),equalTo("prefix_efff"));
  assertThat(search.getSuggest().getSuggestion("field2").getEntries().get(1).getOptions().get(2).getText().string(),equalTo("prefix_eggg"));
  assertThat(search.getSuggest().getSuggestion("accuracy").getName(),equalTo("accuracy"));
  assertThat(search.getSuggest().getSuggestion("accuracy").getEntries().get(0).getOptions().isEmpty(),equalTo(true));
}
