{
  DiscoveryNode localNode=lastDiscoveryNodes.getLocalNode();
  if (localNode == null) {
    listener.onFailure(error);
    return;
  }
  final TaskResult taskResult;
  try {
    taskResult=task.result(localNode,error);
  }
 catch (  IOException ex) {
    logger.warn(new ParameterizedMessage("couldn't store error {}",ExceptionsHelper.detailedMessage(error)),ex);
    listener.onFailure(ex);
    return;
  }
  taskResultsService.storeResult(taskResult,new ActionListener<Void>(){
    @Override public void onResponse(    Void aVoid){
      listener.onFailure(error);
    }
    @Override public void onFailure(    Exception e){
      logger.warn(new ParameterizedMessage("couldn't store error {}",ExceptionsHelper.detailedMessage(error)),e);
      listener.onFailure(e);
    }
  }
);
}
