{
  DiscoveryNode localNode=lastDiscoveryNodes.getLocalNode();
  if (localNode == null) {
    listener.onFailure(error);
    return;
  }
  final PersistedTaskInfo taskResult;
  try {
    taskResult=task.result(localNode,error);
  }
 catch (  IOException ex) {
    logger.warn("couldn't persist error {}",ex,ExceptionsHelper.detailedMessage(error));
    listener.onFailure(ex);
    return;
  }
  taskResultsService.persist(taskResult,new ActionListener<Void>(){
    @Override public void onResponse(    Void aVoid){
      listener.onFailure(error);
    }
    @Override public void onFailure(    Throwable e){
      logger.warn("couldn't persist error {}",e,ExceptionsHelper.detailedMessage(error));
      listener.onFailure(e);
    }
  }
);
}
