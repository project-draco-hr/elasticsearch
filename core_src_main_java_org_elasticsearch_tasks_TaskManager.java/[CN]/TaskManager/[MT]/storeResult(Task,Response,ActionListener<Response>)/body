{
  DiscoveryNode localNode=lastDiscoveryNodes.getLocalNode();
  if (localNode == null) {
    logger.warn("couldn't store response {}, the node didn't join the cluster yet",response);
    listener.onResponse(response);
    return;
  }
  final TaskResult taskResult;
  try {
    taskResult=task.result(localNode,response);
  }
 catch (  IOException ex) {
    logger.warn(new ParameterizedMessage("couldn't store response {}",response),ex);
    listener.onFailure(ex);
    return;
  }
  taskResultsService.storeResult(taskResult,new ActionListener<Void>(){
    @Override public void onResponse(    Void aVoid){
      listener.onResponse(response);
    }
    @Override public void onFailure(    Exception e){
      logger.warn(new ParameterizedMessage("couldn't store response {}",response),e);
      listener.onFailure(e);
    }
  }
);
}
