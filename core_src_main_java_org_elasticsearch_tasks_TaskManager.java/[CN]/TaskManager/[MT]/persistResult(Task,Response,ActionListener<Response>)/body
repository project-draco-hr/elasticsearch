{
  DiscoveryNode localNode=lastDiscoveryNodes.getLocalNode();
  if (localNode == null) {
    logger.warn("couldn't persist response {}, the node didn't join the cluster yet",response);
    listener.onResponse(response);
    return;
  }
  final PersistedTaskInfo taskResult;
  try {
    taskResult=task.result(localNode,response);
  }
 catch (  IOException ex) {
    logger.warn("couldn't persist response {}",ex,response);
    listener.onFailure(ex);
    return;
  }
  taskResultsService.persist(taskResult,new ActionListener<Void>(){
    @Override public void onResponse(    Void aVoid){
      listener.onResponse(response);
    }
    @Override public void onFailure(    Exception e){
      logger.warn("couldn't persist response {}",e,response);
      listener.onFailure(e);
    }
  }
);
}
