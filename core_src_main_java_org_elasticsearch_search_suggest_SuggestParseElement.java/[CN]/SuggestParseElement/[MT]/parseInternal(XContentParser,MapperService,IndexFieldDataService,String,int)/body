{
  SuggestionSearchContext suggestionSearchContext=new SuggestionSearchContext();
  BytesRef globalText=null;
  String fieldName=null;
  Map<String,SuggestionContext> suggestionContexts=new HashMap<>();
  XContentParser.Token token;
  while ((token=parser.nextToken()) != XContentParser.Token.END_OBJECT) {
    if (token == XContentParser.Token.FIELD_NAME) {
      fieldName=parser.currentName();
    }
 else     if (token.isValue()) {
      if ("text".equals(fieldName)) {
        globalText=parser.utf8Bytes();
      }
 else {
        throw new IllegalArgumentException("[suggest] does not support [" + fieldName + "]");
      }
    }
 else     if (token == XContentParser.Token.START_OBJECT) {
      String suggestionName=fieldName;
      BytesRef suggestText=null;
      BytesRef prefix=null;
      BytesRef regex=null;
      SuggestionContext suggestionContext=null;
      while ((token=parser.nextToken()) != XContentParser.Token.END_OBJECT) {
        if (token == XContentParser.Token.FIELD_NAME) {
          fieldName=parser.currentName();
        }
 else         if (token.isValue()) {
          if ("text".equals(fieldName)) {
            suggestText=parser.utf8Bytes();
          }
 else           if ("prefix".equals(fieldName)) {
            prefix=parser.utf8Bytes();
          }
 else           if ("regex".equals(fieldName)) {
            regex=parser.utf8Bytes();
          }
 else {
            throw new IllegalArgumentException("[suggest] does not support [" + fieldName + "]");
          }
        }
 else         if (token == XContentParser.Token.START_OBJECT) {
          if (suggestionName == null) {
            throw new IllegalArgumentException("Suggestion must have name");
          }
          if (suggesters.get(fieldName) == null) {
            throw new IllegalArgumentException("Suggester[" + fieldName + "] not supported");
          }
          final SuggestContextParser contextParser=suggesters.get(fieldName).getContextParser();
          suggestionContext=contextParser.parse(parser,mapperService,fieldDataService);
        }
      }
      if (suggestionContext != null) {
        if (suggestText != null && prefix == null) {
          suggestionContext.setPrefix(suggestText);
          suggestionContext.setText(suggestText);
        }
 else         if (suggestText == null && prefix != null) {
          suggestionContext.setPrefix(prefix);
          suggestionContext.setText(prefix);
        }
 else         if (regex != null) {
          suggestionContext.setRegex(regex);
          suggestionContext.setText(regex);
        }
        suggestionContexts.put(suggestionName,suggestionContext);
      }
    }
  }
  for (  Map.Entry<String,SuggestionContext> entry : suggestionContexts.entrySet()) {
    String suggestionName=entry.getKey();
    SuggestionContext suggestionContext=entry.getValue();
    suggestionContext.setShard(shardId);
    suggestionContext.setIndex(index);
    SuggestUtils.verifySuggestion(mapperService,globalText,suggestionContext);
    suggestionSearchContext.addSuggestion(suggestionName,suggestionContext);
  }
  return suggestionSearchContext;
}
