{
  super(settings);
  this.clusterService=clusterService;
  this.jmxService=jmxService;
  this.getJmxServiceUrlAction=getJmxServiceUrlAction;
  this.clusterNodesJmxUpdater=newSingleThreadExecutor(daemonThreadFactory(settings,"jmxService#updateTask"));
  if (jmxService.publishUrl() != null) {
    clusterService.add(new JmxClusterEventListener());
    for (    final DiscoveryNode node : clusterService.state().nodes()) {
      clusterNodesJmxUpdater.execute(new Runnable(){
        @Override public void run(){
          String nodeServiceUrl=getJmxServiceUrlAction.obtainPublishUrl(node);
          registerNode(node,nodeServiceUrl);
        }
      }
);
    }
  }
}
