{
  assertAcked(prepareCreate("test").addMapping("type1",jsonBuilder().startObject().startObject("type1").startObject("properties").startObject("test").field("type","string").endObject().startObject("num").field("type","float").endObject().endObject().endObject().endObject()));
  ensureYellow();
  client().prepareIndex().setType("type1").setId("1").setIndex("test").setSource(jsonBuilder().startObject().field("test","value").field("num",10).endObject()).get();
  refresh();
  SearchResponse response=client().search(searchRequest().searchType(SearchType.QUERY_THEN_FETCH).source(searchSource().explain(true).query(functionScoreQuery(termQuery("test","value"),new FunctionScoreQueryBuilder.FilterFunctionBuilder[]{new FunctionScoreQueryBuilder.FilterFunctionBuilder(gaussDecayFunction("num",5,5)),new FunctionScoreQueryBuilder.FilterFunctionBuilder(exponentialDecayFunction("num",5,5)),new FunctionScoreQueryBuilder.FilterFunctionBuilder(linearDecayFunction("num",5,5))})))).get();
  String explanation=response.getHits().getAt(0).explanation().toString();
  checkQueryExplanationAppearsOnlyOnce(explanation);
  response=client().search(searchRequest().searchType(SearchType.QUERY_THEN_FETCH).source(searchSource().explain(true).query(functionScoreQuery(termQuery("test","value"),fieldValueFactorFunction("num"))))).get();
  explanation=response.getHits().getAt(0).explanation().toString();
  checkQueryExplanationAppearsOnlyOnce(explanation);
  response=client().search(searchRequest().searchType(SearchType.QUERY_THEN_FETCH).source(searchSource().explain(true).query(functionScoreQuery(termQuery("test","value"),randomFunction(10))))).get();
  explanation=response.getHits().getAt(0).explanation().toString();
  checkQueryExplanationAppearsOnlyOnce(explanation);
}
