{
  result.shardTarget(new SearchShardTarget(shard.currentNodeId(),shard.index(),shard.id()));
  processFirstPhaseResult(shardIndex,result);
  successfulOps.incrementAndGet();
  final int xTotalOps=totalOps.addAndGet(shardIt.remaining() + 1);
  if (xTotalOps == expectedTotalOps) {
    try {
      innerMoveToSecondPhase();
    }
 catch (    Throwable e) {
      if (logger.isDebugEnabled()) {
        logger.debug("{}: Failed to execute [{}] while moving to second phase",e,shardIt.shardId(),request);
      }
      raiseEarlyFailure(new ReduceSearchPhaseException(firstPhaseName(),"",e,buildShardFailures()));
    }
  }
 else   if (xTotalOps > expectedTotalOps) {
    raiseEarlyFailure(new IllegalStateException("unexpected higher total ops [" + xTotalOps + "] compared "+ "to expected ["+ expectedTotalOps+ "]"));
  }
}
