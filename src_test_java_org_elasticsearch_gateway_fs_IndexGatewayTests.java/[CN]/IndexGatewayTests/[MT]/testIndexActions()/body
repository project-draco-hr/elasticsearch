{
  cluster().startNode(nodeSettings(0));
  logger.info("Running Cluster Health (waiting for node to startup properly)");
  ClusterHealthResponse clusterHealth=client().admin().cluster().health(clusterHealthRequest().waitForGreenStatus()).actionGet();
  logger.info("Done Cluster Health, status " + clusterHealth.getStatus());
  assertThat(clusterHealth.isTimedOut(),equalTo(false));
  assertThat(clusterHealth.getStatus(),equalTo(ClusterHealthStatus.GREEN));
  assertAcked(client().admin().indices().create(createIndexRequest("test")).actionGet());
  cluster().stopRandomNode();
  cluster().startNode(nodeSettings(0));
  assertTrue("index should exists",awaitBusy(new Predicate<Object>(){
    @Override public boolean apply(    Object input){
      try {
        client().admin().indices().create(createIndexRequest("test")).actionGet();
        return false;
      }
 catch (      IndexAlreadyExistsException e) {
        return true;
      }
    }
  }
));
}
