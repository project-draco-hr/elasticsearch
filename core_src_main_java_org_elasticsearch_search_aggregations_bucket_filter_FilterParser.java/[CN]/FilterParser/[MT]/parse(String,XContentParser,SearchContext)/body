{
  QueryParseContext queryParseContext=new QueryParseContext(queriesRegistry);
  queryParseContext.reset(parser);
  queryParseContext.parseFieldMatcher(context.parseFieldMatcher());
  QueryBuilder<?> filter=queryParseContext.parseInnerQueryBuilder();
  FilterAggregator.Factory factory=new FilterAggregator.Factory(aggregationName);
  factory.filter(filter == null ? new MatchAllQueryBuilder() : filter);
  return factory;
}
