{
  InternalSearchResponse internalResponse=searchPhaseController.merge(sortedShardList,queryResults,fetchResults);
  String scrollId=null;
  if (request.getScroll() != null) {
    scrollId=request.getScrollId();
  }
  listener.onResponse(new SearchResponse(internalResponse,scrollId,this.scrollId.getContext().length,successfulOps.get(),System.currentTimeMillis() - startTime,buildShardFailures()));
  searchCache.releaseQueryResults(queryResults);
  searchCache.releaseFetchResults(fetchResults);
}
