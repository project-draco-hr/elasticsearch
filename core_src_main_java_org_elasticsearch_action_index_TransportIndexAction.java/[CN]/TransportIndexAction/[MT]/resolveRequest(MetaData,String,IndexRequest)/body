{
  MappingMetaData mappingMd=null;
  if (metaData.hasIndex(concreteIndex)) {
    mappingMd=metaData.index(concreteIndex).mappingOrDefault(request.type());
  }
  request.process(metaData,mappingMd,allowIdGeneration,concreteIndex);
  ShardId shardId=clusterService.operationRouting().shardId(clusterService.state(),concreteIndex,request.id(),request.routing());
  request.setShardId(shardId);
}
