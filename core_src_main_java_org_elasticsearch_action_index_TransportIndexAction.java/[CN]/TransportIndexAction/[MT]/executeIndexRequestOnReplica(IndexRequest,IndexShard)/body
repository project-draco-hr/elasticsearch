{
  final ShardId shardId=indexShard.shardId();
  SourceToParse sourceToParse=SourceToParse.source(SourceToParse.Origin.REPLICA,request.source()).index(shardId.getIndex()).type(request.type()).id(request.id()).routing(request.routing()).parent(request.parent()).timestamp(request.timestamp()).ttl(request.ttl());
  final Engine.Index operation=indexShard.prepareIndexOnReplica(sourceToParse,request.version(),request.versionType());
  Mapping update=operation.parsedDoc().dynamicMappingsUpdate();
  if (update != null) {
    throw new RetryOnReplicaException(shardId,"Mappings are not available on the replica yet, triggered update: " + update);
  }
  indexShard.index(operation);
  return operation;
}
