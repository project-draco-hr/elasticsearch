{
  final ShardId shardId=indexShard.shardId();
  SourceToParse sourceToParse=SourceToParse.source(SourceToParse.Origin.REPLICA,shardId.getIndexName(),request.type(),request.id(),request.source()).routing(request.routing()).parent(request.parent()).timestamp(request.timestamp()).ttl(request.ttl());
  final Engine.Index operation=indexShard.prepareIndexOnReplica(sourceToParse,request.version(),request.versionType(),request.getAutoGeneratedTimestamp(),request.isRetry());
  Mapping update=operation.parsedDoc().dynamicMappingsUpdate();
  if (update != null) {
    throw new RetryOnReplicaException(shardId,"Mappings are not available on the replica yet, triggered update: " + update);
  }
  indexShard.index(operation);
  return operation;
}
