{
  ClusterState state=clusterService.state();
  if (autoCreateIndex.shouldAutoCreate(request.index(),state)) {
    CreateIndexRequest createIndexRequest=new CreateIndexRequest();
    createIndexRequest.index(request.index());
    createIndexRequest.mapping(request.type());
    createIndexRequest.cause("auto(index api)");
    createIndexRequest.masterNodeTimeout(request.timeout());
    createIndexAction.execute(task,createIndexRequest,new ActionListener<CreateIndexResponse>(){
      @Override public void onResponse(      CreateIndexResponse result){
        innerExecute(task,request,listener);
      }
      @Override public void onFailure(      Throwable e){
        if (ExceptionsHelper.unwrapCause(e) instanceof IndexAlreadyExistsException) {
          try {
            innerExecute(task,request,listener);
          }
 catch (          Throwable e1) {
            listener.onFailure(e1);
          }
        }
 else {
          listener.onFailure(e);
        }
      }
    }
);
  }
 else {
    innerExecute(task,request,listener);
  }
}
