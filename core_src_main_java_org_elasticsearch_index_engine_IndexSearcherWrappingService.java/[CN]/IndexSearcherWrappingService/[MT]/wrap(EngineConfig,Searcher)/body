{
  if (wrapper == null) {
    return engineSearcher;
  }
  DirectoryReader reader=wrapper.wrap((DirectoryReader)engineSearcher.reader());
  IndexSearcher innerIndexSearcher=new IndexSearcher(reader);
  innerIndexSearcher.setQueryCache(engineConfig.getQueryCache());
  innerIndexSearcher.setQueryCachingPolicy(engineConfig.getQueryCachingPolicy());
  innerIndexSearcher.setSimilarity(engineConfig.getSimilarity());
  IndexSearcher indexSearcher=wrapper.wrap(engineConfig,innerIndexSearcher);
  if (reader == engineSearcher.reader() && indexSearcher == innerIndexSearcher) {
    return engineSearcher;
  }
 else {
    return new Engine.Searcher(engineSearcher.source(),indexSearcher){
      @Override public void close() throws ElasticsearchException {
        engineSearcher.close();
      }
    }
;
  }
}
