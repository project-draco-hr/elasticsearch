{
  assumeTrue("File system does not support permissions, skipping",supportsPermissions);
  URL pluginUrl=createPlugin(false,false);
  Path path=environment.configFile().resolve(pluginName);
  Files.createDirectories(path);
  Files.createFile(path.resolve("my-custom-config.yaml"));
  Path binPath=environment.binFile().resolve(pluginName);
  Files.createDirectories(binPath);
  try {
    Files.setPosixFilePermissions(path.resolve("my-custom-config.yaml"),PosixFilePermissions.fromString("---------"));
    Files.setPosixFilePermissions(path,PosixFilePermissions.fromString("---------"));
    Files.setPosixFilePermissions(binPath,PosixFilePermissions.fromString("---------"));
    PluginManager pluginManager=new PluginManager(environment,pluginUrl,PluginManager.OutputMode.VERBOSE,TimeValue.timeValueSeconds(10));
    pluginManager.downloadAndExtract(pluginName,terminal,true);
  }
  finally {
    Files.setPosixFilePermissions(binPath,PosixFilePermissions.fromString("rwxrwxrwx"));
    Files.setPosixFilePermissions(path,PosixFilePermissions.fromString("rwxrwxrwx"));
    Files.setPosixFilePermissions(path.resolve("my-custom-config.yaml"),PosixFilePermissions.fromString("rwxrwxrwx"));
  }
}
