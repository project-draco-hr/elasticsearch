{
  assumeTrue("File system does not support permissions, skipping",supportsPermissions);
  Files.createDirectories(environment.configFile());
  Files.createFile(environment.configFile().resolve(pluginName));
  URL pluginUrl=createPlugin(randomBoolean(),true);
  PluginManager pluginManager=new PluginManager(environment,pluginUrl,PluginManager.OutputMode.VERBOSE,TimeValue.timeValueSeconds(10));
  try {
    pluginManager.downloadAndExtract(pluginName,terminal);
    fail("Expected plugin installation to fail, but didnt");
  }
 catch (  IOException e) {
    assertFileExists(environment.configFile().resolve(pluginName));
    assertFileNotExists(environment.binFile().resolve(pluginName));
    assertFileNotExists(environment.pluginsFile().resolve(pluginName));
  }
}
