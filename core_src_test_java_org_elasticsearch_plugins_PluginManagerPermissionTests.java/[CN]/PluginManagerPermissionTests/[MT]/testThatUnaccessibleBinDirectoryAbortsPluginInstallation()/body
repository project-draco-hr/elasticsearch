{
  assumeTrue("File system does not support permissions, skipping",supportsPermissions);
  URL pluginUrl=createPlugin(true,randomBoolean());
  Path binPath=environment.binFile().resolve(pluginName);
  Files.createDirectories(binPath);
  try {
    Files.setPosixFilePermissions(binPath,PosixFilePermissions.fromString("---------"));
    PluginManager pluginManager=new PluginManager(environment,pluginUrl,PluginManager.OutputMode.VERBOSE,TimeValue.timeValueSeconds(10));
    pluginManager.downloadAndExtract(pluginName,terminal);
    fail("Expected IOException but did not happen");
  }
 catch (  IOException e) {
    assertFileNotExists(environment.pluginsFile().resolve(pluginName));
    assertFileNotExists(environment.configFile().resolve(pluginName));
    assertDirectoryExists(environment.binFile().resolve(pluginName));
    assertThat(terminal.getTerminalOutput(),hasItem(containsString("Error copying bin directory ")));
  }
 finally {
    Files.setPosixFilePermissions(binPath,PosixFilePermissions.fromString("rwxrwxrwx"));
  }
}
