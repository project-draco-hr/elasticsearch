def readServerOutput(p, startupEvent, failureEvent):
    try:
        while True:
            line = p.stdout.readline()
            if (len(line) == 0):
                p.poll()
                if (not startupEvent.isSet()):
                    failureEvent.set()
                    startupEvent.set()
                print 'ES: **process exit**\n'
                break
            line = line.decode('utf-8').rstrip()
            if (line.endswith('started') and (not startupEvent.isSet())):
                startupEvent.set()
            print ('ES: %s' % line)
    except:
        print ()
        print 'Exception reading Elasticsearch output:'
        traceback.print_exc()
        failureEvent.set()
        startupEvent.set()
