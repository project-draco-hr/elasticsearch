{
  Directory dir=new RAMDirectory();
  IndexWriter indexWriter=new IndexWriter(dir,Lucene.STANDARD_ANALYZER,true,IndexWriter.MaxFieldLength.UNLIMITED);
  indexWriter.commit();
  assertThat("Index is empty after creation and commit",estimateRamSize(indexWriter),equalTo(0l));
  indexWriter.addDocument(doc().add(field("_id","1")).add(new NumericField("test",Field.Store.YES,true).setIntValue(2)).build());
  long size=estimateRamSize(indexWriter);
  assertThat("After indexing a small document, should be higher",size,greaterThan(100000l));
  indexWriter.deleteDocuments(new Term("_id","1"));
  assertThat(estimateRamSize(indexWriter),greaterThan(size));
  indexWriter.commit();
  assertThat(estimateRamSize(indexWriter),equalTo(0l));
}
