{
  if (connectMode) {
    TransportResponseHandler transportResponseHandler=transportServiceAdapter.onResponseReceived(requestId);
    if (action.equals(TransportLivenessAction.NAME)) {
      transportResponseHandler.handleResponse(new LivenessResponse(clusterName,node));
    }
 else {
      transportResponseHandler.handleResponse(new TransportService.HandshakeResponse(node,clusterName,Version.CURRENT));
    }
    return;
  }
  triedNodes.add(node);
  if (RandomInts.randomInt(random,100) > 10) {
    connectTransportExceptions.incrementAndGet();
    throw new ConnectTransportException(node,"node not available");
  }
 else {
    if (random.nextBoolean()) {
      failures.incrementAndGet();
      throw new IllegalStateException();
    }
 else {
      TransportResponseHandler transportResponseHandler=transportServiceAdapter.onResponseReceived(requestId);
      if (random.nextBoolean()) {
        successes.incrementAndGet();
        transportResponseHandler.handleResponse(newResponse());
      }
 else {
        failures.incrementAndGet();
        transportResponseHandler.handleException(new TransportException("transport exception"));
      }
    }
  }
}
