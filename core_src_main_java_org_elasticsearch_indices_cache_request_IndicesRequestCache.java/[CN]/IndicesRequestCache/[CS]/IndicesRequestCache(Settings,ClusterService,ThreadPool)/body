{
  super(settings);
  this.clusterService=clusterService;
  this.threadPool=threadPool;
  this.cleanInterval=settings.getAsTime(INDICES_CACHE_REQUEST_CLEAN_INTERVAL,TimeValue.timeValueSeconds(60));
  String size=settings.get(INDICES_CACHE_QUERY_SIZE);
  if (size == null) {
    size=settings.get(DEPRECATED_INDICES_CACHE_QUERY_SIZE);
    if (size != null) {
      deprecationLogger.deprecated("The [" + DEPRECATED_INDICES_CACHE_QUERY_SIZE + "] settings is now deprecated, use ["+ INDICES_CACHE_QUERY_SIZE+ "] instead");
    }
  }
  if (size == null) {
    size="1%";
  }
  this.size=size;
  this.expire=settings.getAsTime(INDICES_CACHE_QUERY_EXPIRE,null);
  this.concurrencyLevel=settings.getAsInt(INDICES_CACHE_QUERY_CONCURRENCY_LEVEL,16);
  if (concurrencyLevel <= 0) {
    throw new IllegalArgumentException("concurrency_level must be > 0 but was: " + concurrencyLevel);
  }
  buildCache();
  this.reaper=new Reaper();
  threadPool.schedule(cleanInterval,ThreadPool.Names.SAME,reaper);
}
