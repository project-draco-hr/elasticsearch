{
  assertAcked(prepareCreate("test").addMapping("type","str","type=string","lng","type=long","dbl","type=double"));
  ensureGreen();
  indexRandom(true,client().prepareIndex("test","type","1").setSource("str","1","lng",1l,"dbl",1.0d),client().prepareIndex("test","type","2").setSource("str","2","lng",2l,"dbl",2.0d),client().prepareIndex("test","type","3").setSource("str","3","lng",3l,"dbl",3.0d),client().prepareIndex("test","type","4").setSource("str","4","lng",4l,"dbl",4.0d));
  SearchResponse searchResponse=client().prepareSearch("test").setQuery(filteredQuery(matchAllQuery(),termsFilter("str","1","4").execution("fielddata"))).get();
  assertHitCount(searchResponse,2l);
  assertSearchHits(searchResponse,"1","4");
  searchResponse=client().prepareSearch("test").setQuery(filteredQuery(matchAllQuery(),termsFilter("lng",new long[]{2,3}).execution("fielddata"))).get();
  assertHitCount(searchResponse,2l);
  assertSearchHits(searchResponse,"2","3");
  searchResponse=client().prepareSearch("test").setQuery(filteredQuery(matchAllQuery(),termsFilter("dbl",new double[]{2,3}).execution("fielddata"))).get();
  assertHitCount(searchResponse,2l);
  assertSearchHits(searchResponse,"2","3");
  searchResponse=client().prepareSearch("test").setQuery(filteredQuery(matchAllQuery(),termsFilter("lng",new int[]{1,3}).execution("fielddata"))).get();
  assertHitCount(searchResponse,2l);
  assertSearchHits(searchResponse,"1","3");
  searchResponse=client().prepareSearch("test").setQuery(filteredQuery(matchAllQuery(),termsFilter("dbl",new float[]{2,4}).execution("fielddata"))).get();
  assertHitCount(searchResponse,2l);
  assertSearchHits(searchResponse,"2","4");
  searchResponse=client().prepareSearch("test").setQuery(filteredQuery(matchAllQuery(),termsFilter("str","2","5").execution("fielddata"))).get();
  assertNoFailures(searchResponse);
  assertHitCount(searchResponse,1l);
  assertFirstHit(searchResponse,hasId("2"));
  searchResponse=client().prepareSearch("test").setQuery(filteredQuery(matchAllQuery(),termsFilter("dbl",new double[]{2,5}).execution("fielddata"))).get();
  assertNoFailures(searchResponse);
  assertHitCount(searchResponse,1l);
  assertFirstHit(searchResponse,hasId("2"));
  searchResponse=client().prepareSearch("test").setQuery(filteredQuery(matchAllQuery(),termsFilter("lng",new long[]{2,5}).execution("fielddata"))).get();
  assertNoFailures(searchResponse);
  assertHitCount(searchResponse,1l);
  assertFirstHit(searchResponse,hasId("2"));
  searchResponse=client().prepareSearch("test").setQuery(filteredQuery(matchAllQuery(),termsFilter("str","5","6").execution("fielddata"))).get();
  assertHitCount(searchResponse,0l);
  searchResponse=client().prepareSearch("test").setQuery(filteredQuery(matchAllQuery(),termsFilter("dbl",new double[]{5,6}).execution("fielddata"))).get();
  assertHitCount(searchResponse,0l);
  searchResponse=client().prepareSearch("test").setQuery(filteredQuery(matchAllQuery(),termsFilter("lng",new long[]{5,6}).execution("fielddata"))).get();
  assertHitCount(searchResponse,0l);
}
