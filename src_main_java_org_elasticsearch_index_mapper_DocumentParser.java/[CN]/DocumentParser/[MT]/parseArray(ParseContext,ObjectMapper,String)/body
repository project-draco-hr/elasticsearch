{
  String arrayFieldName=lastFieldName;
  Mapper mapper=parentMapper.getMapper(lastFieldName);
  if (mapper != null) {
    if (mapper instanceof ArrayValueMapperParser) {
      final Mapper subUpdate=parseObjectOrField(context,mapper);
      if (subUpdate != null) {
        return parentMapper.mappingUpdate(subUpdate);
      }
 else {
        return null;
      }
    }
 else {
      return parseNonDynamicArray(context,parentMapper,lastFieldName,arrayFieldName);
    }
  }
 else {
    ObjectMapper.Dynamic dynamic=parentMapper.dynamic();
    if (dynamic == null) {
      dynamic=dynamicOrDefault(context.root().dynamic());
    }
    if (dynamic == ObjectMapper.Dynamic.STRICT) {
      throw new StrictDynamicMappingException(parentMapper.fullPath(),arrayFieldName);
    }
 else     if (dynamic == ObjectMapper.Dynamic.TRUE) {
      Mapper.Builder builder=context.root().findTemplateBuilder(context,arrayFieldName,"object");
      if (builder == null) {
        return parseNonDynamicArray(context,parentMapper,lastFieldName,arrayFieldName);
      }
      Mapper.BuilderContext builderContext=new Mapper.BuilderContext(context.indexSettings(),context.path());
      mapper=builder.build(builderContext);
      if (mapper != null && mapper instanceof ArrayValueMapperParser) {
        context.path().add(arrayFieldName);
        mapper=parseAndMergeUpdate(mapper,context);
        return parentMapper.mappingUpdate(mapper);
      }
 else {
        return parseNonDynamicArray(context,parentMapper,lastFieldName,arrayFieldName);
      }
    }
 else {
      return parseNonDynamicArray(context,parentMapper,lastFieldName,arrayFieldName);
    }
  }
}
