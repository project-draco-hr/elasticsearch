{
  receiveSnapshotRecoveryThread=Thread.currentThread();
  try {
    if (closed) {
      throw new IndexShardClosedException(shardId);
    }
    indexShard.performRecoveryOperations(snapshot.operations);
    channel.sendResponse(VoidStreamable.INSTANCE);
  }
  finally {
    receiveSnapshotRecoveryThread=null;
  }
}
