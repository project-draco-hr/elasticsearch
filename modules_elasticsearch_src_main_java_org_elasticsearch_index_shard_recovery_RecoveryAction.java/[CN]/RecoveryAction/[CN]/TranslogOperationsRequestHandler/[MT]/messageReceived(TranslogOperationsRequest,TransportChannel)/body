{
  receiveSnapshotRecoveryThread=Thread.currentThread();
  try {
    if (closed) {
      throw new IndexShardClosedException(shardId);
    }
    for (    Translog.Operation operation : snapshot.operations) {
      indexShard.performRecoveryOperation(operation);
    }
    channel.sendResponse(VoidStreamable.INSTANCE);
  }
  finally {
    receiveSnapshotRecoveryThread=null;
  }
}
