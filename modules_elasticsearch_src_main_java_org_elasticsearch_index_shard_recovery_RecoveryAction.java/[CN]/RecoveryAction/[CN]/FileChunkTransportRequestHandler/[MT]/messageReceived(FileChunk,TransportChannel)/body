{
  if (closed) {
    throw new IndexShardClosedException(shardId);
  }
  IndexOutput indexOutput;
  if (request.position == 0) {
    indexOutput=openIndexOutputs.remove(request.name);
    if (indexOutput != null) {
      try {
        indexOutput.close();
      }
 catch (      IOException e) {
      }
    }
    indexOutput=store.directory().createOutput(request.name);
    openIndexOutputs.put(request.name,indexOutput);
  }
 else {
    indexOutput=openIndexOutputs.get(request.name);
  }
synchronized (indexOutput) {
    try {
      indexOutput.writeBytes(request.content,request.contentLength);
      if (indexOutput.getFilePointer() == request.length) {
        indexOutput.close();
        openIndexOutputs.remove(request.name);
      }
    }
 catch (    IOException e) {
      openIndexOutputs.remove(request.name);
      try {
        indexOutput.close();
      }
 catch (      IOException e1) {
      }
    }
  }
  channel.sendResponse(VoidStreamable.INSTANCE);
}
