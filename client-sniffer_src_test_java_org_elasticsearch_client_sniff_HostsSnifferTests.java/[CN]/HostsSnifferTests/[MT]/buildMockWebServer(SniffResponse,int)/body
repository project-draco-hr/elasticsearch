{
  MockWebServer server=new MockWebServer();
  final Dispatcher dispatcher=new Dispatcher(){
    @Override public MockResponse dispatch(    RecordedRequest request) throws InterruptedException {
      if (request.getMethod().equals(HttpGet.METHOD_NAME)) {
        String decodedUrl;
        try {
          decodedUrl=URLDecoder.decode(request.getPath(),StandardCharsets.UTF_8.name());
        }
 catch (        UnsupportedEncodingException e) {
          throw new RuntimeException(e);
        }
        String sniffUrl="/_nodes/http?timeout=" + sniffTimeout + "ms";
        if (sniffUrl.equals(decodedUrl)) {
          return new MockResponse().setBody(sniffResponse.nodesInfoBody).setResponseCode(sniffResponse.nodesInfoResponseCode);
        }
      }
      return new MockResponse().setResponseCode(404);
    }
  }
;
  server.setDispatcher(dispatcher);
  return server;
}
