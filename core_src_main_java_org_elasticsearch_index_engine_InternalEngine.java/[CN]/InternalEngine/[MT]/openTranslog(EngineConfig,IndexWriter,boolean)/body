{
  final Translog.TranslogGeneration generation=loadTranslogIdFromCommit(writer,createNew);
  final TranslogConfig translogConfig=engineConfig.getTranslogConfig();
  translogConfig.setTranslogGeneration(generation);
  final Translog translog=new Translog(translogConfig);
  if (generation == null || generation.translogUUID == null) {
    assert createNew;
    if (generation == null) {
      logger.debug("no translog ID present in the current generation - creating one");
    }
 else     if (generation.translogUUID == null) {
      logger.debug("upgraded translog to pre 2.0 format, associating translog with index - writing translog UUID");
    }
    boolean success=false;
    try {
      commitIndexWriter(writer,translog);
      success=true;
    }
  finally {
      if (success == false) {
        IOUtils.closeWhileHandlingException(translog);
      }
    }
  }
  return translog;
}
