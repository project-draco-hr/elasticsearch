{
  try {
    Query query=delete.query();
    if (delete.aliasFilter() != null) {
      query=new BooleanQuery.Builder().add(query,Occur.MUST).add(delete.aliasFilter(),Occur.FILTER).build();
    }
    if (delete.nested()) {
      query=new IncludeNestedDocsQuery(query,delete.parentFilter());
    }
    indexWriter.deleteDocuments(query);
    translog.add(new Translog.DeleteByQuery(delete));
  }
 catch (  Throwable t) {
    maybeFailEngine("delete_by_query",t);
    throw new DeleteByQueryFailedEngineException(shardId,delete,t);
  }
  refresh("delete_by_query");
}
