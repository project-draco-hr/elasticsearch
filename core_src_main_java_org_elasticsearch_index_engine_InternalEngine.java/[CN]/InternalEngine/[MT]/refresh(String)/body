{
  try (ReleasableLock lock=readLock.acquire()){
    ensureOpen();
    refreshing=true;
    searcherManager.maybeRefreshBlocking();
  }
 catch (  AlreadyClosedException e) {
    ensureOpen();
    maybeFailEngine("refresh",e);
  }
catch (  EngineClosedException e) {
    throw e;
  }
catch (  Throwable t) {
    failEngine("refresh failed",t);
    throw new RefreshFailedEngineException(shardId,t);
  }
 finally {
    refreshing=false;
  }
  maybePruneDeletedTombstones();
  versionMapRefreshPending.set(false);
  mergeScheduler.refreshConfig();
}
