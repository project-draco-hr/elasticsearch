{
  ThreadPool threadPool=new ThreadPool("test");
  IndicesWarmer warmer=new IndicesWarmer(settings,threadPool);
  IndicesQueryCache indicesQueryCache=new IndicesQueryCache(settings);
  CircuitBreakerService circuitBreakerService=new NoneCircuitBreakerService();
  PageCacheRecycler recycler=new PageCacheRecycler(settings,threadPool);
  BigArrays bigArrays=new BigArrays(recycler,circuitBreakerService);
  IndicesFieldDataCache indicesFieldDataCache=new IndicesFieldDataCache(settings,new IndicesFieldDataCacheListener(circuitBreakerService),threadPool);
  Set<ScriptEngineService> scriptEngines=Collections.emptySet();
  scriptEngines.addAll(Arrays.asList(scriptEngineServices));
  ScriptEngineRegistry scriptEngineRegistry=new ScriptEngineRegistry(Collections.emptyList());
  ScriptContextRegistry scriptContextRegistry=new ScriptContextRegistry(Collections.emptyList());
  ScriptSettings scriptSettings=new ScriptSettings(scriptEngineRegistry,scriptContextRegistry);
  ScriptService scriptService=new ScriptService(settings,environment,scriptEngines,new ResourceWatcherService(settings,threadPool),scriptEngineRegistry,scriptContextRegistry,scriptSettings);
  IndicesQueriesRegistry indicesQueriesRegistry=new IndicesQueriesRegistry(settings,emptyMap());
  return new NodeServicesProvider(threadPool,indicesQueryCache,warmer,bigArrays,client,scriptService,indicesQueriesRegistry,indicesFieldDataCache,circuitBreakerService);
}
