{
  logger.info("-->  creating azure repository with container name [{}]",container);
  assertBusy(new Runnable(){
    @Override public void run(){
      try {
        PutRepositoryResponse putRepositoryResponse=client().admin().cluster().preparePutRepository("test-repo").setType("azure").setSettings(Settings.settingsBuilder().put(Repository.CONTAINER_SETTING.getKey(),container).put(Repository.BASE_PATH_SETTING.getKey(),getRepositoryPath()).put(Repository.CHUNK_SIZE_SETTING.getKey(),randomIntBetween(1000,10000),ByteSizeUnit.BYTES)).get();
        client().admin().cluster().prepareDeleteRepository("test-repo").get();
        try {
          logger.info("--> remove container [{}]",container);
          cleanRepositoryFiles(container);
        }
 catch (        StorageException|URISyntaxException e) {
        }
        assertTrue(putRepositoryResponse.isAcknowledged() == correct);
      }
 catch (      RepositoryVerificationException e) {
        if (correct) {
          logger.debug(" -> container is being removed. Let's wait a bit...");
          fail();
        }
      }
    }
  }
,5,TimeUnit.MINUTES);
}
