{
  if (profiler != null) {
    ProfileBreakdown profile=profiler.getQueryBreakdown(query);
    profile.startTime(ProfileBreakdown.TimingType.CREATE_WEIGHT);
    final Weight weight;
    try {
      weight=super.createWeight(query,needsScores);
    }
  finally {
      profile.stopAndRecordTime();
      profiler.pollLastQuery();
    }
    return new ProfileWeight(query,weight,profile);
  }
 else {
    return super.createWeight(query,needsScores);
  }
}
