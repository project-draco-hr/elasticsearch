{
  DocSet boundingBoxDocSet=null;
  if (boundingBoxFilter != null) {
    DocIdSet docIdSet=boundingBoxFilter.getDocIdSet(context,acceptedDocs);
    if (docIdSet == null) {
      return null;
    }
    boundingBoxDocSet=DocSets.convert(context.reader(),docIdSet);
  }
  final GeoPointFieldData fieldData=(GeoPointFieldData)fieldDataCache.cache(GeoPointFieldDataType.TYPE,context.reader(),fieldName);
  GeoDistanceDocSet distDocSet=new GeoDistanceDocSet(context.reader().maxDoc(),fieldData,fixedSourceDistance,distanceBoundingCheck,distance);
  if (boundingBoxDocSet == null) {
    return distDocSet;
  }
 else {
    return new AndDocSet(ImmutableList.of(boundingBoxDocSet,distDocSet));
  }
}
