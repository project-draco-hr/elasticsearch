{
  if (routing == null && mappingMd.routing().hasPath()) {
    XContentParser parser=null;
    try {
      parser=XContentFactory.xContent(source,sourceOffset,sourceLength).createParser(source,sourceOffset,sourceLength);
      routing=mappingMd.parseRouting(parser);
    }
 catch (    Exception e) {
      throw new ElasticSearchParseException("failed to parse doc to extract routing",e);
    }
 finally {
      if (parser != null) {
        parser.close();
      }
    }
  }
  if (mappingMd.routing().required() && routing == null) {
    throw new RoutingMissingException(index,type,id);
  }
}
