{
  if (region != null && endpoint == null) {
    endpoint=getEndpoint(region);
    logger.debug("using s3 region [{}], with endpoint [{}]",region,endpoint);
  }
 else   if (endpoint == null) {
    endpoint=getDefaultEndpoint();
  }
  if (account == null || key == null) {
    account=settings.get(CLOUD_S3.KEY,settings.get(CLOUD_AWS.KEY));
    key=settings.get(CLOUD_S3.SECRET,settings.get(CLOUD_AWS.SECRET));
  }
  return getClient(endpoint,protocol,account,key,maxRetries,pathStyleAccess);
}
