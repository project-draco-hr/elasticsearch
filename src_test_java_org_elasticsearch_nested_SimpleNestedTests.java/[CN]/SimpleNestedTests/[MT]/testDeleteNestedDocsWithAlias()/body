{
  assertAcked(prepareCreate("test").setSettings(settingsBuilder().put(indexSettings()).put("index.referesh_interval",-1).build()).addMapping("type1",jsonBuilder().startObject().startObject("type1").startObject("properties").startObject("nested1").field("type","nested").endObject().endObject().endObject().endObject()));
  client().admin().indices().prepareAliases().addAlias("test","alias1",FilterBuilders.termFilter("field1","value1")).execute().actionGet();
  ensureGreen();
  client().prepareIndex("test","type1","1").setSource(jsonBuilder().startObject().field("field1","value1").startArray("nested1").startObject().field("n_field1","n_value1_1").field("n_field2","n_value2_1").endObject().startObject().field("n_field1","n_value1_2").field("n_field2","n_value2_2").endObject().endArray().endObject()).execute().actionGet();
  client().prepareIndex("test","type1","2").setSource(jsonBuilder().startObject().field("field1","value2").startArray("nested1").startObject().field("n_field1","n_value1_1").field("n_field2","n_value2_1").endObject().startObject().field("n_field1","n_value1_2").field("n_field2","n_value2_2").endObject().endArray().endObject()).execute().actionGet();
  flush();
  refresh();
  assertDocumentCount("test",6);
  client().prepareDeleteByQuery("alias1").setQuery(QueryBuilders.matchAllQuery()).execute().actionGet();
  flush();
  refresh();
  assertDocumentCount("test",3);
  assertThat(client().prepareGet("test","type1","1").execute().actionGet().isExists(),equalTo(false));
}
