{
  boolean roundCeil=Defaults.ROUND_CEIL;
  if (context.indexSettings() != null) {
    Settings settings=context.indexSettings();
    roundCeil=settings.getAsBoolean("index.mapping.date.round_ceil",settings.getAsBoolean("index.mapping.date.parse_upper_inclusive",Defaults.ROUND_CEIL));
  }
  fieldType.setOmitNorms(fieldType.omitNorms() && boost == 1.0f);
  if (!locale.equals(dateTimeFormatter.locale())) {
    dateTimeFormatter=new FormatDateTimeFormatter(dateTimeFormatter.format(),dateTimeFormatter.parser(),dateTimeFormatter.printer(),locale);
  }
  DateFieldMapper fieldMapper=new DateFieldMapper(buildNames(context),dateTimeFormatter,precisionStep,boost,fieldType,docValues,nullValue,timeUnit,roundCeil,ignoreMalformed(context),postingsProvider,docValuesProvider,similarity,normsLoading,fieldDataSettings,context.indexSettings());
  fieldMapper.includeInAll(includeInAll);
  return fieldMapper;
}
