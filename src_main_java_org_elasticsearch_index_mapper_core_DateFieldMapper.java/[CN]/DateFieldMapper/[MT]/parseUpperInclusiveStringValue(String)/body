{
  if (!parseUpperInclusive) {
    return parseStringValue(value);
  }
  try {
    MutableDateTime dateTime=new MutableDateTime(3000,12,31,23,59,59,999,DateTimeZone.UTC);
    int location=dateTimeFormatter.parser().parseInto(dateTime,value,0);
    if (location == value.length()) {
      return dateTime.getMillis();
    }
    if (location <= 0 || dateTime.getYear() > 5000) {
      try {
        long time=Long.parseLong(value);
        return timeUnit.toMillis(time);
      }
 catch (      NumberFormatException e1) {
        throw new MapperParsingException("failed to parse date field [" + value + "], tried both date format ["+ dateTimeFormatter.format()+ "], and timestamp number");
      }
    }
    return dateTime.getMillis();
  }
 catch (  RuntimeException e) {
    try {
      long time=Long.parseLong(value);
      return timeUnit.toMillis(time);
    }
 catch (    NumberFormatException e1) {
      throw new MapperParsingException("failed to parse date field [" + value + "], tried both date format ["+ dateTimeFormatter.format()+ "], and timestamp number",e);
    }
  }
}
