{
  String mapping=copyToStringFromClasspath("/org/elasticsearch/index/mapper/all/mapping.json");
  DocumentMapper docMapper=createIndex("test").mapperService().documentMapperParser().parse(mapping);
  byte[] json=copyToBytesFromClasspath("/org/elasticsearch/index/mapper/all/test1.json");
  Document doc=docMapper.parse("test","person","1",new BytesArray(json)).rootDoc();
  AllField field=(AllField)doc.getField("_all");
  assertThat(field.tokenStream(docMapper.mappers().indexAnalyzer(),null),Matchers.instanceOf(AllTokenStream.class));
  AllEntries allEntries=field.getAllEntries();
  assertThat(allEntries.fields().size(),equalTo(3));
  assertThat(allEntries.fields().contains("address.last.location"),equalTo(true));
  assertThat(allEntries.fields().contains("name.last"),equalTo(true));
  assertThat(allEntries.fields().contains("simple1"),equalTo(true));
  AllFieldMapper mapper=docMapper.allFieldMapper();
  assertThat(field.fieldType().omitNorms(),equalTo(true));
  assertThat(mapper.fieldType().queryStringTermQuery(new Term("_all","foobar")),Matchers.instanceOf(AllTermQuery.class));
}
