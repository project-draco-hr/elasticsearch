{
  DocumentMapperParser parser=createIndex("test").mapperService().documentMapperParser();
  String mapping=copyToStringFromClasspath("/org/elasticsearch/index/mapper/all/store-mapping.json");
  DocumentMapper docMapper=parser.parse(mapping);
  String builtMapping=docMapper.mappingSource().string();
  DocumentMapper builtDocMapper=parser.parse(builtMapping);
  byte[] json=copyToBytesFromClasspath("/org/elasticsearch/index/mapper/all/test1.json");
  Document doc=builtDocMapper.parse("person","1",new BytesArray(json)).rootDoc();
  AllField field=(AllField)doc.getField("_all");
  AllEntries allEntries=field.getAllEntries();
  assertThat(allEntries.fields().size(),equalTo(2));
  assertThat(allEntries.fields().contains("name.last"),equalTo(true));
  assertThat(allEntries.fields().contains("simple1"),equalTo(true));
  String text=field.stringValue();
  assertThat(text,equalTo(allEntries.buildText()));
  assertThat(field.fieldType().omitNorms(),equalTo(false));
}
