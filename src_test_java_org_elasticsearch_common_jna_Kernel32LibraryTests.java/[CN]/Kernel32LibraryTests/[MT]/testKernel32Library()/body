{
  ConsoleCtrlHandler handler=new ConsoleCtrlHandler(){
    @Override public boolean handle(    int code){
      return false;
    }
  }
;
  assertNotNull(Kernel32Library.getInstance());
  assertThat(Kernel32Library.getInstance().getCallbacks().size(),equalTo(0));
  if (Constants.WINDOWS) {
    assertTrue(Kernel32Library.getInstance().addConsoleCtrlHandler(handler));
    assertThat(Kernel32Library.getInstance().getCallbacks().size(),equalTo(1));
  }
 else {
    try {
      Kernel32Library.getInstance().addConsoleCtrlHandler(handler);
      fail("should have thrown an unsupported operation exception");
    }
 catch (    UnsupportedOperationException e) {
      assertThat(e.getMessage(),e.getMessage().contains("console ctrl handler cannot be set"),equalTo(true));
    }
  }
}
