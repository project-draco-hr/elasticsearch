{
  ANTLRInputStream stream=new ANTLRInputStream(source);
  PainlessLexer lexer=new EnhancedPainlessLexer(stream,"testing");
  PainlessParser parser=new PainlessParser(new CommonTokenStream(lexer));
  ParserErrorStrategy strategy=new ParserErrorStrategy("testing");
  lexer.removeErrorListeners();
  parser.removeErrorListeners();
  parser.addErrorListener(new DiagnosticErrorListener(true));
  parser.addErrorListener(new BaseErrorListener(){
    @Override public void syntaxError(    final Recognizer<?,?> recognizer,    final Object offendingSymbol,    final int line,    final int charPositionInLine,    final String msg,    final RecognitionException e){
      throw new TestException("line: " + line + ", offset: "+ charPositionInLine+ ", symbol:"+ offendingSymbol+ " "+ msg);
    }
  }
);
  parser.getInterpreter().setPredictionMode(PredictionMode.LL_EXACT_AMBIG_DETECTION);
  parser.setErrorHandler(strategy);
  return parser.source();
}
