{
  assert(((ReentrantReadWriteLock.WriteLock)rwl.writeLock()).isHeldByCurrentThread());
  if (bufferCount > 0) {
    Channels.writeToChannel(buffer,0,bufferCount,channelReference.channel());
    lastWrittenPosition+=bufferCount;
    bufferCount=0;
  }
}
