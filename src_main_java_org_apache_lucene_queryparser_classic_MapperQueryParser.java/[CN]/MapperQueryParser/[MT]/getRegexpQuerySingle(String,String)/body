{
  currentMapper=null;
  Analyzer oldAnalyzer=getAnalyzer();
  try {
    MapperService.SmartNameFieldMappers fieldMappers=parseContext.smartFieldMappers(field);
    if (fieldMappers != null) {
      if (!forcedAnalyzer) {
        setAnalyzer(fieldMappers.searchAnalyzer());
      }
      currentMapper=fieldMappers.fieldMappers().mapper();
      if (currentMapper != null) {
        Query query=null;
        if (currentMapper.useTermQueryWithQueryString()) {
          query=currentMapper.regexpQuery(termStr,RegExp.ALL,maxDeterminizedStates,multiTermRewriteMethod,parseContext);
        }
        if (query == null) {
          query=super.getRegexpQuery(field,termStr);
        }
        return query;
      }
    }
    return super.getRegexpQuery(field,termStr);
  }
 catch (  RuntimeException e) {
    if (settings.lenient()) {
      return null;
    }
    throw e;
  }
 finally {
    setAnalyzer(oldAnalyzer);
  }
}
