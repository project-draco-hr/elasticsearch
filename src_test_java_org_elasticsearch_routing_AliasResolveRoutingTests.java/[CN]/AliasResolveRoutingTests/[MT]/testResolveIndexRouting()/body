{
  createIndex("test1");
  createIndex("test2");
  client().admin().cluster().prepareHealth().setWaitForEvents(Priority.LANGUID).setWaitForGreenStatus().execute().actionGet();
  client().admin().indices().prepareAliases().addAliasAction(newAddAliasAction("test1","alias")).execute().actionGet();
  client().admin().indices().prepareAliases().addAliasAction(newAddAliasAction("test1","alias10").routing("0")).execute().actionGet();
  client().admin().indices().prepareAliases().addAliasAction(newAddAliasAction("test1","alias110").searchRouting("1,0")).execute().actionGet();
  client().admin().indices().prepareAliases().addAliasAction(newAddAliasAction("test1","alias12").routing("2")).execute().actionGet();
  client().admin().indices().prepareAliases().addAliasAction(newAddAliasAction("test2","alias20").routing("0")).execute().actionGet();
  client().admin().indices().prepareAliases().addAliasAction(newAddAliasAction("test2","alias21").routing("1")).execute().actionGet();
  client().admin().indices().prepareAliases().addAliasAction(newAddAliasAction("test1","alias0").routing("0")).execute().actionGet();
  client().admin().indices().prepareAliases().addAliasAction(newAddAliasAction("test2","alias0").routing("0")).execute().actionGet();
  assertThat(clusterService().state().metaData().resolveIndexRouting(null,"test1"),nullValue());
  assertThat(clusterService().state().metaData().resolveIndexRouting(null,"alias"),nullValue());
  assertThat(clusterService().state().metaData().resolveIndexRouting(null,"test1"),nullValue());
  assertThat(clusterService().state().metaData().resolveIndexRouting(null,"alias10"),equalTo("0"));
  assertThat(clusterService().state().metaData().resolveIndexRouting(null,"alias20"),equalTo("0"));
  assertThat(clusterService().state().metaData().resolveIndexRouting(null,"alias21"),equalTo("1"));
  assertThat(clusterService().state().metaData().resolveIndexRouting("3","test1"),equalTo("3"));
  assertThat(clusterService().state().metaData().resolveIndexRouting("0","alias10"),equalTo("0"));
  try {
    clusterService().state().metaData().resolveIndexRouting("1","alias10");
    fail("should fail");
  }
 catch (  IllegalArgumentException e) {
  }
  try {
    clusterService().state().metaData().resolveIndexRouting(null,"alias0");
    fail("should fail");
  }
 catch (  IllegalArgumentException ex) {
  }
}
