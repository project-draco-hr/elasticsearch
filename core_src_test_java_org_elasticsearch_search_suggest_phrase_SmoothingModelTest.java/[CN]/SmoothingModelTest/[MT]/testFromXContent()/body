{
  QueryParseContext context=new QueryParseContext(indicesQueriesRegistry);
  context.parseFieldMatcher(new ParseFieldMatcher(Settings.EMPTY));
  SM testModel=createTestModel();
  XContentBuilder contentBuilder=XContentFactory.contentBuilder(randomFrom(XContentType.values()));
  if (randomBoolean()) {
    contentBuilder.prettyPrint();
  }
  contentBuilder.startObject();
  testModel.innerToXContent(contentBuilder,ToXContent.EMPTY_PARAMS);
  contentBuilder.endObject();
  XContentParser parser=XContentHelper.createParser(contentBuilder.bytes());
  context.reset(parser);
  SmoothingModel<?> prototype=(SmoothingModel<?>)namedWriteableRegistry.getPrototype(SmoothingModel.class,testModel.getWriteableName());
  SmoothingModel<?> parsedModel=prototype.fromXContent(context);
  assertNotSame(testModel,parsedModel);
  assertEquals(testModel,parsedModel);
  assertEquals(testModel.hashCode(),parsedModel.hashCode());
}
