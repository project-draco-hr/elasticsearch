{
  assertAcked(prepareCreate("test").addAlias(new Alias("alias")).setSettings(ImmutableSettings.builder().put(indexSettings()).put(IndexMetaData.SETTING_NUMBER_OF_SHARDS,between(2,DEFAULT_MAX_NUM_SHARDS))));
  ensureYellow();
  final String id=routingKeyForShard("test","test",0);
  final String routingOtherShard=routingKeyForShard("test","test",1);
  client().prepareIndex("test","test",id).setRefresh(true).setRouting(routingOtherShard).setSource(jsonBuilder().startObject().field("foo","bar").endObject()).execute().actionGet();
  MultiGetResponse mgetResponse=client().prepareMultiGet().add(new MultiGetRequest.Item(indexOrAlias(),"test",id).routing(routingOtherShard)).add(new MultiGetRequest.Item(indexOrAlias(),"test",id)).execute().actionGet();
  assertThat(mgetResponse.getResponses().length,is(2));
  assertThat(mgetResponse.getResponses()[0].isFailed(),is(false));
  assertThat(mgetResponse.getResponses()[0].getResponse().isExists(),is(true));
  assertThat(mgetResponse.getResponses()[0].getResponse().getIndex(),is("test"));
  assertThat(mgetResponse.getResponses()[1].isFailed(),is(false));
  assertThat(mgetResponse.getResponses()[1].getResponse().isExists(),is(false));
  assertThat(mgetResponse.getResponses()[1].getResponse().getIndex(),is("test"));
}
