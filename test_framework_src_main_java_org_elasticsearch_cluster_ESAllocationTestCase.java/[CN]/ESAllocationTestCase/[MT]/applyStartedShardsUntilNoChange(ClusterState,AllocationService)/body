{
  RoutingAllocation.Result routingResult;
  do {
    logger.debug("ClusterState: {}",clusterState.getRoutingNodes().prettyPrint());
    routingResult=service.applyStartedShards(clusterState,clusterState.getRoutingNodes().shardsWithState(INITIALIZING));
    clusterState=ClusterState.builder(clusterState).routingResult(routingResult).build();
  }
 while (routingResult.changed());
  return clusterState;
}
