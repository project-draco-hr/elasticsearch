{
  final AtomicInteger writeCounter=new AtomicInteger(0);
  Terminal terminal=new TerminalMock(){
    @Override public void doPrint(    String msg,    Object... args){
      int count=writeCounter.incrementAndGet();
switch (count) {
case 1:
        assertThat(msg,equalTo("\n"));
      break;
case 2:
    assertThat(msg,equalTo("cmd1 help\n"));
  break;
case 3:
assertThat(msg,equalTo("\n"));
break;
default :
fail("written more than expected");
}
}
}
;
final AtomicReference<Boolean> executed=new AtomicReference<>(false);
final NamedCommand cmd=new NamedCommand("cmd1",terminal){
@Override public CliTool.ExitStatus execute(Settings settings,Environment env) throws Exception {
executed.set(true);
throw new IOException("io error");
}
}
;
SingleCmdTool tool=new SingleCmdTool("tool",terminal,cmd);
int status=tool.execute(args("-h"));
assertExecuted(status,CliTool.ExitStatus.OK,writeCounter,3);
}
