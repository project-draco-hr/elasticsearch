{
  InternalSearchResponse internalResponse=searchPhaseController.merge(sortedShardList,queryResults,fetchResults);
  String scrollId=null;
  if (request.scroll() != null) {
    scrollId=TransportSearchHelper.buildScrollId(this.scrollId.type(),fetchResults.values());
  }
  transportSearchCache.releaseQueryResults(queryResults);
  transportSearchCache.releaseFetchResults(fetchResults);
  listener.onResponse(new SearchResponse(internalResponse,scrollId,this.scrollId.values().length,successfulOps.get()));
}
