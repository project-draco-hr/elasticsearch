{
  int compressedLength=Snappy.rawCompress(data,offset,len,compressedBuffer,0);
  if (compressedLength >= (len - (len / 8))) {
    out.writeByte((byte)0);
    out.writeVInt(len);
    out.writeBytes(data,offset,len);
  }
 else {
    out.writeByte((byte)1);
    out.writeVInt(compressedLength);
    out.writeBytes(compressedBuffer,0,compressedLength);
  }
}
