{
  EnumSet<ShardStatusChangeType> changes=EnumSet.noneOf(ShardStatusChangeType.class);
  changes.addAll(purgeDeletedAndClosedShards());
  final List<IndexShard> activeToInactiveIndexingShards=Lists.newArrayList();
  final int activeShards=updateShardStatuses(changes,activeToInactiveIndexingShards);
  for (  IndexShard indexShard : activeToInactiveIndexingShards) {
    try {
      ((IndexShard)indexShard).engine().updateIndexingBufferSize(Engine.INACTIVE_SHARD_INDEXING_BUFFER);
      ((IndexShard)indexShard).translog().updateBuffer(Translog.INACTIVE_SHARD_TRANSLOG_BUFFER);
    }
 catch (    EngineClosedException e) {
    }
catch (    FlushNotAllowedEngineException e) {
    }
  }
  if (!changes.isEmpty()) {
    calcAndSetShardBuffers(activeShards,"[" + changes + "]");
  }
}
