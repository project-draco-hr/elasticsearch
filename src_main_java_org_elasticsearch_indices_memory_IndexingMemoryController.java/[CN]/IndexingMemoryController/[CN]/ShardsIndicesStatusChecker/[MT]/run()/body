{
  EnumSet<ShardStatusChangeType> changes=EnumSet.noneOf(ShardStatusChangeType.class);
  changes.addAll(purgeDeletedAndClosedShards());
  final List<IndexShard> activeToInactiveIndexingShards=Lists.newArrayList();
  final int activeShards=updateShardStatuses(changes,activeToInactiveIndexingShards);
  for (  IndexShard indexShard : activeToInactiveIndexingShards) {
    try {
      indexShard.markAsInactive();
    }
 catch (    EngineClosedException e) {
    }
catch (    FlushNotAllowedEngineException e) {
    }
  }
  if (!changes.isEmpty()) {
    calcAndSetShardBuffers(activeShards,"[" + changes + "]");
  }
}
