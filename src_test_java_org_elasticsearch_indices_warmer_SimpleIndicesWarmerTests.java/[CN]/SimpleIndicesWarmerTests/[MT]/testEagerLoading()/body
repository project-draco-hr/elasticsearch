{
  for (  LoadingMethod method : LoadingMethod.values()) {
    logger.debug("METHOD " + method);
    String indexName=method.name().toLowerCase(Locale.ROOT);
    assertAcked(method.createIndex(indexName,"t","foo"));
    client().prepareIndex(indexName,"t","1").setSource("foo","bar").execute().actionGet();
    client().prepareIndex(indexName,"t","2").setSource("foo","bar baz foo").setRefresh(true).execute().actionGet();
    ensureGreen(indexName);
    long memoryUsage0=getSegmentsMemoryUsage(indexName);
    client().prepareSearch(indexName).setQuery(QueryBuilders.matchQuery("foo","bar")).execute().actionGet();
    long memoryUsage1=getSegmentsMemoryUsage(indexName);
    if (method.isLazy()) {
      assertThat(memoryUsage1,greaterThan(memoryUsage0));
    }
 else {
      assertThat(memoryUsage1,equalTo(memoryUsage0));
    }
  }
}
