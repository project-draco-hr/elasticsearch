{
  for (  LoadingMethod method : LoadingMethod.values()) {
    System.out.println("METHOD " + method);
    method.createIndex("idx","t","foo");
    client().prepareIndex("idx","t","1").setSource("foo","bar").setRefresh(true).execute().actionGet();
    long memoryUsage0=getSegmentsMemoryUsage("idx");
    client().prepareSearch("idx").setQuery(QueryBuilders.matchQuery("foo","bar")).execute().actionGet();
    long memoryUsage1=getSegmentsMemoryUsage("idx");
    if (method.isLazy()) {
      assertThat(memoryUsage1,greaterThan(memoryUsage0));
    }
 else {
      assertThat(memoryUsage1,equalTo(memoryUsage0));
    }
    wipeIndices("idx");
  }
}
