import fnmatch
import subprocess
import tempfile
import re
import os
import shutil
VERSION_FILE = 'core/src/main/java/org/elasticsearch/Version.java'
POM_FILE = 'pom.xml'
if (__name__ == '__main__'):
    release_version = find_release_version()
    print ('*** Preparing release version: [%s]' % release_version)
    ensure_checkout_is_clean()
    pom_files = find_pom_files_with_snapshots()
    remove_maven_snapshot(pom_files, release_version)
    remove_version_snapshot(VERSION_FILE, release_version)
    pending_files = pom_files
    pending_files.append(VERSION_FILE)
    add_pending_files(*pending_files)
    commit_release(release_version)
    pending_files = update_reference_docs(release_version)
    if pending_files:
        add_pending_files(*pending_files)
        commit_feature_flags(release_version)
    else:
        print ('WARNING: no documentation references updates for release %s' % release_version)
    print '*** Done removing snapshot version. Run git push manually.'
