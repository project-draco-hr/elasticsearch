{
  builder.field(InternalTerms.DOC_COUNT_ERROR_UPPER_BOUND_FIELD_NAME,docCountError);
  builder.startArray(CommonFields.BUCKETS);
  for (  InternalTerms.Bucket bucket : buckets) {
    builder.startObject();
    builder.field(CommonFields.KEY,((Bucket)bucket).term);
    if (formatter != null && formatter != ValueFormatter.RAW) {
      builder.field(CommonFields.KEY_AS_STRING,formatter.format(((Bucket)bucket).term));
    }
    builder.field(CommonFields.DOC_COUNT,bucket.getDocCount());
    if (showTermDocCountError) {
      builder.field(InternalTerms.DOC_COUNT_ERROR_UPPER_BOUND_FIELD_NAME,bucket.getDocCountError());
    }
    ((InternalAggregations)bucket.getAggregations()).toXContentInternal(builder,params);
    builder.endObject();
  }
  builder.endArray();
  return builder;
}
