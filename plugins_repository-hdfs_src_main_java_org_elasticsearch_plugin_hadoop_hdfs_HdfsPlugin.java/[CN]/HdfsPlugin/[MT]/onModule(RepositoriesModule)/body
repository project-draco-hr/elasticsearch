{
  String baseLib=Utils.detectLibFolder();
  List<URL> cp=getHadoopClassLoaderPath(baseLib);
  ClassLoader hadoopCL=URLClassLoader.newInstance(cp.toArray(new URL[cp.size()]),getClass().getClassLoader());
  Class<? extends Repository> repository=null;
  try {
    repository=(Class<? extends Repository>)hadoopCL.loadClass("org.elasticsearch.repositories.hdfs.HdfsRepository");
  }
 catch (  ClassNotFoundException cnfe) {
    throw new IllegalStateException("Cannot load plugin class; is the plugin class setup correctly?",cnfe);
  }
  repositoriesModule.registerRepository("hdfs",repository,BlobStoreIndexShardRepository.class);
  Loggers.getLogger(HdfsPlugin.class).info("Loaded Hadoop [{}] libraries from {}",getHadoopVersion(hadoopCL),baseLib);
}
