{
  final DirectResponseChannel channel=new DirectResponseChannel(logger,localNode,action,requestId,adapter,threadPool);
  try {
    final RequestHandlerRegistry reg=adapter.getRequestHandler(action);
    if (reg == null) {
      throw new ActionNotFoundTransportException("Action [" + action + "] not found");
    }
    final String executor=reg.getExecutor();
    if (ThreadPool.Names.SAME.equals(executor)) {
      reg.getHandler().messageReceived(request,channel);
    }
 else {
      threadPool.executor(executor).execute(new AbstractRunnable(){
        @Override protected void doRun() throws Exception {
          reg.getHandler().messageReceived(request,channel);
        }
        @Override public boolean isForceExecution(){
          return reg.isForceExecution();
        }
        @Override public void onFailure(        Throwable e){
          try {
            channel.sendResponse(e);
          }
 catch (          Throwable e1) {
            logger.warn("failed to notify channel of error message for action [" + action + "]",e1);
            logger.warn("actual exception",e);
          }
        }
      }
);
    }
  }
 catch (  Throwable e) {
    try {
      channel.sendResponse(e);
    }
 catch (    Throwable e1) {
      logger.warn("failed to notify channel of error message for action [" + action + "]",e1);
      logger.warn("actual exception",e1);
    }
  }
}
