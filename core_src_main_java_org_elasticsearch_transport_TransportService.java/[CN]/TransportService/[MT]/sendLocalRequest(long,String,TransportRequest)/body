{
  final DirectResponseChannel channel=new DirectResponseChannel(logger,localNode,action,requestId,adapter,threadPool);
  try {
    final RequestHandlerRegistry reg=adapter.getRequestHandler(action);
    if (reg == null) {
      throw new ActionNotFoundTransportException("Action [" + action + "] not found");
    }
    final String executor=reg.getExecutor();
    if (ThreadPool.Names.SAME.equals(executor)) {
      reg.processMessageReceived(request,channel);
    }
 else {
      threadPool.executor(executor).execute(new AbstractRunnable(){
        @Override protected void doRun() throws Exception {
          reg.processMessageReceived(request,channel);
        }
        @Override public boolean isForceExecution(){
          return reg.isForceExecution();
        }
        @Override public void onFailure(        Exception e){
          try {
            channel.sendResponse(e);
          }
 catch (          Exception inner) {
            inner.addSuppressed(e);
            logger.warn("failed to notify channel of error message for action [{}]",inner,action);
          }
        }
      }
);
    }
  }
 catch (  Exception e) {
    try {
      channel.sendResponse(e);
    }
 catch (    Exception inner) {
      inner.addSuppressed(e);
      logger.warn("failed to notify channel of error message for action [{}]",inner,action);
    }
  }
}
