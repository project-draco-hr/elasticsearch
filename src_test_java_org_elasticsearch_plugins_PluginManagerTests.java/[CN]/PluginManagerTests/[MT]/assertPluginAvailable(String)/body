{
  final HttpRequestBuilder httpRequestBuilder=getHttpRequestBuilder();
  assertThat(awaitBusy(new Predicate<Object>(){
    public boolean apply(    Object obj){
      try {
        HttpResponse response=httpRequestBuilder.method("GET").path("/").execute();
        if (response.getStatusCode() != RestStatus.OK.getStatus()) {
          logger.info("--> error caught [{}], headers [{}]",response.getStatusCode(),response.getHeaders());
          logger.info("--> cluster state [{}]",internalCluster().clusterService().state());
          return false;
        }
        return true;
      }
 catch (      IOException e) {
        throw new ElasticsearchException("HTTP problem",e);
      }
    }
  }
,5,TimeUnit.SECONDS),equalTo(true));
  HttpResponse response=getHttpRequestBuilder().method("GET").path("/_plugin/" + pluginName + "/").execute();
  assertThat(response,notNullValue());
  assertThat(response.getReasonPhrase(),response.getStatusCode(),equalTo(RestStatus.OK.getStatus()));
}
