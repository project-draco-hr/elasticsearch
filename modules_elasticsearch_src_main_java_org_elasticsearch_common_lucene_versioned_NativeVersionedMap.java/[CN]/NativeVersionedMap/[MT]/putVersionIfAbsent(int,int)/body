{
  Segment segment=segmentFor(hash(key));
  segment.rwl.writeLock().lock();
  try {
    if (!segment.map.containsKey(key)) {
      segment.map.put(key,version);
    }
  }
  finally {
    segment.rwl.writeLock().unlock();
  }
}
