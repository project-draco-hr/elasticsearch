{
  Segment segment=segmentFor(hash(key));
  segment.rwl.writeLock().lock();
  try {
    segment.map.put(key,version);
  }
  finally {
    segment.rwl.writeLock().unlock();
  }
}
