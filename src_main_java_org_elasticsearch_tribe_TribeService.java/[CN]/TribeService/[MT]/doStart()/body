{
  final CountDownLatch latch=new CountDownLatch(1);
  clusterService.submitStateUpdateTask("updating local node id",new ProcessedClusterStateUpdateTask(){
    @Override public ClusterState execute(    ClusterState currentState) throws Exception {
      return ClusterState.builder(currentState).nodes(DiscoveryNodes.builder(currentState.nodes()).put(clusterService.localNode()).localNodeId(clusterService.localNode().id())).build();
    }
    @Override public void onFailure(    String source,    Throwable t){
      logger.error("{}",t,source);
      latch.countDown();
    }
    @Override public void clusterStateProcessed(    String source,    ClusterState oldState,    ClusterState newState){
      latch.countDown();
    }
  }
);
  try {
    latch.await();
  }
 catch (  InterruptedException e) {
  }
  for (  InternalNode node : nodes) {
    node.start();
  }
}
