{
  AnalysisModule analysisModule=new AnalysisModule(new Environment(settings));
  new AnalysisStempelPlugin().onModule(analysisModule);
  SettingsModule settingsModule=new SettingsModule(settings);
  settingsModule.registerSetting(InternalSettingsPlugin.VERSION_CREATED);
  Injector parentInjector=new ModulesBuilder().add(settingsModule,new EnvironmentModule(new Environment(settings)),analysisModule).createInjector();
  return parentInjector.getInstance(AnalysisRegistry.class).build(IndexSettingsModule.newIndexSettings(index,settings));
}
