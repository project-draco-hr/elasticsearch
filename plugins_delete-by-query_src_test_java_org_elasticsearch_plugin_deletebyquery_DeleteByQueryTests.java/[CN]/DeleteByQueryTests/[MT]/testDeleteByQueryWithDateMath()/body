{
  index("test","type","1","d","2013-01-01");
  ensureGreen();
  refresh();
  assertHitCount(client().prepareSearch("test").setSize(0).get(),1);
  DeleteByQueryRequestBuilder delete=newDeleteByQuery().setIndices("test").setQuery(QueryBuilders.rangeQuery("d").to("now-1h"));
  assertDBQResponse(delete.get(),1L,1L,0l,0l);
  refresh();
  assertHitCount(client().prepareSearch("test").setSize(0).get(),0);
  assertSearchContextsClosed();
}
