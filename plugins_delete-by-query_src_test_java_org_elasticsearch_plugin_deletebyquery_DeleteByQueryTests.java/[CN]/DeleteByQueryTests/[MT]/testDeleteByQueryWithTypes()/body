{
  final long docs=randomIntBetween(1,50);
  for (int i=0; i < docs; i++) {
    index(randomFrom("test1","test2","test3"),"type1",String.valueOf(i),"foo","bar");
    index(randomFrom("test1","test2","test3"),"type2",String.valueOf(i),"foo","bar");
  }
  refresh();
  assertHitCount(client().prepareSearch().setSize(0).get(),docs * 2);
  assertHitCount(client().prepareSearch().setSize(0).setTypes("type1").get(),docs);
  assertHitCount(client().prepareSearch().setSize(0).setTypes("type2").get(),docs);
  DeleteByQueryRequestBuilder delete=newDeleteByQuery().setTypes("type1").setQuery(QueryBuilders.matchAllQuery());
  assertDBQResponse(delete.get(),docs,docs,0L,0L);
  refresh();
  assertHitCount(client().prepareSearch().setSize(0).get(),docs);
  assertHitCount(client().prepareSearch().setSize(0).setTypes("type1").get(),0);
  assertHitCount(client().prepareSearch().setSize(0).setTypes("type2").get(),docs);
  assertSearchContextsClosed();
}
