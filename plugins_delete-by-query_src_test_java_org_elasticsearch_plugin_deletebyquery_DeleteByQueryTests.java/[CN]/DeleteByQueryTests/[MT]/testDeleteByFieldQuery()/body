{
  assertAcked(prepareCreate("test").addAlias(new Alias("alias")));
  int numDocs=scaledRandomIntBetween(10,100);
  for (int i=0; i < numDocs; i++) {
    client().prepareIndex("test","test",Integer.toString(i)).setRouting(randomAsciiOfLengthBetween(1,5)).setSource("foo","bar").get();
  }
  refresh();
  int n=between(0,numDocs - 1);
  assertHitCount(client().prepareCount("test").setQuery(QueryBuilders.matchQuery("_id",Integer.toString(n))).get(),1);
  assertHitCount(client().prepareCount("test").setQuery(QueryBuilders.matchAllQuery()).get(),numDocs);
  DeleteByQueryRequestBuilder delete=newDeleteByQuery().setIndices("alias").setQuery(QueryBuilders.matchQuery("_id",Integer.toString(n)));
  assertDBQResponse(delete.get(),1L,1L,0l,0l);
  refresh();
  assertHitCount(client().prepareCount("test").setQuery(QueryBuilders.matchAllQuery()).get(),numDocs - 1);
  assertSearchContextsClosed();
}
