{
  client().prepareIndex("test","test").setSource(jsonBuilder().startObject().field("field1",1).endObject()).setRefresh(true).get();
  assertHitCount(client().prepareSearch().setSize(0).get(),1);
  DeleteByQueryRequestBuilder delete=newDeleteByQuery().setIndices("test","missing").setQuery(QueryBuilders.matchAllQuery());
  try {
    delete.get();
    fail("should have thrown an exception because of a missing index");
  }
 catch (  IndexNotFoundException e) {
  }
  delete.setIndicesOptions(IndicesOptions.lenientExpandOpen());
  assertDBQResponse(delete.get(),1L,1L,0l,0l);
  refresh();
  assertHitCount(client().prepareSearch("test").setSize(0).get(),0);
  assertSearchContextsClosed();
}
