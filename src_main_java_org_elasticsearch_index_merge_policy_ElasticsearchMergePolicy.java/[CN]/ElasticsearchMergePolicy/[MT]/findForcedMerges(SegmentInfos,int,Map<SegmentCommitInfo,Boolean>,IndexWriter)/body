{
  if (upgradeInProgress) {
    MergeSpecification spec=new IndexUpgraderMergeSpecification();
    for (    SegmentCommitInfo info : segmentInfos) {
      org.apache.lucene.util.Version old=info.info.getVersion();
      org.apache.lucene.util.Version cur=Version.CURRENT.luceneVersion;
      if (cur.major > old.major || cur.major == old.major && cur.minor > old.minor) {
        spec.add(new OneMerge(Lists.newArrayList(info)));
      }
      if (spec.merges.size() == MAX_CONCURRENT_UPGRADE_MERGES) {
        return spec;
      }
    }
    upgradeInProgress=false;
    if (spec.merges.isEmpty() == false) {
      return spec;
    }
  }
  return upgradedMergeSpecification(delegate.findForcedMerges(segmentInfos,maxSegmentCount,segmentsToMerge,writer));
}
