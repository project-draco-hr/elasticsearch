{
  if (upgradeInProgress) {
    MergeSpecification spec=new IndexUpgraderMergeSpecification();
    for (    SegmentCommitInfo info : segmentInfos) {
      if (Version.CURRENT.luceneVersion.minor > info.info.getVersion().minor) {
        spec.add(new OneMerge(Lists.newArrayList(info)));
      }
      if (spec.merges.size() == MAX_CONCURRENT_UPGRADE_MERGES) {
        return spec;
      }
    }
    upgradeInProgress=false;
    if (spec.merges.isEmpty() == false) {
      return spec;
    }
  }
  return upgradedMergeSpecification(delegate.findForcedMerges(segmentInfos,maxSegmentCount,segmentsToMerge,writer));
}
