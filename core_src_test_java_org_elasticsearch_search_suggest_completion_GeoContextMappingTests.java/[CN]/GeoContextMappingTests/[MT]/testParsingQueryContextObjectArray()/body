{
  XContentBuilder builder=jsonBuilder().startArray().startObject().startObject("context").field("lat",23.654242).field("lon",90.047153).endObject().field("boost",10).array("neighbours",1,2,3).endObject().startObject().startObject("context").field("lat",22.337374).field("lon",92.112583).endObject().field("boost",2).array("neighbours",5).endObject().endArray();
  XContentParser parser=XContentFactory.xContent(XContentType.JSON).createParser(builder.bytes());
  GeoContextMapping mapping=ContextBuilder.geo("geo").build();
  List<ContextMapping.QueryContext> queryContexts=mapping.parseQueryContext(parser);
  assertThat(queryContexts.size(),equalTo(2 + 8 + 8+ 8+ 8));
  Collection<String> locations=new ArrayList<>();
  locations.add("wh0n94");
  GeoHashUtils.addNeighbors("w",1,locations);
  GeoHashUtils.addNeighbors("wh",2,locations);
  GeoHashUtils.addNeighbors("wh0",3,locations);
  for (int i=1; i < (1 + 8 + 8+ 8); i++) {
    assertThat(queryContexts.get(i).context,isIn(locations));
    assertThat(queryContexts.get(i).boost,equalTo(10));
    assertThat(queryContexts.get(i).isPrefix,equalTo(true));
  }
  locations=new ArrayList<>();
  locations.add("w5cx04");
  GeoHashUtils.addNeighbors("w5cx0",5,locations);
  for (int i=(1 + 8 + 8+ 8); i < queryContexts.size(); i++) {
    assertThat(queryContexts.get(i).context,isIn(locations));
    assertThat(queryContexts.get(i).boost,equalTo(2));
  }
}
