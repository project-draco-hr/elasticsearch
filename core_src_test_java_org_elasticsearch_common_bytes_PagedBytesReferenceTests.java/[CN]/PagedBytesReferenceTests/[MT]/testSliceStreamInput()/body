{
  int length=randomIntBetween(10,scaledRandomIntBetween(PAGE_SIZE * 2,PAGE_SIZE * 20));
  BytesReference pbr=getRandomizedPagedBytesReference(length);
  int sliceOffset=randomIntBetween(1,length / 2);
  int sliceLength=length - sliceOffset;
  BytesReference slice=pbr.slice(sliceOffset,sliceLength);
  StreamInput sliceInput=slice.streamInput();
  assertEquals(sliceInput.available(),sliceLength);
  assertEquals(slice.get(0),sliceInput.readByte());
  assertEquals(slice.get(1),sliceInput.readByte());
  assertEquals(slice.get(2),sliceInput.readByte());
  assertEquals(sliceInput.available(),sliceLength - 3);
  sliceInput.reset();
  assertEquals(sliceInput.available(),sliceLength);
  byte[] sliceBytes=new byte[sliceLength];
  sliceInput.readFully(sliceBytes);
  assertEquals(sliceInput.available(),0);
  byte[] pbrSliceBytes=Arrays.copyOfRange(pbr.toBytes(),sliceOffset,length);
  assertArrayEquals(pbrSliceBytes,sliceBytes);
  byte[] sliceToBytes=slice.toBytes();
  assertEquals(sliceBytes.length,sliceToBytes.length);
  assertArrayEquals(sliceBytes,sliceToBytes);
  sliceInput.reset();
  assertEquals(sliceInput.available(),sliceLength);
  byte[] buffer=new byte[sliceLength + scaledRandomIntBetween(1,100)];
  int offset=scaledRandomIntBetween(0,Math.max(1,buffer.length - sliceLength - 1));
  int read=sliceInput.read(buffer,offset,sliceLength / 2);
  assertEquals(sliceInput.available(),sliceLength - read);
  sliceInput.read(buffer,offset + read,sliceLength);
  assertArrayEquals(sliceBytes,Arrays.copyOfRange(buffer,offset,offset + sliceLength));
  assertEquals(sliceInput.available(),0);
}
