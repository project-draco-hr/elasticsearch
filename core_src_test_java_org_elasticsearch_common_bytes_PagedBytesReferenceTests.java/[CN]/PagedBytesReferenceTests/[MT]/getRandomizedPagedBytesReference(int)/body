{
  ReleasableBytesStreamOutput out=new ReleasableBytesStreamOutput(length,bigarrays);
  try {
    for (int i=0; i < length; i++) {
      out.writeByte((byte)getRandom().nextInt(1 << 8));
    }
  }
 catch (  IOException e) {
    fail("should not happen " + e.getMessage());
  }
  assertThat(out.size(),Matchers.equalTo(length));
  BytesReference ref=out.bytes();
  assertThat(ref.length(),Matchers.equalTo(length));
  assertThat(ref,Matchers.instanceOf(PagedBytesReference.class));
  return ref;
}
