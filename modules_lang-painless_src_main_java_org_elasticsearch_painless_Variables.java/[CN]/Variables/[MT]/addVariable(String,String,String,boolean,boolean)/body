{
  if (!reserved && this.reserved.isReserved(name)) {
    throw new IllegalArgumentException("Error " + location + ": Variable name ["+ name+ "] is reserved.");
  }
  if (getVariable(null,name) != null) {
    throw new IllegalArgumentException("Error " + location + ": Variable name ["+ name+ "] already defined.");
  }
  final Type type;
  try {
    type=definition.getType(typestr);
  }
 catch (  final IllegalArgumentException exception) {
    throw new IllegalArgumentException("Error " + location + ": Not a type ["+ typestr+ "].");
  }
  boolean legal=!name.contains("<");
  try {
    definition.getType(name);
    legal=false;
  }
 catch (  final IllegalArgumentException exception) {
  }
  if (!legal) {
    throw new IllegalArgumentException("Error " + location + ": Variable name ["+ name+ "] cannot be a type.");
  }
  final Variable previous=variables.peekFirst();
  int slot=0;
  if (previous != null) {
    slot=previous.slot + previous.type.type.getSize();
  }
  final Variable variable=new Variable(location,name,type,slot,readonly);
  variables.push(variable);
  final int update=scopes.pop() + 1;
  scopes.push(update);
  return variable;
}
