{
  boolean fullId=req.paramAsBoolean("full_id",false);
  DiscoveryNodes nodes=state.getState().nodes();
  Table table=getTableWithHeader(req);
  for (  DiscoveryNode node : nodes) {
    NodeInfo info=nodesInfo.getNodesMap().get(node.id());
    ImmutableMap<String,String> attrs=node.getAttributes();
    for (    String att : attrs.keySet()) {
      table.startRow();
      table.addCell(node.name());
      table.addCell(fullId ? node.id() : Strings.substring(node.getId(),0,4));
      table.addCell(info == null ? null : info.getProcess().getId());
      table.addCell(node.getHostName());
      table.addCell(node.getHostAddress());
      if (node.address() instanceof InetSocketTransportAddress) {
        table.addCell(((InetSocketTransportAddress)node.address()).address().getPort());
      }
 else {
        table.addCell("-");
      }
      table.addCell(att);
      table.addCell(attrs.containsKey(att) ? attrs.get(att) : null);
      table.endRow();
    }
  }
  return table;
}
