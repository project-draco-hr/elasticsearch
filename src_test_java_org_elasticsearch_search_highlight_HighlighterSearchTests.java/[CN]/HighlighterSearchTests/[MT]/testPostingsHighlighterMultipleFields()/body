{
  client().admin().indices().prepareCreate("test").addMapping("type1",type1PostingsffsetsMapping()).get();
  ensureGreen();
  client().prepareIndex("test","type1").setSource("field1","this is a test1","field2","this is a test2","field3","this is a test3").setRefresh(true).get();
  logger.info("--> highlighting and searching on field1");
  SearchSourceBuilder source=searchSource().query(boolQuery().should(termQuery("field1","test1")).should(termQuery("field2","test2")).should(termQuery("field3","test3"))).highlight(highlight().preTags("<xxx>").postTags("</xxx>").requireFieldMatch(false).field("field1").field("field2").field(new HighlightBuilder.Field("field3").preTags("<x3>").postTags("</x3>")));
  SearchResponse searchResponse=client().search(searchRequest("test").source(source)).actionGet();
  assertHitCount(searchResponse,1l);
  assertThat(searchResponse.getHits().getAt(0).highlightFields().get("field1").fragments()[0].string(),equalTo("this is a <xxx>test1</xxx>"));
  assertThat(searchResponse.getHits().getAt(0).highlightFields().get("field2").fragments()[0].string(),equalTo("this is a <xxx>test2</xxx>"));
  assertThat(searchResponse.getHits().getAt(0).highlightFields().get("field3").fragments()[0].string(),equalTo("this is a <x3>test3</x3>"));
}
