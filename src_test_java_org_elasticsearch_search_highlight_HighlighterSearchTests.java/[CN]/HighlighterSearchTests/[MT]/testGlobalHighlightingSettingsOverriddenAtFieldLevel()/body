{
  client().admin().indices().prepareCreate("test").execute().actionGet();
  client().admin().cluster().prepareHealth("test").setWaitForGreenStatus().execute().actionGet();
  client().prepareIndex("test","type1").setSource("field1","this is a test","field2","this is another test").setRefresh(true).execute().actionGet();
  logger.info("--> highlighting and searching on field1 and field2 produces different tags");
  SearchSourceBuilder source=searchSource().query(termQuery("field1","test")).from(0).size(60).explain(true).highlight(highlight().order("score").preTags("<global>").postTags("</global>").field(new HighlightBuilder.Field("field1")).field(new HighlightBuilder.Field("field2").preTags("<field2>").postTags("</field2>")));
  SearchResponse searchResponse=client().search(searchRequest("test").source(source).searchType(QUERY_THEN_FETCH)).actionGet();
  assertNoFailures(searchResponse);
  assertThat(searchResponse.getHits().totalHits(),equalTo(1l));
  assertThat(searchResponse.getHits().getAt(0).highlightFields().get("field1").fragments()[0].string(),equalTo("this is a <global>test</global>"));
  assertThat(searchResponse.getHits().getAt(0).highlightFields().get("field2").fragments()[0].string(),equalTo("this is another <field2>test</field2>"));
}
