{
  assertAcked(client().admin().indices().prepareCreate("test").addMapping("type1",type1PostingsffsetsMapping()));
  ensureGreen();
  client().prepareIndex("test","type1").setSource("field1","this is a test","field2","The quick brown fox jumps over the lazy dog! Second sentence.").get();
  refresh();
  logger.info("--> highlighting and searching on field2");
  for (  String rewriteMethod : REWRITE_METHODS) {
    SearchSourceBuilder source=searchSource().query(regexpQuery("field2","qu[a-l]+k").rewrite(rewriteMethod)).highlight(highlight().field("field2"));
    SearchResponse searchResponse=client().search(searchRequest("test").source(source).searchType(randomBoolean() ? SearchType.DFS_QUERY_THEN_FETCH : SearchType.QUERY_THEN_FETCH)).get();
    assertHitCount(searchResponse,1l);
    assertThat(searchResponse.getHits().getAt(0).highlightFields().get("field2").fragments()[0].string(),equalTo("The <em>quick</em> brown fox jumps over the lazy dog!"));
  }
}
