{
  final long firstOperationPosition=translog.getFirstOperationPosition();
  TranslogStats stats=stats();
  assertThat(stats.estimatedNumberOfOperations(),equalTo(0l));
  long lastSize=stats.translogSizeInBytes().bytes();
  assertThat((int)firstOperationPosition,greaterThan(CodecUtil.headerLength(TranslogWriter.TRANSLOG_CODEC)));
  assertThat(lastSize,equalTo(firstOperationPosition));
  translog.add(new Translog.Create("test","1",new byte[]{1}));
  stats=stats();
  assertThat(stats.estimatedNumberOfOperations(),equalTo(1l));
  assertThat(stats.translogSizeInBytes().bytes(),greaterThan(lastSize));
  lastSize=stats.translogSizeInBytes().bytes();
  translog.add(new Translog.Index("test","2",new byte[]{2}));
  stats=stats();
  assertThat(stats.estimatedNumberOfOperations(),equalTo(2l));
  assertThat(stats.translogSizeInBytes().bytes(),greaterThan(lastSize));
  lastSize=stats.translogSizeInBytes().bytes();
  translog.add(new Translog.Delete(newUid("3")));
  stats=stats();
  assertThat(stats.estimatedNumberOfOperations(),equalTo(3l));
  assertThat(stats.translogSizeInBytes().bytes(),greaterThan(lastSize));
  lastSize=stats.translogSizeInBytes().bytes();
  translog.add(new Translog.Delete(newUid("4")));
  translog.prepareCommit();
  stats=stats();
  assertThat(stats.estimatedNumberOfOperations(),equalTo(4l));
  assertThat(stats.translogSizeInBytes().bytes(),greaterThan(lastSize));
  translog.commit();
  stats=stats();
  assertThat(stats.estimatedNumberOfOperations(),equalTo(0l));
  assertThat(stats.translogSizeInBytes().bytes(),equalTo(firstOperationPosition));
}
