{
  BytesStreamOutput out=new BytesStreamOutput();
  List<Translog.Operation> ops=newArrayList();
  int translogOperations=randomIntBetween(10,100);
  for (int op=0; op < translogOperations; op++) {
    Translog.Create test=new Translog.Create("test","" + op,Integer.toString(op).getBytes(Charset.forName("UTF-8")));
    Translog.writeOperation(out,test);
    ops.add(test);
  }
  Translog.Snapshot snapshot=Translog.snapshotFromStream(StreamInput.wrap(out.bytes()),ops.size());
  assertEquals(ops.size(),snapshot.estimatedTotalOperations());
  for (  Translog.Operation op : ops) {
    assertEquals(op,snapshot.next());
  }
  assertNull(snapshot.next());
}
