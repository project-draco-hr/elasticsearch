{
  client().admin().indices().prepareCreate("test").setSettings(ImmutableSettings.settingsBuilder().put("index.number_of_shards",1).put("index.number_of_replicas",0)).execute().actionGet();
  client().admin().cluster().prepareHealth().setWaitForEvents(Priority.LANGUID).setWaitForGreenStatus().execute().actionGet();
  PutMappingResponse putMappingResponse=client().admin().indices().preparePutMapping("test").setType("child").setSource("number","type=integer").execute().actionGet();
  assertThat(putMappingResponse.isAcknowledged(),equalTo(true));
  GetMappingsResponse getMappingsResponse=client().admin().indices().prepareGetMappings("test").execute().actionGet();
  Map<String,Object> mapping=getMappingsResponse.getMappings().get("test").get("child").getSourceAsMap();
  assertThat(mapping.size(),equalTo(1));
  assertThat(mapping.get("properties"),notNullValue());
  try {
    client().admin().indices().preparePutMapping("test").setType("child").setSource(jsonBuilder().startObject().startObject("child").startObject("_parent").field("type","parent").endObject().endObject().endObject()).execute().actionGet();
    fail();
  }
 catch (  MergeMappingException e) {
    assertThat(e.getMessage(),equalTo("Merge failed with failures {[The _parent field can't be added or updated]}"));
  }
}
