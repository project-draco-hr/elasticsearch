{
  client().admin().indices().prepareCreate("test").setSettings(ImmutableSettings.settingsBuilder().put("index.number_of_shards",1).put("index.number_of_replicas",0)).addMapping("parent").addMapping("child","_parent","type=parent").get();
  ensureGreen();
  SearchResponse response=client().prepareSearch("test").setQuery(QueryBuilders.hasChildQuery("child",matchQuery("text","value"))).get();
  assertThat(response.getFailedShards(),equalTo(0));
  assertThat(response.getHits().totalHits(),equalTo(0l));
  client().prepareIndex("test","child1").setSource(jsonBuilder().startObject().field("text","value").endObject()).setRefresh(true).get();
  response=client().prepareSearch("test").setQuery(QueryBuilders.hasChildQuery("child",matchQuery("text","value"))).get();
  assertThat(response.getFailedShards(),equalTo(0));
  assertThat(response.getHits().totalHits(),equalTo(0l));
  response=client().prepareSearch("test").setQuery(QueryBuilders.hasChildQuery("child",matchQuery("text","value")).scoreType("max")).get();
  assertThat(response.getFailedShards(),equalTo(0));
  assertThat(response.getHits().totalHits(),equalTo(0l));
  response=client().prepareSearch("test").setQuery(QueryBuilders.hasParentQuery("child",matchQuery("text","value"))).get();
  assertThat(response.getFailedShards(),equalTo(0));
  assertThat(response.getHits().totalHits(),equalTo(0l));
  response=client().prepareSearch("test").setQuery(QueryBuilders.hasParentQuery("child",matchQuery("text","value")).scoreType("score")).get();
  assertThat(response.getFailedShards(),equalTo(0));
  assertThat(response.getHits().totalHits(),equalTo(0l));
}
