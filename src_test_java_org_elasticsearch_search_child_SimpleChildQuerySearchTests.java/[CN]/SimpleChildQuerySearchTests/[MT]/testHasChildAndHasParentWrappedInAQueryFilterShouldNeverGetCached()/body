{
  assertAcked(prepareCreate("test").setSettings(ImmutableSettings.builder().put("index.cache.filter.type","weighted")).addMapping("parent").addMapping("child","_parent","type=parent"));
  ensureGreen();
  client().prepareIndex("test","parent","1").setSource("p_field",1).get();
  client().prepareIndex("test","child","2").setParent("1").setSource("c_field",1).get();
  refresh();
  for (int i=0; i < 10; i++) {
    SearchResponse searchResponse=client().prepareSearch("test").setExplain(true).setQuery(constantScoreQuery(boolFilter().must(queryFilter(hasChildQuery("child",matchQuery("c_field",1)))).cache(true))).get();
    assertSearchHit(searchResponse,1,hasId("1"));
    assertThat(searchResponse.getHits().getAt(0).explanation().getDescription(),startsWith("ConstantScore(BooleanFilter("));
    searchResponse=client().prepareSearch("test").setExplain(true).setQuery(constantScoreQuery(boolFilter().must(queryFilter(boolQuery().must(matchAllQuery()).must(hasChildQuery("child",matchQuery("c_field",1))))).cache(true))).get();
    assertSearchHit(searchResponse,1,hasId("1"));
    assertThat(searchResponse.getHits().getAt(0).explanation().getDescription(),startsWith("ConstantScore(BooleanFilter("));
  }
}
