{
  assertThat(query,notNullValue());
  if (query instanceof MatchAllDocsQuery) {
    assertThat(queryBuilder.zeroTermsQuery(),equalTo(ZeroTermsQuery.ALL));
    return;
  }
switch (queryBuilder.type()) {
case BOOLEAN:
    assertThat(query,either(instanceOf(BooleanQuery.class)).or(instanceOf(ExtendedCommonTermsQuery.class)).or(instanceOf(TermQuery.class)).or(instanceOf(FuzzyQuery.class)));
  break;
case PHRASE:
assertThat(query,either(instanceOf(BooleanQuery.class)).or(instanceOf(PhraseQuery.class)).or(instanceOf(TermQuery.class)).or(instanceOf(FuzzyQuery.class)));
break;
case PHRASE_PREFIX:
assertThat(query,either(instanceOf(BooleanQuery.class)).or(instanceOf(MultiPhrasePrefixQuery.class)).or(instanceOf(TermQuery.class)).or(instanceOf(FuzzyQuery.class)));
break;
}
MappedFieldType fieldType=context.fieldMapper(queryBuilder.fieldName());
if (query instanceof TermQuery && fieldType != null) {
String queryValue=queryBuilder.value().toString();
if (queryBuilder.analyzer() == null || queryBuilder.analyzer().equals("simple")) {
queryValue=queryValue.toLowerCase(Locale.ROOT);
}
Query expectedTermQuery=fieldType.termQuery(queryValue,context);
expectedTermQuery.setBoost(queryBuilder.boost());
assertEquals(expectedTermQuery,query);
}
if (query instanceof BooleanQuery) {
BooleanQuery bq=(BooleanQuery)query;
if (queryBuilder.analyzer() == null && queryBuilder.value().toString().length() > 0) {
assertEquals(bq.clauses().size(),queryBuilder.value().toString().split(" ").length);
}
}
if (query instanceof ExtendedCommonTermsQuery) {
assertTrue(queryBuilder.cutoffFrequency() != null);
ExtendedCommonTermsQuery ectq=(ExtendedCommonTermsQuery)query;
assertEquals((float)queryBuilder.cutoffFrequency(),ectq.getMaxTermFrequency(),Float.MIN_VALUE);
}
if (query instanceof FuzzyQuery) {
assertTrue(queryBuilder.fuzziness() != null);
FuzzyQuery fuzzyQuery=(FuzzyQuery)query;
fuzzyQuery.getTerm().equals(new Term(STRING_FIELD_NAME,BytesRefs.toBytesRef(queryBuilder.value())));
assertThat(queryBuilder.prefixLength(),equalTo(fuzzyQuery.getPrefixLength()));
assertThat(queryBuilder.fuzzyTranspositions(),equalTo(fuzzyQuery.getTranspositions()));
}
}
