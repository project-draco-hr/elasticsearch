{
  final Map<SearchContext,Throwable> copy=new HashMap<>(ACTIVE_SEARCH_CONTEXTS);
  if (copy.isEmpty() == false) {
    Map.Entry<SearchContext,Throwable> firstOpen=copy.entrySet().iterator().next();
    SearchContext context=firstOpen.getKey();
    StringBuilder message=new StringBuilder().append(context.shardTarget());
    if (context.searchType() != SearchType.DEFAULT) {
      message.append("searchType=[").append(context.searchType()).append("]");
    }
    if (context.scrollContext() != null) {
      message.append("scroll=[").append(context.scrollContext().scroll.keepAlive()).append("]");
    }
    message.append(" query=[").append(context.query()).append("]");
    RuntimeException cause=new RuntimeException(message.toString());
    cause.setStackTrace(firstOpen.getValue().getStackTrace());
    throw new AssertionError("There are still " + copy.size() + " in-flight contexts. The first one's creation site is listed as the cause of this exception.",cause);
  }
}
