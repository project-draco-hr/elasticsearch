{
  if (syncNeeded()) {
synchronized (this) {
      ensureOpen();
      final long offsetToSync;
      final int opsCounter;
      try {
        outputStream.flush();
        offsetToSync=totalOffset;
        opsCounter=operationCounter;
        checkpoint(offsetToSync,opsCounter,generation,channel,path);
      }
 catch (      Throwable ex) {
        closeWithTragicEvent(ex);
        throw ex;
      }
      lastSyncedOffset=offsetToSync;
    }
  }
}
