{
  final BytesRef ref=new BytesRef(translogUUID);
  final int headerLength=getHeaderLength(ref.length);
  final FileChannel channel=channelFactory.open(file);
  try {
    final OutputStreamDataOutput out=new OutputStreamDataOutput(java.nio.channels.Channels.newOutputStream(channel));
    CodecUtil.writeHeader(out,TRANSLOG_CODEC,VERSION);
    out.writeInt(ref.length);
    out.writeBytes(ref.bytes,ref.offset,ref.length);
    channel.force(true);
    writeCheckpoint(channelFactory,headerLength,0,file.getParent(),fileGeneration);
    final TranslogWriter writer=new TranslogWriter(channelFactory,shardId,fileGeneration,channel,file,bufferSize);
    return writer;
  }
 catch (  Exception exception) {
    IOUtils.closeWhileHandlingException(channel);
    throw exception;
  }
}
