{
  final long position;
  try (ReleasableLock lock=writeLock.acquire()){
    ensureOpen();
    position=writtenOffset;
    try {
      data.writeTo(channel);
    }
 catch (    Throwable e) {
      closeWithTragicEvent(e);
      throw e;
    }
    writtenOffset=writtenOffset + data.length();
    operationCounter++;
    ;
  }
   return new Translog.Location(generation,position,data.length());
}
