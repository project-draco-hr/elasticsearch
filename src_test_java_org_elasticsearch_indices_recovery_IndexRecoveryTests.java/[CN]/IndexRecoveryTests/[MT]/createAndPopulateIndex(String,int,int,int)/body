{
  logger.info("--> creating test index: {}",name);
  assertAcked(prepareCreate(name,nodeCount,settingsBuilder().put("number_of_shards",shardCount).put("number_of_replicas",replicaCount)));
  ensureGreen();
  logger.info("--> indexing sample data");
  final int numDocs=between(MIN_DOC_COUNT,MAX_DOC_COUNT);
  final IndexRequestBuilder[] docs=new IndexRequestBuilder[numDocs];
  for (int i=0; i < numDocs; i++) {
    docs[i]=client().prepareIndex(INDEX_NAME,INDEX_TYPE).setSource("foo-int-" + i,randomInt(),"foo-string-" + i,randomAsciiOfLength(32),"foo-float-" + i,randomFloat());
  }
  indexRandom(true,docs);
  flush();
  assertThat(client().prepareCount(INDEX_NAME).get().getCount(),equalTo((long)numDocs));
  return client().admin().indices().prepareStats(INDEX_NAME).execute().actionGet();
}
