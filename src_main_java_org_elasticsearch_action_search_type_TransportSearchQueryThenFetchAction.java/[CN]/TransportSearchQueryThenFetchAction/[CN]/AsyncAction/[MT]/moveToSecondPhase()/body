{
  boolean useScroll=!useSlowScroll && request.scroll() != null;
  sortedShardList=searchPhaseController.sortDocs(useScroll,firstResults);
  searchPhaseController.fillDocIdsToLoad(docIdsToLoad,sortedShardList);
  if (docIdsToLoad.asList().isEmpty()) {
    finishHim();
    return;
  }
  final ScoreDoc[] lastEmittedDocPerShard=searchPhaseController.getLastEmittedDocPerShard(request,sortedShardList,firstResults.length());
  final AtomicInteger counter=new AtomicInteger(docIdsToLoad.asList().size());
  for (  AtomicArray.Entry<IntArrayList> entry : docIdsToLoad.asList()) {
    QuerySearchResultProvider queryResult=firstResults.get(entry.index);
    DiscoveryNode node=nodes.get(queryResult.shardTarget().nodeId());
    ShardFetchSearchRequest fetchSearchRequest=createFetchRequest(queryResult.queryResult(),entry,lastEmittedDocPerShard);
    executeFetch(entry.index,queryResult.shardTarget(),counter,fetchSearchRequest,node);
  }
}
