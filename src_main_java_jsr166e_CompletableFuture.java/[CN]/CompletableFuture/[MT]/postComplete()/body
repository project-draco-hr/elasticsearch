{
  WaitNode q;
  Thread t;
  while ((q=waiters) != null) {
    if (UNSAFE.compareAndSwapObject(this,WAITERS,q,q.next) && (t=q.thread) != null) {
      q.thread=null;
      LockSupport.unpark(t);
    }
  }
  CompletionNode h;
  Completion c;
  while ((h=completions) != null) {
    if (UNSAFE.compareAndSwapObject(this,COMPLETIONS,h,h.next) && (c=h.completion) != null)     c.run();
  }
}
