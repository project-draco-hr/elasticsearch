{
  try {
    client.admin().indices().prepareDelete("test").execute().actionGet();
  }
 catch (  Exception e) {
  }
  client.admin().indices().prepareCreate("test").addMapping("type1",jsonBuilder().startObject().startObject("type1").startObject("properties").startObject("field1").field("analyzer","whitespace").field("type","string").endObject().endObject().endObject().endObject()).setSettings(ImmutableSettings.settingsBuilder().put("index.number_of_shards",2)).execute().actionGet();
  client.prepareIndex("test","type1","1").setSource("field1","the quick brown fox").execute().actionGet();
  client.prepareIndex("test","type1","2").setSource("field1","the quick lazy huge brown fox jumps over the tree").execute().actionGet();
  client.prepareIndex("test","type1","3").setSource("field1","quick huge brown","field2","the quick lazy huge brown fox jumps over the tree").execute().actionGet();
  client.admin().indices().prepareRefresh("test").execute().actionGet();
  SearchResponse searchResponse=client.prepareSearch().setQuery(QueryBuilders.matchQuery("field1","the quick brown").operator(MatchQueryBuilder.Operator.OR)).setRescorer(RescoreBuilder.queryRescorer(QueryBuilders.matchPhraseQuery("field1","the quick brown").slop(2).boost(4.0f)).setQueryWeight(0.5f).setRescoreQueryWeight(0.4f)).setRescoreWindow(5).setExplain(true).execute().actionGet();
  assertThat(searchResponse.hits().totalHits(),equalTo(3l));
  assertThat(searchResponse.getHits().getHits()[0].getId(),equalTo("1"));
  assertThat(searchResponse.getHits().getHits()[1].getId(),equalTo("2"));
  assertThat(searchResponse.getHits().getHits()[2].getId(),equalTo("3"));
  for (int i=0; i < 3; i++) {
    assertThat(searchResponse.getHits().getAt(i).explanation(),notNullValue());
    assertThat(searchResponse.getHits().getAt(i).explanation().isMatch(),equalTo(true));
    assertThat(searchResponse.getHits().getAt(i).explanation().getDetails().length,equalTo(2));
    assertThat(searchResponse.getHits().getAt(i).explanation().getDetails()[0].isMatch(),equalTo(true));
    assertThat(searchResponse.getHits().getAt(i).explanation().getDetails()[0].getDetails()[1].getValue(),equalTo(0.5f));
    assertThat(searchResponse.getHits().getAt(i).explanation().getDetails()[1].getDetails()[1].getValue(),equalTo(0.4f));
    if (i == 2) {
      assertThat(searchResponse.getHits().getAt(i).explanation().getDetails()[1].isMatch(),equalTo(false));
      assertThat(searchResponse.getHits().getAt(i).explanation().getDetails()[1].getDetails()[0].getValue(),equalTo(0.0f));
    }
  }
}
