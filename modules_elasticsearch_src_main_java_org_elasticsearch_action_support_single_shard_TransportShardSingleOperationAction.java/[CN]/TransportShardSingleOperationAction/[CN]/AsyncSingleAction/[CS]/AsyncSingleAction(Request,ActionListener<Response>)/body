{
  this.request=request;
  this.listener=listener;
  ClusterState clusterState=clusterService.state();
  nodes=clusterState.nodes();
  String alias=request.index();
  request.index(clusterState.metaData().concreteIndex(request.index()));
  String effectiveRouting=clusterState.metaData().resolveIndexRouting(request.routing(),alias);
  checkBlock(request,clusterState);
  this.shardIt=clusterService.operationRouting().getShards(clusterState,request.index(),request.type(),request.id(),effectiveRouting,request.preference());
}
