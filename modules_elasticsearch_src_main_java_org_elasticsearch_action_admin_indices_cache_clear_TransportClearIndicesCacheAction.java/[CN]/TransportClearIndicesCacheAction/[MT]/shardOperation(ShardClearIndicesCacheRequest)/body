{
  IndexService service=indicesService.indexService(request.index());
  if (service != null) {
    service.cache().queryParserCache().clear();
    boolean clearedAtLeastOne=false;
    if (request.filterCache()) {
      clearedAtLeastOne=true;
      service.cache().filter().clear();
    }
    if (request.fieldDataCache()) {
      clearedAtLeastOne=true;
      service.cache().fieldData().clear();
    }
    if (request.idCache()) {
      clearedAtLeastOne=true;
      service.cache().idCache().clear();
    }
    if (request.bloomCache()) {
      clearedAtLeastOne=true;
      service.cache().bloomCache().clear();
    }
    if (!clearedAtLeastOne) {
      service.cache().clear();
    }
    service.cache().invalidateCache();
  }
  return new ShardClearIndicesCacheResponse(request.index(),request.shardId());
}
