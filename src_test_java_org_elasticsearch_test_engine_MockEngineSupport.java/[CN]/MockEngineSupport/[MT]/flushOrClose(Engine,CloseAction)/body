{
  try {
    if (closing.compareAndSet(false,true)) {
      if (mockContext.flushOnClose > mockContext.random.nextDouble()) {
        return CloseAction.FLUSH_AND_CLOSE;
      }
 else {
        return CloseAction.CLOSE;
      }
    }
 else {
      return originalAction;
    }
  }
  finally {
    if (logger.isTraceEnabled()) {
      for (      Map.Entry<AssertingSearcher,RuntimeException> entry : INFLIGHT_ENGINE_SEARCHERS.entrySet()) {
        logger.trace("Unreleased Searchers instance for shard [{}]",entry.getValue(),entry.getKey().shardId());
      }
    }
  }
}
