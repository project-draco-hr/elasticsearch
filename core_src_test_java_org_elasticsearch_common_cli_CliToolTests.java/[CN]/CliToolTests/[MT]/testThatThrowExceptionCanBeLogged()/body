{
  CaptureOutputTerminal terminal=new CaptureOutputTerminal();
  NamedCommand cmd=new NamedCommand("cmd",terminal){
    @Override public CliTool.ExitStatus execute(    Settings settings,    Environment env) throws Exception {
      throw new ElasticsearchException("error message");
    }
  }
;
  SingleCmdTool tool=new SingleCmdTool("tool",terminal,cmd);
  assertStatus(tool.execute(),CliTool.ExitStatus.CODE_ERROR);
  assertThat(terminal.getTerminalOutput(),hasSize(1));
  assertThat(terminal.getTerminalOutput(),hasItem(containsString("error message")));
  try {
    System.setProperty(Terminal.DEBUG_SYSTEM_PROPERTY,"true");
    terminal=new CaptureOutputTerminal();
    assertStatus(new SingleCmdTool("tool",terminal,cmd).execute(),CliTool.ExitStatus.CODE_ERROR);
    assertThat(terminal.getTerminalOutput(),hasSize(2));
    assertThat(terminal.getTerminalOutput(),hasItem(containsString("error message")));
    assertThat(terminal.getTerminalOutput(),hasItem(containsString(getClass().getName())));
  }
  finally {
    System.clearProperty(Terminal.DEBUG_SYSTEM_PROPERTY);
  }
}
