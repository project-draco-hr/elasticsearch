{
  ensureOpen();
  while (this.refCount.get() == 1) {
    if (this.refCount.compareAndSet(1,0)) {
      IOUtils.closeWhileHandlingException(nodes.values());
      nodes.clear();
    }
  }
  if (clientNode != null) {
    IOUtils.closeWhileHandlingException(clientNode);
  }
}
