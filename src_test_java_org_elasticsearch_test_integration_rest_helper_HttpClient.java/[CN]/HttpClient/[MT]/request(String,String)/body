{
  URL url;
  try {
    url=new URL(baseUrl,path);
  }
 catch (  MalformedURLException e) {
    throw new ElasticSearchException("Cannot parse " + path,e);
  }
  HttpURLConnection urlConnection;
  try {
    urlConnection=(HttpURLConnection)url.openConnection();
    urlConnection.setRequestMethod(method);
    urlConnection.connect();
  }
 catch (  IOException e) {
    throw new ElasticSearchException("",e);
  }
  int errorCode=-1;
  try {
    errorCode=urlConnection.getResponseCode();
    InputStream inputStream=urlConnection.getInputStream();
    String body=null;
    try {
      body=Streams.copyToString(new InputStreamReader(inputStream));
    }
 catch (    IOException e1) {
      throw new ElasticSearchException("problem reading error stream",e1);
    }
    return new HttpClientResponse(body,errorCode,null);
  }
 catch (  IOException e) {
    InputStream errStream=urlConnection.getErrorStream();
    String body=null;
    try {
      body=Streams.copyToString(new InputStreamReader(errStream));
    }
 catch (    IOException e1) {
      throw new ElasticSearchException("problem reading error stream",e1);
    }
    return new HttpClientResponse(body,errorCode,e);
  }
 finally {
    urlConnection.disconnect();
  }
}
