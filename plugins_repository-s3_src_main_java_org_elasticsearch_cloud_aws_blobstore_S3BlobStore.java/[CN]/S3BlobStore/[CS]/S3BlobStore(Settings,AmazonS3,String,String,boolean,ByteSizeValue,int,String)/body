{
  super(settings);
  this.client=client;
  this.bucket=bucket;
  this.region=region;
  this.serverSideEncryption=serverSideEncryption;
  this.bufferSize=(bufferSize != null) ? bufferSize : MIN_BUFFER_SIZE;
  if (this.bufferSize.getBytes() < MIN_BUFFER_SIZE.getBytes()) {
    throw new BlobStoreException("Detected a buffer_size for the S3 storage lower than [" + MIN_BUFFER_SIZE + "]");
  }
  this.cannedACL=initCannedACL(cannedACL);
  this.numberOfRetries=maxRetries;
  int retry=0;
  while (retry <= maxRetries) {
    try {
      if (!client.doesBucketExist(bucket)) {
        CreateBucketRequest request=null;
        if (region != null) {
          request=new CreateBucketRequest(bucket,region);
        }
 else {
          request=new CreateBucketRequest(bucket);
        }
        request.setCannedAcl(this.cannedACL);
        client.createBucket(request);
      }
      break;
    }
 catch (    AmazonClientException e) {
      if (shouldRetry(e) && retry < maxRetries) {
        retry++;
      }
 else {
        logger.debug("S3 client create bucket failed");
        throw e;
      }
    }
  }
}
