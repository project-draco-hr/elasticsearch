{
  InternalCountHistogramFacet.CountEntry[] entries=new InternalCountHistogramFacet.CountEntry[counts.v().size()];
  final boolean[] states=counts.v().allocated;
  final long[] keys=counts.v().keys;
  final long[] values=counts.v().values;
  int entryIndex=0;
  for (int i=0; i < states.length; i++) {
    if (states[i]) {
      entries[entryIndex++]=new InternalCountHistogramFacet.CountEntry(keys[i],values[i]);
    }
  }
  counts.close();
  return new InternalCountHistogramFacet(facetName,comparatorType,entries);
}
