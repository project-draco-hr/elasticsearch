{
  super(name,factories,aggregationContext,parent,metaData);
  if (objectMapper == null) {
    parentFilter=SearchContext.current().bitsetFilterCache().getBitDocIdSetFilter(NonNestedDocsFilter.INSTANCE);
  }
 else {
    parentFilter=SearchContext.current().bitsetFilterCache().getBitDocIdSetFilter(objectMapper.nestedTypeFilter());
  }
  bucketOrdToLastCollectedParentDoc=new LongIntOpenHashMap(32);
  aggregationContext.ensureScoreDocsInOrder();
}
