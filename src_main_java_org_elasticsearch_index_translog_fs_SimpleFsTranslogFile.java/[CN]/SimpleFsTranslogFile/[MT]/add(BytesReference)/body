{
  rwl.writeLock().lock();
  try {
    long position=lastPosition;
    data.writeTo(channelReference.channel());
    lastPosition=lastPosition + data.length();
    lastWrittenPosition=lastWrittenPosition + data.length();
    operationCounter=operationCounter + 1;
    return new Translog.Location(id,position,data.length());
  }
  finally {
    rwl.writeLock().unlock();
  }
}
