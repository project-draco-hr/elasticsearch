{
  if (channelReference.tryIncRef()) {
    boolean success=false;
    try {
      rwl.writeLock().lock();
      try {
        FsChannelSnapshot snapshot=new FsChannelSnapshot(this.id,channelReference,lastWrittenPosition,operationCounter);
        snapshot.seekTo(this.headerSize);
        success=true;
        return snapshot;
      }
  finally {
        rwl.writeLock().unlock();
      }
    }
 catch (    FileNotFoundException e) {
      throw new TranslogException(shardId,"failed to create snapshot",e);
    }
 finally {
      if (!success) {
        channelReference.decRef();
      }
    }
  }
  return null;
}
