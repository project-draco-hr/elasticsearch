{
  ClusterState clusterState=initialClusterState;
  while (clusterState.getRoutingNodes().hasUnassignedShards()) {
    RoutingAllocation.Result result=strategy.applyStartedShards(clusterState,clusterState.getRoutingNodes().shardsWithState(ShardRoutingState.INITIALIZING));
    clusterState=ClusterState.builder(clusterState).routingResult(result).build();
    result=strategy.reroute(clusterState,"reroute");
    clusterState=ClusterState.builder(clusterState).routingResult(result).build();
  }
  return clusterState;
}
