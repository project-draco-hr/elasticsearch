{
  try {
    queryShardContext.reset();
    QueryParseContext queryParseContext=queryShardContext.newParseContext(parser);
    QueryBuilder<?> queryBuilder=QueryBuilder.rewriteQuery(queryParseContext.parseInnerQueryBuilder(),queryShardContext);
    queryBuilder.toFilter(queryShardContext);
  }
  finally {
    queryShardContext.reset();
    parser.close();
  }
}
