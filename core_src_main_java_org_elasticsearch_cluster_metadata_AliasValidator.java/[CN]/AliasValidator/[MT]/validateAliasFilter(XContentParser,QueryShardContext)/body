{
  try {
    queryShardContext.reset(parser);
    QueryParseContext queryParseContext=queryShardContext.parseContext();
    QueryBuilder<?> queryBuilder=QueryBuilder.rewriteQuery(queryParseContext.parseInnerQueryBuilder(),queryShardContext);
    queryBuilder.toFilter(queryShardContext);
  }
  finally {
    queryShardContext.reset(null);
    parser.close();
  }
}
