{
  IndexService indexService=createIndex("test");
  injector=indexService.injector();
  MapperService mapperService=indexService.mapperService();
  String mapping=copyToStringFromClasspath("/org/elasticsearch/index/query/mapping.json");
  mapperService.merge("person",new CompressedXContent(mapping),true);
  ParsedDocument doc=mapperService.documentMapper("person").parse("person","1",new BytesArray(copyToBytesFromClasspath("/org/elasticsearch/index/query/data.json")));
  assertNotNull(doc.dynamicMappingsUpdate());
  client().admin().indices().preparePutMapping("test").setType("person").setSource(doc.dynamicMappingsUpdate().toString()).get();
  queryParser=injector.getInstance(IndexQueryParserService.class);
}
