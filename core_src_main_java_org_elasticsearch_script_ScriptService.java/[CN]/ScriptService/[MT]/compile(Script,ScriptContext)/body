{
  if (script == null) {
    throw new IllegalArgumentException("The parameter script (Script) must not be null.");
  }
  if (scriptContext == null) {
    throw new IllegalArgumentException("The parameter scriptContext (ScriptContext) must not be null.");
  }
  String lang=script.getLang();
  if (lang == null) {
    lang=defaultLang;
  }
  ScriptEngineService scriptEngineService=getScriptEngineServiceForLang(lang);
  if (canExecuteScript(lang,scriptEngineService,script.getType(),scriptContext) == false) {
    throw new ScriptException("scripts of type [" + script.getType() + "], operation ["+ scriptContext.getKey()+ "] and lang ["+ lang+ "] are disabled");
  }
  boolean expression=scriptEngineService instanceof ExpressionScriptEngineService;
  boolean notSupported=scriptContext.getKey().equals(ScriptContext.Standard.UPDATE.getKey()) || scriptContext.getKey().equals(ScriptContext.Standard.MAPPING.getKey());
  if (expression && notSupported) {
    throw new ScriptException("scripts of type [" + script.getType() + "],"+ " operation ["+ scriptContext.getKey()+ "] and lang ["+ lang+ "] are not supported");
  }
  return compileInternal(script);
}
