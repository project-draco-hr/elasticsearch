{
  try {
    client.admin().indices().prepareDelete("test").execute().actionGet();
  }
 catch (  Exception e) {
  }
  client.admin().indices().prepareCreate("test").setSettings(ImmutableSettings.settingsBuilder().put("number_of_shards",1).put("number_of_replicas",0).put("index.codec","SimpleText")).execute().actionGet();
  client.prepareIndex("test","type1","1").setSource("field1","quick brown fox","field2","quick brown fox").execute().actionGet();
  client.prepareIndex("test","type1","2").setSource("field1","quick lazy huge brown fox","field2","quick lazy huge brown fox").setRefresh(true).execute().actionGet();
  SearchResponse searchResponse=client.prepareSearch().setQuery("{ \"text_phrase\" : { \"field2\" : \"quick brown\", \"slop\" : \"2\" }}").execute().actionGet();
  assertThat(searchResponse.hits().totalHits(),equalTo(1l));
  try {
    client.prepareSearch().setQuery("{ \"text_phrase\" : { \"field1\" : \"quick brown\", \"slop\" : \"2\" }}").execute().actionGet();
  }
 catch (  SearchPhaseExecutionException e) {
    assertTrue(e.getMessage().endsWith("IllegalStateException[field \"field1\" was indexed without position data; cannot run PhraseQuery (term=quick)]; }"));
  }
}
