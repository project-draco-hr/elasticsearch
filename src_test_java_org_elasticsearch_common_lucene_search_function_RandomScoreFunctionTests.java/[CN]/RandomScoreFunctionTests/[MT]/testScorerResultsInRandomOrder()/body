{
  List<String> idsNotSpotted=Lists.newArrayList(ids);
  IndexSearcher searcher=mockSearcher();
  for (int i=0; i < 100; ++i) {
    RandomScoreFunction function=new RandomScoreFunction(randomLong());
    function.setNextReader(reader.getContext());
    FunctionScoreQuery query=new FunctionScoreQuery(Queries.newMatchAllQuery(),function);
    TopDocs docs=searcher.search(query,1);
    String id=reader.document(docs.scoreDocs[0].doc).getField("_id").stringValue();
    if (idsNotSpotted.remove(id) && idsNotSpotted.isEmpty()) {
      break;
    }
  }
  assertThat(idsNotSpotted,empty());
}
