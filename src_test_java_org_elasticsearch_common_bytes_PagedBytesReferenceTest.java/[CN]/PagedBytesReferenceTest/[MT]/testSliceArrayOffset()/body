{
  int length=randomInt(PAGE_SIZE * randomIntBetween(2,5));
  BytesReference pbr=getRandomizedPagedBytesReference(length);
  int sliceOffset=randomIntBetween(0,pbr.length());
  int sliceLength=randomIntBetween(pbr.length() - sliceOffset,pbr.length() - sliceOffset);
  BytesReference slice=pbr.slice(sliceOffset,sliceLength);
  if (slice.hasArray()) {
    assertEquals(sliceOffset,slice.arrayOffset());
  }
 else {
    try {
      slice.arrayOffset();
      fail("expected IllegalStateException");
    }
 catch (    IllegalStateException ise) {
    }
  }
}
