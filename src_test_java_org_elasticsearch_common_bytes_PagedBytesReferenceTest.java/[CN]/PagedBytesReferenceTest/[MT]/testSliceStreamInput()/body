{
  int length=randomIntBetween(10,scaledRandomIntBetween(PAGE_SIZE * 2,PAGE_SIZE * 20));
  BytesReference pbr=getRandomizedPagedBytesReference(length);
  int sliceOffset=randomIntBetween(1,length / 2);
  int sliceLength=length - sliceOffset;
  BytesReference slice=pbr.slice(sliceOffset,sliceLength);
  StreamInput sliceInput=slice.streamInput();
  assertEquals(slice.get(0),sliceInput.readByte());
  assertEquals(slice.get(1),sliceInput.readByte());
  assertEquals(slice.get(2),sliceInput.readByte());
  sliceInput.reset();
  byte[] sliceBytes=new byte[sliceLength];
  sliceInput.readFully(sliceBytes);
  byte[] pbrSliceBytes=Arrays.copyOfRange(pbr.toBytes(),sliceOffset,length);
  assertArrayEquals(pbrSliceBytes,sliceBytes);
  byte[] sliceToBytes=slice.toBytes();
  assertEquals(sliceBytes.length,sliceToBytes.length);
  assertArrayEquals(sliceBytes,sliceToBytes);
}
