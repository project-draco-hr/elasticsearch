{
  FieldTypeLookup lookup=new FieldTypeLookup();
  FakeFieldMapper f=new FakeFieldMapper("foo","bar");
  FieldTypeLookup lookup2=lookup.copyAndAddAll("type",newList(f),randomBoolean());
  assertNull(lookup.get("foo"));
  assertNull(lookup.get("bar"));
  assertNull(lookup.getByIndexName("foo"));
  assertNull(lookup.getByIndexName("bar"));
  assertEquals(f.fieldType(),lookup2.get("foo"));
  assertNull(lookup.get("bar"));
  assertEquals(f.fieldType(),lookup2.getByIndexName("bar"));
  assertNull(lookup.getByIndexName("foo"));
  assertEquals(Collections.emptySet(),lookup.getTypes("foo"));
  assertEquals(Collections.emptySet(),lookup.getTypesByIndexName("foo"));
  assertEquals(Collections.emptySet(),lookup.getTypes("bar"));
  assertEquals(Collections.emptySet(),lookup.getTypesByIndexName("bar"));
  assertEquals(Collections.singleton("type"),lookup2.getTypes("foo"));
  assertEquals(Collections.emptySet(),lookup2.getTypesByIndexName("foo"));
  assertEquals(Collections.emptySet(),lookup2.getTypes("bar"));
  assertEquals(Collections.singleton("type"),lookup2.getTypesByIndexName("bar"));
  assertEquals(1,size(lookup2.iterator()));
}
