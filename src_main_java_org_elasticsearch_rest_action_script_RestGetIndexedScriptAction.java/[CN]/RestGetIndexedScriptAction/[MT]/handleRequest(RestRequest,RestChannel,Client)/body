{
  final GetIndexedScriptRequest getRequest=new GetIndexedScriptRequest(getScriptLang(request),request.param("id"));
  getRequest.version(request.paramAsLong("version",getRequest.version()));
  getRequest.versionType(VersionType.fromString(request.param("version_type"),getRequest.versionType()));
  client.getIndexedScript(getRequest,new RestResponseListener<GetIndexedScriptResponse>(channel){
    @Override public RestResponse buildResponse(    GetIndexedScriptResponse response) throws Exception {
      XContentBuilder builder=XContentFactory.contentBuilder(XContentType.JSON);
      if (!response.isExists()) {
        return new BytesRestResponse(NOT_FOUND,builder);
      }
 else {
        try {
          String script=response.getScript();
          builder.startObject();
          builder.field(getScriptFieldName(),script);
          builder.endObject();
          return new BytesRestResponse(OK,builder);
        }
 catch (        IOException|ClassCastException e) {
          throw new ElasticsearchIllegalStateException("Unable to parse " + response.getScript() + " as json",e);
        }
      }
    }
  }
);
}
