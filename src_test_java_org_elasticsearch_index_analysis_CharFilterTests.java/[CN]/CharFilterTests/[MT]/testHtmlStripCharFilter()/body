{
  Index index=new Index("test");
  Settings settings=settingsBuilder().put(IndexMetaData.SETTING_VERSION_CREATED,Version.CURRENT).put("index.analysis.analyzer.custom_with_char_filter.tokenizer","standard").putArray("index.analysis.analyzer.custom_with_char_filter.char_filter","html_strip").build();
  Injector parentInjector=new ModulesBuilder().add(new SettingsModule(settings),new EnvironmentModule(new Environment(settings)),new IndicesAnalysisModule()).createInjector();
  Injector injector=new ModulesBuilder().add(new IndexSettingsModule(index,settings),new IndexNameModule(index),new AnalysisModule(settings,parentInjector.getInstance(IndicesAnalysisService.class))).createChildInjector(parentInjector);
  AnalysisService analysisService=injector.getInstance(AnalysisService.class);
  NamedAnalyzer analyzer1=analysisService.analyzer("custom_with_char_filter");
  assertTokenStreamContents(analyzer1.tokenStream("test","<b>hello</b>!"),new String[]{"hello"});
  assertTokenStreamContents(analyzer1.tokenStream("test","<b>hello</b>!"),new String[]{"hello"});
}
