{
  if (version.onOrAfter(Version.LUCENE_43) && esVersion.onOrAfter(org.elasticsearch.Version.V_0_90_2)) {
    final Version version=this.version == Version.LUCENE_43 ? Version.LUCENE_44 : this.version;
    TokenStream result=tokenStream;
    if (side == Side.BACK) {
      result=new ReverseStringFilter(version,result);
    }
    result=new EdgeNGramTokenFilter(version,result,minGram,maxGram);
    if (side == Side.BACK) {
      result=new ReverseStringFilter(version,result);
    }
    return result;
  }
  return new EdgeNGramTokenFilter(version,tokenStream,side,minGram,maxGram);
}
