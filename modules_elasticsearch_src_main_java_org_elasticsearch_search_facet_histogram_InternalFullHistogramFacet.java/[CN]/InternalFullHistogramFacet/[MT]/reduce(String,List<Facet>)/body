{
  if (facets.size() == 1) {
    InternalFullHistogramFacet internalFacet=(InternalFullHistogramFacet)facets.get(0);
    if (!internalFacet.entries.isEmpty()) {
      List<FullEntry> entries=internalFacet.entries();
      Collections.sort(entries,comparatorType.comparator());
    }
    return internalFacet;
  }
  ExtTLongObjectHashMap<FullEntry> map=CacheRecycler.popLongObjectMap2();
  for (  Facet facet : facets) {
    InternalFullHistogramFacet histoFacet=(InternalFullHistogramFacet)facet;
    for (    Entry entry : histoFacet) {
      FullEntry fullEntry=(FullEntry)entry;
      FullEntry current=map.get(fullEntry.key);
      if (current != null) {
        current.count+=fullEntry.count;
        current.total+=fullEntry.total;
        current.totalCount+=fullEntry.totalCount;
      }
 else {
        map.put(fullEntry.key,fullEntry);
      }
    }
  }
  Object[] values=map.internalValues();
  Arrays.sort(values,(Comparator)comparatorType.comparator());
  List<FullEntry> ordered=new ArrayList<FullEntry>(map.size());
  for (int i=0; i < map.size(); i++) {
    FullEntry value=(FullEntry)values[i];
    if (value == null) {
      break;
    }
    ordered.add(value);
  }
  CacheRecycler.pushLongObjectMap2(map);
  return new InternalFullHistogramFacet(name,comparatorType,ordered);
}
