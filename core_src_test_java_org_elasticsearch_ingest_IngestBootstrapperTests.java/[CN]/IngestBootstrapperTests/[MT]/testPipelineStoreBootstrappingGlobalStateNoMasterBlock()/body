{
  ClusterState.Builder csBuilder=new ClusterState.Builder(new ClusterName("_name"));
  csBuilder.blocks(ClusterBlocks.builder().addGlobalBlock(randomBoolean() ? DiscoverySettings.NO_MASTER_BLOCK_WRITES : DiscoverySettings.NO_MASTER_BLOCK_ALL));
  ClusterState cs=csBuilder.metaData(MetaData.builder().put(IndexTemplateMetaData.builder(IngestBootstrapper.INGEST_INDEX_TEMPLATE_NAME))).build();
  bootstrapper.clusterChanged(new ClusterChangedEvent("test",cs,cs));
  verify(store,never()).start();
  verify(store,never()).stop(anyString());
  when(store.isStarted()).thenReturn(true);
  bootstrapper.clusterChanged(new ClusterChangedEvent("test",cs,cs));
  verify(store,never()).start();
  verify(store,times(1)).stop(anyString());
}
