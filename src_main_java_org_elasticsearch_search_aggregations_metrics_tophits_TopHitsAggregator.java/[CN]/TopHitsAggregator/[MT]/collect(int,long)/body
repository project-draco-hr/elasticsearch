{
  TopDocsAndLeafCollector collectors=topDocsCollectors.get(bucketOrdinal);
  if (collectors == null) {
    Sort sort=subSearchContext.sort();
    int topN=subSearchContext.from() + subSearchContext.size();
    TopDocsCollector<?> topLevelCollector=sort != null ? TopFieldCollector.create(sort,topN,true,subSearchContext.trackScores(),subSearchContext.trackScores()) : TopScoreDocCollector.create(topN);
    collectors=new TopDocsAndLeafCollector(topLevelCollector);
    collectors.leafCollector=collectors.topLevelCollector.getLeafCollector(currentContext);
    collectors.leafCollector.setScorer(currentScorer);
    topDocsCollectors.put(bucketOrdinal,collectors);
  }
  collectors.leafCollector.collect(docId);
}
