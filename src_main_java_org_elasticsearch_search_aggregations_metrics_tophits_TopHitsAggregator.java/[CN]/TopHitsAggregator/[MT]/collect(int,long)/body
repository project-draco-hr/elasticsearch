{
  TopDocsAndLeafCollector collectors=topDocsCollectors.get(bucketOrdinal);
  if (collectors == null) {
    Sort sort=topHitsContext.sort();
    int topN=topHitsContext.from() + topHitsContext.size();
    TopDocsCollector<?> topLevelCollector=sort != null ? TopFieldCollector.create(sort,topN,true,topHitsContext.trackScores(),topHitsContext.trackScores(),false) : TopScoreDocCollector.create(topN,false);
    collectors=new TopDocsAndLeafCollector(topLevelCollector);
    collectors.leafCollector=collectors.topLevelCollector.getLeafCollector(currentContext);
    collectors.leafCollector.setScorer(currentScorer);
    topDocsCollectors.put(bucketOrdinal,collectors);
  }
  collectors.leafCollector.collect(docId);
}
