{
  ClusterState state=clusterService.state();
  final DiscoveryNode localNode=state.nodes().getLocalNode();
  final DiscoveryNode other_node=new DiscoveryNode(randomBoolean() ? localNode.getName() : "other_name",localNode.getId(),localNode.getAddress(),randomBoolean() ? localNode.getAttributes() : Collections.singletonMap("attr","other"),randomBoolean() ? localNode.getRoles() : new HashSet<>(randomSubsetOf(Arrays.asList(DiscoveryNode.Role.values()))),randomBoolean() ? localNode.getVersion() : VersionUtils.randomVersion(random()));
  joinNode(other_node);
  assertThat(clusterService.localNode(),equalTo(other_node));
}
