{
  super.setUp();
  clusterService=new TestClusterService();
  final DiscoveryNodes initialNodes=clusterService.state().nodes();
  final DiscoveryNode localNode=initialNodes.localNode();
  clusterService.setState(ClusterState.builder(clusterService.state()).nodes(DiscoveryNodes.builder(initialNodes).masterNodeId(localNode.id())));
  nodeJoinController=new NodeJoinController(clusterService,new NoopRoutingService(Settings.EMPTY),new DiscoverySettings(Settings.EMPTY,new NodeSettingsService(Settings.EMPTY)),Settings.EMPTY);
}
