{
  for (  IndexService indexService : indicesService) {
    if (indexService == null) {
      continue;
    }
    String index=indexService.index().getName();
    IndexMetaData indexMetaData=event.state().metaData().index(index);
    if (indexMetaData != null && indexMetaData.state() == IndexMetaData.State.CLOSE) {
      for (      Integer shardId : indexService.shardIds()) {
        logger.debug("[{}][{}] removing shard (index is closed)",index,shardId);
        try {
          indexService.removeShard(shardId,"removing shard (index is closed)");
        }
 catch (        Throwable e) {
          logger.warn("[{}] failed to remove shard (index is closed)",e,index);
        }
      }
    }
  }
  for (  IndexService indexService : indicesService) {
    String index=indexService.index().getName();
    if (indexService.shardIds().isEmpty()) {
      if (logger.isDebugEnabled()) {
        logger.debug("[{}] cleaning index (no shards allocated)",index);
      }
      removeIndex(index,"removing index (no shards allocated)");
    }
  }
}
