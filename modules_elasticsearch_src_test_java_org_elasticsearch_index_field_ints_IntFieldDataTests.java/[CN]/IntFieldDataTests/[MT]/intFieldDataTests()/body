{
  Directory dir=new RAMDirectory();
  IndexWriter indexWriter=new IndexWriter(dir,Lucene.STANDARD_ANALYZER,true,IndexWriter.MaxFieldLength.UNLIMITED);
  indexWriter.addDocument(doc().add(new NumericField("svalue").setIntValue(4)).add(new NumericField("mvalue").setIntValue(104)).build());
  indexWriter.addDocument(doc().add(new NumericField("svalue").setIntValue(3)).add(new NumericField("mvalue").setIntValue(104)).add(new NumericField("mvalue").setIntValue(105)).build());
  indexWriter.addDocument(doc().add(new NumericField("svalue").setIntValue(7)).build());
  indexWriter.addDocument(doc().add(new NumericField("mvalue").setIntValue(102)).build());
  indexWriter.addDocument(doc().add(new NumericField("svalue").setIntValue(4)).build());
  IndexReader reader=indexWriter.getReader();
  IntFieldData.load(reader,"svalue",fieldDataOptions().withFreqs(false));
  IntFieldData.load(reader,"mvalue",fieldDataOptions().withFreqs(false));
  IntFieldData sFieldData=IntFieldData.load(reader,"svalue",fieldDataOptions().withFreqs(true));
  IntFieldData mFieldData=IntFieldData.load(reader,"mvalue",fieldDataOptions().withFreqs(true));
  assertThat(sFieldData.fieldName(),equalTo("svalue"));
  assertThat(sFieldData.type(),equalTo(FieldData.Type.INT));
  assertThat(sFieldData.multiValued(),equalTo(false));
  assertThat(mFieldData.fieldName(),equalTo("mvalue"));
  assertThat(mFieldData.type(),equalTo(FieldData.Type.INT));
  assertThat(mFieldData.multiValued(),equalTo(true));
  assertThat(sFieldData.hasValue(0),equalTo(true));
  assertThat(sFieldData.docFieldData(0).isEmpty(),equalTo(false));
  assertThat(sFieldData.value(0),equalTo(4));
  assertThat(sFieldData.docFieldData(0).getValue(),equalTo(4));
  assertThat(sFieldData.values(0).length,equalTo(1));
  assertThat(sFieldData.docFieldData(0).getValues().length,equalTo(1));
  assertThat(sFieldData.docFieldData(0).getValues()[0],equalTo(4));
  assertThat(sFieldData.hasValue(1),equalTo(true));
  assertThat(sFieldData.value(1),equalTo(3));
  assertThat(sFieldData.values(1).length,equalTo(1));
  assertThat(sFieldData.values(1)[0],equalTo(3));
  assertThat(sFieldData.hasValue(2),equalTo(true));
  assertThat(sFieldData.value(2),equalTo(7));
  assertThat(sFieldData.values(2).length,equalTo(1));
  assertThat(sFieldData.values(2)[0],equalTo(7));
  assertThat(sFieldData.hasValue(3),equalTo(false));
  assertThat(sFieldData.hasValue(4),equalTo(true));
  assertThat(sFieldData.value(4),equalTo(4));
  assertThat(sFieldData.values(4).length,equalTo(1));
  assertThat(sFieldData.values(4)[0],equalTo(4));
  final ArrayList<Tuple<Integer,Integer>> values=new ArrayList<Tuple<Integer,Integer>>();
  sFieldData.forEachValue(new IntFieldData.ValueProc(){
    @Override public void onValue(    int value,    int freq){
      values.add(tuple(value,freq));
    }
  }
);
  assertThat(values.size(),equalTo(3));
  assertThat(values.get(0).v1(),equalTo(3));
  assertThat(values.get(0).v2(),equalTo(1));
  assertThat(values.get(1).v1(),equalTo(4));
  assertThat(values.get(1).v2(),equalTo(2));
  assertThat(values.get(2).v1(),equalTo(7));
  assertThat(values.get(2).v2(),equalTo(1));
  assertThat(mFieldData.hasValue(0),equalTo(true));
  assertThat(mFieldData.value(0),equalTo(104));
  assertThat(mFieldData.values(0).length,equalTo(1));
  assertThat(mFieldData.values(0)[0],equalTo(104));
  assertThat(mFieldData.hasValue(1),equalTo(true));
  assertThat(mFieldData.value(1),equalTo(104));
  assertThat(mFieldData.values(1).length,equalTo(2));
  assertThat(mFieldData.values(1)[0],equalTo(104));
  assertThat(mFieldData.values(1)[1],equalTo(105));
  assertThat(mFieldData.hasValue(2),equalTo(false));
  assertThat(mFieldData.hasValue(3),equalTo(true));
  assertThat(mFieldData.value(3),equalTo(102));
  assertThat(mFieldData.values(3).length,equalTo(1));
  assertThat(mFieldData.values(3)[0],equalTo(102));
  assertThat(mFieldData.hasValue(4),equalTo(false));
  indexWriter.close();
  values.clear();
  mFieldData.forEachValue(new IntFieldData.ValueProc(){
    @Override public void onValue(    int value,    int freq){
      values.add(tuple(value,freq));
    }
  }
);
  assertThat(values.size(),equalTo(3));
  assertThat(values.get(0).v1(),equalTo(102));
  assertThat(values.get(0).v2(),equalTo(1));
  assertThat(values.get(1).v1(),equalTo(104));
  assertThat(values.get(1).v2(),equalTo(2));
  assertThat(values.get(2).v1(),equalTo(105));
  assertThat(values.get(2).v2(),equalTo(1));
}
