{
  IndexService indexService=indicesService.indexServiceSafe(request.index());
  IndexShard indexShard=indexService.shardSafe(shardId);
  if (request.refresh() && !request.realtime()) {
    indexShard.refresh(new Engine.Refresh(false));
  }
  MultiGetShardResponse response=new MultiGetShardResponse();
  for (int i=0; i < request.locations.size(); i++) {
    String type=request.types.get(i);
    String id=request.ids.get(i);
    String[] fields=request.fields.get(i);
    try {
      GetResponse getResponse=TransportGetAction.load(logger,scriptService,indexService,indexShard,request.index(),type,id,fields,request.realtime());
      response.add(request.locations.get(i),getResponse);
    }
 catch (    Exception e) {
      logger.debug("[{}][{}] failed to execute multi_get for [{}]/[{}]",e,request.index(),shardId,type,id);
      response.add(request.locations.get(i),new MultiGetResponse.Failure(request.index(),type,id,ExceptionsHelper.detailedMessage(e)));
    }
  }
  return response;
}
