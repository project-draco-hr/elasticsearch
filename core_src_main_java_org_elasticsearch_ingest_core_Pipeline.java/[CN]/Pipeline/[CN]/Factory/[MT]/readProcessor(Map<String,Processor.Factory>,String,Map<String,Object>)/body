{
  Processor.Factory factory=processorRegistry.get(type);
  if (factory != null) {
    List<Map<String,Map<String,Object>>> onFailureProcessorConfigs=ConfigurationUtils.readOptionalList(null,null,config,ON_FAILURE_KEY);
    List<Processor> onFailureProcessors=readProcessorConfigs(onFailureProcessorConfigs,processorRegistry);
    Processor processor;
    try {
      processor=factory.create(config);
    }
 catch (    ConfigurationPropertyException e) {
      throw e;
    }
catch (    Exception e) {
      throw new ConfigurationPropertyException(e.getMessage());
    }
    if (!config.isEmpty()) {
      throw new ConfigurationPropertyException("processor [" + type + "] doesn't support one or more provided configuration parameters "+ Arrays.toString(config.keySet().toArray()));
    }
    if (onFailureProcessors.isEmpty()) {
      return processor;
    }
    return new CompoundProcessor(Collections.singletonList(processor),onFailureProcessors);
  }
  throw new ConfigurationPropertyException("No processor type exists with name [" + type + "]");
}
