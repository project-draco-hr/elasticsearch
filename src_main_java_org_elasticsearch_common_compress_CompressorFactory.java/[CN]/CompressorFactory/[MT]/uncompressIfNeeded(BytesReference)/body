{
  Compressor compressor=compressor(bytes);
  if (compressor != null) {
    if (bytes.hasArray()) {
      return new BytesArray(compressor.uncompress(bytes.array(),bytes.arrayOffset(),bytes.length()));
    }
    StreamInput compressed=compressor.streamInput(bytes.streamInput());
    BytesStreamOutput bStream=new BytesStreamOutput();
    Streams.copy(compressed,bStream);
    compressed.close();
    return bStream.bytes();
  }
  return bytes;
}
