{
  Directory dir=new RAMDirectory();
  IndexWriter indexWriter=new IndexWriter(dir,Lucene.STANDARD_ANALYZER,true,IndexWriter.MaxFieldLength.UNLIMITED);
  Document doc=new Document();
  doc.add(new Field("_id","1",Field.Store.YES,Field.Index.NO));
  AllEntries allEntries=new AllEntries();
  allEntries.addText("field1","something",1.0f);
  allEntries.addText("field2","else",1.0f);
  allEntries.finishTexts();
  doc.add(new Field("_all",AllTokenFilter.allTokenStream("_all",allEntries,Lucene.STANDARD_ANALYZER)));
  indexWriter.addDocument(doc);
  doc=new Document();
  doc.add(new Field("_id","2",Field.Store.YES,Field.Index.NO));
  allEntries=new AllEntries();
  allEntries.addText("field1","else",2.0f);
  allEntries.addText("field2","something",1.0f);
  allEntries.finishTexts();
  doc.add(new Field("_all",AllTokenFilter.allTokenStream("_all",allEntries,Lucene.STANDARD_ANALYZER)));
  indexWriter.addDocument(doc);
  IndexReader reader=indexWriter.getReader();
  IndexSearcher searcher=new IndexSearcher(reader);
  TopDocs docs=searcher.search(new AllTermQuery(new Term("_all","else")),10);
  assertThat(docs.totalHits,equalTo(2));
  assertThat(docs.scoreDocs[0].doc,equalTo(1));
  assertThat(docs.scoreDocs[1].doc,equalTo(0));
  docs=searcher.search(new AllTermQuery(new Term("_all","something")),10);
  assertThat(docs.totalHits,equalTo(2));
  assertThat(docs.scoreDocs[0].doc,equalTo(0));
  assertThat(docs.scoreDocs[1].doc,equalTo(1));
  searcher.close();
  indexWriter.close();
}
