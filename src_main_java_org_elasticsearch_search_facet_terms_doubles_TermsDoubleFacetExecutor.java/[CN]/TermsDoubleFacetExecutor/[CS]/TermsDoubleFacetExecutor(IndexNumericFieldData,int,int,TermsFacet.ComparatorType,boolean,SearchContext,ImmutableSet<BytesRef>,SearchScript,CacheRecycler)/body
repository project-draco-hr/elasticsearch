{
  this.indexFieldData=indexFieldData;
  this.size=size;
  this.shardSize=shardSize;
  this.comparatorType=comparatorType;
  this.script=script;
  this.excluded=excluded;
  this.facets=cacheRecycler.doubleIntMap(-1);
  if (allTerms) {
    for (    AtomicReaderContext readerContext : context.searcher().getTopReaderContext().leaves()) {
      int maxDoc=readerContext.reader().maxDoc();
      DoubleValues values=indexFieldData.load(readerContext).getDoubleValues();
      for (int docId=0; docId < maxDoc; docId++) {
        int numValues=values.setDocument(docId);
        DoubleIntOpenHashMap map=facets.v();
        for (int i=0; i < numValues; i++) {
          map.putIfAbsent(values.nextValue(),0);
        }
      }
    }
  }
}
