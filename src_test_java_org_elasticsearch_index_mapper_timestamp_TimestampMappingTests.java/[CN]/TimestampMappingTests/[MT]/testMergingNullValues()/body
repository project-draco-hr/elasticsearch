{
  String mapping=XContentFactory.jsonBuilder().startObject().startObject("type").startObject("_timestamp").field("enabled",true).field("default",(String)null).endObject().endObject().endObject().string();
  DocumentMapperParser parser=createIndex("test").mapperService().documentMapperParser();
  DocumentMapper docMapper=parser.parse(mapping);
  mapping=XContentFactory.jsonBuilder().startObject().startObject("type").startObject("_timestamp").field("enabled",true).field("default",(String)null).endObject().startObject("properties").startObject("foo").field("type","string").endObject().endObject().endObject().endObject().string();
  DocumentMapper.MergeResult mergeResult=docMapper.merge(parser.parse(mapping),DocumentMapper.MergeFlags.mergeFlags().simulate(true));
  assertThat(mergeResult.hasConflicts(),is(false));
  client().admin().indices().delete(new DeleteIndexRequest("test")).get();
  mapping=XContentFactory.jsonBuilder().startObject().startObject("type").startObject("_timestamp").field("enabled",true).field("default",(String)null).endObject().endObject().endObject().string();
  parser=createIndex("test").mapperService().documentMapperParser();
  docMapper=parser.parse(mapping);
  mapping=XContentFactory.jsonBuilder().startObject().startObject("type").startObject("_timestamp").field("enabled",true).field("default","now").endObject().endObject().endObject().string();
  mergeResult=docMapper.merge(parser.parse(mapping),DocumentMapper.MergeFlags.mergeFlags().simulate(true));
  assertThat(mergeResult.hasConflicts(),is(true));
  client().admin().indices().delete(new DeleteIndexRequest("test")).get();
  mapping=XContentFactory.jsonBuilder().startObject().startObject("type").startObject("_timestamp").field("enabled",true).field("default","now").endObject().endObject().endObject().string();
  parser=createIndex("test").mapperService().documentMapperParser();
  docMapper=parser.parse(mapping);
  mapping=XContentFactory.jsonBuilder().startObject().startObject("type").startObject("_timestamp").field("enabled",true).field("default",(String)null).endObject().endObject().endObject().string();
  mergeResult=docMapper.merge(parser.parse(mapping),DocumentMapper.MergeFlags.mergeFlags().simulate(true));
  assertThat(mergeResult.hasConflicts(),is(true));
}
