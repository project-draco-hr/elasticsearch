{
  DocumentMapper docMapper=parser.parse(mapping1);
  docMapper.refreshSource();
  docMapper=parser.parse(docMapper.mappingSource().string());
  DocumentMapper.MergeResult mergeResult=docMapper.merge(parser.parse(mapping2).mapping(),DocumentMapper.MergeFlags.mergeFlags().simulate(true));
  assertThat(mergeResult.conflicts().length,equalTo(conflict == null ? 0 : 1));
  if (conflict != null) {
    assertThat(mergeResult.conflicts()[0],containsString(conflict));
  }
}
