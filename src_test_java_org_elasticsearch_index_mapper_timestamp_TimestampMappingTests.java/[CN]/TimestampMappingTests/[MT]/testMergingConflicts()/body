{
  String mapping=XContentFactory.jsonBuilder().startObject().startObject("type").startObject("_timestamp").field("enabled",true).startObject("fielddata").field("format","doc_values").endObject().field("store","yes").field("index","analyzed").field("path","foo").field("default","1970-01-01").endObject().endObject().endObject().string();
  Settings indexSettings=ImmutableSettings.builder().put(IndexMetaData.SETTING_VERSION_CREATED,Version.V_1_4_2.id).build();
  DocumentMapperParser parser=createIndex("test",indexSettings).mapperService().documentMapperParser();
  DocumentMapper docMapper=parser.parse(mapping);
  assertThat(docMapper.timestampFieldMapper().fieldDataType().getLoading(),equalTo(FieldMapper.Loading.LAZY));
  mapping=XContentFactory.jsonBuilder().startObject().startObject("type").startObject("_timestamp").field("enabled",false).startObject("fielddata").field("format","array").endObject().field("store","no").field("index","no").field("path","bar").field("default","1970-01-02").endObject().endObject().endObject().string();
  DocumentMapper.MergeResult mergeResult=docMapper.merge(parser.parse(mapping).mapping(),DocumentMapper.MergeFlags.mergeFlags().simulate(true));
  String[] expectedConflicts={"mapper [_timestamp] has different index values","mapper [_timestamp] has different store values","Cannot update default in _timestamp value. Value is 1970-01-01 now encountering 1970-01-02","Cannot update path in _timestamp value. Value is foo path in merged mapping is bar","mapper [_timestamp] has different tokenize values"};
  for (  String conflict : mergeResult.conflicts()) {
    assertThat(conflict,isIn(expectedConflicts));
  }
  assertThat(mergeResult.conflicts().length,equalTo(expectedConflicts.length));
  assertThat(docMapper.timestampFieldMapper().fieldDataType().getLoading(),equalTo(FieldMapper.Loading.LAZY));
  assertTrue(docMapper.timestampFieldMapper().enabled());
  assertThat(docMapper.timestampFieldMapper().fieldDataType().getFormat(indexSettings),equalTo("doc_values"));
}
