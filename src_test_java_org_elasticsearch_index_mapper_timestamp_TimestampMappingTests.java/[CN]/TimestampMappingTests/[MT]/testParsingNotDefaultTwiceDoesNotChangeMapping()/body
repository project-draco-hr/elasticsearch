{
  String mapping=XContentFactory.jsonBuilder().startObject().startObject("type").startObject("_timestamp").field("enabled",true).field("index",randomBoolean() ? "no" : "analyzed").field("store",true).field("path","foo").field("default","1970-01-01").startObject("fielddata").field("format","doc_values").endObject().endObject().startObject("properties").endObject().endObject().endObject().string();
  DocumentMapperParser parser=createIndex("test").mapperService().documentMapperParser();
  DocumentMapper docMapper=parser.parse(mapping);
  docMapper.refreshSource();
  docMapper=parser.parse(docMapper.mappingSource().string());
  assertThat(docMapper.mappingSource().string(),equalTo(mapping));
}
