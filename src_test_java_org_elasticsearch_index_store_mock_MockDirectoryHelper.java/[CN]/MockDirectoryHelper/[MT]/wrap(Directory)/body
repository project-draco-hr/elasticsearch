{
  final MockDirectoryWrapper w=new MockDirectoryWrapper(random,dir);
  w.setRandomIOExceptionRate(randomIOExceptionRate);
  w.setRandomIOExceptionRateOnOpen(randomIOExceptionRateOnOpen);
  w.setThrottling(throttle);
  w.setCheckIndexOnClose(checkIndexOnClose);
  wrappers.add(w);
  return new FilterDirectory(w){
    @Override public Directory getDelegate(){
      return w.getDelegate();
    }
  }
;
}
