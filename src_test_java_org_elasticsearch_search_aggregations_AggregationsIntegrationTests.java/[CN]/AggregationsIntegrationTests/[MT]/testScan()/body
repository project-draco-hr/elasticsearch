{
  try {
    client().prepareSearch("index").setSearchType(SearchType.SCAN).setScroll(new TimeValue(500)).addAggregation(terms("f").field("f")).get();
    fail();
  }
 catch (  SearchPhaseExecutionException e) {
    assertTrue(e.toString(),e.toString().contains("aggregations are not supported with search_type=scan"));
  }
}
