{
  new PutPipelineRequestBuilder(client(),PutPipelineAction.INSTANCE).setId("_id").setSource(jsonBuilder().startObject().field("description","my_pipeline").startArray("processors").startObject().startObject("grok").field("field","field1").field("pattern","%{NUMBER:val:float} %{NUMBER:status:int} <%{WORD:msg}>").endObject().endObject().endArray().endObject().bytes()).get();
  GetPipelineResponse getResponse=new GetPipelineRequestBuilder(client(),GetPipelineAction.INSTANCE).setIds("_id").get();
  assertThat(getResponse.isFound(),is(true));
  assertThat(getResponse.pipelines().size(),equalTo(1));
  assertThat(getResponse.pipelines().get(0).getId(),equalTo("_id"));
  SimulatePipelineResponse response=new SimulatePipelineRequestBuilder(client(),SimulatePipelineAction.INSTANCE).setId("_id").setSource(jsonBuilder().startObject().startArray("docs").startObject().field("_index","index").field("_type","type").field("_id","id").startObject("_source").field("foo","bar").endObject().endObject().endArray().endObject().bytes()).get();
  assertThat(response.isVerbose(),equalTo(false));
  assertThat(response.getPipelineId(),equalTo("_id"));
  assertThat(response.getResults().size(),equalTo(1));
  assertThat(response.getResults().get(0),instanceOf(SimulateDocumentSimpleResult.class));
  SimulateDocumentSimpleResult simulateDocumentSimpleResult=(SimulateDocumentSimpleResult)response.getResults().get(0);
  assertThat(simulateDocumentSimpleResult.getIngestDocument(),nullValue());
  assertThat(simulateDocumentSimpleResult.getFailure(),notNullValue());
  response=new SimulatePipelineRequestBuilder(client(),SimulatePipelineAction.INSTANCE).setId("_id").setSource(jsonBuilder().startObject().startArray("docs").startObject().field("_index","index").field("_type","type").field("_id","id").startObject("_source").field("field1","123.42 400 <foo>").endObject().endObject().endArray().endObject().bytes()).get();
  assertThat(response.isVerbose(),equalTo(false));
  assertThat(response.getPipelineId(),equalTo("_id"));
  assertThat(response.getResults().size(),equalTo(1));
  assertThat(response.getResults().get(0),instanceOf(SimulateDocumentSimpleResult.class));
  simulateDocumentSimpleResult=(SimulateDocumentSimpleResult)response.getResults().get(0);
  Map<String,Object> source=new HashMap<>();
  source.put("field1","123.42 400 <foo>");
  source.put("val",123.42f);
  source.put("status",400);
  source.put("msg","foo");
  IngestDocument ingestDocument=new IngestDocument("index","type","id",null,null,null,null,source);
  assertThat(simulateDocumentSimpleResult.getIngestDocument().getSourceAndMetadata(),equalTo(ingestDocument.getSourceAndMetadata()));
  assertThat(simulateDocumentSimpleResult.getFailure(),nullValue());
}
