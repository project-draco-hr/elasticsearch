{
  Path tmpPortsFile=environment.logsFile().resolve(type + ".ports.tmp");
  try (BufferedWriter writer=Files.newBufferedWriter(tmpPortsFile,Charset.forName("UTF-8"))){
    for (    TransportAddress address : boundAddress.boundAddresses()) {
      InetSocketAddress socketAddress=buildAddress(address.getAddress(),address.getPort());
      if (socketAddress.getAddress() instanceof Inet6Address && socketAddress.getAddress().isLinkLocalAddress()) {
        continue;
      }
      writer.write(NetworkAddress.formatAddress(socketAddress) + "\n");
    }
  }
 catch (  IOException e) {
    throw new RuntimeException("Failed to write ports file",e);
  }
  Path portsFile=environment.logsFile().resolve(type + ".ports");
  try {
    Files.move(tmpPortsFile,portsFile,StandardCopyOption.ATOMIC_MOVE);
  }
 catch (  IOException e) {
    throw new RuntimeException("Failed to rename ports file",e);
  }
}
