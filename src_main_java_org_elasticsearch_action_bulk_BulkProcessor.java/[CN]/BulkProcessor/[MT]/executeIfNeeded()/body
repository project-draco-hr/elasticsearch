{
  if (!isOverTheLimit()) {
    return;
  }
  if (concurrentRequests == 0) {
    try {
      listener.onResponse(client.bulk(bulkRequest).actionGet());
    }
 catch (    Exception e) {
      listener.onFailure(e);
    }
  }
 else {
    try {
      semaphore.acquire();
    }
 catch (    InterruptedException e) {
      listener.onFailure(e);
      return;
    }
    client.bulk(bulkRequest,new ActionListener<BulkResponse>(){
      @Override public void onResponse(      BulkResponse response){
        try {
          listener.onResponse(response);
        }
  finally {
          semaphore.release();
        }
      }
      @Override public void onFailure(      Throwable e){
        try {
          listener.onFailure(e);
        }
  finally {
          semaphore.release();
        }
      }
    }
);
  }
  bulkRequest=new BulkRequest();
}
