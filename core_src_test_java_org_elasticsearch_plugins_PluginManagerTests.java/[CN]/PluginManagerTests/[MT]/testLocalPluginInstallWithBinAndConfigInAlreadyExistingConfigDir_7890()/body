{
  String pluginName="plugin-test";
  Environment env=initialSettings.v2();
  Path pluginConfigDir=env.configFile().resolve(pluginName);
  assertStatusOk(String.format(Locale.ROOT,"install %s --url %s --verbose",pluginName,getPluginUrlForResource("plugin_with_config_v1.zip")));
  assertFileContent(pluginConfigDir,"test.txt","version1\n");
  assertStatusOk("remove " + pluginName);
  assertFileContent(pluginConfigDir,"test.txt","version1\n");
  assertStatusOk(String.format(Locale.ROOT,"install %s --url %s --verbose",pluginName,getPluginUrlForResource("plugin_with_config_v2.zip")));
  assertFileContent(pluginConfigDir,"test.txt","version1\n");
  assertFileContent(pluginConfigDir,"test.txt.new","version2\n");
  assertFileContent(pluginConfigDir,"dir/testdir.txt","version1\n");
  assertFileContent(pluginConfigDir,"dir/subdir/testsubdir.txt","version1\n");
  assertStatusOk("remove " + pluginName);
  assertFileContent(pluginConfigDir,"test.txt","version1\n");
  assertFileContent(pluginConfigDir,"test.txt.new","version2\n");
  assertFileContent(pluginConfigDir,"dir/testdir.txt","version1\n");
  assertFileContent(pluginConfigDir,"dir/subdir/testsubdir.txt","version1\n");
  assertStatusOk(String.format(Locale.ROOT,"install %s --url %s --verbose",pluginName,getPluginUrlForResource("plugin_with_config_v3.zip")));
  assertFileContent(pluginConfigDir,"test.txt","version1\n");
  assertFileContent(pluginConfigDir,"test2.txt","version1\n");
  assertFileContent(pluginConfigDir,"test.txt.new","version3\n");
  assertFileContent(pluginConfigDir,"dir/testdir.txt","version1\n");
  assertFileContent(pluginConfigDir,"dir/testdir.txt.new","version2\n");
  assertFileContent(pluginConfigDir,"dir/testdir2.txt","version1\n");
  assertFileContent(pluginConfigDir,"dir/subdir/testsubdir.txt","version1\n");
  assertFileContent(pluginConfigDir,"dir/subdir/testsubdir.txt.new","version2\n");
}
