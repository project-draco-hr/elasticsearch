{
  boolean success=false;
  try {
    clientBootstrap=createClientBootstrap();
    if (settings.getAsBoolean("network.server",true)) {
      final OpenChannelsHandler openChannels=new OpenChannelsHandler(logger);
      this.serverOpenChannels=openChannels;
      Map<String,Settings> profiles=settings.getGroups("transport.profiles",true);
      if (!profiles.containsKey(DEFAULT_PROFILE)) {
        profiles=Maps.newHashMap(profiles);
        profiles.put(DEFAULT_PROFILE,ImmutableSettings.EMPTY);
      }
      Settings fallbackSettings=createFallbackSettings();
      Settings defaultSettings=profiles.get(DEFAULT_PROFILE);
      for (      Map.Entry<String,Settings> entry : profiles.entrySet()) {
        Settings profileSettings=entry.getValue();
        String name=entry.getKey();
        if (!Strings.hasLength(name)) {
          logger.info("transport profile configured without a name. skipping profile with settings [{}]",profileSettings.toDelimitedString(','));
          continue;
        }
 else         if (DEFAULT_PROFILE.equals(name)) {
          profileSettings=settingsBuilder().put(profileSettings).put("port",profileSettings.get("port",this.settings.get("transport.tcp.port",DEFAULT_PORT_RANGE))).build();
        }
 else         if (profileSettings.get("port") == null) {
          logger.info("No port configured for profile [{}], not binding",name);
          continue;
        }
        Settings mergedSettings=settingsBuilder().put(fallbackSettings).put(defaultSettings).put(profileSettings).build();
        createServerBootstrap(name,mergedSettings);
        bindServerBootstrap(name,mergedSettings);
      }
      InetSocketAddress boundAddress=(InetSocketAddress)serverChannels.get(DEFAULT_PROFILE).getLocalAddress();
      int publishPort=settings.getAsInt("transport.netty.publish_port",settings.getAsInt("transport.publish_port",boundAddress.getPort()));
      String publishHost=settings.get("transport.netty.publish_host",settings.get("transport.publish_host",settings.get("transport.host")));
      InetSocketAddress publishAddress=createPublishAddress(publishHost,publishPort);
      this.boundAddress=new BoundTransportAddress(new InetSocketTransportAddress(boundAddress),new InetSocketTransportAddress(publishAddress));
    }
    success=true;
  }
  finally {
    if (success == false) {
      doStop();
    }
  }
}
