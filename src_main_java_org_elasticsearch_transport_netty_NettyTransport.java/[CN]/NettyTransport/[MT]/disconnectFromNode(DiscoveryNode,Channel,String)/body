{
  NodeChannels nodeChannels=connectedNodes.get(node);
  if (nodeChannels != null && nodeChannels.hasChannel(channel)) {
    connectionLock.acquire(node.id());
    try {
      nodeChannels=connectedNodes.get(node);
      if (nodeChannels != null && nodeChannels.hasChannel(channel)) {
        connectedNodes.remove(node);
        try {
          logger.debug("disconnecting from [{}], {}",node,reason);
          nodeChannels.close();
        }
  finally {
          logger.trace("disconnected from [{}], {}",node,reason);
          transportServiceAdapter.raiseNodeDisconnected(node);
        }
        return true;
      }
    }
  finally {
      connectionLock.release(node.id());
    }
  }
  return false;
}
