{
  UpdateInPlaceMap<String,String> map=UpdateInPlaceMap.of(randomIntBetween(0,500));
  UpdateInPlaceMap<String,String>.Mutator mutator=map.mutator();
  try {
    map.mutator();
    fail("should fail on concurrent mutator");
  }
 catch (  ElasticsearchIllegalStateException e) {
  }
  mutator.close();
  map.mutator();
}
