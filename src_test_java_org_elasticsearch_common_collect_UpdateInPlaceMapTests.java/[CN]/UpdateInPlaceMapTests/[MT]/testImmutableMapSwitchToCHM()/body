{
  int switchSize=randomIntBetween(1,500);
  UpdateInPlaceMap<String,String> map=UpdateInPlaceMap.of(switchSize);
  int i;
  for (i=0; i < switchSize; i++) {
    UpdateInPlaceMap<String,String>.Mutator mutator=map.mutator();
    String key="key" + i;
    String value="value" + i;
    mutator.put(key,value);
    assertThat(mutator.get(key),equalTo(value));
    assertThat(map.get(key),nullValue());
    mutator.close();
    assertThat(map.get(key),equalTo(value));
  }
  int countAfter=switchSize + randomIntBetween(0,100);
  for (; i < countAfter; i++) {
    UpdateInPlaceMap<String,String>.Mutator mutator=map.mutator();
    String key="key" + i;
    String value="value" + i;
    mutator.put(key,value);
    assertThat(mutator.get(key),equalTo(value));
    assertThat(map.get(key),equalTo(value));
    mutator.close();
    assertThat(map.get(key),equalTo(value));
  }
}
