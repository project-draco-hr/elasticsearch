{
  Random random=getRandom();
  List<IndexRequestBuilder> list=Arrays.asList(builders);
  Collections.shuffle(list,random);
  for (  IndexRequestBuilder indexRequestBuilder : list) {
    indexRequestBuilder.execute().actionGet();
    if (rarely()) {
      if (rarely()) {
        client().admin().indices().prepareRefresh(index).execute().get();
      }
 else       if (rarely()) {
        client().admin().indices().prepareFlush(index).execute().get();
      }
 else       if (rarely()) {
        client().admin().indices().prepareOptimize(index).setMaxNumSegments(between(1,10)).setFlush(random.nextBoolean()).execute().get();
      }
    }
  }
  if (forceRefresh) {
    assertNoFailures(client().admin().indices().prepareRefresh(index).execute().get());
  }
}
