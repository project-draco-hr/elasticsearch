{
  indexSettingsService.removeListener(applySettings);
  if (snapshotScheduleFuture != null) {
    snapshotScheduleFuture.cancel(true);
    snapshotScheduleFuture=null;
  }
  if (!indexShard.routingEntry().primary()) {
    delete=false;
  }
  shardGateway.close(delete);
  if (snapshotLock != null) {
    snapshotLock.release();
  }
}
