{
  if (!indexShard.routingEntry().primary()) {
    return;
  }
  if (indexShard.routingEntry().relocating()) {
    return;
  }
  indexShard.snapshot(new Engine.SnapshotHandler(){
    @Override public void snapshot(    SnapshotIndexCommit snapshotIndexCommit,    Translog.Snapshot translogSnapshot) throws EngineException {
      if (lastIndexVersion != snapshotIndexCommit.getVersion() || lastTranslogId != translogSnapshot.translogId() || lastTranslogSize != translogSnapshot.size()) {
        shardGateway.snapshot(snapshotIndexCommit,translogSnapshot);
        lastIndexVersion=snapshotIndexCommit.getVersion();
        lastTranslogId=translogSnapshot.translogId();
        lastTranslogSize=translogSnapshot.size();
      }
    }
  }
);
}
