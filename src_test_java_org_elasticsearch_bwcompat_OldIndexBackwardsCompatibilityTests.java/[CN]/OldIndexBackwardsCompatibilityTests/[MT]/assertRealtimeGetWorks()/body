{
  client().admin().indices().prepareUpdateSettings("test").setSettings(ImmutableSettings.builder().put("refresh_interval",-1).build());
  SearchRequestBuilder searchReq=client().prepareSearch("test").setQuery(QueryBuilders.matchAllQuery());
  SearchHit hit=searchReq.get().getHits().getAt(0);
  String docId=hit.getId();
  client().prepareUpdate("test","doc",docId).setDoc("foo","bar").get();
  GetResponse getRsp=client().prepareGet("test","doc",docId).get();
  Map<String,Object> source=getRsp.getSourceAsMap();
  assertThat(source,Matchers.hasKey("foo"));
  client().admin().indices().prepareUpdateSettings("test").setSettings(ImmutableSettings.builder().put("refresh_interval","1s").build());
}
