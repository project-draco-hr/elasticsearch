def snapshot_index(client, version, repo_dir):
    client.cluster.put_settings(body={'persistent': {'cluster.routing.allocation.exclude.version_attr': version, 'discovery.zen.publish_timeout': '30000', 'indices.recovery.file_chunk_size': '524288', }, })
    client.indices.put_template(name=('template_' + version.lower()), order=0, body={'template': 'te*', 'settings': {'number_of_shards': 1, }, 'mappings': {'type1': {'_source': {'enabled': False, }, }, }, 'aliases': {'alias1': {}, 'alias2': {'filter': {'term': {'version': version, }, }, 'routing': 'kimchy', }, '{index}-alias': {}, }, })
    client.snapshot.create_repository(repository='test_repo', body={'type': 'fs', 'settings': {'location': repo_dir, }, })
    client.snapshot.create(repository='test_repo', snapshot='test_1', wait_for_completion=True)
    client.snapshot.delete_repository(repository='test_repo')
