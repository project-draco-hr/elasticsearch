{
  DocumentMapperParser mapperParser=MapperTestUtils.newMapperParser(ImmutableSettings.builder().build());
  mapperParser.putTypeParser(AttachmentMapper.CONTENT_TYPE,new AttachmentMapper.TypeParser());
  String mapping=copyToStringFromClasspath("/org/elasticsearch/index/mapper/attachment/test/unit/various-doc/test-mapping.json");
  DocumentMapper docMapper=mapperParser.parse(mapping);
  byte[] html=copyToBytesFromClasspath("/org/elasticsearch/index/mapper/attachment/test/sample-files/" + filename);
  BytesReference json=jsonBuilder().startObject().field("_id",1).startObject("file").field("_name",filename).field("_content",html).endObject().endObject().bytes();
  ParseContext.Document doc=docMapper.parse(json).rootDoc();
  if (!errorExpected) {
    assertThat(doc.get(docMapper.mappers().smartName("file").mapper().names().indexName()),not(isEmptyOrNullString()));
    logger.debug("extracted content: {}",doc.get(docMapper.mappers().smartName("file").mapper().names().indexName()));
  }
}
