{
  List<IndexRequestBuilder> builders=new ArrayList();
  builders.add(client().prepareIndex(ScriptService.SCRIPT_INDEX,"groovy","script1").setSource("{" + "\"script\":\"2\"" + "}"));
  builders.add(client().prepareIndex(ScriptService.SCRIPT_INDEX,"groovy","script2").setSource("{" + "\"script\":\"factor*2\"" + "}"));
  indexRandom(true,builders);
  builders.clear();
  builders.add(client().prepareIndex("test","scriptTest","1").setSource("{\"theField\":\"foo\"}"));
  builders.add(client().prepareIndex("test","scriptTest","2").setSource("{\"theField\":\"foo 2\"}"));
  builders.add(client().prepareIndex("test","scriptTest","3").setSource("{\"theField\":\"foo 3\"}"));
  builders.add(client().prepareIndex("test","scriptTest","4").setSource("{\"theField\":\"foo 4\"}"));
  builders.add(client().prepareIndex("test","scriptTest","5").setSource("{\"theField\":\"bar\"}"));
  indexRandom(true,builders);
  SearchResponse searchResponse;
  String query="{ \"query\" : { \"match_all\": {}} , \"script_fields\" : { \"test1\" : { \"id\" : \"script1\" }, \"test2\" : { \"id\" : \"script2\", \"params\":{\"factor\":3}  }}, size:1}";
  searchResponse=client().prepareSearch().setSource(query).setIndices("test").setTypes("scriptTest").get();
  assertHitCount(searchResponse,5);
  assertTrue(searchResponse.getHits().hits().length == 1);
  SearchHit sh=searchResponse.getHits().getAt(0);
  assertTrue(sh.field("test1").getValue() == 2);
  assertTrue(sh.field("test2").getValue() == 6);
}
