{
  long totalSize=0;
  for (  ShardRouting routing : node.shardsWithState(ShardRoutingState.RELOCATING,ShardRoutingState.INITIALIZING)) {
    String actualPath=clusterInfo.getDataPath(routing);
    if (dataPath.equals(actualPath)) {
      if (routing.initializing() && routing.relocatingNodeId() != null) {
        totalSize+=getShardSize(routing,clusterInfo);
      }
 else       if (subtractShardsMovingAway && routing.relocating()) {
        totalSize-=getShardSize(routing,clusterInfo);
      }
    }
  }
  return totalSize;
}
