{
  final IndexMetaData metaData=allocation.metaData().getIndexSafe(shard.index());
  final ClusterInfo info=allocation.clusterInfo();
  if (metaData.getMergeSourceIndex() != null && shard.allocatedPostIndexCreate(metaData) == false) {
    Index mergeSourceIndex=metaData.getMergeSourceIndex();
    long targetShardSize=0;
    for (    IndexShardRoutingTable shardRoutingTable : allocation.routingTable().index(mergeSourceIndex.getName())) {
      targetShardSize+=info.getShardSize(shardRoutingTable.primaryShard(),0);
    }
    return targetShardSize == 0 ? defaultValue : targetShardSize;
  }
 else {
    return info.getShardSize(shard,defaultValue);
  }
}
