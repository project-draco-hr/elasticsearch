{
  final Decision decision=earlyTerminate(allocation);
  if (decision != null) {
    return decision;
  }
  DiskUsage usage=getDiskUsage(node,allocation);
  double freeDiskPercentage=usage.getFreeDiskAsPercentage();
  long freeBytes=usage.getFreeBytes();
  if (logger.isDebugEnabled()) {
    logger.debug("Node [{}] has {}% free disk ({} bytes)",node.nodeId(),freeDiskPercentage,freeBytes);
  }
  if (freeBytes < freeBytesThresholdHigh.bytes()) {
    if (logger.isDebugEnabled()) {
      logger.debug("Less than the required {} free bytes threshold ({} bytes free) on node {}, shard cannot remain",freeBytesThresholdHigh,freeBytes,node.nodeId());
    }
    return allocation.decision(Decision.NO,NAME,"after allocation less than required [%s] free on node, free: [%s]",freeBytesThresholdHigh,new ByteSizeValue(freeBytes));
  }
  if (freeDiskPercentage < freeDiskThresholdHigh) {
    if (logger.isDebugEnabled()) {
      logger.debug("Less than the required {}% free disk threshold ({}% free) on node {}, shard cannot remain",freeDiskThresholdHigh,freeDiskPercentage,node.nodeId());
    }
    return allocation.decision(Decision.NO,NAME,"after allocation less than required [%s%%] free disk on node, free: [%s%%]",freeDiskThresholdHigh,freeDiskPercentage);
  }
  return allocation.decision(Decision.YES,NAME,"enough disk for shard to remain on node, free: [%s]",new ByteSizeValue(freeBytes));
}
