{
  int num=atLeast(100);
  IndexRequestBuilder[] builders=new IndexRequestBuilder[num];
  for (int i=0; i < builders.length; i++) {
    builders[i]=client().prepareIndex("test","type","" + i).setSource("f",English.intToEnglish(i));
  }
  prepareCreate("test").setSettings("number_of_shards",randomIntBetween(1,5),"number_of_replicas",randomIntBetween(0,1)).setSettings();
  indexRandom(true,builders);
  ensureYellow();
  final int iterations=atLeast(500);
  for (int i=0; i < iterations; i++) {
    SearchResponse searchResponse=client().prepareSearch("test").setQuery(matchAllQuery()).setSize(num).get();
    assertNoFailures(searchResponse);
    assertHitCount(searchResponse,num);
  }
}
