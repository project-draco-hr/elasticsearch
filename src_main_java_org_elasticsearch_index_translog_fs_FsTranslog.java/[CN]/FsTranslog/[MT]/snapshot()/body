{
  while (true) {
    FsTranslogFile current=this.current;
    FsChannelSnapshot snapshot=current.snapshot();
    if (snapshot != null) {
      return snapshot;
    }
    if (current.closed() && this.current == current) {
      throw new TranslogException(shardId,"current translog is already closed");
    }
    Thread.yield();
  }
}
