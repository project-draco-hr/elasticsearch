{
  rwl.writeLock().lock();
  try {
    FsTranslogFile newFile;
    try {
      newFile=type.create(shardId,id,new InternalChannelReference(location.resolve(getFilename(id)),StandardOpenOption.READ,StandardOpenOption.WRITE,StandardOpenOption.CREATE_NEW),bufferSize);
    }
 catch (    IOException e) {
      throw new TranslogException(shardId,"failed to create new translog file",e);
    }
    FsTranslogFile old=current;
    current=newFile;
    IOUtils.close(old);
  }
  finally {
    rwl.writeLock().unlock();
  }
}
