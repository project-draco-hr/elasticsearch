{
  if (allocation.ignoreDisable()) {
    return allocation.decision(Decision.YES,"allocation disabling is ignored");
  }
  Settings indexSettings=allocation.routingNodes().metaData().index(shardRouting.index()).settings();
  if (shardRouting.primary() && !allocation.routingNodes().routingTable().index(shardRouting.index()).shard(shardRouting.id()).primaryAllocatedPostApi()) {
    if (indexSettings.getAsBoolean(INDEX_ROUTING_ALLOCATION_DISABLE_NEW_ALLOCATION,disableNewAllocation)) {
      return allocation.decision(Decision.NO,"new primary allocation is disabled");
    }
 else {
      return allocation.decision(Decision.YES,"new primary allocation is enabled");
    }
  }
  if (indexSettings.getAsBoolean(INDEX_ROUTING_ALLOCATION_DISABLE_ALLOCATION,disableAllocation)) {
    return allocation.decision(Decision.NO,"all allocation is disabled");
  }
  if (indexSettings.getAsBoolean(INDEX_ROUTING_ALLOCATION_DISABLE_REPLICA_ALLOCATION,disableReplicaAllocation)) {
    if (shardRouting.primary()) {
      return allocation.decision(Decision.YES,"primary allocation is enabled");
    }
 else {
      return allocation.decision(Decision.NO,"replica allocation is disabled");
    }
  }
  return allocation.decision(Decision.YES,"all allocation is enabled");
}
