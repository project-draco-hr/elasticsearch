{
  if (shardRouting.primary() && !allocation.routingNodes().routingTable().index(shardRouting.index()).shard(shardRouting.id()).primaryAllocatedPostApi()) {
    return allocation.ignoreDisable() ? Decision.YES : disableNewAllocation ? Decision.NO : Decision.YES;
  }
  if (disableAllocation) {
    return allocation.ignoreDisable() ? Decision.YES : Decision.NO;
  }
  if (disableReplicaAllocation) {
    return shardRouting.primary() ? Decision.YES : allocation.ignoreDisable() ? Decision.YES : Decision.NO;
  }
  return Decision.YES;
}
