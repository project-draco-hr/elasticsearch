{
  if (searchContext.parsedFilter() != null && currentState == Stage.MAIN_QUERY) {
    collector=new FilteredCollector(collector,searchContext.parsedFilter());
  }
  if (searchContext.timeoutInMillis() != -1) {
    collector=new TimeLimitingCollector(collector,TimeLimitingCollector.getGlobalCounter(),searchContext.timeoutInMillis());
  }
  if (currentState == Stage.MAIN_QUERY) {
    if (queryCollectors != null && !queryCollectors.isEmpty()) {
      collector=new MultiCollector(collector,queryCollectors.toArray(new Collector[queryCollectors.size()]));
    }
  }
  if (searchContext.minimumScore() != null) {
    collector=new MinimumScoreCollector(collector,searchContext.minimumScore());
  }
  if (searchContext.timeoutInMillis() != -1) {
    try {
      super.search(leaves,weight,collector);
    }
 catch (    TimeLimitingCollector.TimeExceededException e) {
      searchContext.queryResult().searchTimedOut(true);
    }
  }
 else {
    super.search(leaves,weight,collector);
  }
}
