{
  Query expectedQuery;
  if (queryBuilder.ids().size() == 0) {
    expectedQuery=Queries.newMatchNoDocsQuery();
  }
 else {
    String[] typesForQuery;
    if (queryBuilder.types() == null || queryBuilder.types().length == 0) {
      Collection<String> queryTypes=context.queryTypes();
      typesForQuery=queryTypes.toArray(new String[queryTypes.size()]);
    }
 else     if (queryBuilder.types().length == 1 && MetaData.ALL.equals(queryBuilder.types()[0])) {
      typesForQuery=getCurrentTypes();
    }
 else {
      typesForQuery=queryBuilder.types();
    }
    expectedQuery=new TermsQuery(UidFieldMapper.NAME,Uid.createUidsForTypesAndIds(Sets.newHashSet(typesForQuery),queryBuilder.ids()));
  }
  return expectedQuery;
}
