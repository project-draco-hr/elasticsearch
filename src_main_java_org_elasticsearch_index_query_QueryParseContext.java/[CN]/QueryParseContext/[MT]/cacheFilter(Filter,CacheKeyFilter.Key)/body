{
  if (filter == null) {
    return null;
  }
  if (this.disableFilterCaching || this.propagateNoCache || filter instanceof NoCacheFilter) {
    return filter;
  }
  if (filter instanceof ResolvableFilter) {
    final ResolvableFilter resolvableFilter=(ResolvableFilter)filter;
    return new Filter(){
      @Override public DocIdSet getDocIdSet(      LeafReaderContext atomicReaderContext,      Bits bits) throws IOException {
        Filter filter=resolvableFilter.resolve();
        if (filter == null) {
          return null;
        }
        if (cacheKey != null) {
          filter=new CacheKeyFilter.Wrapper(filter,cacheKey);
        }
        filter=indexQueryParser.indexCache.filter().cache(filter);
        return filter.getDocIdSet(atomicReaderContext,bits);
      }
    }
;
  }
 else {
    if (cacheKey != null) {
      filter=new CacheKeyFilter.Wrapper(filter,cacheKey);
    }
    return indexQueryParser.indexCache.filter().cache(filter);
  }
}
