{
  if (allowUnmappedFields) {
    return fieldMapping;
  }
 else   if (mapUnmappedFieldAsString) {
    StringFieldMapper.Builder builder=MapperBuilders.stringField(name);
    StringFieldMapper stringFieldMapper=builder.build(new Mapper.BuilderContext(ImmutableSettings.EMPTY,new ContentPath(1)));
    return new MapperService.SmartNameFieldMappers(mapperService(),new FieldMappers(stringFieldMapper),null,false);
  }
 else {
    Version indexCreatedVersion=indexQueryParser.getIndexCreatedVersion();
    if (fieldMapping == null && indexCreatedVersion.onOrAfter(Version.V_1_4_0_Beta1)) {
      throw new QueryParsingException(index,"Strict field resolution and no field mapping can be found for the field with name [" + name + "]");
    }
 else {
      return fieldMapping;
    }
  }
}
