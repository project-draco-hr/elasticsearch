{
  try {
    if (request.onlyCount()) {
      return percolatorService.countPercolate(request);
    }
 else {
      return percolatorService.matchPercolate(request);
    }
  }
 catch (  Throwable t) {
    logger.trace("[{}][{}] failed to percolate",t,request.index(),request.shardId());
    ShardId shardId=new ShardId(request.index(),request.shardId());
    throw new PercolateException(shardId,"failed to percolate",t);
  }
}
