{
  byte[] b="abcdefghijabcdefghij".getBytes("UTF-8");
  CompressorFactory.defaultCompressor();
  Compressor compressor=CompressorFactory.defaultCompressor();
  BytesStreamOutput bout=new BytesStreamOutput();
  StreamOutput out=compressor.streamOutput(bout);
  out.writeBytes(b);
  out.flush();
  out.writeBytes(b);
  out.close();
  final BytesReference b1=bout.bytes();
  bout=new BytesStreamOutput();
  out=compressor.streamOutput(bout);
  out.writeBytes(b);
  out.writeBytes(b);
  out.close();
  final BytesReference b2=bout.bytes();
  assertFalse(b1.equals(b2));
  assertArrayEquals(b1.toBytes(),new CompressedString(b1).compressed());
  assertArrayEquals(b2.toBytes(),new CompressedString(b2).compressed());
  assertEquals(new CompressedString(b1),new CompressedString(b2));
}
