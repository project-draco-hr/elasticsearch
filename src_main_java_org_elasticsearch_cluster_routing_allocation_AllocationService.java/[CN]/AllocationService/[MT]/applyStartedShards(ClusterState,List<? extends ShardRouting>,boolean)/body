{
  RoutingNodes routingNodes=clusterState.routingNodes();
  routingNodes.unassigned().shuffle();
  StartedRerouteAllocation allocation=new StartedRerouteAllocation(allocationDeciders,routingNodes,clusterState.nodes(),startedShards,clusterInfoService.getClusterInfo());
  boolean changed=applyStartedShards(routingNodes,startedShards);
  if (!changed) {
    return new RoutingAllocation.Result(false,clusterState.routingTable());
  }
  shardsAllocators.applyStartedShards(allocation);
  if (withReroute) {
    reroute(allocation);
  }
  return new RoutingAllocation.Result(true,new RoutingTable.Builder().updateNodes(routingNodes).build().validateRaiseException(clusterState.metaData()));
}
