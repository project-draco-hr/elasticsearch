{
  super.readFrom(in);
  int numberOfSnapshots=in.readVInt();
  ImmutableMap.Builder<SnapshotId,ImmutableMap<ShardId,SnapshotIndexShardStatus>> snapshotMapBuilder=ImmutableMap.builder();
  for (int i=0; i < numberOfSnapshots; i++) {
    SnapshotId snapshotId=SnapshotId.readSnapshotId(in);
    ImmutableMap.Builder<ShardId,SnapshotIndexShardStatus> shardMapBuilder=ImmutableMap.builder();
    int numberOfShards=in.readVInt();
    for (int j=0; j < numberOfShards; j++) {
      ShardId shardId=ShardId.readShardId(in);
      SnapshotIndexShardStatus status=SnapshotIndexShardStatus.readShardSnapshotStatus(in);
      shardMapBuilder.put(shardId,status);
    }
    snapshotMapBuilder.put(snapshotId,shardMapBuilder.build());
  }
  status=snapshotMapBuilder.build();
}
