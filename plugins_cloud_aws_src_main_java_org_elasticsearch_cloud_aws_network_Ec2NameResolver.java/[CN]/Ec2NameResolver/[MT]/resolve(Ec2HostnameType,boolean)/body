{
  URLConnection urlConnection=null;
  InputStream in=null;
  try {
    URL url=new URL(EC2_METADATA_URL + type.ec2Name);
    logger.debug("obtaining ec2 hostname from ec2 meta-data url {}",url);
    urlConnection=url.openConnection();
    urlConnection.setConnectTimeout(2000);
    in=urlConnection.getInputStream();
    BufferedReader urlReader=new BufferedReader(new InputStreamReader(in));
    String metadataResult=urlReader.readLine();
    if (metadataResult == null || metadataResult.length() == 0) {
      logger.error("no ec2 metadata returned from {}",url);
      return null;
    }
    return InetAddress.getByName(metadataResult);
  }
 catch (  IOException e) {
    if (warnOnFailure) {
      logger.warn("failed to get metadata for [" + type.configName + "]: "+ ExceptionsHelper.detailedMessage(e));
    }
 else {
      logger.debug("failed to get metadata for [" + type.configName + "]: "+ ExceptionsHelper.detailedMessage(e));
    }
    return null;
  }
 finally {
    Closeables.closeQuietly(in);
  }
}
