{
  IndexService indexService=createIndex("test",ImmutableSettings.settingsBuilder().build(),"type",mapping);
  CompressedString mappingBeforeUpdate=indexService.mapperService().documentMapper("type").mappingSource();
  DocumentMapper.MergeResult mergeResult=indexService.mapperService().documentMapper("type").merge(indexService.mapperService().parse("type",new CompressedString(mappingUpdate.bytes()),true).mapping(),DocumentMapper.MergeFlags.mergeFlags().simulate(true));
  assertThat(mergeResult.conflicts().length,equalTo(1));
  CompressedString mappingAfterUpdate=indexService.mapperService().documentMapper("type").mappingSource();
  assertThat(mappingAfterUpdate,equalTo(mappingBeforeUpdate));
}
