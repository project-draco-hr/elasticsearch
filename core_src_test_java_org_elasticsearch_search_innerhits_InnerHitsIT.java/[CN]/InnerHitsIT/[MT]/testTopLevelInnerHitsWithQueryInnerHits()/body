{
  assertAcked(prepareCreate("index1").addMapping("child","_parent","type=parent"));
  List<IndexRequestBuilder> requests=new ArrayList<>();
  requests.add(client().prepareIndex("index1","parent","1").setSource("{}"));
  requests.add(client().prepareIndex("index1","child","2").setParent("1").setSource("{}"));
  indexRandom(true,requests);
  InnerHitsBuilder innerHitsBuilder=new InnerHitsBuilder();
  innerHitsBuilder.addParentChildInnerHits("my-inner-hit","child",new InnerHitsBuilder.InnerHit());
  SearchResponse response=client().prepareSearch("index1").setQuery(hasChildQuery("child",new MatchAllQueryBuilder()).innerHit(new QueryInnerHits())).innerHits(innerHitsBuilder).get();
  assertHitCount(response,1);
  assertThat(response.getHits().getAt(0).getInnerHits().size(),equalTo(2));
  assertThat(response.getHits().getAt(0).getInnerHits().get("child").getAt(0).getId(),equalTo("2"));
  assertThat(response.getHits().getAt(0).getInnerHits().get("my-inner-hit").getAt(0).getId(),equalTo("2"));
}
