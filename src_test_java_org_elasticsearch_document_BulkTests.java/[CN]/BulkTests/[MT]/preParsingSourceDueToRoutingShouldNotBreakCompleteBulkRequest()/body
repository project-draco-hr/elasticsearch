{
  XContentBuilder builder=jsonBuilder().startObject().startObject("type").startObject("_routing").field("required",true).field("path","my_routing").endObject().endObject().endObject();
  assertAcked(prepareCreate("test").addMapping("type",builder));
  ensureYellow("test");
  String brokenBuildRequestData="{\"index\": {} }\n" + "{\"name\": \"Malformed}\n" + "{\"index\": { \"_id\" : \"24000\" } }\n"+ "{\"name\": \"Good\", \"my_routing\" : \"48000\"}\n";
  BulkResponse bulkResponse=client().prepareBulk().add(brokenBuildRequestData.getBytes(Charsets.UTF_8),0,brokenBuildRequestData.length(),false,"test","type").setRefresh(true).get();
  assertThat(bulkResponse.getItems().length,is(2));
  assertThat(bulkResponse.getItems()[0].isFailed(),is(true));
  assertThat(bulkResponse.getItems()[1].isFailed(),is(false));
  assertExists(client().prepareGet("test","type","24000").setRouting("48000").get());
}
