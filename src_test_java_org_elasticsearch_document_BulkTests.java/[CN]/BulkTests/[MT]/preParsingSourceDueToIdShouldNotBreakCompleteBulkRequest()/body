{
  XContentBuilder builder=jsonBuilder().startObject().startObject("type").startObject("_id").field("path","my_id").endObject().endObject().endObject();
  assertAcked(prepareCreate("test").addMapping("type",builder));
  ensureYellow("test");
  String brokenBuildRequestData="{\"index\": {} }\n" + "{\"name\": \"Malformed}\n" + "{\"index\": {} }\n"+ "{\"name\": \"Good\", \"my_id\" : \"48\"}\n";
  BulkResponse bulkResponse=client().prepareBulk().add(brokenBuildRequestData.getBytes(Charsets.UTF_8),0,brokenBuildRequestData.length(),false,"test","type").setRefresh(true).get();
  assertThat(bulkResponse.getItems().length,is(2));
  assertThat(bulkResponse.getItems()[0].isFailed(),is(true));
  assertThat(bulkResponse.getItems()[1].isFailed(),is(false));
  assertExists(get("test","type","48"));
}
