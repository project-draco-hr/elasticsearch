{
  Directory dir=newDirectory();
  IndexWriter writer=new IndexWriter(dir,new IndexWriterConfig(Lucene.STANDARD_ANALYZER));
  DirectoryReader directoryReader=ElasticsearchDirectoryReader.wrap(DirectoryReader.open(writer,true),new ShardId("foo","_na_",1));
  MatcherAssert.assertThat(Versions.loadVersion(directoryReader,new Term(UidFieldMapper.NAME,"1")),equalTo(Versions.NOT_FOUND));
  Document doc=new Document();
  UidField uidAndVersion=new UidField("1",1L);
  doc.add(uidAndVersion);
  writer.addDocument(doc);
  uidAndVersion.uid="2";
  uidAndVersion.version=2;
  writer.addDocument(doc);
  writer.commit();
  directoryReader=reopen(directoryReader);
  assertThat(Versions.loadVersion(directoryReader,new Term(UidFieldMapper.NAME,"1")),equalTo(1L));
  assertThat(Versions.loadVersion(directoryReader,new Term(UidFieldMapper.NAME,"2")),equalTo(2L));
  assertThat(Versions.loadVersion(directoryReader,new Term(UidFieldMapper.NAME,"3")),equalTo(Versions.NOT_FOUND));
  directoryReader.close();
  writer.close();
  dir.close();
}
