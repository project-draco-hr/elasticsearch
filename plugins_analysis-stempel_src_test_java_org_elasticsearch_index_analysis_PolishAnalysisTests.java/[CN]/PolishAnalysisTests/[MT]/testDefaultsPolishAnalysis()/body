{
  Settings settings=settingsBuilder().put(Environment.PATH_HOME_SETTING.getKey(),createTempDir()).put(IndexMetaData.SETTING_VERSION_CREATED,Version.CURRENT).build();
  AnalysisModule analysisModule=new AnalysisModule(new Environment(settings));
  new AnalysisStempelPlugin().onModule(analysisModule);
  SettingsModule settingsModule=new SettingsModule(settings);
  settingsModule.registerSetting(InternalSettingsPlugin.VERSION_CREATED);
  Injector parentInjector=new ModulesBuilder().add(settingsModule,new EnvironmentModule(new Environment(settings)),analysisModule).createInjector();
  final AnalysisService analysisService=parentInjector.getInstance(AnalysisRegistry.class).build(IndexSettingsModule.newIndexSettings("test",settings));
  TokenFilterFactory tokenizerFactory=analysisService.tokenFilter("polish_stem");
  MatcherAssert.assertThat(tokenizerFactory,instanceOf(PolishStemTokenFilterFactory.class));
  Analyzer analyzer=analysisService.analyzer("polish").analyzer();
  MatcherAssert.assertThat(analyzer,instanceOf(PolishAnalyzer.class));
}
