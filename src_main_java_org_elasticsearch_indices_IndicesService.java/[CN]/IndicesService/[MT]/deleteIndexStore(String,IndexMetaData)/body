{
  if (nodeEnv.hasNodeFile()) {
synchronized (this) {
      String indexName=metaData.index();
      if (indices.containsKey(indexName)) {
        String localUUid=indices.get(indexName).v1().indexUUID();
        throw new ElasticsearchIllegalStateException("Can't delete index store for [" + indexName + "] - it's still part of the indices service ["+ localUUid+ "] ["+ metaData.getUUID()+ "]");
      }
      ClusterState clusterState=clusterService.state();
      if (clusterState.metaData().hasIndex(indexName) && (clusterState.nodes().localNode().masterNode() == true)) {
        final IndexMetaData index=clusterState.metaData().index(indexName);
        throw new ElasticsearchIllegalStateException("Can't delete closed index store for [" + indexName + "] - it's still part of the cluster state ["+ index.getUUID()+ "] ["+ metaData.getUUID()+ "]");
      }
    }
    Index index=new Index(metaData.index());
    final Settings indexSettings=buildIndexSettings(metaData);
    deleteIndexStore(reason,index,indexSettings);
  }
}
