{
  final AtomicReference<String> promptedSecretValue=new AtomicReference<>(null);
  final AtomicReference<String> promptedTextValue=new AtomicReference<>(null);
  final MockTerminal terminal=new MockTerminal();
  terminal.addTextInput("replaced");
  terminal.addSecretInput("changeit");
  final NamedCommand cmd=new NamedCommand("noop",terminal){
    @Override public CliTool.ExitStatus execute(    Settings settings,    Environment env){
      promptedSecretValue.set(settings.get("foo.password"));
      promptedTextValue.set(settings.get("replace"));
      return OK;
    }
  }
;
  System.setProperty("es.foo.password",InternalSettingsPreparer.SECRET_PROMPT_VALUE);
  System.setProperty("es.replace",InternalSettingsPreparer.TEXT_PROMPT_VALUE);
  try {
    new SingleCmdTool("tool",terminal,cmd).execute();
  }
  finally {
    System.clearProperty("es.foo.password");
    System.clearProperty("es.replace");
  }
  assertThat(promptedSecretValue.get(),is("changeit"));
  assertThat(promptedTextValue.get(),is("replaced"));
}
