{
  if (numFoundParents == 1) {
    BytesRef id=globalValues.lookupOrd((int)parentOrds.nextSetBit(0));
    if (nonNestedDocsFilter != null) {
      BooleanQuery bq=new BooleanQuery();
      bq.add(new TermQuery(new Term(UidFieldMapper.NAME,Uid.createUidAsBytes(parentType,id))),Occur.MUST);
      bq.add(nonNestedDocsFilter,Occur.MUST);
      return new QueryWrapperFilter(bq);
    }
 else {
      return new QueryWrapperFilter(new TermQuery(new Term(UidFieldMapper.NAME,Uid.createUidAsBytes(parentType,id))));
    }
  }
 else {
    BytesRefHash parentIds=null;
    boolean constructed=false;
    try {
      parentIds=new BytesRefHash(numFoundParents,searchContext.bigArrays());
      for (long parentOrd=parentOrds.nextSetBit(0); parentOrd != -1; parentOrd=parentOrds.nextSetBit(parentOrd + 1)) {
        parentIds.add(globalValues.lookupOrd((int)parentOrd));
      }
      constructed=true;
    }
  finally {
      if (!constructed) {
        Releasables.close(parentIds);
      }
    }
    searchContext.addReleasable(parentIds,SearchContext.Lifetime.COLLECTION);
    return new ParentIdsFilter(parentType,nonNestedDocsFilter,parentIds);
  }
}
