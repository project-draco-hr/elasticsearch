{
  RoutingNode routingNode=event.state().readOnlyRoutingNodes().nodesToShards().get(event.state().nodes().localNodeId());
  if (routingNode == null) {
    return;
  }
  for (  MutableShardRouting shard : routingNode) {
    if (!indicesService.hasIndex(shard.index())) {
      final IndexMetaData indexMetaData=event.state().metaData().index(shard.index());
      if (logger.isDebugEnabled()) {
        logger.debug("[{}] creating index",indexMetaData.index());
      }
      indicesService.createIndex(indexMetaData.index(),indexMetaData.settings(),event.state().nodes().localNode().id());
      threadPool.execute(new Runnable(){
        @Override public void run(){
          nodeIndexCreatedAction.nodeIndexCreated(indexMetaData.index(),event.state().nodes().localNodeId());
        }
      }
);
    }
  }
}
