{
  for (  final String index : indicesService.indices()) {
    IndexMetaData indexMetaData=event.state().metaData().index(index);
    if (indexMetaData != null && indexMetaData.state() == IndexMetaData.State.CLOSE) {
      IndexService indexService=indicesService.indexService(index);
      for (      Integer shardId : indexService.shardIds()) {
        logger.warn("[{}][{}] removing shard (index is closed)",index,shardId);
        indexService.removeShard(shardId,"removing shard (index is closed)");
      }
    }
  }
  for (  final String index : indicesService.indices()) {
    if (indicesService.indexService(index).shardIds().isEmpty()) {
      if (logger.isDebugEnabled()) {
        logger.debug("[{}] cleaning index (no shards allocated)",index);
      }
      try {
        indicesService.cleanIndex(index,"cleaning index (no shards allocated)");
      }
 catch (      Exception e) {
        logger.warn("failed to clean index (no shards of that index are allocated on this node)",e);
      }
    }
  }
}
