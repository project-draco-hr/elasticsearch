{
  final long[] lastKnownCount={-1};
  long lastStartCount=-1;
  Predicate<Object> testDocs=new Predicate<Object>(){
    public boolean apply(    Object o){
      lastKnownCount[0]=client().prepareCount().setQuery(matchAllQuery()).execute().actionGet().getCount();
      logger.debug("[{}] docs visible for search. waiting for [{}]",lastKnownCount[0],numDocs);
      return lastKnownCount[0] > numDocs;
    }
  }
;
  while (!awaitBusy(testDocs,5,TimeUnit.MINUTES)) {
    if (lastStartCount == lastKnownCount[0]) {
      fail("failed to reach " + numDocs + "docs");
    }
    lastStartCount=lastKnownCount[0];
  }
}
