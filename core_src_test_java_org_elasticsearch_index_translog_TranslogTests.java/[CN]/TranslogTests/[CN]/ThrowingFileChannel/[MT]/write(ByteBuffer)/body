{
  if (fail.get()) {
    if (partialWrite) {
      if (src.limit() > 1) {
        final int pos=src.position();
        final int limit=src.limit();
        src.limit(limit / 2);
        super.write(src);
        src.position(pos);
        src.limit(limit);
        throw new IOException("__FAKE__ no space left on device");
      }
    }
    throw new MockDirectoryWrapper.FakeIOException();
  }
  return super.write(src);
}
