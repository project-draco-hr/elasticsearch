{
  Location loc0=translog.getLastWriteLocation();
  assertNotNull(loc0);
  Translog.Location loc1=translog.add(new Translog.Index("test","1",new byte[]{1}));
  assertThat(loc1,greaterThan(loc0));
  assertThat(translog.getLastWriteLocation(),greaterThan(loc1));
  Translog.Location loc2=translog.add(new Translog.Index("test","2",new byte[]{2}));
  assertThat(loc2,greaterThan(loc1));
  assertThat(translog.getLastWriteLocation(),greaterThan(loc2));
  assertThat(translog.read(loc1).getSource().source.toBytesArray(),equalTo(new BytesArray(new byte[]{1})));
  assertThat(translog.read(loc2).getSource().source.toBytesArray(),equalTo(new BytesArray(new byte[]{2})));
  Translog.Location lastLocBeforeSync=translog.getLastWriteLocation();
  translog.sync();
  assertEquals(lastLocBeforeSync,translog.getLastWriteLocation());
  assertThat(translog.read(loc1).getSource().source.toBytesArray(),equalTo(new BytesArray(new byte[]{1})));
  assertThat(translog.read(loc2).getSource().source.toBytesArray(),equalTo(new BytesArray(new byte[]{2})));
  Translog.Location loc3=translog.add(new Translog.Index("test","2",new byte[]{3}));
  assertThat(loc3,greaterThan(loc2));
  assertThat(translog.getLastWriteLocation(),greaterThan(loc3));
  assertThat(translog.read(loc3).getSource().source.toBytesArray(),equalTo(new BytesArray(new byte[]{3})));
  lastLocBeforeSync=translog.getLastWriteLocation();
  translog.sync();
  assertEquals(lastLocBeforeSync,translog.getLastWriteLocation());
  assertThat(translog.read(loc3).getSource().source.toBytesArray(),equalTo(new BytesArray(new byte[]{3})));
  translog.prepareCommit();
  assertThat(translog.getLastWriteLocation(),greaterThan(lastLocBeforeSync));
  assertThat(translog.read(loc3).getSource().source.toBytesArray(),equalTo(new BytesArray(new byte[]{3})));
  translog.commit();
  assertNull(translog.read(loc1));
  assertNull(translog.read(loc2));
  assertNull(translog.read(loc3));
  try {
    translog.read(new Translog.Location(translog.currentFileGeneration() + 1,17,35));
    fail("generation is greater than the current");
  }
 catch (  IllegalStateException ex) {
  }
}
