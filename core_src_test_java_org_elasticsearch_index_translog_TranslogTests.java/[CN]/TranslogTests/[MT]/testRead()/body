{
  Translog.Location loc1=translog.add(new Translog.Index("test","1",new byte[]{1}));
  Translog.Location loc2=translog.add(new Translog.Index("test","2",new byte[]{2}));
  assertThat(translog.read(loc1).getSource().source.toBytesArray(),equalTo(new BytesArray(new byte[]{1})));
  assertThat(translog.read(loc2).getSource().source.toBytesArray(),equalTo(new BytesArray(new byte[]{2})));
  translog.sync();
  assertThat(translog.read(loc1).getSource().source.toBytesArray(),equalTo(new BytesArray(new byte[]{1})));
  assertThat(translog.read(loc2).getSource().source.toBytesArray(),equalTo(new BytesArray(new byte[]{2})));
  Translog.Location loc3=translog.add(new Translog.Index("test","2",new byte[]{3}));
  assertThat(translog.read(loc3).getSource().source.toBytesArray(),equalTo(new BytesArray(new byte[]{3})));
  translog.sync();
  assertThat(translog.read(loc3).getSource().source.toBytesArray(),equalTo(new BytesArray(new byte[]{3})));
  translog.prepareCommit();
  assertThat(translog.read(loc3).getSource().source.toBytesArray(),equalTo(new BytesArray(new byte[]{3})));
  translog.commit();
  assertNull(translog.read(loc1));
  assertNull(translog.read(loc2));
  assertNull(translog.read(loc3));
  try {
    translog.read(new Translog.Location(translog.currentFileGeneration() + 1,17,35));
    fail("generation is greater than the current");
  }
 catch (  IllegalStateException ex) {
  }
}
