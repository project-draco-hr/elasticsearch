{
  Objects.requireNonNull(source,"Cannot serialize a null array.");
  if (off < 0) {
    throw new IllegalArgumentException("Cannot have negative offset: " + off);
  }
  if (len < 0) {
    throw new IllegalArgumentException("Cannot have length offset: " + len);
  }
  if (off + len > source.length) {
    throw new IllegalArgumentException(String.format(Locale.ROOT,"Cannot have offset of %d and length of %d with array of length %d",off,len,source.length));
  }
  if ((options & GZIP) != 0) {
    return encodeCompressedBytes(source,off,len,options);
  }
 else {
    return encodeNonCompressedBytes(source,off,len,options);
  }
}
