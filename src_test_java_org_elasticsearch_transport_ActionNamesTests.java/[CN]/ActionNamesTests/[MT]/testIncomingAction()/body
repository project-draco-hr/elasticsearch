{
  List<String> pre_1_4_names=Lists.newArrayList(ActionNames.ACTION_NAMES.inverse().keySet());
  TransportService transportService=internalCluster().getInstance(TransportService.class);
  List<String> actions=Lists.newArrayList(transportService.serverHandlers.keySet());
  Version version=randomVersion();
  int iters=iterations(10,100);
  for (int i=0; i < iters; i++) {
    boolean customAction=rarely();
    String action;
    if (customAction) {
      do {
        action=randomAsciiOfLength(randomInt(30));
      }
 while (pre_1_4_names.contains(action));
    }
 else {
      if (version.before(Version.V_1_4_0_Beta)) {
        action=randomFrom(pre_1_4_names);
      }
 else {
        action=randomFrom(actions);
      }
    }
    String incomingAction=ActionNames.incomingAction(action,version);
    if (version.onOrAfter(Version.V_1_4_0_Beta) || customAction) {
      assertThat(incomingAction,equalTo(action));
    }
 else {
      assertThat(incomingAction,not(equalTo(action)));
      assertThat(incomingAction,equalTo(ActionNames.post_1_4_action(action)));
    }
  }
}
