{
  BytesStreamOutput out=new BytesStreamOutput();
  NamedWriteableRegistry namedWriteableRegistry=new NamedWriteableRegistry();
  namedWriteableRegistry.registerPrototype(BaseNamedWriteable.class,new TestNamedWriteable(null,null));
  TestNamedWriteable namedWriteableIn=new TestNamedWriteable(randomAsciiOfLengthBetween(1,10),randomAsciiOfLengthBetween(1,10));
  out.writeNamedWriteable(namedWriteableIn);
  byte[] bytes=out.bytes().toBytes();
  StreamInput in=new NamedWriteableAwareStreamInput(StreamInput.wrap(bytes),namedWriteableRegistry);
  assertEquals(in.available(),bytes.length);
  BaseNamedWriteable namedWriteableOut=in.readNamedWriteable(BaseNamedWriteable.class);
  assertEquals(namedWriteableOut,namedWriteableIn);
  assertEquals(in.available(),0);
}
