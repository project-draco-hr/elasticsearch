{
  BytesStreamOutput out=new BytesStreamOutput();
  NamedWriteableRegistry namedWriteableRegistry=new NamedWriteableRegistry();
  namedWriteableRegistry.registerPrototype(BaseNamedWriteable.class,new TestNamedWriteable(null,null));
  TestNamedWriteable namedWriteableIn=new TestNamedWriteable(randomAsciiOfLengthBetween(1,10),randomAsciiOfLengthBetween(1,10));
  out.writeNamedWriteable(namedWriteableIn);
  StreamInput in=new NamedWriteableAwareStreamInput(StreamInput.wrap(out.bytes().toBytes()),namedWriteableRegistry);
  BaseNamedWriteable namedWriteableOut=in.readNamedWriteable(BaseNamedWriteable.class);
  assertEquals(namedWriteableOut,namedWriteableIn);
}
