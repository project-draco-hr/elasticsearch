{
  final IndexScopedSettings indexScopedSettings=new IndexScopedSettings(settings,new HashSet<>(this.indexSettings.values()));
  final ClusterSettings clusterSettings=new ClusterSettings(settings,new HashSet<>(this.clusterSettings.values()));
  indexScopedSettings.validate(settings.filter(IndexScopedSettings.INDEX_SETTINGS_KEY_PREDICATE));
  for (  Map.Entry<String,String> entry : settings.filter(IndexScopedSettings.INDEX_SETTINGS_KEY_PREDICATE.negate()).getAsMap().entrySet()) {
    if (clusterSettings.get(entry.getKey()) != null) {
      clusterSettings.validate(entry.getKey(),settings);
    }
  }
  bind(Settings.class).toInstance(settings);
  bind(SettingsFilter.class).toInstance(settingsFilter);
  bind(ClusterSettings.class).toInstance(clusterSettings);
  bind(IndexScopedSettings.class).toInstance(indexScopedSettings);
}
