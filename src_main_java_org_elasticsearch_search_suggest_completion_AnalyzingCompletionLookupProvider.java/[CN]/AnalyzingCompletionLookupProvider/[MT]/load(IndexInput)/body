{
  CodecUtil.checkHeader(input,CODEC_NAME,CODEC_VERSION,CODEC_VERSION);
  final Map<String,AnalyzingSuggestHolder> lookupMap=new HashMap<String,AnalyzingSuggestHolder>();
  input.seek(input.length() - 8);
  long metaPointer=input.readLong();
  input.seek(metaPointer);
  int numFields=input.readVInt();
  Map<Long,String> meta=new TreeMap<Long,String>();
  for (int i=0; i < numFields; i++) {
    String name=input.readString();
    long offset=input.readVLong();
    meta.put(offset,name);
  }
  for (  Map.Entry<Long,String> entry : meta.entrySet()) {
    input.seek(entry.getKey());
    FST<Pair<Long,BytesRef>> fst=new FST<Pair<Long,BytesRef>>(input,new PairOutputs<Long,BytesRef>(PositiveIntOutputs.getSingleton(),ByteSequenceOutputs.getSingleton()));
    int maxAnalyzedPathsForOneInput=input.readVInt();
    int maxSurfaceFormsPerAnalyzedForm=input.readVInt();
    int maxGraphExpansions=input.readInt();
    int options=input.readVInt();
    boolean preserveSep=(options & SERIALIZE_PRESERVE_SEPERATORS) != 0;
    boolean hasPayloads=(options & SERIALIZE_HAS_PAYLOADS) != 0;
    boolean preservePositionIncrements=(options & SERIALIZE_PRESERVE_POSITION_INCREMENTS) != 0;
    lookupMap.put(entry.getValue(),new AnalyzingSuggestHolder(preserveSep,preservePositionIncrements,maxSurfaceFormsPerAnalyzedForm,maxGraphExpansions,hasPayloads,maxAnalyzedPathsForOneInput,fst));
  }
  return new LookupFactory(){
    @Override public Lookup getLookup(    FieldMapper<?> mapper,    boolean exactFirst){
      AnalyzingSuggestHolder analyzingSuggestHolder=lookupMap.get(mapper.names().fullName());
      if (analyzingSuggestHolder == null) {
        return null;
      }
      int flags=exactFirst ? XAnalyzingSuggester.EXACT_FIRST : 0;
      if (analyzingSuggestHolder.preserveSep) {
        flags|=XAnalyzingSuggester.PRESERVE_SEP;
      }
      XAnalyzingSuggester suggester=new XAnalyzingSuggester(mapper.indexAnalyzer(),mapper.searchAnalyzer(),flags,analyzingSuggestHolder.maxSurfaceFormsPerAnalyzedForm,analyzingSuggestHolder.maxGraphExpansions,analyzingSuggestHolder.fst,analyzingSuggestHolder.hasPayloads,analyzingSuggestHolder.maxAnalyzedPathsForOneInput);
      suggester.setPreservePositionIncrements(analyzingSuggestHolder.preservePositionIncrements);
      return suggester;
    }
  }
;
}
