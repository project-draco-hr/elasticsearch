{
  ThreadPool threadPool=new ThreadPool(ImmutableSettings.settingsBuilder().put("threadpool.search.type","cached").put("name","testCachedExecutorType").build());
  final CountDownLatch latch=new CountDownLatch(1);
  Executor oldExecutor=threadPool.executor(Names.SEARCH);
  threadPool.executor(Names.SEARCH).execute(new Runnable(){
    @Override public void run(){
      try {
        Thread.sleep(20000);
      }
 catch (      InterruptedException ex) {
        latch.countDown();
        Thread.currentThread().interrupt();
      }
    }
  }
);
  threadPool.updateSettings(settingsBuilder().put("threadpool.search.type","fixed").build());
  assertThat(threadPool.executor(Names.SEARCH),not(sameInstance(oldExecutor)));
  assertThat(((ThreadPoolExecutor)oldExecutor).isShutdown(),equalTo(true));
  assertThat(((ThreadPoolExecutor)oldExecutor).isTerminating(),equalTo(true));
  assertThat(((ThreadPoolExecutor)oldExecutor).isTerminated(),equalTo(false));
  threadPool.shutdownNow();
  latch.await();
  terminate(threadPool);
}
