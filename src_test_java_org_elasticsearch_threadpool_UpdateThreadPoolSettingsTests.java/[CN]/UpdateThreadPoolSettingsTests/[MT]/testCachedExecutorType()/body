{
  ThreadPool threadPool=new ThreadPool(Settings.settingsBuilder().put("threadpool.search.type","cached").put("name","testCachedExecutorType").build());
  assertThat(info(threadPool,Names.SEARCH).getType(),equalTo("cached"));
  assertThat(info(threadPool,Names.SEARCH).getKeepAlive().minutes(),equalTo(5L));
  assertThat(threadPool.executor(Names.SEARCH),instanceOf(EsThreadPoolExecutor.class));
  threadPool.updateSettings(settingsBuilder().put("threadpool.search.type","same").build());
  assertThat(info(threadPool,Names.SEARCH).getType(),equalTo("same"));
  assertThat(threadPool.executor(Names.SEARCH),instanceOf(MoreExecutors.directExecutor().getClass()));
  threadPool.updateSettings(settingsBuilder().put("threadpool.search.type","scaling").put("threadpool.search.keep_alive","10m").build());
  assertThat(info(threadPool,Names.SEARCH).getType(),equalTo("scaling"));
  assertThat(threadPool.executor(Names.SEARCH),instanceOf(EsThreadPoolExecutor.class));
  assertThat(((EsThreadPoolExecutor)threadPool.executor(Names.SEARCH)).getCorePoolSize(),equalTo(1));
  assertThat(info(threadPool,Names.SEARCH).getKeepAlive().minutes(),equalTo(10L));
  assertThat(((EsThreadPoolExecutor)threadPool.executor(Names.SEARCH)).getKeepAliveTime(TimeUnit.MINUTES),equalTo(10L));
  threadPool.updateSettings(settingsBuilder().put("threadpool.search.type","cached").build());
  assertThat(info(threadPool,Names.SEARCH).getType(),equalTo("cached"));
  assertThat(info(threadPool,Names.SEARCH).getKeepAlive().minutes(),equalTo(10L));
  assertThat(threadPool.executor(Names.SEARCH),instanceOf(EsThreadPoolExecutor.class));
  Executor oldExecutor=threadPool.executor(Names.SEARCH);
  threadPool.updateSettings(settingsBuilder().put("threadpool.search.keep_alive","1m").build());
  assertThat(info(threadPool,Names.SEARCH).getKeepAlive().minutes(),equalTo(1L));
  assertThat(((EsThreadPoolExecutor)threadPool.executor(Names.SEARCH)).getKeepAliveTime(TimeUnit.MINUTES),equalTo(1L));
  assertThat(info(threadPool,Names.SEARCH).getType(),equalTo("cached"));
  assertThat(threadPool.executor(Names.SEARCH),sameInstance(oldExecutor));
  threadPool.updateSettings(settingsBuilder().put("threadpool.search.keep_alive","1m").build());
  assertThat(info(threadPool,Names.SEARCH).getKeepAlive().minutes(),equalTo(1L));
  assertThat(((EsThreadPoolExecutor)threadPool.executor(Names.SEARCH)).getKeepAliveTime(TimeUnit.MINUTES),equalTo(1L));
  assertThat(info(threadPool,Names.SEARCH).getType(),equalTo("cached"));
  assertThat(threadPool.executor(Names.SEARCH),sameInstance(oldExecutor));
  terminate(threadPool);
}
