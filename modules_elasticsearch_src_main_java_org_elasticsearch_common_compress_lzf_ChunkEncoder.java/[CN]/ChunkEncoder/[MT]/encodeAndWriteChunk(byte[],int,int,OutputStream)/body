{
  byte[] headerBuf=_headerBuffer;
  if (headerBuf == null) {
    _headerBuffer=headerBuf=new byte[LZFChunk.MAX_HEADER_LEN];
  }
  if (len >= MIN_BLOCK_TO_COMPRESS) {
    int compLen=tryCompress(data,offset,offset + len,_encodeBuffer,0);
    if (compLen < (len - 2)) {
      LZFChunk.writeCompressedHeader(len,compLen,out,headerBuf);
      out.write(_encodeBuffer,0,compLen);
      return;
    }
  }
  LZFChunk.writeNonCompressedHeader(len,out,headerBuf);
  out.write(data,offset,len);
}
