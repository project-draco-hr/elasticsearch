{
  CreateIndexRequestBuilder createIndexRequestBuilder=Holder.NODE.client().admin().indices().prepareCreate(index).setSettings(settings);
  if (type != null && mappings != null) {
    createIndexRequestBuilder.addMapping(type,mappings);
  }
  assertAcked(createIndexRequestBuilder.get());
  ClusterHealthResponse health=Holder.NODE.client().admin().cluster().health(Requests.clusterHealthRequest(index).waitForYellowStatus().waitForEvents(Priority.LANGUID).waitForRelocatingShards(0)).actionGet();
  assertThat(health.getStatus(),lessThanOrEqualTo(ClusterHealthStatus.YELLOW));
  assertThat("Cluster must be a single node cluster",health.getNumberOfDataNodes(),equalTo(1));
  IndicesService instanceFromNode=getInstanceFromNode(IndicesService.class);
  return instanceFromNode.indexServiceSafe(index);
}
