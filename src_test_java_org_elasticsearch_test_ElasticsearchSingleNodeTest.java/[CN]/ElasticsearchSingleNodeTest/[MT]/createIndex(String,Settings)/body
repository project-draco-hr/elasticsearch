{
  assertAcked(node.client().admin().indices().prepareCreate(index).setSettings(settings).get());
  ClusterHealthResponse health=node.client().admin().cluster().health(Requests.clusterHealthRequest(index).waitForYellowStatus().waitForEvents(Priority.LANGUID).waitForRelocatingShards(0)).actionGet();
  assertThat(health.getStatus(),lessThanOrEqualTo(ClusterHealthStatus.YELLOW));
  assertThat("Cluster must be a single node cluster",health.getNumberOfDataNodes(),equalTo(1));
  IndicesService instanceFromNode=getInstanceFromNode(IndicesService.class,node);
  return instanceFromNode.indexServiceSafe(index);
}
