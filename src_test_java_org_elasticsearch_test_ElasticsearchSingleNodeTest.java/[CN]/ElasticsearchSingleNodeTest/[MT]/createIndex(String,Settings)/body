{
  node.client().admin().indices().prepareCreate(index).setSettings(settings).get();
  ClusterHealthResponse health=node.client().admin().cluster().health(Requests.clusterHealthRequest(index).waitForYellowStatus().waitForEvents(Priority.LANGUID).waitForRelocatingShards(0)).actionGet();
  assertThat(health.getStatus(),lessThanOrEqualTo(ClusterHealthStatus.YELLOW));
  IndicesService instanceFromNode=getInstanceFromNode(IndicesService.class,node);
  return instanceFromNode.indexService(index);
}
