{
  IndexService service=indicesService.indexService(request.index());
  if (service != null) {
    service.cache().queryParserCache().clear();
    boolean clearedAtLeastOne=false;
    if (request.filterCache()) {
      clearedAtLeastOne=true;
      service.cache().filter().clear("api");
      termsFilterCache.clear("api");
    }
    if (request.filterKeys() != null && request.filterKeys().length > 0) {
      clearedAtLeastOne=true;
      service.cache().filter().clear("api",request.filterKeys());
      termsFilterCache.clear("api",request.filterKeys());
    }
    if (request.fieldDataCache()) {
      clearedAtLeastOne=true;
      if (request.fields() == null || request.fields().length == 0) {
        service.fieldData().clear();
      }
 else {
        for (        String field : request.fields()) {
          service.fieldData().clearField(field);
        }
      }
    }
    if (request.recycler()) {
      logger.debug("Clear CacheRecycler on index [{}]",service.index());
      clearedAtLeastOne=true;
    }
    if (request.idCache()) {
      clearedAtLeastOne=true;
      service.fieldData().clearField(ParentFieldMapper.NAME);
    }
    if (!clearedAtLeastOne) {
      if (request.fields() != null && request.fields().length > 0) {
        for (        String field : request.fields()) {
          service.fieldData().clearField(field);
        }
      }
 else {
        service.cache().clear("api");
        service.fieldData().clear();
        termsFilterCache.clear("api");
      }
    }
  }
  return new ShardClearIndicesCacheResponse(request.index(),request.shardId());
}
