{
  IndexService service=indicesService.indexService(request.getIndex());
  if (service != null) {
    service.cache().queryParserCache().clear();
    boolean clearedAtLeastOne=false;
    if (request.isFilterCache()) {
      clearedAtLeastOne=true;
      service.cache().filter().clear("api");
    }
    if (request.getFilterKeys() != null && request.getFilterKeys().length > 0) {
      clearedAtLeastOne=true;
      service.cache().filter().clear("api",request.getFilterKeys());
    }
    if (request.isFieldDataCache()) {
      clearedAtLeastOne=true;
      if (request.getFields() == null || request.getFields().length == 0) {
        service.fieldData().clear();
      }
 else {
        for (        String field : request.getFields()) {
          service.fieldData().clearField(field);
        }
      }
    }
    if (request.isIdCache()) {
      clearedAtLeastOne=true;
      service.cache().idCache().clear();
    }
    if (!clearedAtLeastOne) {
      if (request.getFields() != null && request.getFields().length > 0) {
        for (        String field : request.getFields()) {
          service.fieldData().clearField(field);
        }
      }
 else {
        service.cache().clear("api");
      }
    }
    service.cache().invalidateCache();
  }
  return new ShardClearIndicesCacheResponse(request.getIndex(),request.getShardId());
}
