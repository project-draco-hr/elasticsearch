{
  IndexService service=indicesService.indexService(request.index());
  if (service != null) {
    service.cache().queryParserCache().clear();
    boolean clearedAtLeastOne=false;
    if (request.filterCache()) {
      clearedAtLeastOne=true;
      service.cache().filter().clear("api");
    }
    if (request.fieldDataCache()) {
      clearedAtLeastOne=true;
      if (request.fields() == null || request.fields().length == 0) {
        service.cache().fieldData().clear("api");
      }
 else {
        for (        String field : request.fields()) {
          service.cache().fieldData().clear("api",field);
        }
      }
    }
    if (request.idCache()) {
      clearedAtLeastOne=true;
      service.cache().idCache().clear();
    }
    if (request.bloomCache()) {
      clearedAtLeastOne=true;
      service.cache().bloomCache().clear();
    }
    if (!clearedAtLeastOne) {
      if (request.fields() != null && request.fields().length > 0) {
        for (        String field : request.fields()) {
          service.cache().fieldData().clear("api",field);
        }
      }
 else {
        service.cache().clear("api");
      }
    }
    service.cache().invalidateCache();
  }
  return new ShardClearIndicesCacheResponse(request.index(),request.shardId());
}
