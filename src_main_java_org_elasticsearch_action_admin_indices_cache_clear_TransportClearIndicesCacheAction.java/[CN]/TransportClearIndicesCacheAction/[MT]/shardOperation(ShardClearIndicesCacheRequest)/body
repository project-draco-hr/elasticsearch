{
  IndexService service=indicesService.indexService(request.shardId().getIndex());
  if (service != null) {
    IndexShard shard=service.shard(request.shardId().id());
    boolean clearedAtLeastOne=false;
    if (request.filterCache()) {
      clearedAtLeastOne=true;
      service.cache().filter().clear("api");
    }
    if (request.fieldDataCache()) {
      clearedAtLeastOne=true;
      if (request.fields() == null || request.fields().length == 0) {
        service.fieldData().clear();
      }
 else {
        for (        String field : request.fields()) {
          service.fieldData().clearField(field);
        }
      }
    }
    if (request.queryCache()) {
      clearedAtLeastOne=true;
      indicesQueryCache.clear(shard);
    }
    if (request.recycler()) {
      logger.debug("Clear CacheRecycler on index [{}]",service.index());
      clearedAtLeastOne=true;
    }
    if (request.idCache()) {
      clearedAtLeastOne=true;
      service.fieldData().clearField(ParentFieldMapper.NAME);
    }
    if (!clearedAtLeastOne) {
      if (request.fields() != null && request.fields().length > 0) {
        for (        String field : request.fields()) {
          service.fieldData().clearField(field);
        }
      }
 else {
        service.cache().clear("api");
        service.fieldData().clear();
        indicesQueryCache.clear(shard);
      }
    }
  }
  return new ShardClearIndicesCacheResponse(request.shardId());
}
