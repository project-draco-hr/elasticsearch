{
  SearchResponse response=client().prepareSearch("idx").setTypes("type").addAggregation(terms("terms").executionHint(randomExecutionHint()).field(TERMS_AGGS_FIELD).collectMode(SubAggCollectionMode.BREADTH_FIRST).subAggregation(topHits("hits").addSort(SortBuilders.fieldSort(SORT_FIELD).order(SortOrder.DESC)))).get();
  assertSearchResponse(response);
  try {
    client().prepareSearch("idx").setTypes("type").addAggregation(terms("terms").executionHint(randomExecutionHint()).field(TERMS_AGGS_FIELD).collectMode(SubAggCollectionMode.BREADTH_FIRST).subAggregation(topHits("hits"))).get();
    fail();
  }
 catch (  Exception e) {
    assertThat(e.getMessage(),containsString("ElasticsearchIllegalStateException"));
  }
}
