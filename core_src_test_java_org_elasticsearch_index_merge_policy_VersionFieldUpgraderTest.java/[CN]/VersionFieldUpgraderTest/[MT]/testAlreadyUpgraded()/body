{
  Directory dir=newDirectory();
  IndexWriter iw=new IndexWriter(dir,new IndexWriterConfig(null));
  Document doc=new Document();
  Token token=new Token("1",0,1);
  token.setPayload(new BytesRef(Numbers.longToBytes(3)));
  doc.add(new TextField(UidFieldMapper.NAME,new CannedTokenStream(token)));
  doc.add(new NumericDocValuesField(VersionFieldMapper.NAME,3));
  iw.addDocument(doc);
  iw.commit();
  CodecReader reader=getOnlySegmentReader(DirectoryReader.open(iw,true));
  CodecReader upgraded=VersionFieldUpgrader.wrap(reader);
  assertSame(reader,upgraded);
  reader.close();
  iw.close();
  dir.close();
}
