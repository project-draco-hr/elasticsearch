{
  if (!conf.containsKey("match")) {
    throw new MapperParsingException("template must have match set");
  }
  String match=conf.get("match").toString();
  String unmatch=conf.containsKey("unmatch") ? conf.get("unmatch").toString() : null;
  String matchMappingType=conf.containsKey("match_mapping_type") ? conf.get("match_mapping_type").toString() : null;
  if (!conf.containsKey("mapping")) {
    throw new MapperParsingException("template must have mapping set");
  }
  Map<String,Object> mapping=(Map<String,Object>)conf.get("mapping");
  String matchType=conf.containsKey("match_pattern") ? conf.get("match_pattern").toString() : "simple";
  return new XContentDynamicTemplate(match,unmatch,matchMappingType,MatchType.fromString(matchType),mapping);
}
