{
  internalCluster().ensureAtLeastNumDataNodes(2);
  prepareCreate("test").setSettings(IndexMetaData.SETTING_NUMBER_OF_SHARDS,1,IndexMetaData.SETTING_NUMBER_OF_REPLICAS,1).get();
  ensureGreen();
  ClusterStateResponse state=client().admin().cluster().prepareState().get();
  String nodeId=state.getState().getRoutingTable().index("test").shard(0).getShards().get(0).currentNodeId();
  String nodeName=state.getState().getNodes().get(nodeId).name();
  IndicesService indicesService=internalCluster().getInstance(IndicesService.class,nodeName);
  indicesService.indexServiceSafe("test").shardInjectorSafe(0).getInstance(SyncedFlushService.class).attemptSyncedFlush(new ShardId("test",0));
}
