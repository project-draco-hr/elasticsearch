{
  client().admin().indices().preparePutTemplate("foo_template").setTemplate("te*").setOrder(0).addMapping("type1",XContentFactory.jsonBuilder().startObject().startObject("type1").startObject("properties").startObject("field1").field("type","string").field("store","yes").endObject().startObject("field2").field("type","string").field("store","yes").field("index","not_analyzed").endObject().endObject().endObject().endObject()).get();
  client().admin().indices().preparePutTemplate("fuu_template").setTemplate("test*").setOrder(1).addMapping("type1",XContentFactory.jsonBuilder().startObject().startObject("type1").startObject("properties").startObject("field2").field("type","string").field("store","no").endObject().endObject().endObject().endObject()).get();
  ClusterStateResponse clusterStateResponseUnfiltered=client().admin().cluster().prepareState().get();
  assertThat(clusterStateResponseUnfiltered.getState().metaData().templates().size(),is(greaterThanOrEqualTo(2)));
  ClusterStateResponse clusterStateResponse=client().admin().cluster().prepareState().clear().setMetaData(true).setIndexTemplates("foo_template").get();
  assertThat(clusterStateResponse.getState().metaData().templates().size(),is(1));
}
