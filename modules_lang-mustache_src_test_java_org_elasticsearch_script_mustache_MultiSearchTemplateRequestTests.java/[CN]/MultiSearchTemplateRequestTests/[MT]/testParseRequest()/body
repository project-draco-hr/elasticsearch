{
  byte[] data=StreamsUtils.copyToBytesFromClasspath("/org/elasticsearch/script/mustache/simple-msearch-template.json");
  RestRequest restRequest=new FakeRestRequest.Builder().withContent(new BytesArray(data)).build();
  MultiSearchTemplateRequest request=RestMultiSearchTemplateAction.parseRequest(restRequest,true);
  assertThat(request.requests().size(),equalTo(3));
  assertThat(request.requests().get(0).getRequest().indices()[0],equalTo("test0"));
  assertThat(request.requests().get(0).getRequest().indices()[1],equalTo("test1"));
  assertThat(request.requests().get(0).indices(),arrayContaining("test0","test1"));
  assertThat(request.requests().get(0).getRequest().requestCache(),equalTo(true));
  assertThat(request.requests().get(0).getRequest().preference(),nullValue());
  assertThat(request.requests().get(1).indices()[0],equalTo("test2"));
  assertThat(request.requests().get(1).indices()[1],equalTo("test3"));
  assertThat(request.requests().get(1).getRequest().types()[0],equalTo("type1"));
  assertThat(request.requests().get(1).getRequest().requestCache(),nullValue());
  assertThat(request.requests().get(1).getRequest().preference(),equalTo("_local"));
  assertThat(request.requests().get(2).indices()[0],equalTo("test4"));
  assertThat(request.requests().get(2).indices()[1],equalTo("test1"));
  assertThat(request.requests().get(2).getRequest().types()[0],equalTo("type2"));
  assertThat(request.requests().get(2).getRequest().types()[1],equalTo("type1"));
  assertThat(request.requests().get(2).getRequest().routing(),equalTo("123"));
  assertNotNull(request.requests().get(0).getScript());
  assertNotNull(request.requests().get(1).getScript());
  assertNotNull(request.requests().get(2).getScript());
  assertEquals(ScriptService.ScriptType.INLINE,request.requests().get(0).getScriptType());
  assertEquals(ScriptService.ScriptType.INLINE,request.requests().get(1).getScriptType());
  assertEquals(ScriptService.ScriptType.INLINE,request.requests().get(2).getScriptType());
  assertEquals("{\"query\":{\"match_{{template}}\":{}}}",request.requests().get(0).getScript());
  assertEquals("{\"query\":{\"match_{{template}}\":{}}}",request.requests().get(1).getScript());
  assertEquals("{\"query\":{\"match_{{template}}\":{}}}",request.requests().get(2).getScript());
  assertEquals(1,request.requests().get(0).getScriptParams().size());
  assertEquals(1,request.requests().get(1).getScriptParams().size());
  assertEquals(1,request.requests().get(2).getScriptParams().size());
}
