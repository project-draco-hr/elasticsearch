{
  super(name,factories,aggregationContext,parent);
  MapperService.SmartNameObjectMapper mapper=aggregationContext.searchContext().smartNameObjectMapper(nestedPath);
  if (mapper == null) {
    throw new AggregationExecutionException("facet nested path [" + nestedPath + "] not found");
  }
  ObjectMapper objectMapper=mapper.mapper();
  if (objectMapper == null) {
    throw new AggregationExecutionException("facet nested path [" + nestedPath + "] not found");
  }
  if (!objectMapper.nested().isNested()) {
    throw new AggregationExecutionException("facet nested path [" + nestedPath + "] is not nested");
  }
  parentFilter=aggregationContext.searchContext().filterCache().cache(NonNestedDocsFilter.INSTANCE);
  childFilter=aggregationContext.searchContext().filterCache().cache(objectMapper.nestedTypeFilter());
}
