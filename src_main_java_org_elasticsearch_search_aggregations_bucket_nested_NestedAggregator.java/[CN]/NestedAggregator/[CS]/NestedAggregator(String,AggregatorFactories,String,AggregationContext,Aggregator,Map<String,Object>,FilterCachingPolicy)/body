{
  super(name,factories,aggregationContext,parentAggregator,metaData);
  this.nestedPath=nestedPath;
  this.parentAggregator=parentAggregator;
  MapperService.SmartNameObjectMapper mapper=aggregationContext.searchContext().smartNameObjectMapper(nestedPath);
  if (mapper == null) {
    throw new AggregationExecutionException("[nested] nested path [" + nestedPath + "] not found");
  }
  ObjectMapper objectMapper=mapper.mapper();
  if (objectMapper == null) {
    throw new AggregationExecutionException("[nested] nested path [" + nestedPath + "] not found");
  }
  if (!objectMapper.nested().isNested()) {
    throw new AggregationExecutionException("[nested] nested path [" + nestedPath + "] is not nested");
  }
  childFilter=aggregationContext.searchContext().filterCache().cache(objectMapper.nestedTypeFilter(),null,filterCachingPolicy);
  aggregationContext.ensureScoreDocsInOrder();
}
