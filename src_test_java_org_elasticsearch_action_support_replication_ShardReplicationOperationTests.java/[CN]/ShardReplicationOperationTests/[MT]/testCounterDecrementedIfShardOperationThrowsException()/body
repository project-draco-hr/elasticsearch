{
  action=new ActionWithExceptions(Settings.EMPTY,"testActionWithExceptions",transportService,clusterService,threadPool);
  final String index="test";
  final ShardId shardId=new ShardId(index,0);
  clusterService.setState(state(index,true,ShardRoutingState.STARTED,ShardRoutingState.STARTED));
  logger.debug("--> using initial state:\n{}",clusterService.state().prettyPrint());
  Request request=new Request(shardId).timeout("100ms");
  PlainActionFuture<Response> listener=new PlainActionFuture<>();
  TransportShardReplicationOperationAction<Request,Request,Response>.PrimaryPhase primaryPhase=action.new PrimaryPhase(request,listener);
  primaryPhase.run();
  assertThat(transport.capturedRequests().length,equalTo(0));
  assertIndexShardCounter(1);
}
