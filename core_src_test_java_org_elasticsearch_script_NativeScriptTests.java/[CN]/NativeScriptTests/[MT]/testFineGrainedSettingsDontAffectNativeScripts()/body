{
  ContextAndHeaderHolder contextAndHeaders=new ContextAndHeaderHolder();
  Settings.Builder builder=Settings.settingsBuilder();
  if (randomBoolean()) {
    ScriptType scriptType=randomFrom(ScriptType.values());
    builder.put("script" + "." + scriptType.getScriptType(),randomFrom(ScriptMode.values()));
  }
 else {
    ScriptContext scriptContext=randomFrom(ScriptContext.Standard.values());
    builder.put("script" + "." + scriptContext.getKey(),randomFrom(ScriptMode.values()));
  }
  Settings settings=builder.put(Environment.PATH_HOME_SETTING.getKey(),createTempDir()).build();
  Environment environment=new Environment(settings);
  ResourceWatcherService resourceWatcherService=new ResourceWatcherService(settings,null);
  Map<String,NativeScriptFactory> nativeScriptFactoryMap=new HashMap<>();
  nativeScriptFactoryMap.put("my",new MyNativeScriptFactory());
  Set<ScriptEngineService> scriptEngineServices=singleton(new NativeScriptEngineService(settings,nativeScriptFactoryMap));
  ScriptEngineRegistry scriptEngineRegistry=new ScriptEngineRegistry(Collections.singletonList(new ScriptEngineRegistry.ScriptEngineRegistration(NativeScriptEngineService.class,NativeScriptEngineService.TYPES)));
  ScriptContextRegistry scriptContextRegistry=new ScriptContextRegistry(new ArrayList<>());
  ScriptSettings scriptSettings=new ScriptSettings(scriptEngineRegistry,scriptContextRegistry);
  ScriptService scriptService=new ScriptService(settings,environment,scriptEngineServices,resourceWatcherService,scriptEngineRegistry,scriptContextRegistry,scriptSettings);
  for (  ScriptContext scriptContext : scriptContextRegistry.scriptContexts()) {
    assertThat(scriptService.compile(new Script("my",ScriptType.INLINE,NativeScriptEngineService.NAME,null),scriptContext,contextAndHeaders,Collections.emptyMap()),notNullValue());
  }
}
