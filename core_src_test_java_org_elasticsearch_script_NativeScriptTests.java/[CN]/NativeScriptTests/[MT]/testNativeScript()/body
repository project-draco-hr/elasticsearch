{
  Settings settings=Settings.builder().put("node.name","testNativeScript").put(Environment.PATH_HOME_SETTING.getKey(),createTempDir()).build();
  ScriptModule scriptModule=new ScriptModule(new NativeScriptEngineService(settings,Collections.singletonMap("my",new MyNativeScriptFactory())));
  List<Setting<?>> scriptSettings=scriptModule.getSettings();
  scriptSettings.add(InternalSettingsPlugin.VERSION_CREATED);
  SettingsModule settingsModule=new SettingsModule(settings,scriptSettings,Collections.emptyList());
  final ThreadPool threadPool=new ThreadPool(settings);
  Injector injector=new ModulesBuilder().add(new EnvironmentModule(new Environment(settings),threadPool),new SettingsModule(settings),scriptModule).createInjector();
  ScriptService scriptService=injector.getInstance(ScriptService.class);
  ClusterState state=ClusterState.builder(new ClusterName("_name")).build();
  ExecutableScript executable=scriptService.executable(new Script("my",ScriptType.INLINE,NativeScriptEngineService.NAME,null),ScriptContext.Standard.SEARCH,Collections.emptyMap(),state);
  assertThat(executable.run().toString(),equalTo("test"));
  terminate(injector.getInstance(ThreadPool.class));
}
