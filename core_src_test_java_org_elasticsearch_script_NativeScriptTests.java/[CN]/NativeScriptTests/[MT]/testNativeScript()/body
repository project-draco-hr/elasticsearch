{
  ContextAndHeaderHolder contextAndHeaders=new ContextAndHeaderHolder();
  Settings settings=Settings.settingsBuilder().put("name","testNativeScript").put("path.home",createTempDir()).build();
  ScriptModule scriptModule=new ScriptModule(settings);
  scriptModule.registerScript("my",MyNativeScriptFactory.class);
  Injector injector=new ModulesBuilder().add(new EnvironmentModule(new Environment(settings)),new ThreadPoolModule(new ThreadPool(settings)),new SettingsModule(settings,new SettingsFilter(settings)),scriptModule).createInjector();
  ScriptService scriptService=injector.getInstance(ScriptService.class);
  ExecutableScript executable=scriptService.executable(new Script("my",ScriptType.INLINE,NativeScriptEngineService.NAME,null),ScriptContext.Standard.SEARCH,contextAndHeaders,Collections.emptyMap());
  assertThat(executable.run().toString(),equalTo("test"));
  terminate(injector.getInstance(ThreadPool.class));
}
