{
  String masterNodeName=startMasterNode();
  String redNode=startDataNode("red");
  assertAcked(prepareCreate("test").setSettings(ImmutableSettings.builder().put("index.number_of_replicas",0)));
  index("test","doc","1",jsonBuilder().startObject().field("text","some text").endObject());
  waitForConcreteMappingsOnAll("test","doc","text");
  ensureGreen("test");
  assertIndexInMetaState(redNode,"test");
  assertIndexInMetaState(masterNodeName,"test");
  ((InternalTestCluster)cluster()).stopCurrentMasterNode();
  String newMasterNode=startMasterNode();
  ensureGreen("test");
  waitForConcreteMappingsOnAll("test","doc","text");
  assertIndexInMetaState(redNode,"test");
  assertIndexInMetaState(newMasterNode,"test");
  ensureGreen("test");
  assertTrue(client().prepareGet("test","doc","1").get().isExists());
}
