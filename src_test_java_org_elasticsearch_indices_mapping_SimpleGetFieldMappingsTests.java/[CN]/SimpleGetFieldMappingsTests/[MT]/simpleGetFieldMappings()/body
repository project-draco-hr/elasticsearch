{
  Settings.Builder settings=ImmutableSettings.settingsBuilder().put("number_of_shards",randomIntBetween(1,3),"number_of_replicas",randomIntBetween(0,1));
  assertTrue(client().admin().indices().prepareCreate("indexa").addMapping("typeA",getMappingForType("typeA")).addMapping("typeB",getMappingForType("typeB")).setSettings(settings).get().isAcknowledged());
  assertTrue(client().admin().indices().prepareCreate("indexb").addMapping("typeA",getMappingForType("typeA")).addMapping("typeB",getMappingForType("typeB")).setSettings(settings).get().isAcknowledged());
  ensureYellow();
  GetFieldMappingsResponse response=client().admin().indices().prepareGetFieldMappings("indexa").setTypes("typeA").setFields("field1","obj.subfield").get();
  assertThat(response.fieldMappings("indexa","typeA","field1").fullName(),equalTo("field1"));
  assertThat(response.fieldMappings("indexa","typeA","field1").sourceAsMap(),hasKey("field1"));
  assertThat(response.fieldMappings("indexa","typeA","obj.subfield").fullName(),equalTo("obj.subfield"));
  assertThat(response.fieldMappings("indexa","typeA","obj.subfield").sourceAsMap(),hasKey("subfield"));
  assertThat(response.mappings().get("indexa"),not(hasKey("typeB")));
  assertThat(response.fieldMappings("indexa","typeB","field1"),nullValue());
  assertThat(response.mappings(),not(hasKey("indexb")));
  assertThat(response.fieldMappings("indexb","typeB","field1"),nullValue());
  response=client().admin().indices().prepareGetFieldMappings("indexa").setTypes("typeA").setFields("field1","subfield").get();
  assertThat(response.fieldMappings("indexa","typeA","field1").fullName(),equalTo("field1"));
  assertThat(response.fieldMappings("indexa","typeA","field1").sourceAsMap(),hasKey("field1"));
  assertThat(response.fieldMappings("indexa","typeA","subfield").fullName(),equalTo("obj.subfield"));
  assertThat(response.fieldMappings("indexa","typeA","subfield").sourceAsMap(),hasKey("subfield"));
  assertThat(response.fieldMappings("indexa","typeB","field1"),nullValue());
  assertThat(response.fieldMappings("indexb","typeB","field1"),nullValue());
  response=client().admin().indices().prepareGetFieldMappings().setTypes("typeA").setFields("subfield").get();
  assertThat(response.fieldMappings("indexa","typeA","subfield").fullName(),equalTo("obj.subfield"));
  assertThat(response.fieldMappings("indexa","typeA","subfield").sourceAsMap(),hasKey("subfield"));
  assertThat(response.fieldMappings("indexa","typeB","subfield"),nullValue());
  assertThat(response.fieldMappings("indexb","typeA","subfield").fullName(),equalTo("obj.subfield"));
  assertThat(response.fieldMappings("indexb","typeA","subfield").sourceAsMap(),hasKey("subfield"));
  assertThat(response.fieldMappings("indexb","typeB","subfield"),nullValue());
  response=client().admin().indices().prepareGetFieldMappings("indexa").setFields("subfield").get();
  assertThat(response.fieldMappings("indexa","typeA","subfield").fullName(),equalTo("obj.subfield"));
  assertThat(response.fieldMappings("indexa","typeA","subfield").sourceAsMap(),hasKey("subfield"));
  assertThat(response.fieldMappings("indexa","typeA","field1"),nullValue());
  assertThat(response.fieldMappings("indexa","typeB","subfield").fullName(),equalTo("obj.subfield"));
  assertThat(response.fieldMappings("indexa","typeB","subfield").sourceAsMap(),hasKey("subfield"));
  assertThat(response.fieldMappings("indexa","typeB","field1"),nullValue());
  assertThat(response.fieldMappings("indexb","typeA","subfield"),nullValue());
  assertThat(response.fieldMappings("indexb","typeA","field1"),nullValue());
  assertThat(response.fieldMappings("indexb","typeB","subfield"),nullValue());
  assertThat(response.fieldMappings("indexb","typeB","field1"),nullValue());
  response=client().admin().indices().prepareGetFieldMappings().setFields("subfield").get();
  assertThat(response.fieldMappings("indexa","typeA","subfield").fullName(),equalTo("obj.subfield"));
  assertThat(response.fieldMappings("indexa","typeA","subfield").sourceAsMap(),hasKey("subfield"));
  assertThat(response.fieldMappings("indexa","typeA","field1"),nullValue());
  assertThat(response.fieldMappings("indexa","typeB","subfield").fullName(),equalTo("obj.subfield"));
  assertThat(response.fieldMappings("indexa","typeB","subfield").sourceAsMap(),hasKey("subfield"));
  assertThat(response.fieldMappings("indexa","typeB","field1"),nullValue());
  assertThat(response.fieldMappings("indexb","typeA","subfield").fullName(),equalTo("obj.subfield"));
  assertThat(response.fieldMappings("indexb","typeA","subfield").sourceAsMap(),hasKey("subfield"));
  assertThat(response.fieldMappings("indexb","typeB","field1"),nullValue());
  assertThat(response.fieldMappings("indexb","typeB","subfield").fullName(),equalTo("obj.subfield"));
  assertThat(response.fieldMappings("indexb","typeB","subfield").sourceAsMap(),hasKey("subfield"));
  assertThat(response.fieldMappings("indexb","typeB","field1"),nullValue());
}
