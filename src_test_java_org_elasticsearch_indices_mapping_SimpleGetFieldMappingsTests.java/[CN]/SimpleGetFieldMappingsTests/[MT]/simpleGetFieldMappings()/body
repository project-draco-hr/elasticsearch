{
  assertAcked(prepareCreate("indexa").addMapping("typeA",getMappingForType("typeA")).addMapping("typeB",getMappingForType("typeB")));
  assertAcked(client().admin().indices().prepareCreate("indexb").addMapping("typeA",getMappingForType("typeA")).addMapping("typeB",getMappingForType("typeB")));
  ensureYellow();
  GetFieldMappingsResponse response=client().admin().indices().prepareGetFieldMappings("indexa").setTypes("typeA").setFields("field1","obj.subfield").get();
  assertThat(response.fieldMappings("indexa","typeA","field1").fullName(),equalTo("field1"));
  assertThat(response.fieldMappings("indexa","typeA","field1").sourceAsMap(),hasKey("field1"));
  assertThat(response.fieldMappings("indexa","typeA","obj.subfield").fullName(),equalTo("obj.subfield"));
  assertThat(response.fieldMappings("indexa","typeA","obj.subfield").sourceAsMap(),hasKey("subfield"));
  assertThat(response.mappings().get("indexa"),not(hasKey("typeB")));
  assertThat(response.fieldMappings("indexa","typeB","field1"),nullValue());
  assertThat(response.mappings(),not(hasKey("indexb")));
  assertThat(response.fieldMappings("indexb","typeB","field1"),nullValue());
  response=client().admin().indices().prepareGetFieldMappings("indexa").setTypes("typeA").setFields("field1","obj.subfield").get();
  assertThat(response.fieldMappings("indexa","typeA","field1").fullName(),equalTo("field1"));
  assertThat(response.fieldMappings("indexa","typeA","field1").sourceAsMap(),hasKey("field1"));
  assertThat(response.fieldMappings("indexa","typeA","obj.subfield").fullName(),equalTo("obj.subfield"));
  assertThat(response.fieldMappings("indexa","typeA","obj.subfield").sourceAsMap(),hasKey("subfield"));
  assertThat(response.fieldMappings("indexa","typeB","field1"),nullValue());
  assertThat(response.fieldMappings("indexb","typeB","field1"),nullValue());
  response=client().admin().indices().prepareGetFieldMappings().setTypes("typeA").setFields("obj.subfield").get();
  assertThat(response.fieldMappings("indexa","typeA","obj.subfield").fullName(),equalTo("obj.subfield"));
  assertThat(response.fieldMappings("indexa","typeA","obj.subfield").sourceAsMap(),hasKey("subfield"));
  assertThat(response.fieldMappings("indexa","typeB","obj.subfield"),nullValue());
  assertThat(response.fieldMappings("indexb","typeA","obj.subfield").fullName(),equalTo("obj.subfield"));
  assertThat(response.fieldMappings("indexb","typeA","obj.subfield").sourceAsMap(),hasKey("subfield"));
  assertThat(response.fieldMappings("indexb","typeB","obj.subfield"),nullValue());
  response=client().admin().indices().prepareGetFieldMappings("indexa").setFields("obj.subfield").get();
  assertThat(response.fieldMappings("indexa","typeA","obj.subfield").fullName(),equalTo("obj.subfield"));
  assertThat(response.fieldMappings("indexa","typeA","obj.subfield").sourceAsMap(),hasKey("subfield"));
  assertThat(response.fieldMappings("indexa","typeA","field1"),nullValue());
  assertThat(response.fieldMappings("indexa","typeB","obj.subfield").fullName(),equalTo("obj.subfield"));
  assertThat(response.fieldMappings("indexa","typeB","obj.subfield").sourceAsMap(),hasKey("subfield"));
  assertThat(response.fieldMappings("indexa","typeB","field1"),nullValue());
  assertThat(response.fieldMappings("indexb","typeA","obj.subfield"),nullValue());
  assertThat(response.fieldMappings("indexb","typeA","field1"),nullValue());
  assertThat(response.fieldMappings("indexb","typeB","obj.subfield"),nullValue());
  assertThat(response.fieldMappings("indexb","typeB","field1"),nullValue());
  response=client().admin().indices().prepareGetFieldMappings().setFields("obj.subfield").get();
  assertThat(response.fieldMappings("indexa","typeA","obj.subfield").fullName(),equalTo("obj.subfield"));
  assertThat(response.fieldMappings("indexa","typeA","obj.subfield").sourceAsMap(),hasKey("subfield"));
  assertThat(response.fieldMappings("indexa","typeA","field1"),nullValue());
  assertThat(response.fieldMappings("indexa","typeB","obj.subfield").fullName(),equalTo("obj.subfield"));
  assertThat(response.fieldMappings("indexa","typeB","obj.subfield").sourceAsMap(),hasKey("subfield"));
  assertThat(response.fieldMappings("indexa","typeB","field1"),nullValue());
  assertThat(response.fieldMappings("indexb","typeA","obj.subfield").fullName(),equalTo("obj.subfield"));
  assertThat(response.fieldMappings("indexb","typeA","obj.subfield").sourceAsMap(),hasKey("subfield"));
  assertThat(response.fieldMappings("indexb","typeB","field1"),nullValue());
  assertThat(response.fieldMappings("indexb","typeB","obj.subfield").fullName(),equalTo("obj.subfield"));
  assertThat(response.fieldMappings("indexb","typeB","obj.subfield").sourceAsMap(),hasKey("subfield"));
  assertThat(response.fieldMappings("indexb","typeB","field1"),nullValue());
}
