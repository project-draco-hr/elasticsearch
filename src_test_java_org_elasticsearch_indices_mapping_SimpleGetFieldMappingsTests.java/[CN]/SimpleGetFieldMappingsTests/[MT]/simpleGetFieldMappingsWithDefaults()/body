{
  client().admin().indices().prepareCreate("test").addMapping("type",getMappingForType("type")).get();
  client().prepareIndex("test","type","1").setSource("num",1).get();
  awaitBusy(new Predicate<Object>(){
    @Override public boolean apply(    @Nullable java.lang.Object input){
      GetFieldMappingsResponse response=client().admin().indices().prepareGetFieldMappings().setFields("num").get();
      return response.fieldMappings("test","type","num") != null;
    }
  }
);
  GetFieldMappingsResponse response=client().admin().indices().prepareGetFieldMappings().setFields("num","field1","subfield").includeDefaults(true).get();
  assertThat((Map<String,Object>)response.fieldMappings("test","type","num").sourceAsMap().get("num"),hasEntry("index",(Object)"not_analyzed"));
  assertThat((Map<String,Object>)response.fieldMappings("test","type","num").sourceAsMap().get("num"),hasEntry("type",(Object)"long"));
  assertThat((Map<String,Object>)response.fieldMappings("test","type","field1").sourceAsMap().get("field1"),hasEntry("index",(Object)"analyzed"));
  assertThat((Map<String,Object>)response.fieldMappings("test","type","field1").sourceAsMap().get("field1"),hasEntry("type",(Object)"string"));
  assertThat((Map<String,Object>)response.fieldMappings("test","type","subfield").sourceAsMap().get("subfield"),hasEntry("index",(Object)"not_analyzed"));
  assertThat((Map<String,Object>)response.fieldMappings("test","type","subfield").sourceAsMap().get("subfield"),hasEntry("type",(Object)"string"));
}
