{
  super(index,indexSettings,name);
  String tokenizerName=settings.get("tokenizer");
  if (tokenizerName == null) {
    throw new IllegalArgumentException("Custom Analyzer [" + name + "] must be configured with a tokenizer");
  }
  TokenizerFactoryFactory tokenizerFactoryFactory=tokenizerFactories.get(tokenizerName);
  if (tokenizerFactoryFactory == null) {
    throw new IllegalArgumentException("Custom Analyzer [" + name + "] failed to find tokenizer under name ["+ tokenizerName+ "]");
  }
  Settings tokenizerSettings=indexSettings.getGroups("index.analysis.tokenizer").get(tokenizerName);
  if (tokenizerSettings == null) {
    tokenizerSettings=ImmutableSettings.Builder.EMPTY_SETTINGS;
  }
  tokenizerFactory=tokenizerFactoryFactory.create(tokenizerName,tokenizerSettings);
  List<TokenFilterFactory> tokenFilters=newArrayList();
  String[] tokenFilterNames=settings.getAsArray("filter");
  for (  String tokenFilterName : tokenFilterNames) {
    TokenFilterFactoryFactory tokenFilterFactoryFactory=tokenFilterFactories.get(tokenFilterName);
    if (tokenFilterFactoryFactory == null) {
      throw new IllegalArgumentException("Custom Analyzer [" + name + "] failed to find token filter under name ["+ tokenFilterName+ "]");
    }
    Settings tokenFilterSettings=indexSettings.getGroups("index.analysis.filter").get(tokenFilterName);
    if (tokenFilterSettings == null) {
      tokenFilterSettings=ImmutableSettings.Builder.EMPTY_SETTINGS;
    }
    tokenFilters.add(tokenFilterFactoryFactory.create(tokenFilterName,tokenFilterSettings));
  }
  this.tokenFilterFactories=tokenFilters.toArray(new TokenFilterFactory[tokenFilters.size()]);
  this.customAnalyzer=new CustomAnalyzer(this.tokenizerFactory,this.tokenFilterFactories);
}
