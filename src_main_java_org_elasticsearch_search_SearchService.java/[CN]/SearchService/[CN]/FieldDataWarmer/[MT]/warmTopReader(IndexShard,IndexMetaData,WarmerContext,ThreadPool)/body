{
  final MapperService mapperService=indexShard.mapperService();
  final Map<String,FieldMapper<?>> warmUpGlobalOrdinals=new HashMap<>();
  for (  DocumentMapper docMapper : mapperService.docMappers(false)) {
    for (    FieldMapper<?> fieldMapper : docMapper.mappers()) {
      final FieldDataType fieldDataType=fieldMapper.fieldDataType();
      if (fieldDataType == null) {
        continue;
      }
      if (fieldDataType.getLoading() != Loading.EAGER_GLOBAL_ORDINALS) {
        continue;
      }
      final String indexName=fieldMapper.names().indexName();
      if (warmUpGlobalOrdinals.containsKey(indexName)) {
        continue;
      }
      warmUpGlobalOrdinals.put(indexName,fieldMapper);
    }
  }
  final IndexFieldDataService indexFieldDataService=indexShard.indexFieldDataService();
  final Executor executor=threadPool.executor(executor());
  final CountDownLatch latch=new CountDownLatch(warmUpGlobalOrdinals.size());
  for (  final FieldMapper<?> fieldMapper : warmUpGlobalOrdinals.values()) {
    executor.execute(new Runnable(){
      @Override public void run(){
        try {
          final long start=System.nanoTime();
          IndexFieldData.Global ifd=indexFieldDataService.getForField(fieldMapper);
          ifd.loadGlobal(context.reader());
          if (indexShard.warmerService().logger().isTraceEnabled()) {
            indexShard.warmerService().logger().trace("warmed global ordinals for [{}], took [{}]",fieldMapper.names().name(),TimeValue.timeValueNanos(System.nanoTime() - start));
          }
        }
 catch (        Throwable t) {
          indexShard.warmerService().logger().warn("failed to warm-up global ordinals for [{}]",t,fieldMapper.names().name());
        }
 finally {
          latch.countDown();
        }
      }
    }
);
  }
  return new TerminationHandle(){
    @Override public void awaitTermination() throws InterruptedException {
      latch.await();
    }
  }
;
}
