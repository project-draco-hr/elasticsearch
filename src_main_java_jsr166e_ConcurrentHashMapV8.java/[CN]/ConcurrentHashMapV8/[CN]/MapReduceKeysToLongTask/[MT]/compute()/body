{
  final ObjectToLong<? super K> transformer;
  final LongByLongToLong reducer;
  if ((transformer=this.transformer) != null && (reducer=this.reducer) != null) {
    long r=this.basis;
    for (int b; (b=preSplit()) > 0; )     (rights=new MapReduceKeysToLongTask<K,V>(map,this,b,rights,transformer,r,reducer)).fork();
    while (advance() != null)     r=reducer.apply(r,transformer.apply((K)nextKey));
    result=r;
    CountedCompleter<?> c;
    for (c=firstComplete(); c != null; c=c.nextComplete()) {
      MapReduceKeysToLongTask<K,V> t=(MapReduceKeysToLongTask<K,V>)c, s=t.rights;
      while (s != null) {
        t.result=reducer.apply(t.result,s.result);
        s=t.rights=s.nextRight;
      }
    }
  }
}
