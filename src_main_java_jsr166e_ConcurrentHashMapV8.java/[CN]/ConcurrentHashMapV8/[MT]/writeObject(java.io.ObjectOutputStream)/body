{
  if (segments == null) {
    segments=(Segment<K,V>[])new Segment<?,?>[DEFAULT_CONCURRENCY_LEVEL];
    for (int i=0; i < segments.length; ++i)     segments[i]=new Segment<K,V>(LOAD_FACTOR);
  }
  s.defaultWriteObject();
  InternalIterator it=new InternalIterator(table);
  while (it.next != null) {
    s.writeObject(it.nextKey);
    s.writeObject(it.nextVal);
    it.advance();
  }
  s.writeObject(null);
  s.writeObject(null);
  segments=null;
}
