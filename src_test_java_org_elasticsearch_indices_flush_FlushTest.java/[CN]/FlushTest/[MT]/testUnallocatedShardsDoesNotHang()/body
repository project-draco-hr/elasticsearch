{
  prepareCreate("test").setSettings(ImmutableSettings.builder().put("index.routing.allocation.include._name","nonexistent")).get();
  List<ShardsSyncedFlushResult> shardsResult=SyncedFlushUtil.attemptSyncedFlush(internalCluster(),"test").getShardsResultPerIndex().get("test");
  int numShards=client().admin().indices().prepareGetSettings("test").get().getIndexToSettings().get("test").getAsInt(IndexMetaData.SETTING_NUMBER_OF_SHARDS,-1);
  assertThat(shardsResult.size(),equalTo(numShards));
  assertThat(shardsResult.get(0).failureReason(),equalTo("no active shards"));
}
