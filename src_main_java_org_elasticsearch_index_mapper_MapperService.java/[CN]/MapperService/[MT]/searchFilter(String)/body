{
  if (types == null || types.length == 0) {
    if (hasNested) {
      return NonNestedDocsFilter.INSTANCE;
    }
 else {
      return null;
    }
  }
  if (types.length == 1) {
    DocumentMapper docMapper=documentMapper(types[0]);
    if (docMapper == null) {
      return new TermFilter(new Term(types[0]));
    }
    return docMapper.typeFilter();
  }
  boolean useTermsFilter=true;
  for (  String type : types) {
    DocumentMapper docMapper=documentMapper(type);
    if (docMapper == null) {
      useTermsFilter=false;
      break;
    }
    if (!docMapper.typeMapper().fieldType().indexed()) {
      useTermsFilter=false;
      break;
    }
  }
  if (useTermsFilter) {
    BytesRef[] typesBytes=new BytesRef[types.length];
    for (int i=0; i < typesBytes.length; i++) {
      typesBytes[i]=new BytesRef(types[i]);
    }
    return new XTermsFilter(TypeFieldMapper.NAME,typesBytes);
  }
 else {
    XBooleanFilter bool=new XBooleanFilter();
    for (    String type : types) {
      DocumentMapper docMapper=documentMapper(type);
      if (docMapper == null) {
        bool.add(new FilterClause(new TermFilter(new Term(TypeFieldMapper.NAME,type)),BooleanClause.Occur.SHOULD));
      }
 else {
        bool.add(new FilterClause(docMapper.typeFilter(),BooleanClause.Occur.SHOULD));
      }
    }
    return bool;
  }
}
