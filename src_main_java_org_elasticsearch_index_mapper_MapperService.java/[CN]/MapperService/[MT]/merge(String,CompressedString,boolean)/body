{
  if (DEFAULT_MAPPING.equals(type)) {
    DocumentMapper mapper=documentParser.parseCompressed(type,mappingSource);
    mappingLock.writeLock().lock();
    try {
      mappers=newMapBuilder(mappers).put(type,mapper).map();
    }
  finally {
      mappingLock.writeLock().unlock();
    }
    try {
      defaultMappingSource=mappingSource.string();
    }
 catch (    IOException e) {
      throw new ElasticsearchGenerationException("failed to un-compress",e);
    }
    return mapper;
  }
 else {
    return merge(parse(type,mappingSource,applyDefault));
  }
}
