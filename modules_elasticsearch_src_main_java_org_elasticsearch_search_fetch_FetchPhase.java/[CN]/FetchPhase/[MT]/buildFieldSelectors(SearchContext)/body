{
  if (context.hasScriptFields() && !context.hasFieldNames()) {
    return UidFieldSelector.INSTANCE;
  }
  if (!context.hasFieldNames()) {
    return new UidAndSourceFieldSelector();
  }
  if (context.fieldNames().isEmpty()) {
    return UidFieldSelector.INSTANCE;
  }
  if (context.fieldNames().get(0).equals("*")) {
    return AllButSourceFieldSelector.INSTANCE;
  }
  FieldMappersFieldSelector fieldSelector=new FieldMappersFieldSelector();
  for (  String fieldName : context.fieldNames()) {
    FieldMappers x=context.mapperService().smartNameFieldMappers(fieldName);
    if (x == null) {
      throw new FetchPhaseExecutionException(context,"No mapping for field [" + fieldName + "]");
    }
    fieldSelector.add(x);
  }
  fieldSelector.add(UidFieldMapper.NAME);
  return fieldSelector;
}
