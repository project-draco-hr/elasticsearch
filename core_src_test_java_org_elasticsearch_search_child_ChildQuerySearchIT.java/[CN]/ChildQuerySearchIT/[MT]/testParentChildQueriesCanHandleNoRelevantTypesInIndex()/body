{
  assertAcked(prepareCreate("test").addMapping("parent").addMapping("child","_parent","type=parent"));
  ensureGreen();
  SearchResponse response=client().prepareSearch("test").setQuery(QueryBuilders.hasChildQuery("child",matchQuery("text","value"))).get();
  assertNoFailures(response);
  assertThat(response.getHits().totalHits(),equalTo(0L));
  client().prepareIndex("test","child1").setSource(jsonBuilder().startObject().field("text","value").endObject()).setRefresh(true).get();
  response=client().prepareSearch("test").setQuery(QueryBuilders.hasChildQuery("child",matchQuery("text","value"))).get();
  assertNoFailures(response);
  assertThat(response.getHits().totalHits(),equalTo(0L));
  response=client().prepareSearch("test").setQuery(QueryBuilders.hasChildQuery("child",matchQuery("text","value")).scoreMode(ScoreMode.Max)).get();
  assertNoFailures(response);
  assertThat(response.getHits().totalHits(),equalTo(0L));
  response=client().prepareSearch("test").setQuery(QueryBuilders.hasParentQuery("child",matchQuery("text","value"))).get();
  assertNoFailures(response);
  assertThat(response.getHits().totalHits(),equalTo(0L));
  response=client().prepareSearch("test").setQuery(QueryBuilders.hasParentQuery("child",matchQuery("text","value")).score(true)).get();
  assertNoFailures(response);
  assertThat(response.getHits().totalHits(),equalTo(0L));
}
