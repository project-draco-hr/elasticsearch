{
  Index index=new Index("test");
  Settings settings=settingsBuilder().put(IndexMetaData.SETTING_VERSION_CREATED,Version.CURRENT).put("index.analysis.char_filter.my_mapping.type","mapping").putArray("index.analysis.char_filter.my_mapping.mappings","ph=>f","qu=>q").put("index.analysis.analyzer.custom_with_char_filter.tokenizer","standard").putArray("index.analysis.analyzer.custom_with_char_filter.char_filter","my_mapping").put(Environment.PATH_HOME_SETTING.getKey(),createTempDir().toString()).build();
  IndexSettings idxSettings=IndexSettingsModule.newIndexSettings(index,settings);
  AnalysisService analysisService=new AnalysisRegistry(null,new Environment(settings)).build(idxSettings);
  NamedAnalyzer analyzer1=analysisService.analyzer("custom_with_char_filter");
  assertTokenStreamContents(analyzer1.tokenStream("test","jeff quit phish"),new String[]{"jeff","qit","fish"});
  assertTokenStreamContents(analyzer1.tokenStream("test","jeff quit phish"),new String[]{"jeff","qit","fish"});
}
