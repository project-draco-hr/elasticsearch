{
  String customDataDir=indexSettings.get(IndexMetaData.SETTING_DATA_PATH);
  if (customDataDir != null) {
    if (customPathsEnabled == false) {
      throw new ElasticsearchIllegalArgumentException("custom data_paths for indices is disabled");
    }
    if (addNodeId) {
      return Paths.get(customDataDir,Integer.toString(this.localNodeId),shardId.index().name(),Integer.toString(shardId.id()));
    }
 else {
      return Paths.get(customDataDir,shardId.index().name(),Integer.toString(shardId.id()));
    }
  }
 else {
    return null;
  }
}
