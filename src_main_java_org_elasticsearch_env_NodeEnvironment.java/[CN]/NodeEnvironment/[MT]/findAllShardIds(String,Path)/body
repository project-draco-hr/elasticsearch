{
  final Set<ShardId> shardIds=Sets.newHashSet();
  for (  final Path location : locations) {
    if (Files.exists(location) && Files.isDirectory(location)) {
      try (DirectoryStream<Path> indexStream=Files.newDirectoryStream(location)){
        for (        Path indexPath : indexStream) {
          if (index == null || index.equals(indexPath.getFileName().toString())) {
            shardIds.addAll(findAllShardsForIndex(indexPath));
          }
        }
      }
     }
  }
  return shardIds;
}
