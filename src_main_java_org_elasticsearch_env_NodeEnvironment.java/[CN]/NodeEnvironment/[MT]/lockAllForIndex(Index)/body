{
  Set<ShardId> allShardIds=findAllShardIds(index);
  List<ShardLock> allLocks=new ArrayList<>();
  boolean success=false;
  try {
    for (    ShardId shardId : allShardIds) {
      allLocks.add(shardLock(shardId));
    }
    success=true;
  }
  finally {
    if (success == false) {
      IOUtils.closeWhileHandlingException(allLocks);
    }
  }
  return allLocks;
}
