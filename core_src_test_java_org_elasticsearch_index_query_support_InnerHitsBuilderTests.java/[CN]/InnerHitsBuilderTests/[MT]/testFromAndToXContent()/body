{
  QueryParseContext context=new QueryParseContext(indicesQueriesRegistry);
  context.parseFieldMatcher(new ParseFieldMatcher(Settings.EMPTY));
  for (int runs=0; runs < NUMBER_OF_TESTBUILDERS; runs++) {
    InnerHitsBuilder innerHits=randomInnerHits();
    XContentBuilder builder=XContentFactory.contentBuilder(randomFrom(XContentType.values()));
    if (randomBoolean()) {
      builder.prettyPrint();
    }
    innerHits.toXContent(builder,ToXContent.EMPTY_PARAMS);
    XContentParser parser=XContentHelper.createParser(builder.bytes());
    context.reset(parser);
    parser.nextToken();
    InnerHitsBuilder secondInnerHits=InnerHitsBuilder.fromXContent(parser,context);
    assertThat(innerHits,not(sameInstance(secondInnerHits)));
    assertThat(innerHits,equalTo(secondInnerHits));
    assertThat(innerHits.hashCode(),equalTo(secondInnerHits.hashCode()));
  }
}
