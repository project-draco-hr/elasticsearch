{
  indexSingleDocumentWithStringFieldsGeneratedFromText(true,randomBoolean());
  String[] fieldsList={"_all"};
  String[] alwaysNotStoredFieldsList={"_field_names"};
  assertGetFieldsNull(indexOrAlias(),"doc","1",fieldsList);
  assertGetFieldsException(indexOrAlias(),"doc","1",fieldsList);
  assertGetFieldsNull(indexOrAlias(),"doc","1",alwaysNotStoredFieldsList);
  refresh();
  assertGetFieldsAlwaysWorks(indexOrAlias(),"doc","1",fieldsList);
  assertGetFieldsNull(indexOrAlias(),"doc","1",alwaysNotStoredFieldsList);
  flush();
  assertGetFieldsAlwaysWorks(indexOrAlias(),"doc","1",fieldsList);
  assertGetFieldsNull(indexOrAlias(),"doc","1",alwaysNotStoredFieldsList);
}
