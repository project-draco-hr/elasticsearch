{
  StreamInput stream=new BytesStreamInput(data);
  stream=HandlesStreamInput.Cached.cached(stream);
  try {
    long requestId=stream.readLong();
    byte status=stream.readByte();
    boolean isRequest=isRequest(status);
    if (isRequest) {
      handleRequest(stream,requestId,sourceTransport);
    }
 else {
      final TransportResponseHandler handler=transportServiceAdapter.remove(requestId);
      if (handler != null) {
        if (Transport.Helper.isError(status)) {
          handlerResponseError(stream,handler);
        }
 else {
          handleResponse(stream,handler);
        }
      }
    }
  }
 catch (  Exception e) {
    if (responseHandler != null) {
      responseHandler.handleException(new RemoteTransportException(nodeName(),localAddress,action,e));
    }
 else {
      logger.warn("Failed to receive message for action [" + action + "]",e);
    }
  }
}
