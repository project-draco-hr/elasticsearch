{
  ImmutableOpenMap.Builder<String,AliasMetaData> tmpAliases=aliases;
  Settings tmpSettings=settings;
  String[] legacyAliases=settings.getAsArray("index.aliases");
  if (legacyAliases.length > 0) {
    tmpAliases=ImmutableOpenMap.builder();
    for (    String alias : legacyAliases) {
      AliasMetaData aliasMd=AliasMetaData.newAliasMetaDataBuilder(alias).build();
      tmpAliases.put(alias,aliasMd);
    }
    tmpAliases.putAll(aliases);
    tmpSettings=ImmutableSettings.settingsBuilder().put(settings).putArray("index.aliases").build();
  }
  if (mappings.containsKey(MapperService.DEFAULT_MAPPING)) {
    MappingMetaData defaultMapping=mappings.get(MapperService.DEFAULT_MAPPING);
    for (    ObjectCursor<MappingMetaData> cursor : mappings.values()) {
      cursor.value.updateDefaultMapping(defaultMapping);
    }
  }
  return new IndexMetaData(index,version,state,tmpSettings,mappings.build(),tmpAliases.build(),customs.build());
}
