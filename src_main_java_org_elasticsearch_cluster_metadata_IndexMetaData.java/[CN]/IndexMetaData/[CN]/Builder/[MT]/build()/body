{
  MapBuilder<String,AliasMetaData> tmpAliases=aliases;
  Settings tmpSettings=settings;
  String[] legacyAliases=settings.getAsArray("index.aliases");
  if (legacyAliases.length > 0) {
    tmpAliases=MapBuilder.newMapBuilder();
    for (    String alias : legacyAliases) {
      AliasMetaData aliasMd=AliasMetaData.newAliasMetaDataBuilder(alias).build();
      tmpAliases.put(alias,aliasMd);
    }
    tmpAliases.putAll(aliases.immutableMap());
    tmpSettings=ImmutableSettings.settingsBuilder().put(settings).putArray("index.aliases").build();
  }
  if (mappings.containsKey(MapperService.DEFAULT_MAPPING)) {
    MappingMetaData defaultMapping=mappings.get(MapperService.DEFAULT_MAPPING);
    for (    MappingMetaData mappingMetaData : mappings.map().values()) {
      mappingMetaData.updateDefaultMapping(defaultMapping);
    }
  }
  return new IndexMetaData(index,version,state,tmpSettings,mappings.immutableMap(),tmpAliases.immutableMap(),customs.immutableMap());
}
