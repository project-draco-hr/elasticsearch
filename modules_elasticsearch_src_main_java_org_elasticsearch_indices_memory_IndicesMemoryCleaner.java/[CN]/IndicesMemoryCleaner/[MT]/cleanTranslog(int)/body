{
  int totalShards=0;
  int cleanedShards=0;
  long cleaned=0;
  for (  IndexService indexService : indicesService) {
    for (    IndexShard indexShard : indexService) {
      if (indexShard.state() != IndexShardState.STARTED) {
        continue;
      }
      totalShards++;
      Translog translog=((InternalIndexShard)indexShard).translog();
      if (translog.size() > translogNumberOfOperationsThreshold) {
        try {
          indexShard.flush(new Engine.Flush());
          cleanedShards++;
          cleaned=indexShard.estimateFlushableMemorySize().bytes();
        }
 catch (        FlushNotAllowedEngineException e) {
        }
      }
    }
  }
  return new TranslogCleanResult(totalShards,cleanedShards,new ByteSizeValue(cleaned,ByteSizeUnit.BYTES));
}
