{
  Throwable e=unwrap(t,InternalException.class);
  assertThat("expected action [" + action + "] to throw an internal exception",e,notNullValue());
  assertThat(action,equalTo(((InternalException)e).action));
  Map<String,Object> headers=((InternalException)e).headers;
  assertThat(headers,notNullValue());
  assertThat(headers.size(),is(2));
  assertThat(headers.get("key1"),notNullValue());
  assertThat(headers.get("key1").toString(),equalTo("val1"));
  assertThat(headers.get("key2"),notNullValue());
  assertThat(headers.get("key2").toString(),equalTo("val 2"));
}
