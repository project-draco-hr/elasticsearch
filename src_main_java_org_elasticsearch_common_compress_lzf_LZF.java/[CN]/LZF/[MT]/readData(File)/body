{
  int len=(int)in.length();
  byte[] result=new byte[len];
  int offset=0;
  FileInputStream fis=new FileInputStream(in);
  while (len > 0) {
    int count=fis.read(result,offset,len);
    if (count < 0)     break;
    len-=count;
    offset+=count;
  }
  fis.close();
  if (len > 0) {
    throw new IOException("Could not read the whole file -- received EOF when there was " + len + " bytes left to read");
  }
  return result;
}
