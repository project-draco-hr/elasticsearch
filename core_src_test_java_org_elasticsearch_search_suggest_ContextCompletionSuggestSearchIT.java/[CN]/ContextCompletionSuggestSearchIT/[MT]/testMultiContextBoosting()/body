{
  LinkedHashMap<String,ContextMapping> map=new LinkedHashMap<>();
  map.put("cat",ContextBuilder.category("cat").field("cat").build());
  map.put("type",ContextBuilder.category("type").field("type").build());
  final CompletionMappingBuilder mapping=new CompletionMappingBuilder().context(map);
  createIndexAndMapping(mapping);
  int numDocs=10;
  List<IndexRequestBuilder> indexRequestBuilders=new ArrayList<>();
  for (int i=0; i < numDocs; i++) {
    XContentBuilder source=jsonBuilder().startObject().startObject(FIELD).field("input","suggestion" + i).field("weight",i + 1).endObject().field("cat","cat" + i % 2).field("type","type" + i % 4).endObject();
    indexRequestBuilders.add(client().prepareIndex(INDEX,TYPE,"" + i).setSource(source));
  }
  indexRandom(true,indexRequestBuilders);
  ensureYellow(INDEX);
  CompletionSuggestionBuilder catBoostSuggest=SuggestBuilders.completionSuggestion("foo").field(FIELD).prefix("sugg");
  catBoostSuggest.categoryContexts("cat",CategoryQueryContext.builder().setCategory("cat0").setBoost(3).build(),CategoryQueryContext.builder().setCategory("cat1").build());
  assertSuggestions("foo",catBoostSuggest,"suggestion8","suggestion6","suggestion4","suggestion9","suggestion2");
  CompletionSuggestionBuilder typeBoostSuggest=SuggestBuilders.completionSuggestion("foo").field(FIELD).prefix("sugg");
  typeBoostSuggest.categoryContexts("type",CategoryQueryContext.builder().setCategory("type2").setBoost(2).build(),CategoryQueryContext.builder().setCategory("type1").setBoost(4).build());
  assertSuggestions("foo",typeBoostSuggest,"suggestion9","suggestion5","suggestion6","suggestion1","suggestion2");
  CompletionSuggestionBuilder multiContextBoostSuggest=SuggestBuilders.completionSuggestion("foo").field(FIELD).prefix("sugg");
  if (randomBoolean()) {
    multiContextBoostSuggest.categoryContexts("type",CategoryQueryContext.builder().setCategory("type2").setBoost(2).build(),CategoryQueryContext.builder().setCategory("type1").setBoost(4).build());
    multiContextBoostSuggest.categoryContexts("cat",CategoryQueryContext.builder().setCategory("cat0").setBoost(3).build(),CategoryQueryContext.builder().setCategory("cat1").build());
  }
 else {
    multiContextBoostSuggest.categoryContexts("cat",CategoryQueryContext.builder().setCategory("cat0").setBoost(3).build(),CategoryQueryContext.builder().setCategory("cat1").build());
    multiContextBoostSuggest.categoryContexts("type",CategoryQueryContext.builder().setCategory("type2").setBoost(2).build(),CategoryQueryContext.builder().setCategory("type1").setBoost(4).build());
  }
  assertSuggestions("foo",multiContextBoostSuggest,"suggestion9","suggestion6","suggestion5","suggestion2","suggestion1");
}
