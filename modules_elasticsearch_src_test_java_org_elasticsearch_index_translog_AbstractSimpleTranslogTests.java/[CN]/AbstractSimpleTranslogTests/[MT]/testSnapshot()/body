{
  Translog.Snapshot snapshot=translog.snapshot();
  assertThat(snapshot,translogSize(0));
  snapshot.release();
  translog.add(new Translog.Create("test","1","{1}"));
  snapshot=translog.snapshot();
  assertThat(snapshot,translogSize(1));
  Translog.Create create=(Translog.Create)snapshot.iterator().next();
  assertThat(create.source(),equalTo("{1}"));
  snapshot.release();
  translog.add(new Translog.Index("test","2","{2}"));
  snapshot=translog.snapshot(snapshot);
  assertThat(snapshot,translogSize(1));
  Translog.Index index=(Translog.Index)snapshot.iterator().next();
  assertThat(index.source(),equalTo("{2}"));
  snapshot.release();
}
