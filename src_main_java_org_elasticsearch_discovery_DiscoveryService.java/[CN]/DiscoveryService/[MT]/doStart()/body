{
  final CountDownLatch latch=new CountDownLatch(1);
  InitialStateDiscoveryListener listener=new InitialStateDiscoveryListener(){
    @Override public void initialStateProcessed(){
      latch.countDown();
    }
  }
;
  discovery.addListener(listener);
  try {
    discovery.start();
    if (initialStateTimeout.millis() > 0) {
      try {
        logger.trace("waiting for {} for the initial state to be set by the discovery",initialStateTimeout);
        if (latch.await(initialStateTimeout.millis(),TimeUnit.MILLISECONDS)) {
          logger.trace("initial state set from discovery");
          initialStateReceived=true;
        }
 else {
          initialStateReceived=false;
          logger.warn("waited for {} and no initial state was set by the discovery",initialStateTimeout);
        }
      }
 catch (      InterruptedException e) {
      }
    }
  }
  finally {
    discovery.removeListener(listener);
  }
  logger.info(discovery.nodeDescription());
}
