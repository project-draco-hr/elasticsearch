{
  byte[] result=new byte[calculateUncompressedSize(data,length)];
  int inPtr=0;
  int outPtr=0;
  while (inPtr < (length - 1)) {
    inPtr+=2;
    int type=data[inPtr++];
    int len=uint16(data,inPtr);
    inPtr+=2;
    if (type == LZFChunk.BLOCK_TYPE_NON_COMPRESSED) {
      System.arraycopy(data,inPtr,result,outPtr,len);
      outPtr+=len;
    }
 else {
      int uncompLen=uint16(data,inPtr);
      inPtr+=2;
      decompressChunk(data,inPtr,result,outPtr,outPtr + uncompLen);
      outPtr+=uncompLen;
    }
    inPtr+=len;
  }
  return result;
}
