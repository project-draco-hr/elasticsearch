{
  boolean cache=componentSettings.getAsBoolean("cache.enabled",false);
  if (!cache) {
    return null;
  }
  SizeValue bufferSize=componentSettings.getAsSize("cache.buffer_size",new SizeValue(100,SizeUnit.KB));
  SizeValue cacheSize=componentSettings.getAsSize("cache.cache_size",new SizeValue(20,SizeUnit.MB));
  boolean direct=componentSettings.getAsBoolean("cache.direct",true);
  boolean warmCache=componentSettings.getAsBoolean("cache.warm_cache",true);
  Directory memDir;
  if (direct) {
    memDir=new ByteBufferDirectory((int)bufferSize.bytes(),(int)cacheSize.bytes(),true,warmCache);
  }
 else {
    memDir=new HeapDirectory(bufferSize,cacheSize,warmCache);
  }
  String[] primaryExtensions=componentSettings.getAsArray("cache.extensions",new String[]{"","del","gen"});
  return new SwitchDirectory(ImmutableSet.of(primaryExtensions),memDir,fsDirectory,true);
}
