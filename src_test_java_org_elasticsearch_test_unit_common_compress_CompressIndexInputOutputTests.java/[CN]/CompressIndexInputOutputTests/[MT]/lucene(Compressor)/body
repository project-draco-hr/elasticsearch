{
  CompressedDirectory dir=new CompressedDirectory(new RAMDirectory(),compressor,false,"fdt");
  IndexWriter writer=new IndexWriter(dir,new IndexWriterConfig(Lucene.VERSION,Lucene.STANDARD_ANALYZER));
  writer.addDocument(createDoc(1,(int)SizeValue.parseSizeValue("100b").singles()));
  writer.addDocument(createDoc(2,(int)SizeValue.parseSizeValue("5k").singles()));
  writer.commit();
  writer.addDocument(createDoc(3,(int)SizeValue.parseSizeValue("2k").singles()));
  writer.addDocument(createDoc(4,(int)SizeValue.parseSizeValue("1k").singles()));
  writer.commit();
  verify(writer);
  writer.forceMerge(1);
  writer.waitForMerges();
  verify(writer);
  dir.setCompress(false);
  writer.addDocument(createDoc(5,(int)SizeValue.parseSizeValue("2k").singles()));
  writer.addDocument(createDoc(6,(int)SizeValue.parseSizeValue("1k").singles()));
  verify(writer);
  writer.forceMerge(1);
  writer.waitForMerges();
  verify(writer);
  writer.close();
}
