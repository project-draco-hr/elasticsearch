{
  Directory dir=new RAMDirectory();
  IndexOutput out=compressed ? compressor.indexOutput(dir.createOutput("test",IOContext.DEFAULT)) : dir.createOutput("test",IOContext.DEFAULT);
  long pos1=out.getFilePointer();
  out.writeVInt(4);
  out.writeInt(1);
  long pos2=out.getFilePointer();
  out.writeVInt(8);
  long posX=out.getFilePointer();
  out.writeInt(2);
  out.writeInt(3);
  long pos3=out.getFilePointer();
  out.writeVInt(4);
  out.writeInt(4);
  int size=50;
  long[] positions=new long[size];
  String[] data=new String[size];
  for (int i=0; i < 50; i++) {
    positions[i]=out.getFilePointer();
    data[i]=RandomStringGenerator.random(12345);
    out.writeString(data[i]);
  }
  out.close();
  IndexInput in=compressed ? compressor.indexInput(dir.openInput("test",IOContext.DEFAULT)) : dir.openInput("test",IOContext.DEFAULT);
  in.seek(pos2);
  int numBytes=in.readVInt();
  assertThat(in.getFilePointer(),equalTo(posX));
  in.seek(in.getFilePointer() + numBytes);
  assertThat(in.readVInt(),equalTo(4));
  assertThat(in.readInt(),equalTo(4));
  for (int i=0; i < size; i++) {
    in.seek(positions[i]);
    assertThat(in.getFilePointer(),equalTo(positions[i]));
    assertThat(in.readString(),equalTo(data[i]));
  }
}
