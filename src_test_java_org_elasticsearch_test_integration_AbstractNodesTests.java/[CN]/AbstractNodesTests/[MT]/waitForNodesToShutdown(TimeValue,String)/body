{
  long start=System.currentTimeMillis();
  Set<String> activeNodes=newHashSet(nodes);
  do {
    Thread.sleep(100);
    Iterator<String> nodeToCheck=activeNodes.iterator();
    while (nodeToCheck.hasNext()) {
      String id=nodeToCheck.next();
      if (node(id).isClosed()) {
        nodeToCheck.remove();
      }
 else {
        break;
      }
    }
  }
 while (!activeNodes.isEmpty() && (System.currentTimeMillis() - start) < timeout.millis());
  return activeNodes.isEmpty();
}
