{
  String settingsSource=getClass().getName().replace('.','/') + ".yml";
  Settings finalSettings=settingsBuilder().loadFromClasspath(settingsSource).put(defaultSettings).put(settings).put("name",id).build();
  if (finalSettings.get("gateway.type") == null) {
    finalSettings=settingsBuilder().put(finalSettings).put("gateway.type","none").build();
  }
  if (finalSettings.get("cluster.routing.schedule") != null) {
    finalSettings=settingsBuilder().put(finalSettings).put("cluster.routing.schedule","50ms").build();
  }
  Node node=nodeBuilder().settings(finalSettings).build();
  nodes.put(id,node);
  clients.put(id,node.client());
  return node;
}
