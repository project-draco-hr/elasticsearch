{
  long start=System.currentTimeMillis();
  ImmutableSet<ClusterBlock> blocks;
  do {
    blocks=client(node).admin().cluster().prepareState().setLocal(true).execute().actionGet().getState().blocks().global(ClusterBlockLevel.METADATA);
  }
 while (!blocks.isEmpty() && (System.currentTimeMillis() - start) < timeout.millis());
  return blocks;
}
