{
  byte[] result=targetBuffer;
  int inPtr=0;
  int outPtr=0;
  while (inPtr < (sourceBuffer.length - 1)) {
    inPtr+=2;
    int type=sourceBuffer[inPtr++];
    int len=uint16(sourceBuffer,inPtr);
    inPtr+=2;
    if (type == LZFChunk.BLOCK_TYPE_NON_COMPRESSED) {
      System.arraycopy(sourceBuffer,inPtr,result,outPtr,len);
      outPtr+=len;
    }
 else {
      int uncompLen=uint16(sourceBuffer,inPtr);
      inPtr+=2;
      decompressChunk(sourceBuffer,inPtr,result,outPtr,outPtr + uncompLen);
      outPtr+=uncompLen;
    }
    inPtr+=len;
  }
  return outPtr;
}
