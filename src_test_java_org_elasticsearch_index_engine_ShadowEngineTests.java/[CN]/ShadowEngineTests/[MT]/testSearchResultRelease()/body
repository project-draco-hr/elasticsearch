{
  Engine.Searcher searchResult=replicaEngine.acquireSearcher("test");
  MatcherAssert.assertThat(searchResult,EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));
  searchResult.close();
  ParsedDocument doc=testParsedDocument("1","1","test",null,-1,-1,testDocumentWithTextField(),B_1,null);
  primaryEngine.create(new Engine.Create(null,newUid("1"),doc));
  searchResult=primaryEngine.acquireSearcher("test");
  MatcherAssert.assertThat(searchResult,EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));
  MatcherAssert.assertThat(searchResult,EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term("value","test")),0));
  searchResult.close();
  searchResult=replicaEngine.acquireSearcher("test");
  MatcherAssert.assertThat(searchResult,EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));
  MatcherAssert.assertThat(searchResult,EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term("value","test")),0));
  searchResult.close();
  primaryEngine.flush();
  primaryEngine.refresh("test");
  replicaEngine.refresh("test");
  searchResult=primaryEngine.acquireSearcher("test");
  MatcherAssert.assertThat(searchResult,EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));
  MatcherAssert.assertThat(searchResult,EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term("value","test")),1));
  searchResult.close();
  searchResult=replicaEngine.acquireSearcher("test");
  MatcherAssert.assertThat(searchResult,EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));
  MatcherAssert.assertThat(searchResult,EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term("value","test")),1));
  primaryEngine.delete(new Engine.Delete("test","1",newUid("1")));
  primaryEngine.flush();
  primaryEngine.refresh("test");
  replicaEngine.refresh("test");
  Engine.Searcher updateSearchResult=primaryEngine.acquireSearcher("test");
  MatcherAssert.assertThat(updateSearchResult,EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));
  updateSearchResult.close();
  MatcherAssert.assertThat(searchResult,EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));
  MatcherAssert.assertThat(searchResult,EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term("value","test")),1));
  searchResult.close();
}
