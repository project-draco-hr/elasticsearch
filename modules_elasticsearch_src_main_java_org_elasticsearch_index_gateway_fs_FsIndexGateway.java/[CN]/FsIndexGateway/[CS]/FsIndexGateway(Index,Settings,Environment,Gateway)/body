{
  super(index,indexSettings);
  this.environment=environment;
  this.gateway=gateway;
  String location=componentSettings.get("location");
  if (location == null) {
    if (gateway instanceof FsGateway) {
      indexGatewayHome=new File(((FsGateway)gateway).gatewayHome(),index().name());
    }
 else {
      indexGatewayHome=new File(new File(environment.workWithClusterFile(),"gateway"),index().name());
    }
    location=Strings.cleanPath(indexGatewayHome.getAbsolutePath());
  }
 else {
    indexGatewayHome=new File(location);
  }
  this.location=location;
  if (!(indexGatewayHome.exists() && indexGatewayHome.isDirectory())) {
    boolean result;
    for (int i=0; i < 5; i++) {
      result=indexGatewayHome.mkdirs();
      if (result) {
        break;
      }
    }
  }
  if (!(indexGatewayHome.exists() && indexGatewayHome.isDirectory())) {
    throw new IndexException(index,"Failed to create index gateway at [" + indexGatewayHome + "]");
  }
}
