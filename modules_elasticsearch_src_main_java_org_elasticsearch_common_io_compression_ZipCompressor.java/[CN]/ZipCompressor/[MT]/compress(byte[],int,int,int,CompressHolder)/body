{
  ch.deflater.reset();
  ch.deflater.setLevel(compressionLevel);
  ch.deflater.setInput(value,offset,length);
  ch.deflater.finish();
  final byte[] buf=ch.buffer;
  while (!ch.deflater.finished()) {
    int count=ch.deflater.deflate(buf);
    ch.bos.write(buf,0,count);
  }
  return ch.bos.copiedByteArray();
}
