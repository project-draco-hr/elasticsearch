{
  client.admin().indices().prepareDelete().execute().actionGet();
  client.admin().indices().preparePutTemplate("template_1").setSource("{\n" + "    \"template\" : \"*\",\n" + "    \"warmers\" : {\n"+ "        \"warmer_1\" : {\n"+ "            \"types\" : [],\n"+ "            \"source\" : {\n"+ "                \"query\" : {\n"+ "                    \"match_all\" : {}\n"+ "                }\n"+ "            }\n"+ "        }\n"+ "    }\n"+ "}").execute().actionGet();
  client.admin().indices().prepareCreate("test").setSettings(ImmutableSettings.settingsBuilder().put("index.number_of_shards",1)).execute().actionGet();
  client.admin().cluster().prepareHealth().setWaitForGreenStatus().execute().actionGet();
  ClusterState clusterState=client.admin().cluster().prepareState().execute().actionGet().getState();
  IndexWarmersMetaData warmersMetaData=clusterState.metaData().index("test").custom(IndexWarmersMetaData.TYPE);
  assertThat(warmersMetaData,Matchers.notNullValue());
  assertThat(warmersMetaData.entries().size(),equalTo(1));
  client.prepareIndex("test","type1","1").setSource("field","value1").setRefresh(true).execute().actionGet();
  client.prepareIndex("test","type1","2").setSource("field","value2").setRefresh(true).execute().actionGet();
}
