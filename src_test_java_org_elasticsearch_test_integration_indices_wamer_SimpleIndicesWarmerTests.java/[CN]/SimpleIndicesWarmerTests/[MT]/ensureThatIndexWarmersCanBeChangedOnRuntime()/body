{
  client().admin().indices().prepareDelete().execute().actionGet();
  client().admin().indices().prepareCreate("test").setSettings(ImmutableSettings.settingsBuilder().put("index.number_of_shards",1,"index.number_of_replicas",0)).execute().actionGet();
  client().admin().cluster().prepareHealth("test").setWaitForGreenStatus().execute().actionGet();
  client().admin().indices().preparePutWarmer("custom_warmer").setSearchRequest(client().prepareSearch("test").setTypes("test").setQuery(QueryBuilders.matchAllQuery())).execute().actionGet();
  client().prepareIndex("test","test","1").setSource("foo","bar").setRefresh(true).execute().actionGet();
  client().admin().indices().prepareUpdateSettings("test").setSettings(ImmutableSettings.builder().put("index.warmer.enabled",false)).execute().actionGet();
  long warmerRunsAfterDisabling=getWarmerRuns();
  assertThat(getWarmerRuns(),greaterThanOrEqualTo(1L));
  client().prepareIndex("test","test","2").setSource("foo2","bar2").setRefresh(true).execute().actionGet();
  assertThat(getWarmerRuns(),equalTo(warmerRunsAfterDisabling));
}
