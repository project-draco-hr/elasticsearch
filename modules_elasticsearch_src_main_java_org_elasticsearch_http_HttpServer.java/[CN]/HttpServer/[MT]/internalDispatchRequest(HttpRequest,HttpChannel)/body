{
  final HttpServerHandler httpHandler=getHandler(request);
  if (httpHandler == null) {
    if (!restController.dispatchRequest(request,channel)) {
      if (request.method() == RestRequest.Method.OPTIONS) {
        StringRestResponse response=new StringRestResponse(OK);
        channel.sendResponse(response);
      }
 else {
        channel.sendResponse(new StringRestResponse(BAD_REQUEST,"No handler found for uri [" + request.uri() + "] and method ["+ request.method()+ "]"));
      }
    }
  }
 else {
    if (httpHandler.spawn()) {
      threadPool.execute(new Runnable(){
        @Override public void run(){
          try {
            httpHandler.handleRequest(request,channel);
          }
 catch (          Exception e) {
            try {
              channel.sendResponse(new XContentThrowableRestResponse(request,e));
            }
 catch (            IOException e1) {
              logger.error("Failed to send failure response for uri [" + request.uri() + "]",e1);
            }
          }
        }
      }
);
    }
 else {
      try {
        httpHandler.handleRequest(request,channel);
      }
 catch (      Exception e) {
        try {
          channel.sendResponse(new XContentThrowableRestResponse(request,e));
        }
 catch (        IOException e1) {
          logger.error("Failed to send failure response for uri [" + request.uri() + "]",e1);
        }
      }
    }
  }
}
