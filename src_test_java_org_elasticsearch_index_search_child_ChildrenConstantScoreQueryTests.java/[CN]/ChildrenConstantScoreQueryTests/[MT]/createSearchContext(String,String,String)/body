{
  final Index index=new Index(indexName);
  final IdCache idCache=new SimpleIdCache(index,ImmutableSettings.EMPTY);
  final CacheRecycler cacheRecycler=new CacheRecycler(ImmutableSettings.EMPTY);
  MapperService mapperService=new MapperService(index,ImmutableSettings.EMPTY,new Environment(),new AnalysisService(index),null,null,null);
  mapperService.merge(childType,PutMappingRequest.buildFromSimplifiedDef(childType,"_parent","type=" + parentType).string(),true);
  final IndexService indexService=new SimpleIdCacheTests.StubIndexService(mapperService);
  idCache.setIndexService(indexService);
  return new TestSearchContext(cacheRecycler,idCache,indexService);
}
