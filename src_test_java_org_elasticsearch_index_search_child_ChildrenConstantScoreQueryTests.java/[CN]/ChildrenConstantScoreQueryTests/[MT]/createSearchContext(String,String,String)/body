{
  final Index index=new Index(indexName);
  final IdCache idCache=new SimpleIdCache(index,ImmutableSettings.EMPTY);
  final CacheRecycler cacheRecycler=new CacheRecycler(ImmutableSettings.EMPTY);
  final PageCacheRecycler pageCacheRecycler=new PageCacheRecycler(ImmutableSettings.EMPTY,new ThreadPool());
  Settings settings=ImmutableSettings.EMPTY;
  MapperService mapperService=MapperTestUtils.newMapperService(index,settings);
  final IndexService indexService=new SimpleIdCacheTests.StubIndexService(mapperService);
  idCache.setIndexService(indexService);
  mapperService.merge(childType,new CompressedString(PutMappingRequest.buildFromSimplifiedDef(childType,"_parent","type=" + parentType).string()),true);
  ThreadPool threadPool=new ThreadPool();
  NodeSettingsService nodeSettingsService=new NodeSettingsService(settings);
  IndicesFilterCache indicesFilterCache=new IndicesFilterCache(settings,threadPool,cacheRecycler,nodeSettingsService);
  WeightedFilterCache filterCache=new WeightedFilterCache(index,settings,indicesFilterCache);
  return new TestSearchContext(cacheRecycler,pageCacheRecycler,idCache,indexService,filterCache);
}
