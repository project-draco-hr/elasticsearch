{
  final Index index=new Index(indexName);
  final CacheRecycler cacheRecycler=new CacheRecycler(ImmutableSettings.EMPTY);
  ThreadPool threadPool=new ThreadPool();
  final PageCacheRecycler pageCacheRecycler=new PageCacheRecycler(ImmutableSettings.EMPTY,threadPool);
  final BigArrays bigArrays=new BigArrays(ImmutableSettings.EMPTY,pageCacheRecycler);
  Settings settings=ImmutableSettings.EMPTY;
  MapperService mapperService=MapperTestUtils.newMapperService(index,settings);
  IndexFieldDataService indexFieldDataService=new IndexFieldDataService(index,new DummyCircuitBreakerService());
  final IndexService indexService=new StubIndexService(mapperService);
  indexFieldDataService.setIndexService(indexService);
  mapperService.merge(childType,new CompressedString(PutMappingRequest.buildFromSimplifiedDef(childType,"_parent","type=" + parentType).string()),true);
  NodeSettingsService nodeSettingsService=new NodeSettingsService(settings);
  IndicesFilterCache indicesFilterCache=new IndicesFilterCache(settings,threadPool,cacheRecycler,nodeSettingsService);
  WeightedFilterCache filterCache=new WeightedFilterCache(index,settings,indicesFilterCache);
  return new TestSearchContext(cacheRecycler,pageCacheRecycler,bigArrays,indexService,filterCache,indexFieldDataService);
}
