{
  final Index index=new Index(indexName);
  final IdCache idCache=new SimpleIdCache(index,ImmutableSettings.EMPTY);
  final CacheRecycler cacheRecycler=new CacheRecycler(ImmutableSettings.EMPTY);
  Settings settings=ImmutableSettings.EMPTY;
  MapperService mapperService=new MapperService(index,settings,new Environment(),new AnalysisService(index),null,null,null);
  mapperService.merge(childType,new CompressedString(PutMappingRequest.buildFromSimplifiedDef(childType,"_parent","type=" + parentType).string()),true);
  final IndexService indexService=new SimpleIdCacheTests.StubIndexService(mapperService);
  idCache.setIndexService(indexService);
  ThreadPool threadPool=new ThreadPool();
  NodeSettingsService nodeSettingsService=new NodeSettingsService(settings);
  IndicesFilterCache indicesFilterCache=new IndicesFilterCache(settings,threadPool,cacheRecycler,nodeSettingsService);
  WeightedFilterCache filterCache=new WeightedFilterCache(index,settings,indicesFilterCache);
  return new TestSearchContext(cacheRecycler,idCache,indexService,filterCache);
}
