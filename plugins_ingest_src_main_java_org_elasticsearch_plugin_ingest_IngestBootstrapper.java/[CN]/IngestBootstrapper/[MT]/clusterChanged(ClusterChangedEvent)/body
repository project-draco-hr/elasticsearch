{
  ClusterState state=event.state();
  if (state.blocks().hasGlobalBlock(GatewayService.STATE_NOT_RECOVERED_BLOCK)) {
    return;
  }
  if (pipelineStore.isStarted()) {
    if (validClusterState(state) == false) {
      stopPipelineStore("cluster state invalid [" + state + "]");
    }
    if (isIngestTemplateInstallationRequired(state.metaData())) {
      forkAndInstallIngestIndexTemplate();
    }
  }
 else {
    if (validClusterState(state)) {
      startPipelineStore(state.metaData());
    }
  }
}
