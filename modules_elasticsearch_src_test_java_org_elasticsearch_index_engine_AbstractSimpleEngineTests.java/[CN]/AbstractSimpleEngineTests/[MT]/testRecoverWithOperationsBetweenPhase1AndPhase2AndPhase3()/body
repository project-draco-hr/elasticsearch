{
  engine.create(new Engine.Create(doc().add(field("_uid","1")).add(field("value","test")).build(),Lucene.STANDARD_ANALYZER,"test","1","{1}"));
  engine.flush(new Engine.Flush());
  engine.create(new Engine.Create(doc().add(field("_uid","2")).add(field("value","test")).build(),Lucene.STANDARD_ANALYZER,"test","2","{2}"));
  engine.recover(new Engine.RecoveryHandler(){
    @Override public void phase1(    SnapshotIndexCommit snapshot) throws EngineException {
    }
    @Override public void phase2(    Translog.Snapshot snapshot) throws EngineException {
      assertThat(snapshot,translogSize(1));
      Translog.Create create=(Translog.Create)snapshot.iterator().next();
      assertThat(create.source(),equalTo("{2}"));
      engine.create(new Engine.Create(doc().add(field("_uid","3")).add(field("value","test")).build(),Lucene.STANDARD_ANALYZER,"test","3","{3}"));
    }
    @Override public void phase3(    Translog.Snapshot snapshot) throws EngineException {
      assertThat(snapshot,translogSize(1));
      Translog.Create create=(Translog.Create)snapshot.iterator().next();
      assertThat(create.source(),equalTo("{3}"));
    }
  }
);
  engine.flush(new Engine.Flush());
  engine.close();
}
