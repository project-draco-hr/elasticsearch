{
  Engine.Searcher searchResult=engine.searcher();
  assertThat(searchResult,engineSearcherTotalHits(0));
  searchResult.release();
  List<Engine.Operation> ops=Lists.newArrayList();
  ParsedDocument doc=new ParsedDocument("1","1","test",null,doc().add(uidField("1")).add(field("value","1_test")).build(),Lucene.STANDARD_ANALYZER,B_1,false);
  ops.add(new Engine.Create(newUid("1"),doc));
  doc=new ParsedDocument("2","2","test",null,doc().add(uidField("2")).add(field("value","2_test")).build(),Lucene.STANDARD_ANALYZER,B_2,false);
  ops.add(new Engine.Create(newUid("2"),doc));
  doc=new ParsedDocument("3","3","test",null,doc().add(uidField("3")).add(field("value","3_test")).build(),Lucene.STANDARD_ANALYZER,B_3,false);
  ops.add(new Engine.Create(newUid("3"),doc));
  doc=new ParsedDocument("1","1","test",null,doc().add(uidField("1")).add(field("value","1_test1")).build(),Lucene.STANDARD_ANALYZER,B_1,false);
  ops.add(new Engine.Index(newUid("1"),doc));
  ops.add(new Engine.Delete("test","2",newUid("2")));
  EngineException[] failures=engine.bulk(new Engine.Bulk(ops.toArray(new Engine.Operation[ops.size()])));
  assertThat(failures,nullValue());
  engine.refresh(new Engine.Refresh(true));
  searchResult=engine.searcher();
  assertThat(searchResult,engineSearcherTotalHits(2));
  assertThat(searchResult,engineSearcherTotalHits(new TermQuery(newUid("1")),1));
  assertThat(searchResult,engineSearcherTotalHits(new TermQuery(newUid("2")),0));
  assertThat(searchResult,engineSearcherTotalHits(new TermQuery(newUid("3")),1));
  assertThat(searchResult,engineSearcherTotalHits(new TermQuery(new Term("value","1_test")),0));
  assertThat(searchResult,engineSearcherTotalHits(new TermQuery(new Term("value","1_test1")),1));
  searchResult.release();
}
