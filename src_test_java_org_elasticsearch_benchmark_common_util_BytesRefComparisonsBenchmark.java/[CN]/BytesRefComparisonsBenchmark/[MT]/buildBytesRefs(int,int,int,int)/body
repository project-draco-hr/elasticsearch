{
  final BytesRef[] uniqueRefs=new BytesRef[uniqueCount];
  for (int i=0; i < uniqueCount; ++i) {
    final int len=RandomInts.randomIntBetween(R,minLen,maxLen);
    final byte[] bytes=new byte[len];
    for (int j=0; j < bytes.length; ++j) {
      bytes[j]=(byte)R.nextInt(2);
    }
    uniqueRefs[i]=new BytesRef(bytes);
  }
  final BytesRef[] result=new BytesRef[count];
  for (int i=0; i < count; ++i) {
    result[i]=RandomPicks.randomFrom(R,uniqueRefs);
  }
  int totalLen=0;
  for (  BytesRef b : result) {
    totalLen+=b.length;
  }
  final byte[] data=new byte[totalLen];
  int offset=0;
  for (int i=0; i < count; ++i) {
    final BytesRef b=result[i];
    System.arraycopy(b.bytes,b.offset,data,offset,b.length);
    result[i]=new BytesRef(data,offset,b.length);
    offset+=b.length;
  }
  if (offset != totalLen) {
    throw new AssertionError();
  }
  return result;
}
