{
  if (deleted.get()) {
    final Settings indexSettings=settingsService.getSettings();
    try {
      if (ownsShard) {
        try {
          eventListener.beforeIndexShardDeleted(lock.getShardId(),indexSettings);
        }
  finally {
          indicesServices.deleteShardStore("delete index",lock,indexSettings);
          eventListener.afterIndexShardDeleted(lock.getShardId(),indexSettings);
        }
      }
    }
 catch (    IOException e) {
      indicesServices.addPendingDelete(lock.getShardId(),indexSettings);
      logger.debug("[{}] failed to delete shard content - scheduled a retry",e,lock.getShardId().id());
    }
  }
}
