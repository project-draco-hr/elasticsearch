{
  final int shardId=sId.id();
  final Settings indexSettings=this.getIndexSettings().getSettings();
  try {
    try {
      listener.beforeIndexShardClosed(sId,indexShard,indexSettings);
    }
  finally {
      if (indexShard != null) {
        try {
          final boolean flushEngine=deleted.get() == false && closed.get();
          indexShard.close(reason,flushEngine);
        }
 catch (        Exception e) {
          logger.debug(new ParameterizedMessage("[{}] failed to close index shard",shardId),e);
        }
      }
      listener.afterIndexShardClosed(sId,indexShard,indexSettings);
    }
  }
  finally {
    try {
      store.close();
    }
 catch (    Exception e) {
      logger.warn(new ParameterizedMessage("[{}] failed to close store on shard removal (reason: [{}])",shardId,reason),e);
    }
  }
}
