{
  final int shardId=sId.id();
  final Settings indexSettings=this.getIndexSettings().getSettings();
  try {
    try {
      listener.beforeIndexShardClosed(sId,indexShard,indexSettings);
    }
  finally {
      if (indexShard != null) {
        try {
          final boolean flushEngine=deleted.get() == false && closed.get();
          indexShard.close(reason,flushEngine);
        }
 catch (        Throwable e) {
          logger.debug("[{}] failed to close index shard",e,shardId);
        }
      }
      listener.afterIndexShardClosed(sId,indexShard,indexSettings);
    }
  }
  finally {
    try {
      store.close();
    }
 catch (    Throwable e) {
      logger.warn("[{}] failed to close store on shard removal (reason: [{}])",e,shardId,reason);
    }
  }
}
