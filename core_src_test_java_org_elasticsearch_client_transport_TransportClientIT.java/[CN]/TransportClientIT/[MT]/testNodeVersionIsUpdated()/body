{
  TransportClient client=(TransportClient)internalCluster().client();
  Node node=new Node(Settings.builder().put(internalCluster().getDefaultSettings()).put(Environment.PATH_HOME_SETTING.getKey(),createTempDir()).put("node.name","testNodeVersionIsUpdated").put("http.enabled",false).put(Node.NODE_DATA_SETTING.getKey(),false).put("cluster.name","foobar").build());
  node.start();
  try {
    TransportAddress transportAddress=node.injector().getInstance(TransportService.class).boundAddress().publishAddress();
    client.addTransportAddress(transportAddress);
    assertThat(client.connectedNodes().size(),greaterThanOrEqualTo(1));
    for (    DiscoveryNode discoveryNode : client.connectedNodes()) {
      assertThat(discoveryNode.getVersion(),equalTo(Version.CURRENT));
    }
    for (    DiscoveryNode discoveryNode : client.listedNodes()) {
      assertThat(discoveryNode.getId(),startsWith("#transport#-"));
      assertThat(discoveryNode.getVersion(),equalTo(Version.CURRENT.minimumCompatibilityVersion()));
    }
    assertThat(client.filteredNodes().size(),equalTo(1));
    for (    DiscoveryNode discoveryNode : client.filteredNodes()) {
      assertThat(discoveryNode.getVersion(),equalTo(Version.CURRENT.minimumCompatibilityVersion()));
    }
  }
  finally {
    node.close();
  }
}
