{
  final String indexName="test-idx";
  final int numberOfShards=randomIntBetween(1,5);
  final int numberOfReplicas=randomIntBetween(4,7);
  final ActiveShardCount waitForActiveShards=ActiveShardCount.from(randomIntBetween(2,numberOfReplicas));
  ClusterState clusterState=initializeWithNewIndex(indexName,numberOfShards,numberOfReplicas);
  assertFalse(waitForActiveShards.enoughShardsActive(clusterState,indexName));
  clusterState=startPrimaries(clusterState,indexName);
  assertFalse(waitForActiveShards.enoughShardsActive(clusterState,indexName));
  clusterState=startLessThanWaitOnShards(clusterState,indexName,waitForActiveShards);
  assertFalse(waitForActiveShards.enoughShardsActive(clusterState,indexName));
  clusterState=startWaitOnShards(clusterState,indexName,waitForActiveShards);
  assertTrue(waitForActiveShards.enoughShardsActive(clusterState,indexName));
  clusterState=startAllShards(clusterState,indexName);
  assertTrue(waitForActiveShards.enoughShardsActive(clusterState,indexName));
}
