{
  if (node.isLeaf()) {
    result.add(node);
    return;
  }
  final Collection<Node> subCells=node.getSubCells(shape);
  if (node.getLevel() == detailLevel - 1) {
    if (subCells.size() < node.getSubCellsSize()) {
      if (inclParents)       result.add(node);
      for (      Node subCell : subCells) {
        subCell.setLeaf();
      }
      result.addAll(subCells);
    }
 else {
      node.setLeaf();
      result.add(node);
    }
  }
 else {
    if (inclParents) {
      result.add(node);
    }
    for (    Node subCell : subCells) {
      recursiveGetNodes(subCell,shape,detailLevel,inclParents,result);
    }
  }
}
