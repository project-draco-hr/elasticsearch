{
  try {
    assertAcked(client().admin().indices().prepareCreate(name).setSettings("index.number_of_shards",1,"index.number_of_replicas",0).get());
    waitForRelocation(ClusterHealthStatus.GREEN);
    BulkRequestBuilder bulk=client().prepareBulk();
    for (int i=0; i < DOC_COUNT; i++) {
      bulk.add(client().prepareIndex(name,"test").setSource("foo","bar " + i));
    }
    Retry retry=Retry.on(EsRejectedExecutionException.class).policy(BackoffPolicy.exponentialBackoff());
    BulkResponse response=retry.withSyncBackoff(client(),bulk.request());
    assertFalse(response.buildFailureMessage(),response.hasFailures());
    refresh(name);
  }
 catch (  Exception e) {
    throw new RuntimeException(e);
  }
}
