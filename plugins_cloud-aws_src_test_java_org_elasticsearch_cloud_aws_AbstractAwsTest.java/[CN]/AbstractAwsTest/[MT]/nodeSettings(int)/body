{
  Settings.Builder settings=Settings.builder().put(super.nodeSettings(nodeOrdinal)).put("path.home",createTempDir()).put("plugin.types",CloudAwsPlugin.class.getName()).put(AwsModule.S3_SERVICE_TYPE_KEY,TestAwsS3Service.class).put("cloud.aws.test.random",randomInt()).put("cloud.aws.test.write_failures",0.1).put("cloud.aws.test.read_failures",0.1);
  Environment environment=new Environment(settings.build());
  try {
    if (Strings.hasText(System.getProperty("tests.config"))) {
      settings.loadFromUrl(environment.resolveConfig(System.getProperty("tests.config")));
    }
 else {
      throw new IllegalStateException("to run integration tests, you need to set -Dtest.thirdparty=true and -Dtests.config=/path/to/elasticsearch.yml");
    }
  }
 catch (  FailedToResolveConfigException exception) {
    throw new IllegalStateException("your test configuration file is incorrect: " + System.getProperty("tests.config"),exception);
  }
  return settings.build();
}
