{
  clusterService.submitStateUpdateTask("remove-index-template [" + request.name + "]",Priority.URGENT,new ProcessedClusterStateUpdateTask(){
    @Override public ClusterState execute(    ClusterState currentState){
      if (!currentState.metaData().templates().containsKey(request.name)) {
        listener.onFailure(new IndexTemplateMissingException(request.name));
        return currentState;
      }
      MetaData.Builder metaData=MetaData.builder().metaData(currentState.metaData()).removeTemplate(request.name);
      return ClusterState.builder().state(currentState).metaData(metaData).build();
    }
    @Override public void clusterStateProcessed(    ClusterState clusterState){
      listener.onResponse(new RemoveResponse(true));
    }
  }
);
}
