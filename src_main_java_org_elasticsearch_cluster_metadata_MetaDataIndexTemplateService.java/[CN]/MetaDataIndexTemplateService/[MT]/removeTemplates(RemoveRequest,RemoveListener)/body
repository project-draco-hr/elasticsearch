{
  clusterService.submitStateUpdateTask("remove-index-template [" + request.name + "]",Priority.URGENT,new ProcessedClusterStateUpdateTask(){
    @Override public ClusterState execute(    ClusterState currentState){
      Set<String> templateNames=Sets.newHashSet();
      for (      String templateName : currentState.metaData().templates().keySet()) {
        if (Regex.simpleMatch(request.name,templateName)) {
          templateNames.add(templateName);
        }
      }
      if (templateNames.isEmpty()) {
        listener.onFailure(new IndexTemplateMissingException(request.name));
        return currentState;
      }
      MetaData.Builder metaData=MetaData.builder().metaData(currentState.metaData());
      for (      String templateName : templateNames) {
        metaData.removeTemplate(templateName);
      }
      return ClusterState.builder().state(currentState).metaData(metaData).build();
    }
    @Override public void clusterStateProcessed(    ClusterState clusterState){
      listener.onResponse(new RemoveResponse(true));
    }
  }
);
}
