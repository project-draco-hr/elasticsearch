{
  if (mapper instanceof AllFieldMapper.IncludeInAll) {
    ((AllFieldMapper.IncludeInAll)mapper).includeInAllIfNotSet(includeInAll);
  }
synchronized (mutex) {
    UpdateInPlaceMap<String,Mapper>.Mutator mappingMutator=this.mappers.mutator();
    mappingMutator.put(mapper.name(),mapper);
    mappingMutator.close();
  }
  return this;
}
