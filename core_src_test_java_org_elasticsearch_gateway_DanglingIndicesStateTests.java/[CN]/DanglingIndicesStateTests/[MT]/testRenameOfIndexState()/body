{
  try (NodeEnvironment env=newNodeEnvironment()){
    MetaStateService metaStateService=new MetaStateService(Settings.EMPTY,env);
    DanglingIndicesState danglingState=new DanglingIndicesState(Settings.EMPTY,env,metaStateService,null);
    MetaData metaData=MetaData.builder().build();
    IndexMetaData dangledIndex=IndexMetaData.builder("test1").settings(indexSettings).build();
    metaStateService.writeIndex("test_write",dangledIndex,null);
    for (    Path path : env.indexPaths(new Index("test1"))) {
      Files.move(path,path.getParent().resolve("test1_renamed"));
    }
    Map<String,IndexMetaData> newDanglingIndices=danglingState.findNewDanglingIndices(metaData);
    assertThat(newDanglingIndices.size(),equalTo(1));
    assertThat(newDanglingIndices.keySet(),Matchers.hasItems("test1_renamed"));
  }
 }
