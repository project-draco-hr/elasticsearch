{
  Adler32 expected=new Adler32();
  byte bytes[]="abcdefgh".getBytes(StandardCharsets.UTF_8);
  expected.update(bytes);
  String expectedString=Store.digestToString(expected.getValue());
  byte corruptBytes[]="abcdefch".getBytes(StandardCharsets.UTF_8);
  Directory dir=newDirectory();
  IndexOutput o=dir.createOutput("legacy",IOContext.DEFAULT);
  VerifyingIndexOutput out=new LegacyVerification.Adler32VerifyingIndexOutput(o,expectedString,8);
  out.writeBytes(corruptBytes,0,bytes.length);
  try {
    out.verify();
    fail();
  }
 catch (  CorruptIndexException e) {
  }
  out.close();
  try {
    out.verify();
    fail();
  }
 catch (  CorruptIndexException e) {
  }
  dir.close();
}
