{
  final int NUMBER_OF_NODES=4;
  final int NUMBER_OF_INDICES=600;
  final int BATCH=300;
  final Settings nodeSettings=ImmutableSettings.settingsBuilder().put("index.number_of_shards",2).build();
  Node[] nodes=new Node[NUMBER_OF_NODES];
  for (int i=0; i < nodes.length; i++) {
    nodes[i]=NodeBuilder.nodeBuilder().settings(nodeSettings).node();
  }
  Client client=nodes.length == 1 ? nodes[0].client() : nodes[1].client();
  while (true) {
    BulkRequestBuilder bulkRequest=client.prepareBulk();
    for (int i=0; i < BATCH; i++) {
      bulkRequest.add(Requests.indexRequest("test" + ThreadLocalRandom.current().nextInt(NUMBER_OF_INDICES)).type("type").source("field","value"));
    }
    bulkRequest.execute().actionGet();
  }
}
