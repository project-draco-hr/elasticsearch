{
  String concreteIndex=concreteIndices.getConcreteIndex(request.index());
  boolean isClosed=false;
  if (concreteIndex == null) {
    try {
      concreteIndex=concreteIndices.resolveIfAbsent(request.index(),request.indicesOptions());
    }
 catch (    IndexClosedException ice) {
      isClosed=true;
    }
  }
  if (!isClosed) {
    IndexMetaData indexMetaData=metaData.index(concreteIndex);
    isClosed=indexMetaData.getState() == IndexMetaData.State.CLOSE;
  }
  if (isClosed) {
    BulkItemResponse.Failure failure=new BulkItemResponse.Failure(request.index(),request.type(),request.id(),new IndexClosedException(new Index(metaData.index(request.index()).getIndex())));
    BulkItemResponse bulkItemResponse=new BulkItemResponse(idx,"index",failure);
    responses.set(idx,bulkItemResponse);
    bulkRequest.requests.set(idx,null);
  }
  return isClosed;
}
