{
  URL resource=getClass().getResource(pluginDir);
  ImmutableSettings.Builder settings=settingsBuilder();
  settings.put(nodeSettings);
  if (resource != null) {
    settings.put("path.plugins",getDataPath(pluginDir).toAbsolutePath());
  }
  if (pluginClassNames.length > 0) {
    settings.putArray("plugin.types",pluginClassNames);
  }
  String nodeName=internalCluster().startNode(settings);
  client().admin().cluster().health(clusterHealthRequest().waitForGreenStatus()).actionGet();
  return internalCluster().getInstance(ClusterService.class,nodeName).state().nodes().localNodeId();
}
