{
  IndexService indexService=indicesService.indexServiceSafe(request.shardId().getIndex());
  IndexShard indexShard=indexService.getShard(request.shardId().id());
  ShardSuggestMetric suggestMetric=indexShard.getSuggestMetric();
  suggestMetric.preSuggest();
  long startTime=System.nanoTime();
  try (Engine.Searcher searcher=indexShard.acquireSearcher("suggest")){
    SuggestBuilder suggest=request.suggest();
    if (suggest != null) {
      final SuggestionSearchContext context=suggest.build(indexService.newQueryShardContext());
      final Suggest result=suggestPhase.execute(context,searcher.searcher());
      return new ShardSuggestResponse(request.shardId(),result);
    }
    return new ShardSuggestResponse(request.shardId(),new Suggest());
  }
 catch (  Throwable ex) {
    throw new ElasticsearchException("failed to execute suggest",ex);
  }
 finally {
    suggestMetric.postSuggest(System.nanoTime() - startTime);
  }
}
