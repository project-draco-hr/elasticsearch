{
  String mapping=XContentFactory.jsonBuilder().startObject().startObject("type1").startObject("properties").startObject("location1").field("type","geo_shape").endObject().startObject("location2").field("type","geo_shape").endObject().endObject().endObject().endObject().string();
  prepareCreate("test").addMapping("type1",mapping).execute().actionGet();
  ensureYellow();
  String p1="\"location1\" : {\"type\":\"polygon\", \"coordinates\":[[[-10,-10],[10,-10],[10,10],[-10,10],[-10,-10]]]}";
  String p2="\"location2\" : {\"type\":\"polygon\", \"coordinates\":[[[-20,-20],[20,-20],[20,20],[-20,20],[-20,-20]]]}";
  String o1="{" + p1 + ", "+ p2+ "}";
  client().prepareIndex("test","type1","1").setSource(o1).execute().actionGet();
  client().admin().indices().prepareRefresh("test").execute().actionGet();
  String filter="{\"geo_shape\": {\"location2\": {\"indexed_shape\": {" + "\"id\": \"1\"," + "\"type\": \"type1\","+ "\"index\": \"test\","+ "\"path\": \"location2\""+ "}}}}";
  SearchResponse result=client().prepareSearch("test").setQuery(QueryBuilders.matchAllQuery()).setPostFilter(filter).execute().actionGet();
  assertHitCount(result,1);
}
