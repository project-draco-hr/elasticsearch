{
  if (reader == null) {
    return null;
  }
  if (reader instanceof SegmentReader) {
    return (SegmentReader)reader;
  }
 else   if (reader instanceof FilterLeafReader) {
    final FilterLeafReader fReader=(FilterLeafReader)reader;
    return segmentReader(FilterLeafReader.unwrap(fReader));
  }
  if (fail) {
    throw new ElasticsearchIllegalStateException("Can not extract segment reader from given index reader [" + reader + "]");
  }
  return null;
}
