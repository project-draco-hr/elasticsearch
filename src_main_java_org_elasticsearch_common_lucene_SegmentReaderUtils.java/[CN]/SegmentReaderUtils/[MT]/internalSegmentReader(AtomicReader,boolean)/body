{
  if (reader == null) {
    return null;
  }
  if (reader instanceof SegmentReader) {
    return (SegmentReader)reader;
  }
 else   if (reader instanceof FilterAtomicReader) {
    final FilterAtomicReader fReader=(FilterAtomicReader)reader;
    return segmentReader(FilterAtomicReader.unwrap(fReader));
  }
  if (fail) {
    throw new ElasticsearchIllegalStateException("Can not extract segment reader from given index reader [" + reader + "]");
  }
  return null;
}
