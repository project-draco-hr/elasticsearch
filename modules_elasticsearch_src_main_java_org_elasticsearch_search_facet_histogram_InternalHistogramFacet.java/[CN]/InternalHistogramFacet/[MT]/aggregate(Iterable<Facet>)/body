{
  TLongLongHashMap counts=null;
  TLongDoubleHashMap totals=null;
  for (  Facet facet : facets) {
    if (!facet.name().equals(name)) {
      continue;
    }
    InternalHistogramFacet histoFacet=(InternalHistogramFacet)facet;
    if (!histoFacet.counts.isEmpty()) {
      if (counts == null) {
        counts=histoFacet.counts;
      }
 else {
        for (TLongLongIterator it=histoFacet.counts.iterator(); it.hasNext(); ) {
          it.advance();
          counts.adjustOrPutValue(it.key(),it.value(),it.value());
        }
      }
    }
    if (!histoFacet.totals.isEmpty()) {
      if (totals == null) {
        totals=histoFacet.totals;
      }
 else {
        for (TLongDoubleIterator it=histoFacet.totals.iterator(); it.hasNext(); ) {
          it.advance();
          totals.adjustOrPutValue(it.key(),it.value(),it.value());
        }
      }
    }
  }
  if (counts == null) {
    counts=EMPTY_LONG_LONG_MAP;
  }
  if (totals == null) {
    totals=EMPTY_LONG_DOUBLE_MAP;
  }
  return new InternalHistogramFacet(name,keyFieldName,valueFieldName,interval,comparatorType,counts,totals);
}
