{
  this.request=request;
  this.listener=listener;
  ClusterState clusterState=clusterService.state();
  if (logger.isTraceEnabled()) {
    logger.trace("executing [{}] based on cluster state version [{}]",request,clusterState.version());
  }
  nodes=clusterState.nodes();
  ClusterBlockException blockException=checkGlobalBlock(clusterState,request);
  if (blockException != null) {
    throw blockException;
  }
  resolveRequest(clusterState,request);
  blockException=checkRequestBlock(clusterState,request);
  if (blockException != null) {
    throw blockException;
  }
  this.shardIt=shards(clusterState,request);
}
