{
  ByteBufferAllocator.Type allocatorType=ByteBufferAllocator.Type.LARGE;
  if (name.contains("segments") || name.endsWith(".del")) {
    allocatorType=ByteBufferAllocator.Type.SMALL;
  }
  ByteBufferFileOutput file=new ByteBufferFileOutput(this,allocator.sizeInBytes(allocatorType));
  ByteBufferFile existing=files.put(name,file);
  if (existing != null) {
    sizeInBytes.addAndGet(-existing.sizeInBytes());
    existing.delete();
  }
  return new ByteBufferIndexOutput(this,name,allocator,allocatorType,file);
}
