{
  ensureGreen();
  HttpClientResponse response=httpClient().request("/_protected");
  assertThat(response.errorCode(),equalTo(RestStatus.UNAUTHORIZED.getStatus()));
  assertThat(response.getHeader("Secret"),equalTo("required"));
  Map<String,String> headers=Maps.newHashMap();
  headers.put("Secret","password");
  HttpClientResponse authResponse=httpClient().request("GET","_protected",headers);
  assertThat(authResponse.errorCode(),equalTo(RestStatus.OK.getStatus()));
  assertThat(authResponse.getHeader("Secret"),equalTo("granted"));
}
