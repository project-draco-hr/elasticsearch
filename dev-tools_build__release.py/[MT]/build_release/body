def build_release(run_tests=False, dry_run=True, cpus=1):
    target = 'deploy'
    if dry_run:
        target = 'package'
    if run_tests:
        run_mvn('clean', ('test -Dtests.jvms=%s -Des.node.mode=local' % cpus), ('test -Dtests.jvms=%s -Des.node.mode=network' % cpus))
    run_mvn(('clean %s -DskipTests' % target))
    try:
        run_mvn('-DskipTests rpm:rpm')
    except RuntimeError as e:
        log(('Failed to build RPM - Exception: [%s]' % e.message))
