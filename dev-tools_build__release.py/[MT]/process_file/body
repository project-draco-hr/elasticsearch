def process_file(file_path, line_callback):
    (fh, abs_path) = tempfile.mkstemp()
    with open(abs_path, 'w') as new_file:
        with open(file_path) as old_file:
            for line in old_file:
                new_file.write(line_callback(line))
            new_file.close()
            os.close(fh)
            old_file.close()
            os.remove(file_path)
            shutil.move(abs_path, file_path)
