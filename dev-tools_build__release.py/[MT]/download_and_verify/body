def download_and_verify(release, files, base_url='https://download.elasticsearch.org/elasticsearch/elasticsearch'):
    print ('Downloading and verifying release %s from %s' % (release, base_url))
    tmp_dir = tempfile.mkdtemp()
    try:
        downloaded_files = []
        for file in files:
            name = os.path.basename(file)
            url = ('%s/%s' % (base_url, name))
            abs_file_path = os.path.join(tmp_dir, name)
            print ('  Downloading %s' % url)
            downloaded_files.append(abs_file_path)
            urllib.request.urlretrieve(url, abs_file_path)
            url = ''.join([url, '.sha1.txt'])
            checksum_file = os.path.join(tmp_dir, ''.join([abs_file_path, '.sha1.txt']))
            urllib.request.urlretrieve(url, checksum_file)
            print ('  Verifying checksum %s' % checksum_file)
            run(('cd %s && sha1sum -c %s' % (tmp_dir, os.path.basename(checksum_file))))
        smoke_test_release(release, downloaded_files, get_hash(('v%s' % release)))
    finally:
        shutil.rmtree(tmp_dir)
