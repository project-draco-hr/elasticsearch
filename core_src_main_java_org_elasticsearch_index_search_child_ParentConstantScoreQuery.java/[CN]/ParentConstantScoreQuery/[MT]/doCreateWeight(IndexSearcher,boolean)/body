{
  IndexParentChildFieldData globalIfd=parentChildIndexFieldData.loadGlobal(searcher.getIndexReader());
  final long maxOrd;
  List<LeafReaderContext> leaves=searcher.getIndexReader().leaves();
  if (globalIfd == null || leaves.isEmpty()) {
    return new BooleanQuery().createWeight(searcher,needsScores);
  }
 else {
    AtomicParentChildFieldData afd=globalIfd.load(leaves.get(0));
    SortedDocValues globalValues=afd.getOrdinalsValues(parentType);
    maxOrd=globalValues.getValueCount();
  }
  if (maxOrd == 0) {
    return new BooleanQuery().createWeight(searcher,needsScores);
  }
  ParentOrdsCollector collector=new ParentOrdsCollector(globalIfd,maxOrd,parentType);
  IndexSearcher indexSearcher=new IndexSearcher(searcher.getIndexReader());
  indexSearcher.setSimilarity(searcher.getSimilarity(true));
  indexSearcher.setQueryCache(null);
  indexSearcher.search(parentQuery,collector);
  if (collector.parentCount() == 0) {
    return new BooleanQuery().createWeight(searcher,needsScores);
  }
  return new ChildrenWeight(this,childrenFilter,collector,globalIfd);
}
