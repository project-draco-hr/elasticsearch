{
  Settings nodeSettings=Settings.settingsBuilder().put("discovery.type","zen").put("node.mode","local").build();
  String nodeName=internalCluster().startNode(nodeSettings,Version.V_2_0_0_beta1);
  ZenDiscovery zenDiscovery=(ZenDiscovery)internalCluster().getInstance(Discovery.class,nodeName);
  DiscoveryNode node=new DiscoveryNode("_node_id",new LocalTransportAddress("_id"),Version.V_1_6_0);
  final AtomicReference<IllegalStateException> holder=new AtomicReference<>();
  zenDiscovery.handleJoinRequest(node,new MembershipAction.JoinCallback(){
    @Override public void onSuccess(){
    }
    @Override public void onFailure(    Throwable t){
      holder.set((IllegalStateException)t);
    }
  }
);
  assertThat(holder.get(),notNullValue());
  assertThat(holder.get().getMessage(),equalTo("Can't handle join request from a node with a version [1.6.0] that is lower than the minimum compatible version [2.0.0-SNAPSHOT]"));
}
