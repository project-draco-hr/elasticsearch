{
  final ScriptFieldsFunction function=new ScriptFieldsFunction(scriptLang,script,scriptService,mapperService,fieldDataCache);
  function.setNextReader(reader);
  return new GetDocSet(reader.maxDoc()){
    @Override public boolean isCacheable(){
      return false;
    }
    @Override public boolean get(    int doc) throws IOException {
      Object val=function.execute(doc,params);
      if (val == null) {
        return false;
      }
      if (val instanceof Boolean) {
        return (Boolean)val;
      }
      if (val instanceof Number) {
        return ((Number)val).longValue() != 0;
      }
      throw new IOException("Can't handle type [" + val + "] in script filter");
    }
  }
;
}
