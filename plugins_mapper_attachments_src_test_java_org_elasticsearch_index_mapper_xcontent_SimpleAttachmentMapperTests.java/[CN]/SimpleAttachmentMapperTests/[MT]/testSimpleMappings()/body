{
  String mapping=copyToStringFromClasspath("/org/elasticsearch/index/mapper/xcontent/test-mapping.json");
  XContentDocumentMapper docMapper=mapperParser.parse(mapping);
  byte[] json=jsonBuilder().startObject().field("_id",1).field("file",copyToBytesFromClasspath("/org/elasticsearch/index/mapper/xcontent/testXHTML.html")).endObject().copiedBytes();
  Document doc=docMapper.parse(json).doc();
  assertThat(doc.get(docMapper.mappers().smartName("file.title").mapper().names().indexName()),equalTo("XHTML test document"));
  assertThat(doc.get(docMapper.mappers().smartName("file").mapper().names().indexName()),containsString("This document tests the ability of Apache Tika to extract content"));
  String builtMapping=docMapper.mappingSource().string();
  docMapper=mapperParser.parse(builtMapping);
  json=jsonBuilder().startObject().field("_id",1).field("file",copyToBytesFromClasspath("/org/elasticsearch/index/mapper/xcontent/testXHTML.html")).endObject().copiedBytes();
  doc=docMapper.parse(json).doc();
  assertThat(doc.get(docMapper.mappers().smartName("file.title").mapper().names().indexName()),equalTo("XHTML test document"));
  assertThat(doc.get(docMapper.mappers().smartName("file").mapper().names().indexName()),containsString("This document tests the ability of Apache Tika to extract content"));
}
