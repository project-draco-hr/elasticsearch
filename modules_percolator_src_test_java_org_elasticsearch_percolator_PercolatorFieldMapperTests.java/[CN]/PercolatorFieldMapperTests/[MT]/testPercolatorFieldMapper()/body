{
  addQueryMapping();
  QueryBuilder queryBuilder=termQuery("field","value");
  ParsedDocument doc=mapperService.documentMapper(typeName).parse("test",typeName,"1",XContentFactory.jsonBuilder().startObject().field(fieldName,queryBuilder).endObject().bytes());
  assertThat(doc.rootDoc().getFields(fieldType.getExtractedTermsField()).length,equalTo(1));
  assertThat(doc.rootDoc().getFields(fieldType.getExtractedTermsField())[0].binaryValue().utf8ToString(),equalTo("field\0value"));
  assertThat(doc.rootDoc().getFields(fieldType.getQueryBuilderFieldName()).length,equalTo(1));
  assertThat(doc.rootDoc().getFields(fieldType.getExtractionResultFieldName()).length,equalTo(1));
  assertThat(doc.rootDoc().getFields(fieldType.getExtractionResultFieldName())[0].stringValue(),equalTo(EXTRACTION_COMPLETE));
  BytesRef qbSource=doc.rootDoc().getFields(fieldType.getQueryBuilderFieldName())[0].binaryValue();
  assertQueryBuilder(qbSource,queryBuilder);
  queryBuilder=rangeQuery("field").from("a").to("z");
  doc=mapperService.documentMapper(typeName).parse("test",typeName,"1",XContentFactory.jsonBuilder().startObject().field(fieldName,queryBuilder).endObject().bytes());
  assertThat(doc.rootDoc().getFields(fieldType.getExtractionResultFieldName()).length,equalTo(1));
  assertThat(doc.rootDoc().getFields(fieldType.getExtractionResultFieldName())[0].stringValue(),equalTo(EXTRACTION_FAILED));
  assertThat(doc.rootDoc().getFields(fieldType.getExtractedTermsField()).length,equalTo(0));
  assertThat(doc.rootDoc().getFields(fieldType.getQueryBuilderFieldName()).length,equalTo(1));
  qbSource=doc.rootDoc().getFields(fieldType.getQueryBuilderFieldName())[0].binaryValue();
  assertQueryBuilder(qbSource,queryBuilder);
}
