{
  ArrayUtil.timSort(surfaceFormsAndPayload,0,count);
  int deduplicator=0;
  analyzed.bytes[analyzed.offset + analyzed.length]=0;
  analyzed.length+=2;
  for (int i=0; i < count; i++) {
    analyzed.bytes[analyzed.offset + analyzed.length - 1]=(byte)deduplicator++;
    Util.toIntsRef(analyzed,scratchInts);
    SurfaceFormAndPayload candiate=surfaceFormsAndPayload[i];
    long cost=candiate.weight == -1 ? encodeWeight(Math.min(Integer.MAX_VALUE,defaultWeight)) : candiate.weight;
    builder.add(scratchInts,outputs.newPair(cost,candiate.payload));
  }
  seenSurfaceForms.clear();
  count=0;
}
