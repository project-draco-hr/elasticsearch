{
  byte status=0;
  status=TransportStreams.statusSetResponse(status);
  if (options.compress()) {
    status=TransportStreams.statusSetCompress(status);
    StreamOutput stream=cachedEntry.cachedHandles(CompressorFactory.defaultCompressor());
    cachedEntry.bytes().write(HEADER_PLACEHOLDER);
    message.writeTo(stream);
    stream.close();
  }
 else {
    StreamOutput stream=cachedEntry.cachedHandles();
    cachedEntry.bytes().write(HEADER_PLACEHOLDER);
    message.writeTo(stream);
    stream.close();
  }
  TransportStreams.writeHeader(cachedEntry.bytes().underlyingBytes(),cachedEntry.bytes().size(),requestId,status);
}
