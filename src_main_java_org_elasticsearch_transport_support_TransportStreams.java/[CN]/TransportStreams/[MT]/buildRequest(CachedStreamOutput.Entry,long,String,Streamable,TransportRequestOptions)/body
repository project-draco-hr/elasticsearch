{
  byte status=0;
  status=TransportStreams.statusSetRequest(status);
  if (options.compress()) {
    status=TransportStreams.statusSetCompress(status);
    cachedEntry.bytes().write(HEADER_PLACEHOLDER);
    StreamOutput stream=cachedEntry.handles(CompressorFactory.defaultCompressor());
    stream.writeUTF(action);
    message.writeTo(stream);
    stream.close();
  }
 else {
    StreamOutput stream=cachedEntry.handles();
    cachedEntry.bytes().write(HEADER_PLACEHOLDER);
    stream.writeUTF(action);
    message.writeTo(stream);
    stream.close();
  }
  TransportStreams.writeHeader(cachedEntry.bytes().underlyingBytes(),cachedEntry.bytes().size(),requestId,status);
}
