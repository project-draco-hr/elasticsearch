{
  if (preference == null) {
    return indexShard.activeShardsRandomIt();
  }
  if ("_local".equals(preference)) {
    return indexShard.preferNodeShardsIt(nodeId);
  }
  if ("_primary".equals(preference)) {
    return indexShard.primaryShardIt();
  }
  return indexShard.shardsIt(DjbHashFunction.DJB_HASH(preference));
}
