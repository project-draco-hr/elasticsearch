{
  int shardId=Math.abs(hash(type,id)) % indexMetaData(clusterState,index).numberOfShards();
  IndexShardRoutingTable indexShard=indexRoutingTable(clusterState,index).shard(shardId);
  if (indexShard == null) {
    throw new IndexShardMissingException(new ShardId(index,shardId));
  }
  return indexShard;
}
