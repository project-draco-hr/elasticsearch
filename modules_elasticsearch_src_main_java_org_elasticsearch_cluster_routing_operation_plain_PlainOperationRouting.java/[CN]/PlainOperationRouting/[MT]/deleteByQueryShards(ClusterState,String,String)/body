{
  if (routing == null) {
    return indexRoutingTable(clusterState,index).groupByShardsIt();
  }
  String[] routings=routingPattern.split(routing);
  if (routing.length() == 0) {
    return indexRoutingTable(clusterState,index).groupByShardsIt();
  }
  HashSet<ShardsIterator> set=new HashSet<ShardsIterator>();
  IndexRoutingTable indexRouting=indexRoutingTable(clusterState,index);
  for (  String r : routings) {
    int shardId=shardId(clusterState,index,null,null,r);
    IndexShardRoutingTable indexShard=indexRouting.shard(shardId);
    if (indexShard == null) {
      throw new IndexShardMissingException(new ShardId(index,shardId));
    }
    set.add(indexShard.shardsRandomIt());
  }
  return new GroupShardsIterator(set);
}
