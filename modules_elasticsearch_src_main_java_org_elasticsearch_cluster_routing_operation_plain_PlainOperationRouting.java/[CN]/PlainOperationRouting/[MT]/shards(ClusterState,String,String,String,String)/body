{
  int shardId=shardId(clusterState,index,type,id,routing);
  IndexShardRoutingTable indexShard=indexRoutingTable(clusterState,index).shard(shardId);
  if (indexShard == null) {
    throw new IndexShardMissingException(new ShardId(index,shardId));
  }
  return indexShard;
}
