{
  super.writeTo(out);
  if (out.getVersion().before(Version.V_1_4_0_Beta1)) {
    out.writeString(index);
  }
  out.writeString(type);
  out.writeString(id);
  if (out.getVersion().onOrAfter(Version.V_1_4_0_Beta1)) {
    out.writeBoolean(doc != null);
    if (doc != null) {
      out.writeBytesReference(doc);
    }
  }
  out.writeOptionalString(routing);
  out.writeOptionalString(preference);
  long longFlags=0;
  for (  Flag flag : flagsEnum) {
    longFlags|=(1 << flag.ordinal());
  }
  out.writeVLong(longFlags);
  if (selectedFields != null) {
    out.writeVInt(selectedFields.size());
    for (    String selectedField : selectedFields) {
      out.writeString(selectedField);
    }
  }
 else {
    out.writeVInt(0);
  }
}
