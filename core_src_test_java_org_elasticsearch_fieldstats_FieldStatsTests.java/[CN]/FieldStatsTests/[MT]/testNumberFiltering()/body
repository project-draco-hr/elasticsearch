{
  createIndex("test1",Settings.EMPTY,"type","value","type=long");
  client().prepareIndex("test1","test").setSource("value",1L).get();
  createIndex("test2",Settings.EMPTY,"type","value","type=long");
  client().prepareIndex("test2","test").setSource("value",3L).get();
  client().admin().indices().prepareRefresh().get();
  FieldStatsResponse response=client().prepareFieldStats().setFields("value").setLevel("indices").get();
  assertThat(response.getIndicesMergedFieldStats().size(),equalTo(2));
  assertThat(response.getIndicesMergedFieldStats().get("test1").get("value").getMinValue(),equalTo(1L));
  assertThat(response.getIndicesMergedFieldStats().get("test2").get("value").getMinValue(),equalTo(3L));
  response=client().prepareFieldStats().setFields("value").setIndexContraints(new IndexConstraint("value",MIN,GTE,"-1"),new IndexConstraint("value",MAX,LTE,"0")).setLevel("indices").get();
  assertThat(response.getIndicesMergedFieldStats().size(),equalTo(0));
  response=client().prepareFieldStats().setFields("value").setIndexContraints(new IndexConstraint("value",MIN,GTE,"0"),new IndexConstraint("value",MAX,LT,"1")).setLevel("indices").get();
  assertThat(response.getIndicesMergedFieldStats().size(),equalTo(0));
  response=client().prepareFieldStats().setFields("value").setIndexContraints(new IndexConstraint("value",MIN,GTE,"0"),new IndexConstraint("value",MAX,LTE,"1")).setLevel("indices").get();
  assertThat(response.getIndicesMergedFieldStats().size(),equalTo(1));
  assertThat(response.getIndicesMergedFieldStats().get("test1").get("value").getMinValue(),equalTo(1L));
  response=client().prepareFieldStats().setFields("value").setIndexContraints(new IndexConstraint("value",MIN,GTE,"1"),new IndexConstraint("value",MAX,LTE,"2")).setLevel("indices").get();
  assertThat(response.getIndicesMergedFieldStats().size(),equalTo(1));
  assertThat(response.getIndicesMergedFieldStats().get("test1").get("value").getMinValue(),equalTo(1L));
  response=client().prepareFieldStats().setFields("value").setIndexContraints(new IndexConstraint("value",MIN,GT,"1"),new IndexConstraint("value",MAX,LTE,"2")).setLevel("indices").get();
  assertThat(response.getIndicesMergedFieldStats().size(),equalTo(0));
  response=client().prepareFieldStats().setFields("value").setIndexContraints(new IndexConstraint("value",MIN,GT,"2"),new IndexConstraint("value",MAX,LTE,"3")).setLevel("indices").get();
  assertThat(response.getIndicesMergedFieldStats().size(),equalTo(1));
  assertThat(response.getIndicesMergedFieldStats().get("test2").get("value").getMinValue(),equalTo(3L));
  response=client().prepareFieldStats().setFields("value").setIndexContraints(new IndexConstraint("value",MIN,GTE,"3"),new IndexConstraint("value",MAX,LTE,"4")).setLevel("indices").get();
  assertThat(response.getIndicesMergedFieldStats().size(),equalTo(1));
  assertThat(response.getIndicesMergedFieldStats().get("test2").get("value").getMinValue(),equalTo(3L));
  response=client().prepareFieldStats().setFields("value").setIndexContraints(new IndexConstraint("value",MIN,GT,"3"),new IndexConstraint("value",MAX,LTE,"4")).setLevel("indices").get();
  assertThat(response.getIndicesMergedFieldStats().size(),equalTo(0));
  response=client().prepareFieldStats().setFields("value").setIndexContraints(new IndexConstraint("value",MIN,GTE,"1"),new IndexConstraint("value",MAX,LTE,"3")).setLevel("indices").get();
  assertThat(response.getIndicesMergedFieldStats().size(),equalTo(2));
  assertThat(response.getIndicesMergedFieldStats().get("test1").get("value").getMinValue(),equalTo(1L));
  assertThat(response.getIndicesMergedFieldStats().get("test2").get("value").getMinValue(),equalTo(3L));
  response=client().prepareFieldStats().setFields("value").setIndexContraints(new IndexConstraint("value",MIN,GT,"1"),new IndexConstraint("value",MAX,LT,"3")).setLevel("indices").get();
  assertThat(response.getIndicesMergedFieldStats().size(),equalTo(0));
}
