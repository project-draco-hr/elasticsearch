{
  assertAcked(prepareCreate("test").addMapping("type1",jsonBuilder().startObject().startObject("type1").startObject("properties").startObject("body").field("type","string").startObject("fields").startObject("sub").field("type","string").endObject().endObject().endObject().endObject().endObject().endObject()));
  client().prepareIndex("test","type1","1").setSource("body","foo bar baz").get();
  refresh();
  SearchResponse searchResponse=client().prepareSearch().setQuery(simpleQueryString("foo bar baz").field("body")).get();
  assertHitCount(searchResponse,1l);
  assertSearchHits(searchResponse,"1");
  searchResponse=client().prepareSearch().setQuery(simpleQueryString("foo bar baz").field("type1.body")).get();
  assertHitCount(searchResponse,1l);
  assertSearchHits(searchResponse,"1");
  searchResponse=client().prepareSearch().setQuery(simpleQueryString("foo bar baz").field("body.sub")).get();
  assertHitCount(searchResponse,1l);
  assertSearchHits(searchResponse,"1");
  searchResponse=client().prepareSearch().setQuery(simpleQueryString("foo bar baz").field("type1.body.sub")).get();
  assertHitCount(searchResponse,1l);
  assertSearchHits(searchResponse,"1");
}
