{
  boolean includeDefaults=params.paramAsBoolean("include_defaults",false);
  if (!includeDefaults && customFieldDataSettings == null && (postingsFormat == null || postingsFormat.name().equals(defaultPostingFormat())) && (docValuesFormat == null || docValuesFormat.name().equals(defaultDocValuesFormat()))) {
    return builder;
  }
  builder.startObject(CONTENT_TYPE);
  if (postingsFormat != null) {
    if (includeDefaults || !postingsFormat.name().equals(defaultPostingFormat())) {
      builder.field("postings_format",postingsFormat.name());
    }
  }
 else   if (includeDefaults) {
    String format=defaultPostingFormat();
    if (format == null) {
      format=PostingsFormatService.DEFAULT_FORMAT;
    }
    builder.field("postings_format",format);
  }
  if (docValuesFormat != null) {
    if (includeDefaults || !docValuesFormat.name().equals(defaultDocValuesFormat())) {
      builder.field(DOC_VALUES_FORMAT,docValuesFormat.name());
    }
  }
 else   if (includeDefaults) {
    String format=defaultDocValuesFormat();
    if (format == null) {
      format=DocValuesFormatService.DEFAULT_FORMAT;
    }
    builder.field(DOC_VALUES_FORMAT,format);
  }
  if (customFieldDataSettings != null) {
    builder.field("fielddata",(Map)customFieldDataSettings.getAsMap());
  }
 else   if (includeDefaults) {
    builder.field("fielddata",(Map)fieldDataType.getSettings().getAsMap());
  }
  builder.endObject();
  return builder;
}
