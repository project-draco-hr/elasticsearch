import fnmatch
import subprocess
import tempfile
import re
import os
import shutil
VERSION_FILE = 'core/src/main/java/org/elasticsearch/Version.java'
POM_FILE = 'pom.xml'
if (__name__ == '__main__'):
    release_version = find_release_version()
    print ('*** Preparing release version: [%s]' % release_version)
    ensure_checkout_is_clean()
    run(('mvn versions:set -DnewVersion=%s -DgenerateBackupPoms=false' % release_version))
    remove_version_snapshot(VERSION_FILE, release_version)
    print '*** Done removing snapshot version. DO NOT COMMIT THIS, WHEN CREATING A RELEASE CANDIDATE.'
    shortHash = subprocess.check_output('git log --pretty=format:"%h" -n 1', shell=True)
    print ''
    print '*** To create a release candidate run: '
    print ('  mvn clean deploy -Prelease -DskipTests -Dgpg.keyname="D88E42B4" -Dpackaging.rpm.rpmbuild=/usr/bin/rpmbuild -Delasticsearch.s3.repository=s3://download.elasticsearch.org/elasticsearch/staging/elasticsearch-%s-%s' % (release_version, shortHash.decode('utf-8')))
    print ''
    print 'NOTE: this command will promt you several times for the GPG passphrase of the key you specified you can alternatively pass it via -Dgpg.passphrase=yourPassPhrase'
