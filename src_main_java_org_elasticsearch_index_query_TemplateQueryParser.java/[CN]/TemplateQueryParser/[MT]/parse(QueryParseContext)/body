{
  XContentParser parser=parseContext.parser();
  TemplateContext templateContext=parse(parser,PARAMS,parametersToTypes);
  ExecutableScript executable=this.scriptService.executable(MustacheScriptEngineService.NAME,templateContext.template(),templateContext.scriptType(),templateContext.params());
  BytesReference querySource=(BytesReference)executable.run();
  try (XContentParser qSourceParser=XContentFactory.xContent(querySource).createParser(querySource)){
    final QueryParseContext context=new QueryParseContext(parseContext.index(),parseContext.indexQueryParserService());
    context.reset(qSourceParser);
    return context.parseInnerQuery();
  }
 }
