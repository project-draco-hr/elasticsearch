{
  String defaultMapping=jsonBuilder().startObject().startObject("_default_").field("dynamic","strict").endObject().endObject().string();
  client().admin().indices().prepareCreate("index").addMapping("_default_",defaultMapping).get();
  try {
    client().prepareIndex("index","type","id").setSource("test","test").get();
    fail();
  }
 catch (  StrictDynamicMappingException ex) {
  }
  awaitBusy(new Predicate<Object>(){
    @Override public boolean apply(    java.lang.Object input){
      GetMappingsResponse currentMapping=client().admin().indices().prepareGetMappings("index").get();
      return currentMapping.getMappings().get("index").get("type") != null;
    }
  }
);
  String docMapping=jsonBuilder().startObject().startObject("type").startObject("_all").field("enabled",false).endObject().endObject().endObject().string();
  try {
    client().admin().indices().preparePutMapping("index").setType("type").setSource(docMapping).get();
    fail();
  }
 catch (  Exception e) {
  }
  for (  Client client : cluster()) {
    GetMappingsResponse mapping=client.admin().indices().prepareGetMappings("index").setLocal(true).get();
    assertNotNull(mapping.getMappings().get("index").get("type"));
  }
}
