{
  String query=copyToStringFromClasspath("/org/elasticsearch/search/aggregations/bucket/agg-filter-with-empty-bool.json");
  createIndex("testidx");
  index("testidx","apache","1","field","text");
  index("testidx","nginx","2","field","text");
  refresh();
  ensureGreen("testidx");
  SearchResponse searchResponse=client().prepareSearch("testidx").setQuery(matchAllQuery()).get();
  assertThat(searchResponse.getHits().getTotalHits(),equalTo(2l));
  searchResponse=client().prepareSearch("testidx").setSource(query).get();
  assertSearchResponse(searchResponse);
  assertThat(searchResponse.getAggregations().getAsMap().get("issue7240"),instanceOf(Filter.class));
  Filter filterAgg=(Filter)searchResponse.getAggregations().getAsMap().get("issue7240");
  assertThat(filterAgg.getAggregations().getAsMap().get("terms"),instanceOf(StringTerms.class));
  assertThat(((StringTerms)filterAgg.getAggregations().getAsMap().get("terms")).getBuckets().get(0).getDocCount(),equalTo(1l));
}
