{
  builder.startObject(indexTemplateMetaData.name(),XContentBuilder.FieldCaseConversion.NONE);
  builder.field("order",indexTemplateMetaData.order());
  builder.field("template",indexTemplateMetaData.template());
  builder.startObject("settings");
  for (  Map.Entry<String,String> entry : indexTemplateMetaData.settings().getAsMap().entrySet()) {
    builder.field(entry.getKey(),entry.getValue());
  }
  builder.endObject();
  if (params.paramAsBoolean("reduce_mappings",false)) {
    builder.startObject("mappings");
    for (    Map.Entry<String,CompressedString> entry : indexTemplateMetaData.mappings().entrySet()) {
      byte[] mappingSource=entry.getValue().uncompressed();
      XContentParser parser=XContentFactory.xContent(mappingSource).createParser(mappingSource);
      Map<String,Object> mapping=parser.map();
      if (mapping.size() == 1 && mapping.containsKey(entry.getKey())) {
        mapping=(Map<String,Object>)mapping.get(entry.getKey());
      }
      builder.field(entry.getKey());
      builder.map(mapping);
    }
    builder.endObject();
  }
 else {
    builder.startArray("mappings");
    for (    Map.Entry<String,CompressedString> entry : indexTemplateMetaData.mappings().entrySet()) {
      byte[] data=entry.getValue().uncompressed();
      XContentParser parser=XContentFactory.xContent(data).createParser(data);
      Map<String,Object> mapping=parser.mapOrderedAndClose();
      builder.map(mapping);
    }
    builder.endArray();
  }
  for (  Map.Entry<String,IndexMetaData.Custom> entry : indexTemplateMetaData.customs().entrySet()) {
    builder.startObject(entry.getKey(),XContentBuilder.FieldCaseConversion.NONE);
    IndexMetaData.lookupFactorySafe(entry.getKey()).toXContent(entry.getValue(),builder,params);
    builder.endObject();
  }
  builder.endObject();
}
