{
  client().admin().indices().prepareCreate("test").setSettings("index.number_of_shards",1).get();
  indexRandom(true,client().prepareIndex("test","test","1").setSource("foo","bar"),client().prepareIndex("test","test","2").setSource("foo","bar"),client().prepareIndex("test","test","3").setSource("foo","bar"));
  request.setRequestsPerSecond(.000001f);
  request.source().setSize(1);
  ListenableActionFuture<? extends BulkIndexByScrollResponse> responseListener=request.execute();
  ListTasksResponse rethrottleResponse=rethrottle().setActions(actionName).setRequestsPerSecond(Float.POSITIVE_INFINITY).get();
  assertThat(rethrottleResponse.getTasks(),hasSize(1));
  BulkByScrollTask.Status status=(BulkByScrollTask.Status)rethrottleResponse.getTasks().get(0).getStatus();
  assertEquals(Float.POSITIVE_INFINITY,status.getRequestsPerSecond(),Float.MIN_NORMAL);
  BulkIndexByScrollResponse response=responseListener.get();
  assertEquals("Batches didn't match, this may invalidate the test as throttling is done between batches",3,response.getBatches());
}
