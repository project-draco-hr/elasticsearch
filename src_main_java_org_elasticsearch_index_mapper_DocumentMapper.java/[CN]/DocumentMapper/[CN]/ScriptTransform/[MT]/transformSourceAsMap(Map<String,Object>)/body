{
  try {
    ExecutableScript executable=scriptService.executable(new Script(language,script,scriptType,parameters),ScriptContext.Standard.MAPPING);
    Map<String,Object> ctx=new HashMap<>(1);
    ctx.put("_source",sourceAsMap);
    executable.setNextVar("ctx",ctx);
    executable.run();
    ctx=(Map<String,Object>)executable.unwrap(ctx);
    return (Map<String,Object>)ctx.get("_source");
  }
 catch (  Exception e) {
    throw new ElasticsearchIllegalArgumentException("failed to execute script",e);
  }
}
