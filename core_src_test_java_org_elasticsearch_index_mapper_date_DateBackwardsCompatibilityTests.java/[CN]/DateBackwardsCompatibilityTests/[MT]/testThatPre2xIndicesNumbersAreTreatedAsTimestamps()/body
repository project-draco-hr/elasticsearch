{
  long date=2015062301000l;
  XContentBuilder mapping=jsonBuilder().startObject().startObject("properties").startObject("date_field").field("type","date").field("format","yyyyMMddHHSSS").endObject().endObject().endObject();
  index=createIndex(randomVersionBelow2x,mapping);
  XContentBuilder document=XContentFactory.jsonBuilder().startObject().field("date_field",randomBoolean() ? String.valueOf(date) : date).endObject();
  index(document);
  QueryBuilder query=QueryBuilders.rangeQuery("date_field").from("2015-06-23").to("2015-06-24").format("dateOptionalTime");
  SearchResponse response=client().prepareSearch(index).setQuery(query).get();
  assertNoSearchHits(response);
  QueryBuilder timestampQuery=QueryBuilders.rangeQuery("date_field").from(2015062300000L).to(2015062302000L);
  assertHitCount(client().prepareSearch(index).setQuery(timestampQuery).get(),1);
  QueryBuilder regularTimeQuery=QueryBuilders.rangeQuery("date_field").from("2033-11-08").to("2033-11-09").format("dateOptionalTime");
  assertHitCount(client().prepareSearch(index).setQuery(regularTimeQuery).get(),1);
}
