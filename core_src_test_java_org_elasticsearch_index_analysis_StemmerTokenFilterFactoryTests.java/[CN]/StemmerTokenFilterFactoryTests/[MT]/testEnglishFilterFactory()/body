{
  int iters=scaledRandomIntBetween(20,100);
  for (int i=0; i < iters; i++) {
    Version v=VersionUtils.randomVersion(random());
    Settings settings=Settings.settingsBuilder().put("index.analysis.filter.my_english.type","stemmer").put("index.analysis.filter.my_english.language","english").put("index.analysis.analyzer.my_english.tokenizer","whitespace").put("index.analysis.analyzer.my_english.filter","my_english").put(SETTING_VERSION_CREATED,v).put(Environment.PATH_HOME_SETTING.getKey(),createTempDir().toString()).build();
    AnalysisService analysisService=AnalysisTestsHelper.createAnalysisServiceFromSettings(settings);
    TokenFilterFactory tokenFilter=analysisService.tokenFilter("my_english");
    assertThat(tokenFilter,instanceOf(StemmerTokenFilterFactory.class));
    Tokenizer tokenizer=new WhitespaceTokenizer();
    tokenizer.setReader(new StringReader("foo bar"));
    TokenStream create=tokenFilter.create(tokenizer);
    NamedAnalyzer analyzer=analysisService.analyzer("my_english");
    assertThat(create,instanceOf(PorterStemFilter.class));
    assertAnalyzesTo(analyzer,"consolingly",new String[]{"consolingli"});
  }
}
