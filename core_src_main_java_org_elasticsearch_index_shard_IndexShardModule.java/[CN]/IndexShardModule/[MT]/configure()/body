{
  bind(ShardId.class).toInstance(shardId);
  if (useShadowEngine()) {
    bind(IndexShard.class).to(ShadowIndexShard.class).asEagerSingleton();
  }
 else {
    bind(IndexShard.class).asEagerSingleton();
    bind(TranslogService.class).asEagerSingleton();
  }
  Class<? extends InternalEngineFactory> engineFactoryClass=InternalEngineFactory.class;
  String customEngineFactory=settings.get(ENGINE_FACTORY);
  if (customEngineFactory != null) {
    engineFactoryClass=Classes.loadClass(getClass().getClassLoader(),customEngineFactory);
  }
  bind(EngineFactory.class).to(engineFactoryClass);
  bind(StoreRecoveryService.class).asEagerSingleton();
  bind(ShardPercolateService.class).asEagerSingleton();
  bind(ShardTermVectorsService.class).asEagerSingleton();
  bind(IndexSearcherWrappingService.class).asEagerSingleton();
  Multibinder<IndexSearcherWrapper> multibinder=Multibinder.newSetBinder(binder(),IndexSearcherWrapper.class);
}
