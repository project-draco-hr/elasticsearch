{
  boolean fullId=req.paramAsBoolean("full_id",false);
  DiscoveryNodes nodes=state.getState().nodes();
  String masterId=nodes.masterNodeId();
  Table table=getTableWithHeader(req);
  for (  DiscoveryNode node : nodes) {
    NodeInfo info=nodesInfo.getNodesMap().get(node.id());
    NodeStats stats=nodesStats.getNodesMap().get(node.id());
    table.startRow();
    table.addCell(fullId ? node.id() : Strings.substring(node.getId(),0,4));
    table.addCell(info == null ? null : info.getProcess().id());
    table.addCell(node.getHostName());
    table.addCell(node.getHostAddress());
    if (node.address() instanceof InetSocketTransportAddress) {
      table.addCell(((InetSocketTransportAddress)node.address()).address().getPort());
    }
 else {
      table.addCell("-");
    }
    table.addCell(node.getVersion().number());
    table.addCell(info == null ? null : info.getBuild().hashShort());
    table.addCell(info == null ? null : info.getJvm().version());
    table.addCell(stats == null ? null : stats.getFs() == null ? null : stats.getFs().total().getAvailable());
    table.addCell(stats == null ? null : stats.getJvm().getMem().getHeapUsedPrecent());
    table.addCell(info == null ? null : info.getJvm().getMem().getHeapMax());
    table.addCell(stats == null ? null : stats.getOs().mem() == null ? null : stats.getOs().mem().usedPercent());
    table.addCell(info == null ? null : info.getOs().mem() == null ? null : info.getOs().mem().total());
    table.addCell(stats == null ? null : stats.getOs() == null ? null : stats.getOs().getLoadAverage().length < 1 ? null : String.format(Locale.ROOT,"%.2f",stats.getOs().getLoadAverage()[0]));
    table.addCell(stats == null ? null : stats.getJvm().uptime());
    table.addCell(node.clientNode() ? "c" : node.dataNode() ? "d" : "-");
    table.addCell(masterId == null ? "x" : masterId.equals(node.id()) ? "*" : node.masterNode() ? "m" : "-");
    table.addCell(node.name());
    table.addCell(stats == null ? null : stats.getIndices().getCompletion().getSize());
    table.addCell(stats == null ? null : stats.getIndices().getFieldData().getMemorySize());
    table.addCell(stats == null ? null : stats.getIndices().getFieldData().getEvictions());
    table.addCell(stats == null ? null : stats.getIndices().getFilterCache().getMemorySize());
    table.addCell(stats == null ? null : stats.getIndices().getFilterCache().getEvictions());
    table.addCell(stats == null ? null : stats.getIndices().getQueryCache().getMemorySize());
    table.addCell(stats == null ? null : stats.getIndices().getQueryCache().getEvictions());
    table.addCell(stats == null ? null : stats.getIndices().getQueryCache().getHitCount());
    table.addCell(stats == null ? null : stats.getIndices().getQueryCache().getMissCount());
    table.addCell(stats == null ? null : stats.getIndices().getFlush().getTotal());
    table.addCell(stats == null ? null : stats.getIndices().getFlush().getTotalTime());
    table.addCell(stats == null ? null : stats.getIndices().getGet().current());
    table.addCell(stats == null ? null : stats.getIndices().getGet().getTime());
    table.addCell(stats == null ? null : stats.getIndices().getGet().getCount());
    table.addCell(stats == null ? null : stats.getIndices().getGet().getExistsTime());
    table.addCell(stats == null ? null : stats.getIndices().getGet().getExistsCount());
    table.addCell(stats == null ? null : stats.getIndices().getGet().getMissingTime());
    table.addCell(stats == null ? null : stats.getIndices().getGet().getMissingCount());
    table.addCell(stats == null ? null : stats.getIndices().getIdCache().getMemorySize());
    table.addCell(stats == null ? null : stats.getIndices().getIndexing().getTotal().getDeleteCurrent());
    table.addCell(stats == null ? null : stats.getIndices().getIndexing().getTotal().getDeleteTime());
    table.addCell(stats == null ? null : stats.getIndices().getIndexing().getTotal().getDeleteCount());
    table.addCell(stats == null ? null : stats.getIndices().getIndexing().getTotal().getIndexCurrent());
    table.addCell(stats == null ? null : stats.getIndices().getIndexing().getTotal().getIndexTime());
    table.addCell(stats == null ? null : stats.getIndices().getIndexing().getTotal().getIndexCount());
    table.addCell(stats == null ? null : stats.getIndices().getMerge().getCurrent());
    table.addCell(stats == null ? null : stats.getIndices().getMerge().getCurrentNumDocs());
    table.addCell(stats == null ? null : stats.getIndices().getMerge().getCurrentSize());
    table.addCell(stats == null ? null : stats.getIndices().getMerge().getTotal());
    table.addCell(stats == null ? null : stats.getIndices().getMerge().getTotalNumDocs());
    table.addCell(stats == null ? null : stats.getIndices().getMerge().getTotalSize());
    table.addCell(stats == null ? null : stats.getIndices().getMerge().getTotalTime());
    table.addCell(stats == null ? null : stats.getIndices().getPercolate().getCurrent());
    table.addCell(stats == null ? null : stats.getIndices().getPercolate().getMemorySize());
    table.addCell(stats == null ? null : stats.getIndices().getPercolate().getNumQueries());
    table.addCell(stats == null ? null : stats.getIndices().getPercolate().getTime());
    table.addCell(stats == null ? null : stats.getIndices().getPercolate().getCount());
    table.addCell(stats == null ? null : stats.getIndices().getRefresh().getTotal());
    table.addCell(stats == null ? null : stats.getIndices().getRefresh().getTotalTime());
    table.addCell(stats == null ? null : stats.getIndices().getSearch().getTotal().getFetchCurrent());
    table.addCell(stats == null ? null : stats.getIndices().getSearch().getTotal().getFetchTime());
    table.addCell(stats == null ? null : stats.getIndices().getSearch().getTotal().getFetchCount());
    table.addCell(stats == null ? null : stats.getIndices().getSearch().getOpenContexts());
    table.addCell(stats == null ? null : stats.getIndices().getSearch().getTotal().getQueryCurrent());
    table.addCell(stats == null ? null : stats.getIndices().getSearch().getTotal().getQueryTime());
    table.addCell(stats == null ? null : stats.getIndices().getSearch().getTotal().getQueryCount());
    table.addCell(stats == null ? null : stats.getIndices().getSegments().getCount());
    table.addCell(stats == null ? null : stats.getIndices().getSegments().getMemory());
    table.addCell(stats == null ? null : stats.getIndices().getSegments().getIndexWriterMemory());
    table.addCell(stats == null ? null : stats.getIndices().getSegments().getIndexWriterMaxMemory());
    table.addCell(stats == null ? null : stats.getIndices().getSegments().getVersionMapMemory());
    table.addCell(stats == null ? null : stats.getIndices().getSegments().getFixedBitSetMemory());
    table.addCell(stats == null ? null : stats.getIndices().getSuggest().getCurrent());
    table.addCell(stats == null ? null : stats.getIndices().getSuggest().getTime());
    table.addCell(stats == null ? null : stats.getIndices().getSuggest().getCount());
    table.endRow();
  }
  return table;
}
