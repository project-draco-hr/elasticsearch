{
  Settings clientSettings=Settings.settingsBuilder().put("name","qa_smoke_client_" + counter.getAndIncrement()).put(InternalSettingsPreparer.IGNORE_SYSTEM_PROPERTIES_SETTING,true).put("client.transport.ignore_cluster_name",true).put("path.home",tempDir).put("node.mode","network").build();
  TransportClient.Builder transportClientBuilder=TransportClient.builder().settings(clientSettings);
  TransportClient client=transportClientBuilder.build().addTransportAddresses(transportAddresses);
  logger.info("--> Elasticsearch Java TransportClient started");
  Exception clientException=null;
  try {
    ClusterHealthResponse health=client.admin().cluster().prepareHealth().get();
    logger.info("--> connected to [{}] cluster which is running [{}] node(s).",health.getClusterName(),health.getNumberOfNodes());
  }
 catch (  Exception e) {
    clientException=e;
  }
  assumeNoException("Sounds like your cluster is not running at " + clusterAddresses,clientException);
  return client;
}
