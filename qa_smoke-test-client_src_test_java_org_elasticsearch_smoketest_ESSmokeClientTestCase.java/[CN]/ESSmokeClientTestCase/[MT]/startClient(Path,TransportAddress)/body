{
  Settings clientSettings=Settings.builder().put("node.name","qa_smoke_client_" + counter.getAndIncrement()).put("client.transport.ignore_cluster_name",true).put(Environment.PATH_HOME_SETTING.getKey(),tempDir).put(Node.NODE_MODE_SETTING.getKey(),"network").build();
  TransportClient.Builder transportClientBuilder=TransportClient.builder().settings(clientSettings);
  TransportClient client=transportClientBuilder.build().addTransportAddresses(transportAddresses);
  logger.info("--> Elasticsearch Java TransportClient started");
  Exception clientException=null;
  try {
    ClusterHealthResponse health=client.admin().cluster().prepareHealth().get();
    logger.info("--> connected to [{}] cluster which is running [{}] node(s).",health.getClusterName(),health.getNumberOfNodes());
  }
 catch (  Exception e) {
    clientException=e;
  }
  assumeNoException("Sounds like your cluster is not running at " + clusterAddresses,clientException);
  return client;
}
