{
  mapperService.merge(childType,new CompressedXContent(PutMappingRequest.buildFromSimplifiedDef(childType,"_parent","type=" + parentType).string()),true);
  mapperService.merge(grandChildType,new CompressedXContent(PutMappingRequest.buildFromSimplifiedDef(grandChildType,"_parent","type=" + childType).string()),true);
  Document d=new Document();
  d.add(new StringField(UidFieldMapper.NAME,Uid.createUid(parentType,"1"),Field.Store.NO));
  d.add(createJoinField(parentType,"1"));
  writer.addDocument(d);
  d=new Document();
  d.add(new StringField(UidFieldMapper.NAME,Uid.createUid(childType,"2"),Field.Store.NO));
  d.add(new StringField(ParentFieldMapper.NAME,Uid.createUid(parentType,"1"),Field.Store.NO));
  d.add(createJoinField(parentType,"1"));
  d.add(createJoinField(childType,"2"));
  writer.addDocument(d);
  writer.commit();
  d=new Document();
  d.add(new StringField(UidFieldMapper.NAME,Uid.createUid(childType,"3"),Field.Store.NO));
  d.add(new StringField(ParentFieldMapper.NAME,Uid.createUid(parentType,"1"),Field.Store.NO));
  d.add(createJoinField(parentType,"1"));
  d.add(createJoinField(childType,"3"));
  writer.addDocument(d);
  d=new Document();
  d.add(new StringField(UidFieldMapper.NAME,Uid.createUid(parentType,"2"),Field.Store.NO));
  d.add(createJoinField(parentType,"2"));
  writer.addDocument(d);
  d=new Document();
  d.add(new StringField(UidFieldMapper.NAME,Uid.createUid(childType,"4"),Field.Store.NO));
  d.add(new StringField(ParentFieldMapper.NAME,Uid.createUid(parentType,"2"),Field.Store.NO));
  d.add(createJoinField(parentType,"2"));
  d.add(createJoinField(childType,"4"));
  writer.addDocument(d);
  d=new Document();
  d.add(new StringField(UidFieldMapper.NAME,Uid.createUid(childType,"5"),Field.Store.NO));
  d.add(new StringField(ParentFieldMapper.NAME,Uid.createUid(parentType,"1"),Field.Store.NO));
  d.add(createJoinField(parentType,"1"));
  d.add(createJoinField(childType,"5"));
  writer.addDocument(d);
  writer.commit();
  d=new Document();
  d.add(new StringField(UidFieldMapper.NAME,Uid.createUid(grandChildType,"6"),Field.Store.NO));
  d.add(new StringField(ParentFieldMapper.NAME,Uid.createUid(childType,"2"),Field.Store.NO));
  d.add(createJoinField(childType,"2"));
  writer.addDocument(d);
  d=new Document();
  d.add(new StringField(UidFieldMapper.NAME,Uid.createUid("other-type","1"),Field.Store.NO));
  writer.addDocument(d);
}
