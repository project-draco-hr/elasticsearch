{
  if (optimizeSingleShard && searchRequest.searchType() != SCAN) {
    try {
      ClusterState clusterState=clusterService.state();
      searchRequest.indices(clusterState.metaData().concreteIndices(searchRequest.indices()));
      GroupShardsIterator groupIt=clusterService.operationRouting().searchShards(clusterState,searchRequest.indices(),searchRequest.queryHint(),searchRequest.routing());
      if (groupIt.size() == 1) {
        searchRequest.searchType(QUERY_AND_FETCH);
      }
    }
 catch (    IndexMissingException e) {
    }
catch (    Exception e) {
      logger.debug("failed to optimize search type, continue as normal",e);
    }
  }
  if (searchRequest.searchType() == DFS_QUERY_THEN_FETCH) {
    dfsQueryThenFetchAction.execute(searchRequest,listener);
  }
 else   if (searchRequest.searchType() == SearchType.QUERY_THEN_FETCH) {
    queryThenFetchAction.execute(searchRequest,listener);
  }
 else   if (searchRequest.searchType() == SearchType.DFS_QUERY_AND_FETCH) {
    dfsQueryAndFetchAction.execute(searchRequest,listener);
  }
 else   if (searchRequest.searchType() == SearchType.QUERY_AND_FETCH) {
    queryAndFetchAction.execute(searchRequest,listener);
  }
 else   if (searchRequest.searchType() == SearchType.SCAN) {
    scanAction.execute(searchRequest,listener);
  }
}
