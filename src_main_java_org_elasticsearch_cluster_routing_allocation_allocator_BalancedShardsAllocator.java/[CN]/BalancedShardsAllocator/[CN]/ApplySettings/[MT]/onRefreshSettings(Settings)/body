{
  final float indexBalance=settings.getAsFloat(SETTING_INDEX_BALANCE_FACTOR,weightFunction.indexBalance);
  final float shardBalance=settings.getAsFloat(SETTING_SHARD_BALANCE_FACTOR,weightFunction.shardBalance);
  final float primaryBalance=settings.getAsFloat(SETTING_PRIMARY_BALANCE_FACTOR,weightFunction.primaryBalance);
  float threshold=settings.getAsFloat(SETTING_THRESHOLD,BalancedShardsAllocator.this.threshold);
  if (threshold <= 0.0f) {
    throw new ElasticSearchIllegalArgumentException("threshold must be greater than 0.0f but was: " + threshold);
  }
  BalancedShardsAllocator.this.threshold=threshold;
  BalancedShardsAllocator.this.weightFunction=new WeightFunction(indexBalance,shardBalance,primaryBalance);
}
