{
  try {
    Set<PosixFilePermission> perms=new HashSet<>();
    perms.add(PosixFilePermission.OWNER_EXECUTE);
    perms.add(PosixFilePermission.OWNER_READ);
    perms.add(PosixFilePermission.OWNER_WRITE);
    perms.add(PosixFilePermission.GROUP_READ);
    perms.add(PosixFilePermission.GROUP_EXECUTE);
    perms.add(PosixFilePermission.OTHERS_READ);
    perms.add(PosixFilePermission.OTHERS_EXECUTE);
    return Files.createTempDirectory(pluginsDir,".installing-",PosixFilePermissions.asFileAttribute(perms));
  }
 catch (  IllegalArgumentException e) {
    final StackTraceElement[] elements=e.getStackTrace();
    if (elements.length >= 1 && elements[0].getClassName().equals("com.google.common.jimfs.AttributeService") && elements[0].getMethodName().equals("setAttributeInternal")) {
      return stagingDirectoryWithoutPosixPermissions(pluginsDir);
    }
 else {
      throw e;
    }
  }
catch (  UnsupportedOperationException e) {
    return stagingDirectoryWithoutPosixPermissions(pluginsDir);
  }
}
