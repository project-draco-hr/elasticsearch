{
  client().admin().indices().prepareCreate("test").addMapping("type1","field1","type=string,index_options=docs").setSettings("index.number_of_shards",1).get();
  client().prepareIndex("test","type1","1").setSource("field1","quick brown fox","field2","quick brown fox").execute().actionGet();
  client().prepareIndex("test","type1","2").setSource("field1","quick lazy huge brown fox","field2","quick lazy huge brown fox").setRefresh(true).execute().actionGet();
  CountResponse countResponse=client().prepareCount().setQuery(QueryBuilders.matchQuery("field2","quick brown").type(Type.PHRASE).slop(0)).get();
  assertHitCount(countResponse,1l);
  try {
    client().prepareCount().setQuery(QueryBuilders.matchQuery("field1","quick brown").type(Type.PHRASE).slop(0)).get();
  }
 catch (  SearchPhaseExecutionException e) {
    assertTrue("wrong exception message " + e.getMessage(),e.getMessage().endsWith("IllegalStateException[field \"field1\" was indexed without position data; cannot run PhraseQuery (term=quick)]; }"));
  }
}
