{
  assertAcked(prepareCreate("test").addMapping("type1","field1","type=string,index_options=docs"));
  client().prepareIndex("test","type1","1").setSource("field1","quick brown fox","field2","quick brown fox").get();
  client().prepareIndex("test","type1","2").setSource("field1","quick lazy huge brown fox","field2","quick lazy huge brown fox").get();
  refresh();
  CountResponse countResponse=client().prepareCount().setQuery(QueryBuilders.matchQuery("field2","quick brown").type(Type.PHRASE).slop(0)).get();
  assertHitCount(countResponse,1l);
  countResponse=client().prepareCount().setQuery(QueryBuilders.matchQuery("field1","quick brown").type(Type.PHRASE).slop(0)).get();
  assertHitCount(countResponse,0l);
  assertThat(countResponse.getFailedShards(),anyOf(equalTo(1),equalTo(2)));
  assertThat(countResponse.getFailedShards(),equalTo(countResponse.getShardFailures().length));
  for (  ShardOperationFailedException shardFailure : countResponse.getShardFailures()) {
    assertThat(shardFailure.status(),equalTo(RestStatus.INTERNAL_SERVER_ERROR));
    assertThat(shardFailure.reason(),containsString("[field \"field1\" was indexed without position data; cannot run PhraseQuery (term=quick)]"));
  }
}
