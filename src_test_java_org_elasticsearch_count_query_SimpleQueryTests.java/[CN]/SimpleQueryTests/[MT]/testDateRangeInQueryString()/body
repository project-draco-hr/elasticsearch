{
  client().admin().indices().prepareCreate("test").setSettings(ImmutableSettings.settingsBuilder().put("index.number_of_shards",1)).execute().actionGet();
  String aMonthAgo=ISODateTimeFormat.yearMonthDay().print(new DateTime(DateTimeZone.UTC).minusMonths(1));
  String aMonthFromNow=ISODateTimeFormat.yearMonthDay().print(new DateTime(DateTimeZone.UTC).plusMonths(1));
  client().prepareIndex("test","type","1").setSource("past",aMonthAgo,"future",aMonthFromNow).execute().actionGet();
  client().admin().indices().prepareRefresh().execute().actionGet();
  CountResponse countResponse=client().prepareCount().setQuery(queryString("past:[now-2M/d TO now/d]")).execute().actionGet();
  assertHitCount(countResponse,1l);
  countResponse=client().prepareCount().setQuery(queryString("future:[now/d TO now+2M/d]").lowercaseExpandedTerms(false)).execute().actionGet();
  assertHitCount(countResponse,1l);
  try {
    client().prepareCount().setQuery(queryString("future:[now/D TO now+2M/d]").lowercaseExpandedTerms(false)).execute().actionGet();
    fail("D is an unsupported unit in date math");
  }
 catch (  Exception e) {
  }
}
