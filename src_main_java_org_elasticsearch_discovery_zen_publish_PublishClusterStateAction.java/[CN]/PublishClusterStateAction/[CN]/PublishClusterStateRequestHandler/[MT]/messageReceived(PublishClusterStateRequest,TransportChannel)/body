{
  Compressor compressor=CompressorFactory.compressor(request.clusterStateInBytes);
  StreamInput in;
  if (compressor != null) {
    in=CachedStreamInput.cachedHandlesCompressed(compressor,request.clusterStateInBytes.streamInput());
  }
 else {
    in=CachedStreamInput.cachedHandles(request.clusterStateInBytes.streamInput());
  }
  in.setVersion(request.version);
  ClusterState clusterState=ClusterState.Builder.readFrom(in,nodesProvider.nodes().localNode());
  listener.onNewClusterState(clusterState);
  channel.sendResponse(TransportResponse.Empty.INSTANCE);
}
