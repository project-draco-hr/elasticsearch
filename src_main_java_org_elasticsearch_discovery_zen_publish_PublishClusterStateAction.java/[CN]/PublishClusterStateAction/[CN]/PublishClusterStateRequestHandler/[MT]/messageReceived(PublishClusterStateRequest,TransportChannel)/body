{
  Compressor compressor=CompressorFactory.compressor(request.clusterStateInBytes.bytes(),request.clusterStateInBytes.offset(),request.clusterStateInBytes.length());
  BytesStreamInput bytes=new BytesStreamInput(request.clusterStateInBytes.bytes(),request.clusterStateInBytes.offset(),request.clusterStateInBytes.length(),false);
  StreamInput in;
  if (compressor != null) {
    in=CachedStreamInput.cachedHandlesCompressed(compressor,bytes);
  }
 else {
    in=CachedStreamInput.cachedHandles(bytes);
  }
  ClusterState clusterState=ClusterState.Builder.readFrom(in,nodesProvider.nodes().localNode());
  listener.onNewClusterState(clusterState);
  channel.sendResponse(VoidStreamable.INSTANCE);
}
