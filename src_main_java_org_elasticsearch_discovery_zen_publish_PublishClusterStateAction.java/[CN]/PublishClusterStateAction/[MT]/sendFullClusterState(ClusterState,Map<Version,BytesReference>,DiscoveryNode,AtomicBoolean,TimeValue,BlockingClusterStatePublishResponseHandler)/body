{
  BytesReference bytes=null;
  if (serializedStates != null) {
    bytes=serializedStates.get(node.version());
  }
  if (bytes == null) {
    try {
      bytes=serializeFullClusterState(clusterState,node.version());
      if (serializedStates != null) {
        serializedStates.put(node.version(),bytes);
      }
    }
 catch (    Throwable e) {
      logger.warn("failed to serialize cluster_state before publishing it to node {}",e,node);
      publishResponseHandler.onFailure(node,e);
      return;
    }
  }
  publishClusterStateToNode(clusterState,bytes,node,timedOutWaitingForNodes,publishTimeout,publishResponseHandler,false);
}
