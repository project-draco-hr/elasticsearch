{
  GeoIpProcessor.Factory factory=new GeoIpProcessor.Factory(databaseReaders);
  Set<GeoIpProcessor.Field> fields=EnumSet.noneOf(GeoIpProcessor.Field.class);
  List<String> fieldNames=new ArrayList<>();
  int numFields=scaledRandomIntBetween(1,GeoIpProcessor.Field.values().length);
  for (int i=0; i < numFields; i++) {
    GeoIpProcessor.Field field=GeoIpProcessor.Field.values()[i];
    fields.add(field);
    fieldNames.add(field.name().toLowerCase(Locale.ROOT));
  }
  Map<String,Object> config=new HashMap<>();
  config.put("source_field","_field");
  config.put("fields",fieldNames);
  GeoIpProcessor processor=factory.create(config);
  assertThat(processor.getSourceField(),equalTo("_field"));
  assertThat(processor.getFields(),equalTo(fields));
}
