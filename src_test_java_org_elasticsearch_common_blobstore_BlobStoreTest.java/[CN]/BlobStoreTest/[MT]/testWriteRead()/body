{
  BlobContainer store=newBlobContainer();
  int length=randomIntBetween(10,scaledRandomIntBetween(1024,1 << 16));
  byte[] data=new byte[length];
  for (int i=0; i < data.length; i++) {
    data[i]=(byte)randomInt();
  }
  try (OutputStream stream=store.createOutput("foobar")){
    stream.write(data);
  }
   InputStream stream=store.openInput("foobar");
  BytesRef target=new BytesRef();
  while (target.length < data.length) {
    byte[] buffer=new byte[scaledRandomIntBetween(1,data.length - target.length)];
    int offset=scaledRandomIntBetween(0,buffer.length - 1);
    int read=stream.read(buffer,offset,buffer.length - offset);
    target.append(new BytesRef(buffer,offset,read));
  }
  assertEquals(data.length,target.length);
  assertArrayEquals(data,Arrays.copyOfRange(target.bytes,target.offset,target.length));
}
