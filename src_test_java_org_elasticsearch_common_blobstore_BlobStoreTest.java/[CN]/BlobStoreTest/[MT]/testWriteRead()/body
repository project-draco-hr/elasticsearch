{
  final BlobStore store=newBlobStore();
  final BlobContainer container=store.blobContainer(new BlobPath());
  int length=randomIntBetween(10,scaledRandomIntBetween(1024,1 << 16));
  byte[] data=new byte[length];
  for (int i=0; i < data.length; i++) {
    data[i]=(byte)randomInt();
  }
  try (OutputStream stream=container.createOutput("foobar")){
    stream.write(data);
  }
   try (InputStream stream=container.openInput("foobar")){
    BytesRefBuilder target=new BytesRefBuilder();
    while (target.length() < data.length) {
      byte[] buffer=new byte[scaledRandomIntBetween(1,data.length - target.length())];
      int offset=scaledRandomIntBetween(0,buffer.length - 1);
      int read=stream.read(buffer,offset,buffer.length - offset);
      target.append(new BytesRef(buffer,offset,read));
    }
    assertEquals(data.length,target.length());
    assertArrayEquals(data,Arrays.copyOfRange(target.bytes(),0,target.length()));
  }
   store.close();
}
