{
  if (fieldName == null && fieldsNames == null && script == null) {
    throw new SearchSourceBuilderException("field/fields/script must be set on terms facet for facet [" + name + "]");
  }
  builder.startObject(name);
  builder.startObject(TermsFacet.TYPE);
  if (fieldsNames != null) {
    if (fieldsNames.length == 1) {
      builder.field("field",fieldsNames[0]);
    }
 else {
      builder.field("fields",fieldsNames);
    }
  }
 else   if (fieldName != null) {
    builder.field("field",fieldName);
  }
  builder.field("size",size);
  if (exclude != null) {
    builder.startArray("exclude");
    for (    String ex : exclude) {
      builder.value(ex);
    }
    builder.endArray();
  }
  if (regex != null) {
    builder.field("regex",regex);
    if (regexFlags != 0) {
      builder.field("regex_flags",Regex.flagsToString(regexFlags));
    }
  }
  if (comparatorType != null) {
    builder.field("order",comparatorType.name().toLowerCase());
  }
  if (allTerms != null) {
    builder.field("all_terms",allTerms);
  }
  if (script != null) {
    builder.field("script",script);
    if (lang != null) {
      builder.field("lang",lang);
    }
    if (this.params != null) {
      builder.field("params",this.params);
    }
  }
  builder.endObject();
  addFilterFacetAndGlobal(builder,params);
  builder.endObject();
  return builder;
}
