{
  verifyNotClosed();
  if (canIndex()) {
    long ramBytesUsed=getEngine().indexBufferRAMBytesUsed();
    indexingMemoryController.addWritingBytes(this,ramBytesUsed);
    try {
      logger.debug("refresh with source [{}] indexBufferRAMBytesUsed [{}]",source,new ByteSizeValue(ramBytesUsed));
      long time=System.nanoTime();
      getEngine().refresh(source);
      refreshMetric.inc(System.nanoTime() - time);
    }
  finally {
      indexingMemoryController.removeWritingBytes(this,ramBytesUsed);
    }
  }
 else {
    logger.debug("refresh with source [{}]",source);
    long time=System.nanoTime();
    getEngine().refresh(source);
    refreshMetric.inc(System.nanoTime() - time);
  }
}
