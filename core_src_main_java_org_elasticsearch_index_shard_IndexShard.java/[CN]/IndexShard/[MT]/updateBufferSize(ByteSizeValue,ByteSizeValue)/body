{
  final EngineConfig config=engineConfig;
  final ByteSizeValue preValue=config.getIndexingBufferSize();
  config.setIndexingBufferSize(shardIndexingBufferSize);
  Engine engine=engineUnsafe();
  if (engine == null) {
    logger.debug("updateBufferSize: engine is closed; skipping");
    return;
  }
  if (preValue.bytes() != shardIndexingBufferSize.bytes()) {
    engine.onSettingsChanged();
    logger.debug("updating index_buffer_size from [{}] to [{}]",preValue,shardIndexingBufferSize);
    long iwBytesUsed=engine.indexWriterRAMBytesUsed();
    if (shardIndexingBufferSize.bytes() < iwBytesUsed) {
      logger.debug("refresh because index buffer decreased to [{}] and IndexWriter is now using [{}] bytes",shardIndexingBufferSize,iwBytesUsed);
      try {
        refresh("update index buffer");
      }
 catch (      Throwable e) {
        logger.warn("failed to refresh after decreasing index buffer",e);
      }
    }
  }
  engine.getTranslog().updateBuffer(shardTranslogBufferSize);
}
