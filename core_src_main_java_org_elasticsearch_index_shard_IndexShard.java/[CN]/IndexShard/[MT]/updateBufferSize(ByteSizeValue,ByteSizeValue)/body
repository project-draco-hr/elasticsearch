{
  final EngineConfig config=engineConfig;
  final ByteSizeValue preValue=config.getIndexingBufferSize();
  config.setIndexingBufferSize(shardIndexingBufferSize);
  Engine engine=engineUnsafe();
  if (engine == null) {
    logger.debug("updateBufferSize: engine is closed; skipping");
    return;
  }
  if (preValue.bytes() != shardIndexingBufferSize.bytes()) {
    if (shardIndexingBufferSize == EngineConfig.INACTIVE_SHARD_INDEXING_BUFFER) {
      logger.debug("updating index_buffer_size from [{}] to (inactive) [{}]",preValue,shardIndexingBufferSize);
      try {
        refresh("update index buffer");
      }
 catch (      Throwable e) {
        logger.warn("failed to refresh after setting shard to inactive",e);
      }
    }
 else {
      logger.debug("updating index_buffer_size from [{}] to [{}]",preValue,shardIndexingBufferSize);
    }
    engine.onSettingsChanged();
  }
  engine.getTranslog().updateBuffer(shardTranslogBufferSize);
}
