{
  if (state != IndexShardState.RECOVERING) {
    throw new IndexShardNotRecoveringException(shardId,state);
  }
  recoveryState.setStage(RecoveryState.Stage.VERIFY_INDEX);
  if (Booleans.parseBoolean(checkIndexOnStartup,false)) {
    try {
      checkIndex();
    }
 catch (    IOException ex) {
      throw new RecoveryFailedException(recoveryState,"check index failed",ex);
    }
  }
  recoveryState.setStage(RecoveryState.Stage.TRANSLOG);
  engineConfig.setEnableGcDeletes(false);
  createNewEngine(skipTranslogRecovery,engineConfig);
  return engineConfig.getTranslogRecoveryPerformer().getRecoveredTypes();
}
