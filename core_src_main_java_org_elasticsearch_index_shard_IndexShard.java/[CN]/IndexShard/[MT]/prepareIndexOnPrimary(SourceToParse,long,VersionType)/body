{
  try {
    if (shardRouting.primary() == false) {
      throw new IllegalIndexShardStateException(shardId,state,"shard is not a primary");
    }
    return prepareIndex(docMapper(source.type()),source,version,versionType,Engine.Operation.Origin.PRIMARY);
  }
 catch (  Throwable t) {
    verifyNotClosed(t);
    throw t;
  }
}
