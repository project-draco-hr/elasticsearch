{
  IndexShardState state=this.state;
  if (origin == Engine.Operation.Origin.PRIMARY) {
    if (state != IndexShardState.STARTED && state != IndexShardState.RELOCATED) {
      throw new IllegalIndexShardStateException(shardId,state,"operation only allowed when started/recovering, origin [" + origin + "]");
    }
  }
 else {
    if (state != IndexShardState.STARTED && state != IndexShardState.RELOCATED && state != IndexShardState.RECOVERING && state != IndexShardState.POST_RECOVERY) {
      throw new IllegalIndexShardStateException(shardId,state,"operation only allowed when started/recovering, origin [" + origin + "]");
    }
  }
}
