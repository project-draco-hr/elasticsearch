{
  super(shardId,indexSettings);
  this.codecService=provider.getCodecService();
  this.warmer=provider.getWarmer();
  this.deletionPolicy=new SnapshotDeletionPolicy(new KeepOnlyLastCommitDeletionPolicy());
  this.similarityService=provider.getSimilarityService();
  Objects.requireNonNull(store,"Store must be provided to the index shard");
  this.engineFactory=provider.getFactory();
  this.indicesLifecycle=(InternalIndicesLifecycle)provider.getIndicesLifecycle();
  this.store=store;
  this.mergeSchedulerConfig=new MergeSchedulerConfig(indexSettings);
  this.threadPool=provider.getThreadPool();
  this.mapperService=provider.getMapperService();
  this.queryParserService=provider.getQueryParserService();
  this.indexCache=provider.getIndexCache();
  this.indexAliasesService=provider.getIndexAliasesService();
  this.indexingService=new ShardIndexingService(shardId,indexSettings);
  this.getService=new ShardGetService(this,mapperService);
  this.termVectorsService=provider.getTermVectorsService();
  this.searchService=new ShardSearchStats(indexSettings);
  this.shardWarmerService=new ShardIndexWarmerService(shardId,indexSettings);
  this.indicesQueryCache=provider.getIndicesQueryCache();
  this.shardQueryCache=new ShardRequestCache(shardId,indexSettings);
  this.shardFieldData=new ShardFieldData();
  this.shardPercolateService=new ShardPercolateService(shardId,indexSettings);
  this.indexFieldDataService=provider.getIndexFieldDataService();
  this.percolatorQueriesRegistry=new PercolatorQueriesRegistry(shardId,indexSettings,queryParserService,indexingService,indicesLifecycle,mapperService,indexFieldDataService,shardPercolateService);
  this.shardBitsetFilterCache=new ShardBitsetFilterCache(shardId,indexSettings);
  state=IndexShardState.CREATED;
  this.refreshInterval=indexSettings.getAsTime(INDEX_REFRESH_INTERVAL,EngineConfig.DEFAULT_REFRESH_INTERVAL);
  this.flushOnClose=indexSettings.getAsBoolean(INDEX_FLUSH_ON_CLOSE,true);
  this.path=path;
  this.mergePolicyConfig=new MergePolicyConfig(logger,indexSettings);
  logger.debug("state: [CREATED]");
  this.checkIndexOnStartup=indexSettings.get("index.shard.check_on_startup","false");
  this.translogConfig=new TranslogConfig(shardId,shardPath().resolveTranslog(),indexSettings,getFromSettings(logger,indexSettings,Translog.Durabilty.REQUEST),provider.getBigArrays(),threadPool);
  final QueryCachingPolicy cachingPolicy;
  if (indexSettings.getAsBoolean(IndexCacheModule.QUERY_CACHE_EVERYTHING,false)) {
    cachingPolicy=QueryCachingPolicy.ALWAYS_CACHE;
  }
 else {
    cachingPolicy=new UsageTrackingQueryCachingPolicy();
  }
  this.engineConfig=newEngineConfig(translogConfig,cachingPolicy);
  this.flushThresholdOperations=indexSettings.getAsInt(INDEX_TRANSLOG_FLUSH_THRESHOLD_OPS,indexSettings.getAsInt("index.translog.flush_threshold",Integer.MAX_VALUE));
  this.flushThresholdSize=indexSettings.getAsBytesSize(INDEX_TRANSLOG_FLUSH_THRESHOLD_SIZE,new ByteSizeValue(512,ByteSizeUnit.MB));
  this.disableFlush=indexSettings.getAsBoolean(INDEX_TRANSLOG_DISABLE_FLUSH,false);
  this.indexShardOperationCounter=new IndexShardOperationCounter(logger,shardId);
  this.searcherWrapper=provider.getIndexSearcherWrapper();
}
