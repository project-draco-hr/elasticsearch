{
  MappedFieldType fieldType=fullNameToFieldType.get(fieldMapper.fieldType().names().fullName());
  if (fieldType != null) {
    List<String> conflicts=new ArrayList<>();
    final Set<String> types=fullNameToTypes.get(fieldMapper.fieldType().names().fullName());
    boolean strict=beStrict(type,types,updateAllTypes);
    fieldType.checkCompatibility(fieldMapper.fieldType(),conflicts,strict);
    if (conflicts.isEmpty() == false) {
      throw new IllegalArgumentException("Mapper for [" + fieldMapper.fieldType().names().fullName() + "] conflicts with existing mapping in other types:\n"+ conflicts.toString());
    }
  }
  fieldType=indexNameToFieldType.get(fieldMapper.fieldType().names().indexName());
  if (fieldType != null) {
    List<String> conflicts=new ArrayList<>();
    final Set<String> types=indexNameToTypes.get(fieldMapper.fieldType().names().indexName());
    boolean strict=beStrict(type,types,updateAllTypes);
    fieldType.checkCompatibility(fieldMapper.fieldType(),conflicts,strict);
    if (conflicts.isEmpty() == false) {
      throw new IllegalArgumentException("Mapper for [" + fieldMapper.fieldType().names().fullName() + "] conflicts with mapping with the same index name in other types"+ conflicts.toString());
    }
  }
}
