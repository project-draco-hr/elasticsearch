{
  try {
    client.admin().indices().prepareDelete("test").execute().actionGet();
  }
 catch (  Exception e) {
  }
  client.admin().indices().prepareCreate("test").setSettings(settingsBuilder().put("index.number_of_shards","1").put("index.number_of_replicas",0).put("index.routing.allocation.include.tag","A")).execute().actionGet();
  client.admin().cluster().prepareHealth().setWaitForEvents(Priority.LANGUID).setWaitForGreenStatus().execute().actionGet();
  ClusterSearchShardsResponse response=client("node1").admin().cluster().prepareSearchShards("test").execute().actionGet();
  assertThat(response.getGroups().length,equalTo(1));
  assertThat(response.getGroups()[0].getIndex(),equalTo("test"));
  assertThat(response.getGroups()[0].getShardId(),equalTo(0));
  assertThat(response.getGroups()[0].getShards().length,equalTo(1));
  assertThat(response.getNodes().length,equalTo(1));
  assertThat(response.getGroups()[0].getShards()[0].currentNodeId(),equalTo(response.getNodes()[0].getId()));
  response=client("node2").admin().cluster().prepareSearchShards("test").setRouting("A").execute().actionGet();
  assertThat(response.getGroups().length,equalTo(1));
  assertThat(response.getGroups()[0].getIndex(),equalTo("test"));
  assertThat(response.getGroups()[0].getShardId(),equalTo(0));
  assertThat(response.getGroups()[0].getShards().length,equalTo(1));
  assertThat(response.getNodes().length,equalTo(1));
  assertThat(response.getGroups()[0].getShards()[0].currentNodeId(),equalTo(response.getNodes()[0].getId()));
}
