{
  try {
    client.admin().indices().prepareDelete("test").execute().actionGet();
  }
 catch (  Exception e) {
  }
  client.admin().indices().prepareCreate("test").setSettings(settingsBuilder().put("index.number_of_shards","4").put("index.number_of_replicas",0).put("index.routing.allocation.include.tag","A")).execute().actionGet();
  client.admin().cluster().prepareHealth().setWaitForEvents(Priority.LANGUID).setWaitForGreenStatus().execute().actionGet();
  ClusterSearchShardsResponse response=client("node1").admin().cluster().prepareSearchShards("test").execute().actionGet();
  assertThat(response.getGroups().length,equalTo(4));
  assertThat(response.getGroups()[0].getIndex(),equalTo("test"));
  assertThat(response.getNodes().length,equalTo(1));
  assertThat(response.getGroups()[0].getShards()[0].currentNodeId(),equalTo(response.getNodes()[0].getId()));
  response=client("node1").admin().cluster().prepareSearchShards("test").setRouting("ABC").execute().actionGet();
  assertThat(response.getGroups().length,equalTo(1));
  response=client("node1").admin().cluster().prepareSearchShards("test").setPreference("_shards:2").execute().actionGet();
  assertThat(response.getGroups().length,equalTo(1));
  assertThat(response.getGroups()[0].getShardId(),equalTo(2));
}
