{
  ValuesSourceConfig config;
  while (parent != null) {
    if (parent instanceof ValuesSourceBased) {
      config=((ValuesSourceBased)parent).valuesSourceConfig();
      if (config != null && config.valid()) {
        if (requiredValuesSourceType == null || requiredValuesSourceType.isAssignableFrom(config.valueSourceType())) {
          return (ValuesSourceConfig<VS>)config;
        }
      }
    }
    parent=parent.parent();
  }
  throw new AggregationExecutionException("could not find the appropriate value context to perform aggregation [" + aggName + "]");
}
