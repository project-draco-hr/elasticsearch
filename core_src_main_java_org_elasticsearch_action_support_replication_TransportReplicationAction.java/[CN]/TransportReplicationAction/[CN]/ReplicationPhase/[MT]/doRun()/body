{
  if (pending.get() == 0) {
    doFinish();
    return;
  }
  ShardRouting shard;
  shardIt.reset();
  while ((shard=shardIt.nextOrNull()) != null) {
    if (shard.unassigned()) {
      continue;
    }
    if (shard.primary()) {
      if (originalPrimaryShard.currentNodeId().equals(shard.currentNodeId()) == false) {
        performOnReplica(shard,shard.currentNodeId());
      }
      if (shard.relocating()) {
        performOnReplica(shard,shard.relocatingNodeId());
      }
    }
 else     if (shouldExecuteReplication(indexMetaData.getSettings())) {
      performOnReplica(shard,shard.currentNodeId());
      if (shard.relocating()) {
        performOnReplica(shard,shard.relocatingNodeId());
      }
    }
  }
}
