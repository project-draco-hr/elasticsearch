{
  if (pending.get() == 0) {
    doFinish();
    return;
  }
  for (  ShardRouting shard : shards) {
    if (shard.primary() == false && executeOnReplica == false) {
      continue;
    }
    if (shard.unassigned()) {
      continue;
    }
    if (nodes.localNodeId().equals(shard.currentNodeId()) == false) {
      performOnReplica(shard);
    }
    if (shard.relocating() && nodes.localNodeId().equals(shard.relocatingNodeId()) == false) {
      performOnReplica(shard.buildTargetRelocatingShard());
    }
  }
}
