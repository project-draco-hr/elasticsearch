{
  for (  Map.Entry<String,String> entry : fields.entrySet()) {
    String oldFieldName=entry.getKey();
    if (document.hasField(oldFieldName) == false) {
      throw new IllegalArgumentException("field [" + oldFieldName + "] doesn't exist");
    }
    String newFieldName=entry.getValue();
    if (document.hasField(newFieldName)) {
      throw new IllegalArgumentException("field [" + newFieldName + "] already exists");
    }
    Object oldValue=document.getFieldValue(entry.getKey(),Object.class);
    document.setFieldValue(newFieldName,oldValue);
    try {
      document.removeField(oldFieldName);
    }
 catch (    Exception e) {
      document.removeField(newFieldName);
      throw e;
    }
  }
}
