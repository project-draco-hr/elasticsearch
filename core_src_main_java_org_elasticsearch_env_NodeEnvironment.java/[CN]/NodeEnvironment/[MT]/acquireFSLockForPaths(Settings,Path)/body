{
  Lock[] locks=new Lock[shardPaths.length];
  Directory[] dirs=new Directory[shardPaths.length];
  try {
    for (int i=0; i < shardPaths.length; i++) {
      Path p=shardPaths[i].resolve("index");
      dirs[i]=new SimpleFSDirectory(p,FsDirectoryService.buildLockFactory(indexSettings));
      try {
        locks[i]=Lucene.acquireWriteLock(dirs[i]);
      }
 catch (      IOException ex) {
        throw new LockObtainFailedException("unable to acquire " + IndexWriter.WRITE_LOCK_NAME + " for "+ p);
      }
    }
  }
  finally {
    IOUtils.closeWhileHandlingException(locks);
    IOUtils.closeWhileHandlingException(dirs);
  }
}
