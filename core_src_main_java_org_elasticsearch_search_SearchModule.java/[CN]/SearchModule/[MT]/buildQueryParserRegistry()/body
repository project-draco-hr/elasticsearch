{
  Map<String,QueryParser<?>> queryParsersMap=new HashMap<>();
  for (  Supplier<QueryParser<?>> parserSupplier : queryParsers) {
    QueryParser<? extends QueryBuilder<?>> parser=parserSupplier.get();
    for (    String name : parser.names()) {
      Object oldValue=queryParsersMap.putIfAbsent(name,parser);
      if (oldValue != null) {
        throw new IllegalArgumentException("Query parser [" + oldValue + "] already registered for name ["+ name+ "] while trying to register ["+ parser+ "]");
      }
    }
    namedWriteableRegistry.registerPrototype(QueryBuilder.class,parser.getBuilderPrototype());
  }
  for (  QueryRegistration<?> query : queries) {
    QueryParser<? extends QueryBuilder<?>> parser=query.parser;
    for (    String name : query.names) {
      Object oldValue=queryParsersMap.putIfAbsent(name,parser);
      if (oldValue != null) {
        throw new IllegalArgumentException("Query parser [" + oldValue + "] already registered for name ["+ name+ "] while trying to register ["+ parser+ "]");
      }
    }
    namedWriteableRegistry.register(QueryBuilder.class,query.names[0],query.reader);
  }
  return new IndicesQueriesRegistry(settings,queryParsersMap);
}
