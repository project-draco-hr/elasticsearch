{
  InnerHitsContext.BaseInnerHits innerHitsContext;
  if (nestedPath != null) {
    ObjectMapper nestedObjectMapper=context.getObjectMapper(nestedPath);
    ObjectMapper parentObjectMapper=context.nestedScope().getObjectMapper();
    innerHitsContext=new InnerHitsContext.NestedInnerHits(name,parentSearchContext,parentObjectMapper,nestedObjectMapper);
  }
 else   if (parentChildType != null) {
    DocumentMapper documentMapper=context.getMapperService().documentMapper(parentChildType);
    innerHitsContext=new InnerHitsContext.ParentChildInnerHits(name,parentSearchContext,context.getMapperService(),documentMapper);
  }
 else {
    throw new IllegalStateException("Neither a nested or parent/child inner hit");
  }
  setupInnerHitsContext(context,innerHitsContext);
  return innerHitsContext;
}
