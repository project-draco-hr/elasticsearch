{
  Path[] dirs=new Path[]{createTempDir(),createTempDir(),createTempDir()};
  for (  Path dir : dirs) {
    Files.write(dir.resolve("file1.txt"),"file1".getBytes(Charsets.UTF_8));
    Files.createDirectory(dir.resolve("dir"));
    Files.write(dir.resolve("dir").resolve("file2.txt"),"file2".getBytes(Charsets.UTF_8));
  }
  FileSystemUtils.moveFilesWithoutOverwriting(dirs[0],dst,".new");
  assertFileContent(dst,"file1.txt","file1");
  assertFileContent(dst,"dir/file2.txt","file2");
  FileSystemUtils.moveFilesWithoutOverwriting(dirs[1],dst,".new");
  assertFileContent(dst,"file1.txt","file1");
  assertFileContent(dst,"dir/file2.txt","file2");
  assertFileNotExists(dst.resolve("file1.txt.new"));
  assertFileNotExists(dst.resolve("dir").resolve("file2.txt.new"));
  Files.write(dirs[2].resolve("dir").resolve("file2.txt"),"UPDATED".getBytes(Charsets.UTF_8));
  FileSystemUtils.moveFilesWithoutOverwriting(dirs[2],dst,".new");
  assertFileContent(dst,"file1.txt","file1");
  assertFileContent(dst,"dir/file2.txt","file2");
  assertFileContent(dst,"dir/file2.txt.new","UPDATED");
}
