{
  Tuple<Settings,Environment> initialSettings=InternalSettingsPreparer.prepareSettings(EMPTY_SETTINGS,true);
  if (!initialSettings.v2().pluginsFile().exists()) {
    FileSystemUtils.mkdirs(initialSettings.v2().pluginsFile());
  }
  String url=null;
  OutputMode outputMode=OutputMode.DEFAULT;
  String pluginName=null;
  int action=ACTION.NONE;
  if (args.length < 1) {
    displayHelp(null);
  }
  try {
    for (int c=0; c < args.length; c++) {
      String command=args[c];
      if ("-u".equals(command) || "--url".equals(command) || "url".equals(command)|| "-url".equals(command)) {
        url=args[++c];
      }
 else       if ("-v".equals(command) || "--verbose".equals(command) || "verbose".equals(command)|| "-verbose".equals(command)) {
        outputMode=OutputMode.VERBOSE;
      }
 else       if ("-s".equals(command) || "--silent".equals(command) || "silent".equals(command)|| "-silent".equals(command)) {
        outputMode=OutputMode.SILENT;
      }
 else       if (command.equals("-i") || command.equals("--install") || command.equals("install")|| command.equals("-install")) {
        pluginName=args[++c];
        action=ACTION.INSTALL;
      }
 else       if (command.equals("-r") || command.equals("--remove") || command.equals("remove")|| command.equals("-remove")) {
        pluginName=args[++c];
        action=ACTION.REMOVE;
      }
 else       if (command.equals("-l") || command.equals("--list")) {
        action=ACTION.LIST;
      }
 else       if (command.equals("-h") || command.equals("--help")) {
        displayHelp(null);
      }
 else {
        displayHelp("Command [" + args[c] + "] unknown.");
        System.exit(EXIT_CODE_CMD_USAGE);
      }
    }
  }
 catch (  Throwable e) {
    displayHelp("Error while parsing options: " + e.getClass().getSimpleName() + ": "+ e.getMessage());
    System.exit(EXIT_CODE_CMD_USAGE);
  }
  if (action > ACTION.NONE) {
    int exitCode=EXIT_CODE_ERROR;
    PluginManager pluginManager=new PluginManager(initialSettings.v2(),url,outputMode);
switch (action) {
case ACTION.INSTALL:
      try {
        pluginManager.log("-> Installing " + pluginName + "...");
        pluginManager.downloadAndExtract(pluginName);
        exitCode=EXIT_CODE_OK;
      }
 catch (      IOException e) {
        exitCode=EXIT_CODE_IO_ERROR;
        pluginManager.log("Failed to install " + pluginName + ", reason: "+ e.getMessage());
      }
catch (      Throwable e) {
        exitCode=EXIT_CODE_ERROR;
        displayHelp("Error while installing plugin, reason: " + e.getClass().getSimpleName() + ": "+ e.getMessage());
      }
    break;
case ACTION.REMOVE:
  try {
    pluginManager.log("-> Removing " + pluginName + " ");
    pluginManager.removePlugin(pluginName);
    exitCode=EXIT_CODE_OK;
  }
 catch (  IOException e) {
    exitCode=EXIT_CODE_IO_ERROR;
    pluginManager.log("Failed to remove " + pluginName + ", reason: "+ e.getMessage());
  }
catch (  Throwable e) {
    exitCode=EXIT_CODE_ERROR;
    displayHelp("Error while removing plugin, reason: " + e.getClass().getSimpleName() + ": "+ e.getMessage());
  }
break;
case ACTION.LIST:
try {
pluginManager.listInstalledPlugins();
exitCode=EXIT_CODE_OK;
}
 catch (Throwable e) {
displayHelp("Error while listing plugins, reason: " + e.getClass().getSimpleName() + ": "+ e.getMessage());
}
break;
default :
pluginManager.log("Unknown Action [" + action + "]");
exitCode=EXIT_CODE_ERROR;
}
System.exit(exitCode);
}
}
