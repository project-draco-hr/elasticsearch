{
  Compressor compressor=CompressorFactory.compressor(data);
  if (compressor != null) {
    this.bytes=data.toBytes();
    this.crc32=crc32(new BytesArray(uncompressed()));
  }
 else {
    BytesStreamOutput out=new BytesStreamOutput();
    try (OutputStream compressedOutput=CompressorFactory.defaultCompressor().streamOutput(out)){
      data.writeTo(compressedOutput);
    }
     this.bytes=out.bytes().toBytes();
    this.crc32=crc32(data);
  }
  assertConsistent();
}
