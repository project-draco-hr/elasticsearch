{
synchronized (mutex) {
    StoreFileMetaData fromMetaData=filesMetadata.get(from);
    if (fromMetaData == null) {
      throw new FileNotFoundException(from);
    }
    directoryService.renameFile(fromMetaData.directory(),from,to);
    StoreFileMetaData toMetaData=new StoreFileMetaData(to,fromMetaData.length(),fromMetaData.lastModified(),fromMetaData.checksum(),fromMetaData.directory());
    filesMetadata=MapBuilder.newMapBuilder(filesMetadata).remove(from).put(to,toMetaData).immutableMap();
    files=filesMetadata.keySet().toArray(new String[filesMetadata.size()]);
  }
}
