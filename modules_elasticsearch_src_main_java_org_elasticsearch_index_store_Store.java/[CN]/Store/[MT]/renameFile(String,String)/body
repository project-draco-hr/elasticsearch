{
  directoryService.renameFile(directory.delegate(),from,to);
synchronized (mutex) {
    StoreFileMetaData fromMetaData=filesMetadata.get(from);
    StoreFileMetaData toMetaData=new StoreFileMetaData(to,fromMetaData.length(),fromMetaData.lastModified(),fromMetaData.checksum());
    filesMetadata=MapBuilder.newMapBuilder(filesMetadata).remove(from).put(to,toMetaData).immutableMap();
    files=filesMetadata.keySet().toArray(new String[filesMetadata.size()]);
  }
}
