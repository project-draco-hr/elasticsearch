{
  if (!lifecycle.started()) {
    return;
  }
  if (event.state().blocks().disableStatePersistence()) {
    return;
  }
  if (event.localNodeMaster()) {
    if (!event.metaDataChanged()) {
      return;
    }
    writeStateExecutor.execute(new Runnable(){
      @Override public void run(){
        logger.debug("writing to gateway {} ...",this);
        StopWatch stopWatch=new StopWatch().start();
        try {
          write(event.state().metaData());
          logger.debug("wrote to gateway {}, took {}",this,stopWatch.stop().totalTime());
        }
 catch (        Exception e) {
          logger.error("failed to write to gateway",e);
        }
      }
    }
);
  }
}
