{
  StringBuilder message=new StringBuilder();
  int cnt=1;
  final Formatter f=new Formatter(message,Locale.ENGLISH);
  for (  Map.Entry<Thread,StackTraceElement[]> e : threads.entrySet()) {
    if (e.getKey().isAlive()) {
      f.format(Locale.ENGLISH,"\n  %2d) %s",cnt++,threadName(e.getKey())).flush();
    }
    if (e.getValue().length == 0) {
      message.append("\n        at (empty stack)");
    }
 else {
      for (      StackTraceElement ste : e.getValue()) {
        message.append("\n        at ").append(ste);
      }
    }
  }
  return message.toString();
}
