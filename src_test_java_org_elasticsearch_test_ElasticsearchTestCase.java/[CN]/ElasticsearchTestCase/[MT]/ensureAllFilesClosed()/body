{
  try {
    for (    final MockDirectoryHelper.ElasticsearchMockDirectoryWrapper w : MockDirectoryHelper.wrappers) {
      try {
        awaitBusy(new Predicate<Object>(){
          @Override public boolean apply(          Object input){
            return !w.isOpen();
          }
        }
);
      }
 catch (      InterruptedException e) {
        Thread.interrupted();
      }
      if (!w.successfullyClosed()) {
        if (w.closeException() == null) {
          w.close();
          if (w.closeException() != null) {
            throw w.closeException();
          }
        }
 else {
          throw w.closeException();
        }
      }
      assertThat(w.isOpen(),is(false));
    }
  }
  finally {
    forceClearMockWrappers();
  }
}
