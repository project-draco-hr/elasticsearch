{
  this.type=type;
  this.source=new CompressedString(XContentFactory.jsonBuilder().map(mapping).string());
  Map<String,Object> withoutType=mapping;
  if (mapping.size() == 1 && mapping.containsKey(type)) {
    withoutType=(Map<String,Object>)mapping.get(type);
  }
  if (withoutType.containsKey("_routing")) {
    boolean required=false;
    String path=null;
    Map<String,Object> routingNode=(Map<String,Object>)withoutType.get("_routing");
    for (    Map.Entry<String,Object> entry : routingNode.entrySet()) {
      String fieldName=Strings.toUnderscoreCase(entry.getKey());
      Object fieldNode=entry.getValue();
      if (fieldName.equals("required")) {
        required=nodeBooleanValue(fieldNode);
      }
 else       if (fieldName.equals("path")) {
        path=fieldNode.toString();
      }
    }
    this.routing=new Routing(required,path);
  }
 else {
    this.routing=Routing.EMPTY;
  }
}
