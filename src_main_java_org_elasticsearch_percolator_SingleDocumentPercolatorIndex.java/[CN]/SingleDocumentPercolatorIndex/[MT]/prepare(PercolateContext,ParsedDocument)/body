{
  MemoryIndex memoryIndex=cache.get();
  for (  IndexableField field : parsedDocument.rootDoc().getFields()) {
    if (field.fieldType().indexOptions() == IndexOptions.NONE && field.name().equals(UidFieldMapper.NAME)) {
      continue;
    }
    try {
      Analyzer analyzer=context.mapperService().documentMapper(parsedDocument.type()).mappers().indexAnalyzer();
      TokenStream tokenStream=field.tokenStream(analyzer,null);
      if (tokenStream != null) {
        memoryIndex.addField(field.name(),tokenStream,field.boost());
      }
    }
 catch (    IOException e) {
      throw new ElasticsearchException("Failed to create token stream",e);
    }
  }
  context.initialize(new DocEngineSearcher(memoryIndex),parsedDocument);
}
