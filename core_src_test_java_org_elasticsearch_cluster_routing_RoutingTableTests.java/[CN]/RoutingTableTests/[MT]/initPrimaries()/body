{
  logger.info("adding " + (this.numberOfReplicas + 1) + " nodes and performing rerouting");
  Builder discoBuilder=DiscoveryNodes.builder();
  for (int i=0; i < this.numberOfReplicas + 1; i++) {
    discoBuilder=discoBuilder.put(newNode("node" + i));
  }
  this.clusterState=ClusterState.builder(clusterState).nodes(discoBuilder).build();
  RoutingAllocation.Result rerouteResult=ALLOCATION_SERVICE.reroute(clusterState);
  this.testRoutingTable=rerouteResult.routingTable();
  assertThat(rerouteResult.changed(),is(true));
  this.clusterState=ClusterState.builder(clusterState).routingTable(rerouteResult.routingTable()).build();
}
