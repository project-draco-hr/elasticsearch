{
  long startTime=System.currentTimeMillis();
  logger.info("--> Testing old index " + index);
  String indexName=loadIndex(index);
  client().admin().cluster().prepareReroute().get();
  ensureClosed(indexName);
  try {
    client().admin().indices().prepareOpen(indexName).get();
    fail("Shouldn't be able to open an old index");
  }
 catch (  IndexException ex) {
    assertThat(ex.getMessage(),containsString("cannot open the index due to upgrade failure"));
  }
  unloadIndex(indexName);
  logger.info("--> Done testing " + index + ", took "+ ((System.currentTimeMillis() - startTime) / 1000.0)+ " seconds");
}
