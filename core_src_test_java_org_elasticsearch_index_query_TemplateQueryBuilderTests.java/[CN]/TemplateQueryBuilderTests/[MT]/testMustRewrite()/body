{
  String query="{ \"match_all\" : {}}";
  QueryBuilder<?> builder=new TemplateQueryBuilder(new Template(query,ScriptType.INLINE,"mockscript",XContentType.JSON,Collections.emptyMap()));
  try {
    builder.toQuery(queryShardContext());
    fail();
  }
 catch (  UnsupportedOperationException ex) {
    assertEquals("this query must be rewritten first",ex.getMessage());
  }
  assertEquals(new MatchAllQueryBuilder(),builder.rewrite(queryShardContext()));
}
