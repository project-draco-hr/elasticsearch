{
  if (hasParentBucketAggregator(parent)) {
    return false;
  }
  final long maxNumUniqueValues=valuesSource.metaData().maxAtomicUniqueValuesCount();
  if (maxNumUniqueValues == -1) {
    return false;
  }
  int maxDoc=0;
  for (  AtomicReaderContext ctx : context.searchContext().searcher().getTopReaderContext().reader().leaves()) {
    maxDoc=Math.max(maxDoc,ctx.reader().maxDoc());
  }
  if (maxNumUniqueValues > (maxDoc >>> 4)) {
    return false;
  }
  return true;
}
