{
  long estimatedBucketCount=valuesSource.metaData().maxAtomicUniqueValuesCount();
  if (estimatedBucketCount < 0) {
    estimatedBucketCount=50;
  }
  estimatedBucketCount=Math.min(estimatedBucketCount,512);
  if (Aggregator.hasParentBucketAggregator(parent)) {
    estimatedBucketCount=Math.min(estimatedBucketCount,8);
  }
  return estimatedBucketCount;
}
