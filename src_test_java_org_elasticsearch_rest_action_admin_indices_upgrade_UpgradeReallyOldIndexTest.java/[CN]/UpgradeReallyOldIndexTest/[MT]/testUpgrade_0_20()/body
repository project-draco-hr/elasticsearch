{
  assertFalse("test infra is broken!",LuceneTestCase.OLD_FORMAT_IMPERSONATION_IS_ACTIVE);
  File dataDir=prepareBackwardsDataDir(new File(getClass().getResource("index-0.20.zip").toURI()));
  internalCluster().startNode(ImmutableSettings.builder().put("path.data",dataDir.getPath()).put("gateway.type","local").put(InternalNode.HTTP_ENABLED,true).build());
  ensureGreen("test");
  assertIndexSanity();
  HttpRequestBuilder httpClient=httpClient();
  UpgradeTest.assertNotUpgraded(httpClient,"test");
  UpgradeTest.runUpgrade(httpClient,"test","wait_for_completion","true");
  UpgradeTest.assertUpgraded(httpClient,"test");
}
